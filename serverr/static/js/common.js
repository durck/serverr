(window.webpackJsonp=window.webpackJsonp||[]).push([["common"],{"+YbT":function(e,t){var n={obj:null,highlight:!1,start:function(e){e.touches&&1==e.touches.length&&(n.clear(),n.end(e),n.obj=this||null,n.obj&&(n.highlight=!0,addClass("hover",n.obj),addClass("_thover",n.obj)))},cancel:function(e){n.obj&&(n.highlight=!1,n.end(e))},end:function(){n.obj&&(removeClass("hover",n.obj),n.highlight&&(n.clear(),addClass("active",n.obj)),n.obj=null,n.highlight=!1)},clear:function(){removeClass("active",geByClass1("active","vk_wrap")),removeClass("active",$(".Popup .active._thover"))}};window.thover=n},"+cqQ":function(e,t,n){"use strict";function i(){var e=[],t=function(){var e=this,t=arguments;if("function"!=typeof t[0]){for(var n=e.length,i=!1,a=0;a<n;a++)!0===e[a].apply(null,t)&&(i=!0);return i}Array.prototype.slice.call(t).forEach(function(t){return e.push(t)})}.bind(e);return t.off=function(e){e?function(e,t){for(;;){var n=e.indexOf(t);if(!(n>=0))break;e.splice(n,1)}}(this,e):this.length=0}.bind(e),t._fns=e,t}n.r(t),t.default=Object.assign(i,{kind:function(){var e={};return function(t){return e[t]||(e[t]=i())}}}),window.befall=i},"/8IX":function(e,t){function n(e,t){if(!e)throw new Error(t||"AssertionError")}n.notEqual=function(e,t,i){n(e!=t,i)},n.notOk=function(e,t){n(!e,t)},n.equal=function(e,t,i){n(e==t,i)},n.ok=n,e.exports=n},"/Id8":function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("TYsd"),r=n("9y81"),s=n("KMpi"),l=n("u33z"),c=n("B+U2"),u=n("BoyB"),d=n("fdw3");function f(){var e=Object(i.default)(['\n    <div class="msg__keyboard">\n      ',"\n    </div>\n  "]);return f=function(){return e},e}function _(){var e=Object(i.default)(['\n    <a class="','"\n      href="','"\n      ',"\n      ",'\n      style="width: ',"px; height: ",'px;"\n    >\n      <img class="msg__stickerImg sticker_img" height="','" src="','">\n    </a>\n  ']);return _=function(){return e},e}function p(){var e=Object(i.default)(['\n    <div class="msg__stickerWrap">\n      ',"\n    </div>\n  "]);return p=function(){return e},e}function h(){var e=Object(i.default)(['\n    <a href="','" class="msg__replyLink" ',">\n      ","\n    </a>\n  "]);return h=function(){return e},e}function m(){var e=Object(i.default)(['\n    <div class="msg__replyAttach">',"</div>\n  "]);return m=function(){return e},e}function A(){var e=Object(i.default)(['\n    <div class="msg__bodyPreview">\n      ',"\n      ","\n    </div>\n  "]);return A=function(){return e},e}function v(){var e=Object(i.default)(['\n    <div class="msg__reply">\n      ','\n      <div class="msg__replyInner">\n        <div class="msg__replyHead">\n          <div class="msg__replyHeadRow">\n            <div class="msg__replyName">','</div>\n            <div class="msg__replyDate">','</div>\n          </div>\n        </div>\n        <div class="msg__replyBody">\n          ',"\n        </div>\n      </div>\n    </div>\n  "]);return v=function(){return e},e}function g(){var e=Object(i.default)(['\n    <div class="msg__info msg__restoreText msg__restoreText_remove">\n      ','\n      <span class="msg__restoreText msg__infoLink" ',">\n        ",'\n      </span>\n    </div>\n    <div class="msg__info msg__restoreText msg__restoreText_spam">\n      ','\n      <span class="msg__restoreText msg__infoLink" ',">\n        ","\n      </span>\n    </div>\n  "]);return g=function(){return e},e}function b(){var e=Object(i.default)(['\n    <span class="msg__edited">\n      <span class="msg__editedMiddot">&middot;</span><span class="msg__editedText">',"</span>\n    </span>\n  "]);return b=function(){return e},e}function y(){var e=Object(i.default)(['\n    <div class="msg__admin">\n      (<a class="msg__adminLink" href="','">',"</a>)\n    </div>\n  "]);return y=function(){return e},e}function w(){var e=Object(i.default)(['\n    <div class="msg__actions">\n      ',"\n    </div>\n  "]);return w=function(){return e},e}function C(){var e=Object(i.default)(['\n    <div class="msg_item','">\n      <div class="mi_header">\n        ','\n        <a class="msg__author" href="','">','</a>\n        <div class="msg__date">',"</div>\n        ","\n      </div>\n      ","\n      ","\n      ","\n      ","\n    </div>\n  "]);return C=function(){return e},e}function k(){var e=Object(i.default)(['\n    <div class="msg__detailed">\n      <div class="msg__detailedHead">\n        ','\n        <div class="msg__detailedInfo">\n          <div class="msg__detailedRow">\n            <a class="msg__detailedAuthor" href="','">','</a>\n            <span class="msg__detailedPeer">','</span>\n          </div>\n          <div class="msg__detailedRow">\n            <div class="msg__date">','</div>\n          </div>\n        </div>\n      </div>\n      <div class="msg__content">\n        <div class="msg__text">\n          ',"\n        </div>\n        ","\n      </div>\n    </div>\n  "]);return k=function(){return e},e}function S(){var e=Object(i.default)(['\n    <div class="msg_item _msg single_msg_item msg__text">\n      <div class="msg__giftMedia">',"</div>\n      ","\n    </div>\n  "]);return S=function(){return e},e}function E(){var e=Object(i.default)(['\n    <div class="msg_item _msg single_msg_item msg__text">\n      <div class="mi_cont">\n        <div class="mi_body">\n          ',"\n          ","\n          ","\n          ","\n        </div>\n      </div>\n    </div>\n  "]);return E=function(){return e},e}function O(){var e=Object(i.default)(["\n    ",'\n    <div class="msg__content">\n      <div class="msg__head">\n        <a class="msg__author" href="','">',"</a>\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n      </div>\n      ",'\n      <div class="msg__text">\n        ',"\n      </div>\n      ",'\n    </div>\n    <div class="msg__restore">\n      ',"\n    </div>\n  "]);return O=function(){return e},e}function T(){var e=Object(i.default)(['\n    <div class="','" ',">\n      ","\n    </div>\n  "]);return T=function(){return e},e}var D=function(e){var t=e.id,n=e.removed,i=e.service,o=function(e){var t=window.lang;if(e.service)return e.text;var n,i=Object(s.default)({mix:"msg__avatar",url:e.authorUrl,photos:[e.authorPhoto],size:40}),o=Object(r.default)({mix:"msg__check",icon:"check"}),c=Object(r.default)({mix:"msg__star",icon:"star",blue:!0}),u=!!e.attaches.gift,d=store.mail.msgs[e.id];d&&d.authorId===d.peerId&&(n=store.mail.peers[d.peerId]);var f,_=e.admin?(E=e.admin,a.default.html(y(),E.url,E.name)):"",p=e.removed?x(e.id):"",h=e.edited?M():"",m=e.pending||e.failed?"":'<div class="msg__date">'+e.date+"</div>",A=e.pending?'<div class="msg__pending"></div>':"",v=e.failed?'<div class="msg__error">'+t.mobile_mail_send_error+"</div>":"",g=e.channel?(C=e.id,k=Object(l.default)({class:"msg__actionForward",onClick:a.default.onClick("Msg._onActionClick","event","forward",C)}),a.default.html(w(),k)):"",b=u&&n?'<div class="msg__giftHead">'+langSex(n.sex,t.mobile_mail_sent_gift)+"</div>":"";var C,k;var E;f=u?function(e){var t=e.text,n=e.attachesHTML;t&&(t='<div class="msg__giftText">'+t+"</div>");return a.default.html(S(),n,t)}(e):j(e);var T=e.keyboard?V(e):"";return a.default.html(O(),i,e.authorUrl,e.authorName,b,m,A,v,h,_,o,c,g,f,T,p)}(e),c=!i&&!(!e.attaches||!e.attaches.gift),u=a.default.class("msg",{id:t,service:i,unread:e.unread&&!e.failed,important:e.important,removed:!!n,spam:"spam"===n,pending:e.pending,failed:e.failed,gift:c}),d="";i||(d=e.pending||e.failed?a.default.onClick("Msg._onPendingClick","event","this",t,e.sendId||"",!!e.failed):a.default.onClick("Msg._onClick","event","this",t));return a.default.html(T(),u,d,o)};function j(e){var t,n,i=window.lang,o=e.text,r=0;e.attachesHTML?t=e.attachesHTML:e.attaches.sticker&&e.sticker?(n=function(e,t,n,i,o,r,s){void 0===i&&(i=""),void 0===o&&(o=!0),void 0===r&&(r=""),void 0===s&&(s="");var l=Date.now(),c=Math.random(),u=""+l+c,d="msg__sticker",f="";s&&(d+=" sticker_animation",f='\n      data-animation-path="'+s+'"\n      data-uniq-id="'+u+'"\n      data-sticker-id="'+e+'"\n      data-loop-count="3"\n      ontouchstart="StickersAnimation.touchStartSticker(this);"\n      ontouchend="StickersAnimation.touchEndSticker(this);"\n    ');var p=a.default.onClick("Msg._onStickerClick","event","this",o,i);return a.default.html(_(),d,r,p,f,t,t,t,n)}(e.sticker.id,e.sticker.height,e.sticker.url),t=a.default.html(p(),n)):W(e)&&Object.keys(e.attaches).length&&(r+=1,t=F(N(e),!e.failed&&1===r));var l,c=e.forwards;c.length&&(W(e)&&q(c)?(r+=1,l=F(langNumeric(c.length,i.mobile_mail_N_forwards),!e.failed&&1===r)):l=(l=c.map(function(t){return function e(t,n,i){var o=window.lang;var r=store.mail;var l=r.forwards[t]||r.msgs[t];if(!l)return"";var c=r.members[l.authorId];var u=l.peerId;r.peers[u];var d=$(c,u,r.cur.userId);var f=l.edited;var _=c.avatar;var p=c.url;var h=d;var m=l.date;var A=l.text;var v=l.attachesHTML;var g=l.forwards;var b=l.reply;var y=Object(s.default)({mix:"mi_author_photo",photos:[_],size:36});var w=f?M():"";var k;if(i>0){for(var S=[],E=g.length,O=0;O<E;O++){var T=e(g[O],n,i-1);S.push(T)}k=S.join("")}else if(g.length){var D=langNumeric(g.length,o.mobile_mail_N_forwards);k='<a href="/mail?act=msg&id='+n+'" class="msg__fwdsLink">'+D+"</a>"}v&&(v='<div class="mi_medias">'+(v=v.replace(/%top_msg_id%/g,n))+"</div>");k&&(k='<div class="mi_forwarded">'+k+"</div>");A&&(A='<div class="mi_text">'+A+"</div>");var j=b?P(b,n):"";var I=!!l.attaches.gift;var x=I?" msg__forwardGift":"";return a.default.html(C(),x,y,p,h,m,w,j,A,v,k)}(t,e.id,e.maxDepth-1)})).join(""));var u,f=e.reply;f&&(W(e)&&(q([f])||!function(e){var t=store.mail;return Object(d.isForwardedMessageId)(e)?!!t.replies[e]:!!t.pendingReplies[e]}(f))?(r+=1,u=F(i.mobile_mail_in_reply_to,!e.failed&&1===r)):u=P(f,e.id));return t&&(t='<div class="mi_medias">'+t+"</div>"),l&&(l='<div class="mi_forwarded">'+l+"</div>"),o&&(o='<div class="mi_text">'+o+"</div>"),a.default.html(E(),u,o,t,l)}function I(e){var t=j(e),n=e.keyboard?V(e):"",i=Object(s.default)({mix:"msg__avatar",url:e.authorUrl,photos:[e.authorPhoto],size:40}),o=function(e){var t=window.lang,n=store.mail,i=n.msgs[e.id],a=n.peers[i.peerId],o="";if(Object(d.isChatPeer)(i.peerId)){var r='<a href="'+Object(d.wrapCommunityMailUrl)("/mail?act=show&peer="+i.peerId)+'">'+a.title+"</a>";o=t.mobile_mail_message_to_chat.replace("{chat}",r)}return o}(e);return a.default.html(k(),i,e.authorUrl,e.authorName,o,e.date,t,n)}function M(){var e=window.lang;return a.default.html(b(),e.mobile_mail_edited_short)}function x(e){var t=window.lang,n=a.default.onClick("Msg._onRestoreClick","event",e);return a.default.html(g(),t.mobile_msg_mail_message_deleted,n,t.mobile_restore,t.mobile_msg_mail_message_marked_as_spam,n,t.mobile_restore)}function B(e,t,n){var i="/mail?act=msg";return t?(i=Object(d.concatValues)(i,"&id="+t+"&reply=true"),n&&(i=Object(d.concatValues)(i,"&reply_id="+n))):i=Object(d.concatValues)(i,"&id="+e),Object(d.wrapCommunityMailUrl)(i)}function P(e,t){var n=store.mail.forwards[e]||store.mail.msgs[e],i=store.mail.replies[e]||store.mail.pendingReplies[e];return U(L(n,$(store.mail.members[n.authorId],n.peerId,store.mail.cur.userId),i.preview_url),i.msg_id,t,e)}function L(e,t,n){var i=e.body?R(e.body):H(e),o="";return(e.attaches.photo||e.attaches.video||e.attaches.doc)&&(o=n?'<div class="msg__replyPreview"\n        style="background-image: url('+n+')"></div>':e.attaches.doc?'<div class="msg__replyPreview msg__replyPreview_icon">\n        <div class="msg__replyPreviewDoc"></div>\n      </div>':'<div class="msg__replyPreview msg__replyPreview_empty"></div>'),a.default.html(v(),o,t,e.date,i)}function R(e){return e=e.replace(/<br>/g,"\n"),e=Object(d.mailReplaceDomainMentions)(e,"@$3"),e=Object(d.mailReplaceMentions)(e,"$3"),e=Object(d.emojiToHTML)(e)}function N(e){var t,n=window.lang,i=Object.keys(e.attaches),a=i.length;if(a>1){for(var o=0,r=i.length,s=0;s<r;s++)o+=0|e.attaches[i[s]];t=langNumeric(o,n.mobile_mail_attachments)}else if(1===a){var l=i[0],c=e.attaches[l];if(1===c)switch(l){case"poll":t=n.mobile_mail_added_poll;break;case"article":t=n.global_article;break;case"photo":t=n.mobile_mail_added_photo;break;case"video":t=n.mobile_mail_added_video;break;case"audio":t=n.mobile_mail_added_audio;break;case"audio_playlist":t=n.mobile_mail_added_audio_playlist;break;case"money_transfer":t=n.mobile_mail_added_money_transfer;break;case"podcast":t=n.mobile_mail_added_podcast;break;case"money_request":t=n.mobile_mail_added_money_request;break;case"vkpay":t=n.mobile_mail_added_vkpay;break;case"story":t=n.mobile_mail_added_story;break;case"graffiti":t=n.mobile_mail_added_graffiti;break;case"audiomsg":t=n.mobile_mail_added_audiomsg;break;case"doc":t=n.mobile_mail_added_doc;break;case"geo":case"map":t=n.mobile_mail_added_geo;break;case"wall":t=n.mobile_mail_added_wall;break;case"wall_reply":t=n.mobile_mail_added_wall_reply;break;case"gift":t=n.mobile_mail_added_gift;break;case"link":t=n.mobile_mail_added_link;break;case"sticker":t=n.mobile_mail_added_sticker;break;case"market":t=n.mobile_mail_added_market_item;break;case"call":t=n.mobile_mail_added_call}else if(c>1)switch(l){case"photo":t=langNumeric(c,n.mobile_mail_added_photos);break;case"video":t=langNumeric(c,n.mobile_mail_added_videos);break;case"audio":t=langNumeric(c,n.mobile_mail_added_audios);break;case"doc":t=langNumeric(c,n.mobile_mail_added_docs)}}var u=e.forwards&&e.forwards.length||e.hasReply;return!t&&u&&(t=e.hasReply?langNumeric(1,n.mobile_mail_messages):langNumeric(e.forwards.length,n.mobile_mail_N_forwards)),t||""}function F(e,t){var n;return t&&(n='<div class="msg__loading">'+(n=Object(u.default)({large:!0}))+"</div>"),a.default.html(A(),e,n)}function H(e){var t=N(e);return a.default.html(m(),t)}function U(e,t,n,i){var o=B(t,n,i),r=a.default.onClick("Msg._onReplyClick","event",t,n,i);return a.default.html(h(),o,r,e)}function V(e){var t=o.default.render(Object(c.default)({keyboard:e.keyboard,msgId:e.id}));return a.default.html(f(),t)}function $(e,t,n){return t>2e9?e.name:t>-2e9&&t<0?e.id===n?e.firstName:e.name:e.firstName}function q(e){for(var t=store.mail.msgs,n=store.mail.members,i=store.mail.forwards,a=e.length,o=0;o<a;o++){var r=e[o];if(Object(d.isForwardedMessageId)(r)){var s=i[r];if(!s)return!0;if(!s.authorId||!n[s.authorId])return!0}else{var l=t[r];if(!l)return!0;if(!l.authorId||!n[l.authorId])return!0}}return!1}function W(e){return e.pending||e.failed||e.waiting}var z=n("UxAg"),Q=n("+cqQ"),Y=n("Gzds"),X=n("OcsD"),G=need("Voting");Object.assign(D,{class:"msg",onClick:Object(Q.default)(),onPendingClick:Object(Q.default)(),onRestoreClick:Object(Q.default)(),onReplyClick:Object(Q.default)(),onForward:Object(Q.default)(),onLoadAgain:Object(Q.default)(),getElem:function(e){return Object(z.$)(".msg_id_"+e)},remove:function(e,t){void 0===t&&(t=!1);t?Object(z.$$)(".msg_id_"+e).forEach(function(e){return e.remove()}):ie(e,!1)},spam:function(e){ie(e,!0)},restore:function(e){Object(z.$$)(".msg_id_"+e).forEach(function(e){e.classList.remove("msg_removed"),e.classList.remove("msg_spam")})},unselectAll:function(){Object(z.$$)(".msg_selected").forEach(function(e){return e.classList.remove("msg_selected")})},getReplyDataFromHTML:function(e){var t=e&&D.getElem(e),n="";if(t){var i=Object(z.$)(".thumbs_map .thumb_map_img_as_div",t);return(n=i&&i.style.backgroundImage)&&(n=n.replace(/^url\((['"])?/,"").replace(/(['"])?\)$/,"")),{msg_id:e,parent_id:null,preview_url:n}}return null},toggleImportant:function(e,t){[].concat(e).forEach(function(e){var n=Object(z.$)(".msg_id_"+e);n&&n.classList.toggle("msg_important",t)})},markAsRead:function(e){Object(z.$$)(".msg_id_"+e).forEach(function(e){return e.classList.remove("msg_unread")})},getId:function(e){var t=a.default.parseClass(J.msg,e.className);return Number(t.id)},getTextHtml:function(e){return e.$(Z.text).innerHTML}}),D._onClick=ae,D._onPendingClick=oe,D._onTouchStart=se,D._onRestoreClick=ne,D._onActionClick=le,D._onReplyClick=ue,D._onStickerClick=de,D.onStickerTouchStart=fe;var K,J={msg:"msg"},Z={text:".msg__text"},ee=500,te=!1;function ne(e,t){e.stopPropagation(),t=parseInt(t,10),D.onRestoreClick(t)}function ie(e,t){void 0===t&&(t=!1);var n=x(e);Object(z.$$)(".msg_id_"+e).forEach(function(e){e.$(".msg__restore").innerHTML=n,e.classList.remove("msg_selected"),e.classList.add("msg_removed"),e.classList.toggle("msg_spam",t)})}function ae(e,t,n){re(e.target,t,function(){t.classList.toggle("msg_selected"),D.onClick(n)})}function oe(e,t,n,i,a){re(e.target,t,function(){D.onPendingClick(n,i,a)})}function re(e,t,n){for(var i=t.classList.contains("msg_pending")||t.classList.contains("msg_failed");e!==t;)if(i&&-1!==e.className.indexOf("msg__sticker"))e=e.parentElement;else{if("A"===e.tagName||"BUTTON"===e.tagName||e.getAttribute("onclick")||e.classList.contains("im_msg_audiomsg")||e.classList.contains("articleSnippet__block")||e.classList.contains("MailButton")||e.closest("."+G.cls))return;e=e.parentElement}te?te=!1:ce()||t.classList.contains("msg_removed")||t.classList.contains("msg_spam")||store.mail.cur.editing||n()}function se(){ce()&&(te=!0)}function le(e,t,n){switch(t){case"forward":D.onForward(n)}}function ce(){return window.getSelection().toString().length>0}function ue(e,t,n,i){e.preventDefault(),D.onReplyClick(t,n,i)}function de(e,t,n,i){n&&(e.preventDefault(),i&&Y.default.stickersClick(t,i))}function fe(e,t){if(clearTimeout(K),!!t.getAttribute("data-animation-path")){var n=e.touches[0].clientX,i=e.touches[0].clientY;Object(X.addEvent)(t,"contextmenu",_e),Object(X.addEvent)(t,"touchmove",a,{passive:!0}),Object(X.addEvent)(t,"touchend",o,{passive:!0}),Object(X.addEvent)(t,"touchcancel",o,{passive:!0}),K=setTimeout(function(){!function(e){StickersAnimation.loadAndPlaySticker(e)}(t),o()},ee)}function a(e){(Math.abs(e.touches[0].clientX-n)>=10||Math.abs(e.touches[0].clientY-i)>=10)&&o()}function o(){clearTimeout(K),Object(X.removeEvent)(t,"contextmenu",_e),Object(X.removeEvent)(t,"touchmove",a,{passive:!0}),Object(X.removeEvent)(t,"touchend",o,{passive:!0}),Object(X.removeEvent)(t,"touchcancel",o,{passive:!0})}}function _e(e){event.preventDefault(),event.stopPropagation()}n.d(t,"Msg__restoreInner",function(){return x}),n.d(t,"Msg__reply",function(){return L}),n.d(t,"Msg__authorName",function(){return $}),n.d(t,"Msg__replyAttach",function(){return H}),n.d(t,"Msg__replyLink",function(){return U}),n.d(t,"Msg__textPreview",function(){return R}),n.d(t,"Msg__attachPreview",function(){return N}),n.d(t,"Msg_makeReplyLink",function(){return B}),n.d(t,"Msg_detailed",function(){return I});t.default=D;window.Msg=D},"/Rzu":function(e,t,n){"use strict";n.r(t);n("bZ/P");var i=n("TYsd"),a=(n("Mc5h"),n("s0aB")),o=n("7jQU"),r=n("/Id8"),s=n("fdw3"),l=function(e,t){void 0===t&&(t=null);var n="last"===t,i=store.mail,o=i.peers[e],r=o.url,s=null;if(t){var l;n||(r=r+"&msg="+t),(l=n?_(e):i.msgs[t])&&(s={text:c(l),date:l.dateShort,unreadCount:d(e),muted:o.isMuted,typing:p(e),pending:l.pending,failed:l.failed})}return Object(a.default)({id:e,url:r,photos:o.avatarImages,title:o.title,online:u(o),important:o.isImportant,profileUrl:o.profileUrl,isLast:n,more:s})};function c(e){var t=window.lang,n=store.mail,a=!!e.attaches.call;if(e.isService&&!a)return i.default.html({tag:"span",inner:[i.default.wrap(e.serviceText)]});var o=e.body?i.default.wrap(Object(r.Msg__textPreview)(e.body)):function(e){return{tag:"span",class:"convo__msgAttach",inner:Object(r.Msg__attachPreview)(e)}}(e),l="";return e.authorId===n.cur.userId&&e.peerId!==n.cur.userId?l=t.mobile_mail_you:Object(s.isChatPeer)(e.peerId)&&(l=(l=n.members[e.authorId].shortName).replace(/\.$/,"")),l&&(l+=": "),i.default.html({tag:"span",inner:[i.default.wrap(l),o]})}function u(e){return!!e.isOnline&&("desktop"===e.onlinePlatform?"desktop":"mobile")}function d(e){var t=function(e){return store.mail.peers[e]}(e).countUnread;if(0===t){var n=store.mail,i=_(e);i&&i.isUnread&&i.authorId===n.cur.viewerId&&(t=-1)}return t}function f(e){var t=store.mail,n=t.rolls.peer[e],i=t.presend&&t.presend.pending[e],a=t.presend&&t.presend.failed[e];if(i&&i.length)for(var o=i.length-1;o>=0;o--){var r=i[o];if(-1===r.indexOf("edit"))return r}if(a&&a.length)for(var s=a.length-1;s>=0;s--){var l=a[s];if(-1===l.indexOf("edit"))return l}return n&&n.length?last(n):null}function _(e){var t=store.mail.msgs,n=store.mail.presend,i=n&&n.msgs,a=f(e);return i&&i[a]?i[a]:a?t[a]:null}function p(e){var t,n,i=Object(o.uTyping_getPeerTyping)(e),a=i&&1===i.count&&i.users[0]===e;return i?("mixed"===i.type?(t="simple-dots",n="mixed"):"audio"===i.type?(t="audio",n="audio"):"text"===i.type&&(t="simple-dots",n=""),{typing:!!a||Object(o.uTyping_getNames)(i),typingCount:i.count,animation:t,text:n,dimmed:!1,compact:!0}):""}n("+cqQ");Object.assign(l,{onTap:a.default.onTap,redrawOnline:function(e){var t=store.mail.peers[e];if(t){var n=u(t);a.default.setOnline(e,n)}},redrawUnread:function(e){if(!store.mail.peers[e])return;var t=d(e);a.default.setUnreadCount(e,t)},redrawLastMsg:function(e){var t=_(e);t&&a.default.setLastMsg(e,c(t),{dateShort:t.dateShort,pending:t.pending,failed:t.failed})},redrawTyping:function(e){if(!store.mail.cur)return;var t=Object(o.uTyping_getPeerTyping)(e),n=(t&&1===t.count&&t.users[0],p(e));a.default.setTyping(e,n)},redrawImportant:function(e,t){a.default.setImportant(e,t)}}),n.d(t,"uConvo_getLastMsgId",function(){return f});t.default=l;window.uConvo=l},"03kU":function(e,t,n){"use strict";n.r(t);var i=n("OmnB"),a=n.n(i),o=100,r=101,s=102,l=103,c=105,u=106,d=107,f=108,_=109,p=110,h=112,m=113,A=[r,l,s,u,d,f,_,p],v={clickOnVideo:"click_on_video",clickOnAudio:"click_on_audio",clickOnPhoto:"click_on_photo",clickOnExternalLink:"external_link_click",clickOnCarouselNext:"click_on_carousel_next",clickOnCarouselPrev:"click_on_carousel_prev",clickOnMentions:"click_on_mentions",nightModeOn:"night_mod_on",nightModeOff:"night_mod_off",close:"close"};function g(e,t){for(var n in void 0===e&&(e={}),e)if(Object.prototype.hasOwnProperty.call(e,n)&&!1===t.call(e[n],n,e[n]))break;return e}function b(e,t,n){var i=[];if(g(e,function(e,t){n&&-1==["w","z","y","x","m","s"].indexOf(e)||i.push(t)}),!i.length)return[!1];i.sort(function(e,t){return e[1]-t[1]}),t*=window.devicePixelRatio>=2?2:1;var a=i[i.length-1];return g(i,function(e,n){if(n[1]>=t)return a=n,!1}),a}var y={};function w(e,t){if(isObject(t)&&!isEmpty(t)){var n="https://vk-callback.go.mail.ru/longread_pxl?action="+e;g(t,function(e,t){n+="&"+e+"="+t}),(new Image).src=n}}function C(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function k(e){if(/^https?:\/\/([\w-]+\.)*(instagram\.com|instagr\.am)$/.test(e.origin)){var t=function(e){for(var t,n=document.getElementsByTagName("iframe"),i=n.length-1;i>=0;i--){var a=n[i];if(a.contentWindow===e.source){t=a;break}}return t}(e);if(t){try{e=JSON.parse(e.data)}catch(e){}"object"==typeof e&&"string"==typeof e.type&&"object"==typeof e.details&&setTimeout(function(){if("MEASURE"===e.type){var n=e.details.height;t.setAttribute("height",n)}},100)}}}function S(e,t){var n=domQuery1("[data-sizes]",e),i=JSON.parse(domData(n,"sizes"));(domData(n,"media-links")||"").split(",");if(!(i.length<=1||domData(e,"carousel-inited"))){if(domData(e,"carousel-inited",1),t.mobile)return function(e,t,n){void 0===n&&(n={});var i,a,o,r=geByClass1("article_photo_carousel__controls",t),s=geByClass1("article_photo_carousel__counter",t),l=domData(s,"counter-lang")||getLang("global_article_carousel_counter"),c=getSize(geByClass1("article_figure_content",t)),u=geByClass1("article_photo_carousel_inner",t),d=n.onClick,f=0,_=0,p=!1,h=0,m=0,A=!1,g=!1;r.addEventListener("touchstart",function(e){a=e.touches[0].pageX,i=e.touches[0].pageY,addClass(u,"--no_trans"),p=!0,clearTimeout(o)});var b,y=!1;function w(n,i,a){if(!i||!p){if(p=!0,i)return u.style.transform="translateX(-50px)",void(o=setTimeout(function(){u.style.transform="translateX(0px)"},700));clearTimeout(o),f=void 0===f?Math.min(e.length-1,Math.max(0,f+n)):a,domData(t,"photo-carousel-index",f),E(f,t),s.innerHTML=l.replace("{counter}",f+1).replace("{total}",e.length),u.style.transform="translateX(-"+f*c[0]+"px)"}}return r.addEventListener("touchmove",function(t){if(g||!(Math.abs(t.touches[0].pageY-i)>5||A)){if(_=t.touches[0].pageX-a,!(Math.abs(_)<10)||y){g||window.addEventListener("touchmove",b=function(e){return cancelEvent(e)},{passive:!1}),g=!0,y=!0;var n=Math.min(e.length-1,Math.max(0,f+(_<0?1:-1))),o=0===n&&0===f,r=n===e.length-1&&f===e.length-1;h=n;var s=-f*c[0];s+=o||r?.2*_:_,u.style.transform="translateX("+s+"px)"}}else A=!0}),r.addEventListener("touchend",function(){y=!1,A=!1,g=!1,m=f,removeClass(u,"--no_trans"),b&&window.removeEventListener("touchmove",b),Math.abs(_)<50||(f=h),w(0,!1,h),isFunction(d)&&m!==h&&d(m<h?v.clickOnCarouselNext:v.clickOnCarouselPrev)}),w}(i,e,t);var a=function(e,t,n,i){var a,o=0,r=geByClass1("article_photo_carousel__controls",t),s=geByClass1("article_photo_carousel__counter",t),l=domData(s,"counter-lang")||getLang("global_article_carousel_counter"),c=getSize(geByClass1("article_figure_content",t)),u=geByClass1("article_photo_carousel_inner",t),d=geByClass1("article_photo_carousel__left",t),f=geByClass1("article_photo_carousel__right",t),_=n.onClick,p=!1;function h(n,i){if(!i||!p){if(p=!0,i)return u.style.transform="translateX(-50px)",void(a=setTimeout(function(){u.style.transform="translateX(0px)"},700));clearTimeout(a),o=Math.min(e.length-1,Math.max(0,o+n)),u.style.transform="translateX(-"+o*c[0]+"px)",s.innerHTML=l.replace("{counter}",o+1).replace("{total}",e.length),toggle(d,o>0),toggle(f,o<e.length-1),domData(t,"photo-carousel-index",o),E(o,t)}}return f.addEventListener("click",function(e){return h(1),_&&_(v.clickOnCarouselNext),cancelEvent(e)}),d.addEventListener("click",function(e){return h(-1),_&&_(v.clickOnCarouselPrev),cancelEvent(e)}),t.addEventListener("mousemove",function(){r.style.opacity=1}),t.addEventListener("mouseleave",function(){r.style.opacity=0}),h}(i,e,t);return window.data(e,"changePhotoFunction",a),a}}function E(e,t){var n=geByTag1("figcaption",t),i=[];n&&((i=domData(n,"captions"))&&(i=JSON.parse(i)),n.innerHTML=i[e]||"")}var O,T,D,j=n("lkNA"),I=window,M=I.geByTag,x=I.geByTag1,B=I.each,P=I.nav,L=I.removeClass,R=I.intval,N=I.toggleClass,F=I.domData,H=I.domQuery1,U=I.getW,V=I.getXY,$=I.getH,q=I.geByClass,W=I.ge,z=I.matchesSelector,Q={};window._articleCarouselGlobalId=window._articleCarouselGlobalId||1;var Y,X,G,K,J,Z,ee,te=function(){function e(e,t,n){var i=this;this._article=e,this._options=t,this._readTO=null,this._scrollStatEvent=!1,this._openTime=0,this._els={view:W("article_view_"+e.raw_id)},window.cur&&cur.destroy&&cur.destroy.push(function(){i.deinit()}),window.cur&&cur.destroy.push(function(){i.deinit()}),window.addEventListener("VKWebAppEvent",function(e){if(e&&e.detail&&void 0!==e.detail.index){var t=e.detail.index;if(D){var n=Q[F(D,"id")];n&&n(t)}}}),n&&this.ready()}var t=e.prototype;return t.getEl=function(){return this._els.view},t.getArticle=function(){return this._article},t.getScrollNode=function(){return this._options.getScrollNode?this._options.getScrollNode():document},t._getScrollTop=function(){return this._options.getScrollTop?this._options.getScrollTop():window.scrollNode?window.scrollNode.scrollTop:window.document.documentElement.scrollTop},t.getTimeSpent=function(){return Math.round((Date.now()-this._openTime)/1e3)},t.deinit=function(){this._scrollEvent&&(this.getScrollNode().removeEventListener("scroll",this._scrollEvent),this._scrollEvent=!1),this._scrollStatEvent&&(this.getScrollNode().removeEventListener("scroll",this._scrollStatEvent),this._scrollStatEvent=!1),clearTimeout(this._readTO)},t._onViewScroll=function(){var e=this,t=scrollGetY(),n=window.innerHeight;B(M("figure",this._els.view),function(i,a){var o=R(F(a,"done"));if(!o){var r=$(a),s=V(a)[1],l=R(F(a,"type")),c=101==l?-200:100,u=s<=t+n-c&&t+c<=s+r;(o=e._onObjectView(u,l,a))&&F(a,"done",1)}}),B(M("figure",this._els.view),function(i,a){var o,r=$(a),s=V(a)[1],l=R(F(a,"type")),c=s,u=s+r,d=t,f=t+n;if(c>f||d>u)o=!1;else{var _=Math.max(c,d);o=(Math.min(u,f)-_)/r>.7}e._onObjectPartialView(o,l,a)})},t._initObjects=function(){var e=this;this._initedObjects=this._initedObjects||{},B(q("_article_unmute_button",this._els.view),function(t,n){e._initedObjects[t]||(e._initedObjects[t]=!0,n.addEventListener("click",function(){var e=n.parentNode,t=x("video",e);t.muted=!t.muted,N(e,"article_object_unmuted",!t.muted)}))}),B(M("figure",this._els.view),function(t,n){if(!e._initedObjects[t])switch(e._initedObjects[t]=!0,parseInt(F(n,"type"))){case r:var i=S(n,{mobile:e._options.mobile,moderDeletePhoto:e._options.moderDeletePhoto,onClick:function(t){e.sendStats({type:t})}});if(e._initPhoto(n),i){var a=window._articleCarouselGlobalId++;n.setAttribute("data-carousel-id",a),Q[a]=i}break;case c:case o:geByClass1("article_figure_content",n).addEventListener("click",function(){e.sendStats({type:v.clickOnAudio})},!0);break;case h:case m:break;case l:case s:if(e._options.mobile){var u=x("video",n);u&&(u.addEventListener("play",function(){e.sendStats({type:v.clickOnVideo})}),u.addEventListener("pause",function(){e.sendStats({type:v.clickOnVideo})}))}else{geByClass1("article_figure_content",n).addEventListener("click",function(){e.sendStats({type:v.clickOnVideo})},!0)}}}),this._els.view.addEventListener("click",function(t){var n=t.target;if(z(n,'a[href^="/away"]')){var i=decodeURIComponent(unescape(n.href)).split("vk.com/away.php?to=")[1];i&&e.sendStats({type:v.clickOnExternalLink,domain:encodeURIComponent(e._getUrlDomain(i))})}})},t._initPhoto=function(e){var t=this;geByClass1("article_figure_content",e).addEventListener("click",function(){var n=H("[data-sizes]",e),i=JSON.parse(F(n,"sizes")),a=R(F(e,"photo-carousel-index"));t._options.onImageOpen&&t._options.onImageOpen.call(t,i,e,a),t.sendStats({type:v.clickOnPhoto})})},t._initStats=function(){if(this._statsInited)this._scrollStatEvent&&this._scrollStatEvent();else{this._statsInited=!0,this._openTime=Date.now();var e,t=-1,n=[];this._scrollStatEvent&&this.getScrollNode().removeEventListener("scroll",this._scrollStatEvent),clearTimeout(this._readTO);var i=this;this.getScrollNode().addEventListener("scroll",this._scrollStatEvent=function(){var o=i.getCurrentScrollRatio();if(!(o<0)){var r=1;o>=.95?r=4:o>.66?r=3:o>.33&&(r=2),function(o){if(i._isReady&&(i._article.has_more&&(o=Math.min(o,1)),!(t>=o))){for(var r=t+1;r<=o;r++)n.push(r);if(t=o,clearTimeout(e),e=setTimeout(a,300),3==o&&i._article.ttr){var s=i._article.ttr-i.getTimeSpent();s>0&&(i._readTO=setTimeout(function(){if(!document.hidden){var e=i.getCurrentScrollRatio();if(!(e<0||e>1.3)){var o=4==t;n=[t=4],a(o)}}},1e3*s))}}}(r),4!=r||i._article.has_more||(i.getScrollNode().removeEventListener("scroll",i._scrollStatEvent),i._scrollStatEvent=!1)}},{passive:!0}),this._scrollStatEvent&&this._scrollStatEvent()}function a(e){if(n.length){var t=i._article,a=i._options,o="";if(t.ref)o=t.ref;else if(window.cur){if("feed"===(o=window.cur.module)&&cur.articlePrevLoc&&!a.mobile)"search"===P.fromStr(cur.articlePrevLoc).section&&(o="feed_search")}var r={act:"stats",scroll:n.join(","),spent:i.getTimeSpent(),hash:t.access_hash,article_owner_id:t.owner_id,article_id:t.id,is_web_view:a.isWebView?1:0,post_id:a.sourcePostId,is_widget:a.isWidget,is_delayed_scroll_4:R(e),track_code:a.trackCode,ref:o};ajax.post(a.mobile?"article.php":"al_articles.php",r),t.mailru_stats_data&&n.forEach(function(e){w("scroll_"+e,t.mailru_stats_data)}),n=[]}}},t._initGoogleAnalytics=function(){var e=this._options.googleAnalyticsId;if(e)if(window.dataLayer=window.dataLayer||[],window.gtag)window.gtag("config",e,{page_location:window.location.href});else{var t=document.createElement("script");t.setAttribute("src","https://www.googletagmanager.com/gtag/js?id="+e),t.setAttribute("async","true"),document.head.appendChild(t),window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config",e)}},t._onObjectPartialView=function(e,t,n){if(t==r){var i=H("[data-sizes]",n);if(JSON.parse(F(i,"sizes")).length>1){var a=n.getAttribute("data-carousel-id");e?T!=a&&(clearTimeout(O),O=setTimeout(function(){var e=Q[a];e&&e(1,!0)},400),T=a):a==T&&(T=-1,clearTimeout(O))}}},t._onObjectView=function(e,t,n){var i=!1;switch(t){case r:if(e){var a=x("img",n),o=U(a)||this._options.width,s=H("[data-sizes]",n),c=JSON.parse(F(s,"sizes")),h=M("img",n);c.forEach(function(e,t){var n=b(c[t],o,!0)[0];!function(e,t){if(!0===y[e])return t&&t(),!0;if(isArray(y[e]))return y[e].push(t),!1;y[e]=[t];var n=new Image;n.onload=function(){var t=y[e];y[e]=!0,g(t,function(e,t){t&&t()})},n.src=e}(n,function(){var e=h[t];L(e,"article_object_photo__image_blur"),e.src=n})}),i=!0}break;case l:if(!this._options.mobile){var m=x("video",n);if(m)if(e){if(m.hasAttribute("autoplay")){var A=m.play();A&&A.catch(function(){})}}else m.pause();else i=!0}break;case u:case d:case f:case _:case p:this.initEmbed(t,n),i=!0}return i},t.initEmbed=function(e,t){var n=this;switch(e){case u:var i=H("[data-tweet-id]",t),a=F(i,"tweet-id");Object(j.loadScript)("https://platform.twitter.com/widgets.js",{onLoad:function(){window.twttr.widgets.createTweet(a,i,{align:"center",lang:window.vk&&0==window.vk.lang?"ru":"en",dnt:!0})}});break;case d:var o=window.vk&&0==window.vk.lang?"ru_RU":"en_US";Object(j.loadScript)("https://connect.facebook.net/"+o+"/all.js#xfbml=1&amp;version=v2.8",{onLoad:function(){window.FB.XFBML.parse()}});break;case f:Object(j.loadScript)("https://www.instagram.com/embed.js",{onLoad:function(){window.instgrm.Embeds.process(),addEvent(window,"message",k)}});break;case _:var r=H("[data-raw-id]",t),s=F(r,"raw-id"),l=F(r,"index"),c=s.split(";"),h=c[0],m=c[1];Object(j.loadScript)("/js/api/openapi.js",{onLoad:function(){ajax.post("dev.php",{act:"a_get_post_hash",post:h+"_"+m},{onDone:function(e){e&&window.VK&&window.VK.Widgets&&window.VK.Widgets.Post("vk_post_"+s+"_"+l,h,m,e,{from:n._options.isWebView?"article_webview":""})}})}});break;case p:Object(j.loadScript)("https://telegram.org/js/telegram-widget.js?5",{})}},t.getCurrentScrollRatio=function(){var e=$(this._els.view),t=V(this._els.view)[1]-V(this.getScrollNode().firstElementChild)[1];return(this._getScrollTop()+window.innerHeight-t)/e},t.getScreenVisibilityRatio=function(){var e=$(this._els.view),t=V(this._els.view)[1]-V(this.getScrollNode().firstElementChild)[1],n=this._getScrollTop(),i=window.innerHeight,a=t,o=t+e,r=n,s=n+i;if(r>o||a>s)return 0;var l=Math.max(a,r);return(Math.min(o,s)-l)/i},t.update=function(){this._initObjects(),this._initStats(),this._options.onScroll&&this._options.onScroll.call(this,this.getCurrentScrollRatio())},t.ready=function(){var e=this;(this._isReady=!0,this._initObjects(),this._initStats(),this._initGoogleAnalytics(),setTimeout(function(){var t=C("anchor");if(t){e._options.isWebView||e.scrollToAnchor(t);var n=e.getScrollNode();n===document&&(n=document.scrollingElement||window.scrollNode||document.body),n.click&&n.click(),n.focus()}},0),!this._options.mobile&&window.AudioPlaylist)&&(this._article.audios_list&&this._article.audios_list.length>0&&new AudioPlaylist(AudioPlaylist.TYPE_TEMP,this._article.owner_id,"article_"+this._article.id).mergeWith({list:this._article.audios_list}));this.getScrollNode().addEventListener("scroll",this._scrollEvent=function(){e._onViewScroll(),e._options.onScroll&&e._options.onScroll.call(e,e.getCurrentScrollRatio())}),setTimeout(function(){e._scrollEvent()},this._options.objectsInitDelay||0)},t.scrollToAnchor=function(e){e=e||C("anchor");var t=this._options,n=this.getScrollNode();n===document&&(n=document.scrollingElement||window.scrollNode||document.body);e&&function(){var i=document.getElementById(e);if(i){"scrollRestoration"in history&&(history.scrollRestoration="manual");var a=t.isWebView?0:25,o=i.parentNode.offsetTop-a;window.setTimeout(function(){n.scrollTo?n.scrollTo(0,o):n.scrollTop=o},0)}}()},t.sendStats=function(e){var t=this._article,n=this._options,i={act:"stats",spent:this.getTimeSpent(),article_id:t.id,article_owner_id:t.owner_id,hash:t.access_hash,is_web_view:n.isWebView?1:0};Object.assign(i,e),ajax.post(n.mobile?"article.php":"al_articles.php",i)},t._getUrlDomain=function(e){var t=document.createElement("a");return t.href=e,t.hostname},e}(),ne=window,ie=ne.intval,ae=ne.domData,oe=ne.isEmpty,re=ne.isArray,se=ne.setStyle,le=ne.ce,ce=[],ue=!1,de=function(){function e(){}return e.init=function(e,t,n){if(void 0===n&&(n={}),ue=n.mobile||n.isWebView,t&&e.ads&&!oe(e.ads)&&!(e.has_more||re(e.ads)&&0==e.ads.length)){var i=le("ins");addClass(i,"mrg-tag"),addClass(i,"article_adsblock"),n.mobile&&addClass(i,"article_adsblock_mobile"),se(i,{display:"block","text-decoration":"none"});var a="";for(var o in n.deviceInfo)n.deviceInfo.hasOwnProperty(o)&&(a+="&"+o+"="+n.deviceInfo[o]);for(var r in e.ads.data["ad-query"]=e.ads.data["ad-query"].replace("%device_info%",a),e.ads.data)e.ads.data.hasOwnProperty(r)&&ae(i,r,""+e.ads.data[r]);t.appendChild(i),window.MRGtag||(window.MRGtag=[]);var s=n.isWebView?{iframeMode:!0}:{},l=e.ads.eventsHash;if(fe(e,n,"requested",l),s.onNoAds=function(){fe(e,n,"no_ads",l)},s.onAdsLoaded=function(){fe(e,n,"ads_loaded",l)},s.onAdsClosed=function(){fe(e,n,"ads_closed",l)},s.onAdsSuccess=function(){fe(e,n,"ads_success",l)},s.onAdsClicked=function(){fe(e,n,"ads_clicked",l)},s.onScriptError=function(){fe(e,n,"script_error",l)},window.MRGtagOnAdsImpression=function(){fe(e,n,"ads_impression",l)},window.MRGtag.push(s),!window.mailRuSdsScriptLoaded){var c=document.createElement("script");c.setAttribute("src",e.ads.script),c.setAttribute("async","true"),document.head.appendChild(c),window.mailRuSdsScriptLoaded=!0}}},e.wasShown=function(){return!1},e}();function fe(e,t,n,i){ce.push(n+"/"+e.owner_id+"_"+e.id+"/"+i),clearTimeout(Y),Y=setTimeout(function(){var e=ue?"article.php":"al_articles.php";ajax.post(e,{act:"ads_event",events:ce.join(","),is_web_view:ie(t.isWebView)}),ce=[]},200)}window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);var _e,pe=!1,he=[],me=[],Ae=20,ve=.6,be={InProgress:1,NotAvailable:2},ye={},we={};function Ce(e,t){e=e.split("_");for(var n=0;n<t.length;n++){var i=t[n].split("_");if(i[0]==e[0]&&i[1]==e[1])return n}return-1}function ke(){return document}function Se(){return(document.scrollingElement||window.scrollNode||document.body).scrollTop}function Ee(e){return domQuery('.articleView__social_buttons[data-article-id="'+e+'"] .articleView__footer_btn_bookmark')}function Oe(e){if(ee!=e.raw_id)if(ee=e.raw_id,G.isWebView)!function(e){a.a.send("articleUpdate",{article:Pe(e),isSubscribedToOwner:e.is_subscribed_to_owner})}(e);else{var t=geByClass1("articleView__owner"),n=geByTag1("img",t);t&&n&&(n.src=e.owner_photo);var i=geByTag1("a",t);t&&i&&(i.href=e.owner_href);var o=geByClass1("articleView__ownerName"),r=geByTag1("a",o);o&&r&&(r.href=e.owner_href,r.innerHTML=e.owner_name);var s=geByClass1("articleView__footer"),l=geByClass1("articleView__footer_views");l&&(l.innerHTML=e.views_formatted);var c=geByClass1("articleView__social_buttons",s);s&&c&&!e.is_blog&&c.setAttribute("data-article-id",e.raw_id);var u=[domQuery1('.articleView__content_misc_block[data-article-id="'+e.raw_id+'"] .articleView__footer_btn_share'),s&&domQuery1(".articleView__footer_btn_share",s)];each(u,function(t,n){n&&!e.is_blog&&(n.href="/like?act=publish&object=article"+e.raw_id+"&list="+e.access_hash)});var d=Ee(e.raw_id),f=JSON.stringify(e.mailru_stats_data);each(d,function(t,n){n&&(n.setAttribute("onclick","Article.fave(this, '"+e.url+"', '"+e.fave_hash+"', "+f+", '"+e.raw_id+"')"),toggleClass(n,"_active",e.is_faved))});var _=geByClass1("Unfold__item_name_noted");_&&(_.href="/feed?section=search&q=url:https://vk.com"+e.url);var p=geByClass1("Unfold__item_name_report");p&&(p.href="/reports?act=add&object=article"+e.raw_id+"_"+e.access_hash+"&refrom=feed")}}function Te(e,t){void 0===t&&(t=!1),e.has_more||(he=he.concat(e.audios_list));var n=new te(e,{notFull:!!G.preloadMoreHash,isWebView:G.isWebView,mobile:!0,width:G.width,getScrollTop:Se,getScrollNode:ke,trackCode:G.trackCode,onScroll:function(t){if(!e.has_more){var n=me[me.length-1],i=gpeByClass("articleView__content",n.getEl());t>ve&&e.next_article_url&&(me.length<Ae&&(je(e.next_article_url),addClass(i,"articleView_waitNextArticle")),function(){var e=me[me.length-1];if(e){var t=gpeByClass("articleView__content",e.getEl()),n=geByClass1("articleView__social_buttons",t);n&&show(n)}}()),t>.99&&e.next_article_url&&me.length<Ae&&je(e.next_article_url,function(e,t){if(e){for(var n=0;n<me.length;n++)if(me[n].getArticle().raw_id==t.raw_id)return;_e||(_e=setTimeout(function(){var n=domCreate(e);Z.appendChild(n),removeClass(i,"articleView_waitNextArticle"),addClass(n,"articleView_nextPrepared"),requestAnimationFrame(function(){removeClass(n,"articleView_nextPrepared")}),Te(t),_e=null},400))}}),this.getScreenVisibilityRatio()>.5&&Oe(e)}},onImageOpen:function(e,t,n){if(G.isWebView){for(var i=[],o=0;o<e.length;o++){var r=e[o],s=[];for(var l in r)r.hasOwnProperty(l)&&s.push({type:l,src:r[l][0],width:r[l][1],height:r[l][2]});i.push(s)}a.a.send("articlePhotoView",{photos:i,index:n})}}});t||n.ready(),me.push(n),De(e),each(geByTag("video"),function(e,t){domData(t,"auto-pause-inited")||(domData(t,"auto-pause-inited",1),t.addEventListener("play",function(){each(geByTag("video"),function(e,n){n!=t&&n.pause()})}))}),G.isWebView&&each(geByTag("figure",n._els.view),function(e,t){var i=intval(domData(t,"type"));n._onObjectView(!1,i,t)&&domData(t,"done",1)})}function De(e){var t=gpeByClass("articleView__content",ge("article_view_"+e.raw_id)),n=geByClass1("articleView__ads_block",t);de.init(e,n,G)}function je(e,t){var n=we[e];n!==be.NotAvailable?isArray(n)?t&&t(n[0],n[1]):(ye[e]=ye[e]||[],t&&ye[e].push(t),n!=be.InProgress&&(we[e]=be.InProgress,ajax.post("article.php",{act:"view",url:e,scroll_load:1,wall_owner_id:G.wallOwnerId,audio_bridge:intval(G.audioBridge),can_infinite_scroll:intval(G.canInfiniteScroll),web_view:G.isWebView,context:G.context,ref:"scroll",v:G.clientVersion},{onDone:function(t,n){for(var i=ye[e],a=0;a<i.length;a++)i[a](t,n);we[e]=[t,n]}}))):t&&t()}function Ie(e,t){var n=Ee(e);each(n,function(e,n){toggleClass(n,"_active",t)})}function Me(){var e=C("anchor");e&&function(){var t=document.getElementById(e);if(t){"scrollRestoration"in history&&(history.scrollRestoration="manual");var n=G.isWebView?0:25,i=t.parentNode.offsetTop-n;window.setTimeout(function(){var e;e=i,(document.scrollingElement||window.scrollNode||document.body).scrollTop=e},0)}}()}function xe(e){if(void 0===e&&(e={}),pe)Me();else{G.deviceInfo=e.deviceInfo;var t=me[0],n=t.getArticle();t.ready(),n.has_more?ajax.post("article.php",{act:"load_more",rev:n.rev,hash:n.has_more_hash,article_owner_id:n.owner_id,article_id:n.id,audio_bridge:intval(G.audioBridge),no_lazy_images:intval(G.noLazyImages),can_infinite_scroll:intval(G.canInfiniteScroll),wall_owner_id:G.wallOwnerId,context:G.context,client_version:G.clientVersion},{onFail:function(){G.failTries>0&&(G.failTries--,setTimeout(function(){xe(e)},2e3))},onDone:function(e,i){pe=!0,n.audios_list=i.audios_list,n.next_article_url=i.next_article_url,n.has_more=!1,n.audios_list&&n.audios_list.length&&(he=he.concat(n.audios_list));var a=domCreate(e),o=geByClass1("article_view",a),r=geByClass1("article_view");"figure"!==r.lastElementChild.tagName.toLowerCase()&&r.lastChild.remove();for(var s=r.children.length,l=o.children;s<l.length;)r.appendChild(l[s]);var c=geByClass1("article_preload_spinner");c&&c.parentNode.removeChild(c);var u=geByClass1("articleView__content_misc_block",a);r.parentNode.appendChild(u),function(){for(var e=geByClass1("article").children,t=0;t<e.length;t++){var n=t>0&&e[t-1],i=e[t],a=t+1<e.length&&e[t+1],o=n?n.tagName+"_"+domData(n,"type"):"",r=i?i.tagName+"_"+domData(i,"type"):"",s=a?a.tagName+"_"+domData(a,"type"):"",l=!1,c=!1,u=!1;o&&r==o||(l=!0),s&&r==s||(c=!0),(A.includes(+s.type)||s.sep)&&(u=!0),toggleClass(i,"article_decoration_first",l),toggleClass(i,"article_decoration_last",c),toggleClass(i,"article_decoration_before",u)}}(),De(n),Me(),t.update()}}):ajax.post("article.php",{act:"next_url",access_hash:n.access_hash,article_owner_id:n.owner_id,article_id:n.id,wall_owner_id:G.wallOwnerId,context:G.context},{onDone:function(e){e&&(n.next_article_url=e,t.update())}});var i=t.getEl();e.paddingTop&&setStyle(i,"marginTop",intval(e.paddingTop)),e.paddingBottom&&setStyle(i,"marginBottom",intval(e.paddingBottom)),e.noDarkModeTransition&&addClass(i,"article_dark_no_transition")}}function Be(e){var t=null;return each(me,function(n,i){var a=i.getArticle();if(a.raw_id==e)return t=a,!1}),t}function Pe(e){var t="https://"+G.devHost+"vk.com"+e.url,n={id:e.id,owner_id:e.owner_id,owner_name:e.owner_name,state:"available",can_report:e.can_report,title:e.title,subtitle:"",views:e.views,shares:e.shares,is_favorite:e.is_faved,url:t,view_url:t,access_key:e.access_hash,published_date:e.published_date,no_footer:e.no_footer};return e.owner_photo&&0!=e.owner_photo.indexOf("/images/")&&(n.owner_photo=e.owner_photo),n}function Le(e,t){void 0===t&&(t="");var n=me[me.length-1];if(t)for(var i=0;i<me.length;i++)if(me[i]._article.raw_id===t){n=me[i];break}n.sendStats({type:e})}window.ArticleView=te,window.Article={init:function(e,t){if((G=t).mobile=!0,G.failTries=50,window.cur&&(window.cur.lang=window.cur.lang||{},extend(window.cur.lang,t.lang||{})),Z=geByClass1("articleView__content_list"),!G.isWebView){var n,i=Se(),o=geByClass1("articleView__header"),r=geByClass1("articleView__footer"),s=geByClass1("articleView__layout");ke().addEventListener("scroll",n=function(){var e=s.clientHeight,t=Math.max(0,Se()),n=t-i>0,a=t+window.innerHeight+20>e;toggleClass(o,"articleView__header--narrow",n),r&&toggleClass(r,"articleView__footer--hidden",!a&&n),i=t},{passive:!0});var l=geByClass1("articleView__close"),c=geByClass1("articleView__close_mini");l.addEventListener("click",Le.bind(window,v.close)),c.addEventListener("click",Le.bind(window,v.close)),window.cur&&cur.destroy.push(function(){document.removeEventListener("scroll",n),removeClass(document.body,"article_body_with_transition")}),G.isStandalone&&(window.al=!1)}if(G.preloadMoreHash||show(geByClass1("article_layer_prev_next")),G.isWebView){var u=geByClass1("article");addClass(u,"article_webview")}G.isWebView&&G.audioBridge&&(window.audioplayer={playPause:function(e,t){var n=gpeByClass("audio_item",e.target);if(K&&K!=n&&(removeClass(K,"ai_playing"),K=!1),J&&(removeClass(J,"article_object_audioplaylist_playing"),J=!1),hasClass(n,"ai_playing"))a.a.send("audioPause",{}),removeClass(n,"ai_playing");else{var i=Ce(t,he),o=he;-1==i&&(o.unshift(t),i=0),a.a.send("audioPlay",{audioIds:o,pos:i}),addClass(n,"ai_playing"),K=n}}}),G.isWebView?(a.a.send("articleReady"),window.addEventListener("VKWebAppEvent",function(e){var t=e.detail||{};switch(t.type){case"articleOwnerSubscribed":var n=t.ownerId,i=t.isSubscribed;each(me,function(e,t){var a=t.getArticle();if(a.owner_id==n)return a.is_subscribed_to_owner=i,!1});break;case"articleBookmarked":var a=t.articleOwnerId+"_"+t.articleId,o=Be(a);o&&(o.is_faved=t.isBookmarked);var r=Ee(a);each(r,function(e,n){toggleClass(n,"_active",!!t.isBookmarked)});break;case"articleWebViewShow":xe(t);break;case"articleWebViewClose":Le(v.close);break;case"didShareArticle":var s=t.articleRawId,l=t.shareType;if(!l)break;Le(l,s);break;case"articleMentionClick":var c=t.articleRawId;Le(v.clickOnMentions,c)}}),Te(e,!0)):Te(e,!1)},fave:function(e,t,n,i,o){var r=!hasClass(e,"_active");ajax.post("article.php",{act:"fave",url:t,add:intval(r),hash:n}),me.forEach(function(e){var n=e.getArticle();n.url==t&&(n.is_faved=r)}),w(r?"fave":"unfave",i),Ie(o,r),G.isWebView?function(e){var t=Be(e);t&&(JSON.stringify({article:Pe(t)}),a.a.send("articleBookmarked",{article:Pe(t)}))}(o):Share&&Share.setBookmarkState(o,r)},toggleButton:Ie,share:function(e,t,n){return function(e){var t=Be(e),n=G.clientVersion;if(t)if(n){var i={type:"article",data:Pe(t)};a.a.send("share",i)}else{var o={article:Pe(t)};a.a.send("articleShare",o)}}(t),!1},subscribe:function(e,t,n){ajax.post("article.php",{act:"subscribe",owner_id:t,hash:n},{onDone:function(t,n){toggleClass(e,"articleView__subscribed",t),e.innerHTML=n}})},toggleDarkMode:function(e){X||(X=setTimeout(function(){var t=geByClass1("articleView__layout");toggleClass(t,"article_dark",e),toggleClass(document.body,"article_dark",e);var n=intval(hasClass(t,"article_dark"));X=!1,void 0!==e||G.isWebView||ajax.post("article.php",{act:"set_dark_mode",dark:n});var i=geByClass1("articleMenu");i&&Unfold.setTitle(i,"dark_mode",n?getLang("mobile_articles_menu_dark_disable"):getLang("mobile_articles_menu_dark")),Le(n?v.nightModeOn:v.nightModeOff)},e?0:10))},onWebViewShow:xe,sendStats:Le,audioPlayPlaylist:function(e,t,n){var i=gpeByClass("article_object_audioplaylist_webview",e);if(K&&(removeClass(K,"ai_playing"),K=!1),J){var o=J;if(removeClass(o,"article_object_audioplaylist_playing"),J=!1,o==i)return a.a.send("audioPause",{}),cancelEvent(n)}var r=Ce(t,he),s=he;return-1==r&&(s.unshift(t),r=0),a.a.send("audioPlay",{audioIds:s,pos:r}),addClass(i,"article_object_audioplaylist_playing"),J=i,cancelEvent(n)},onAudioStateChanged:function(e,t){K&&(removeClass(K,"ai_playing"),K=!1),J&&(removeClass(J,"article_object_audioplaylist_playing"),J=!1),e=(e=e.split("_"))[0]+"_"+e[1];var n=ge("audio"+e);n&&toggleClass(n,"ai_playing","play"==t);for(var i=geByClass("_article_object_audioplaylist_webview"),a=0;a<i.length;a++){if((domData(i[a],"ids")||"").split(",").indexOf(e)>=0&&"play"==t){addClass(i[a],"article_object_audioplaylist_playing"),J=i[a];break}}}}},"1By4":function(e,t,n){"use strict";n.r(t);var i=n("wx14"),a=n("2mXy");t.default={html:l,render:function(e){if(m(e))return e;return l(e)},wrap:function(e){return e?{__raw__:e}:null},handle:function(){var e=y(arguments[0]),t=Array.prototype.slice.call(arguments,1),n=e[0];if(!n)return;m(n)||console.warn('Invalid handler "'+n+'"');var i=k(window,n);if(!g(i))return void console.warn("`"+n+"` is not a function");i.apply(null,e.slice(1).concat(t))},handle2:function(e,t){var n=Array.prototype.slice.call(arguments,2),i=e[0];if(!i)return;m(i)||console.warn('Invalid handler "'+i+'"');var a=k(window,i);if(!g(a))return void console.warn("`"+i+"` is not a function");for(var o=e.slice(1),r=0,s=o.length;r<s;r++)if("event"===o[r]){o[r]=t;break}a.apply(null,o.concat(n))},elem:function(e){return e?ceFromString(l(e)):""},preact:function(e,t){return function e(t,n){return function(n){var o=g(t)?t(n):t;if(o){if("string"==typeof o||"number"==typeof o)return o;o.children=o.inner,delete o.inner,A(o.children)?(o.children=flatArray(o.children),o.children=o.children.map(function(t){return e(t)()})):o.children&&o.children.inner&&(o.children.children=o.children.inner,delete o.children.inner),o&&o.children&&"string"==typeof o.children.children&&(o.children=Object(a.createElement)(o.children.tag||"div",o.children.props,o.children.children));var r=Object(i.default)({},n,o,{className:o.class||o.className});return delete r.class,A(r.className)&&(r.className=flatArray(r.className).filter(function(e){return!!e}),r.className=r.className.join(",")),Object(a.createElement)(o.tag||"div",r,o.children)}}}(function(t){return e(t)})(t)},hydrate:function(e,t,n){return Object(a.hydrate)(Object(a.createElement)(e,t),n)},class:u,innerItemToString:c,toFlatArray:C};var o=["tag","inner","attrs","innerHTML","outerHTML"],r=["area","base","br","col","command","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"],s=["abort","auxclick","beforecopy","beforecut","beforepaste","blur","cancel","canplay","canplaythrough","change","click","close","contextmenu","copy","cuechange","cut","dblclick","drag","dragend","dragenter","dragleave","dragover","dragstart","drop","durationchange","emptied","ended","error","focus","gotpointercapture","input","invalid","keydown","keypress","keyup","load","loadeddata","loadedmetadata","loadstart","lostpointercapture","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","mousewheel","paste","pause","play","playing","pointercancel","pointerdown","pointerenter","pointerleave","pointermove","pointerout","pointerover","pointerup","progress","ratechange","reset","resize","scroll","search","seeked","seeking","select","selectstart","stalled","submit","suspend","timeupdate","toggle","touchcancel","touchend","touchmove","touchstart","volumechange","waiting","wheel"].map(function(e){return"on"+e});function l(e){if(m(e))return e?{__raw__:e}:null;if(A(e))return e.map(l).join("");if(!v(e))throw"Invalid input, object is expected";if("outerHTML"in e){var t=e.outerHTML;if(m(t))return t;if(h(t))return t.toString();if(t)throw"Invalid outerHTML";return""}var n=function(e){if("tag"in e){var t=e.tag;if(m(t)&&/^[\w-]+$/.test(t))return t;throw"Invalid tag name"}if(b(e.href))return"a";return"div"}(e),i=function(e){if("innerHTML"in e){var t=e.innerHTML;if(m(t))return t;if(h(t))return t.toString();if(t)throw"Invalid innerHTML";return""}if("inner"in e)return C(e.inner).map(c).join("");return""}(e),a=function(e){var t="";v(e.attrs)&&Object.assign(e,e.attrs);for(var n in e)if(!p(n)){var i=e[n];"class"===n?i=u(i):(r=n,s.includes(r.toLowerCase())&&(A(i)||m(o=i)&&/^[\w.]+$/.test(o))?i=d(i):i&&(i=_(i)));var a=w(n);!0===i?t+=" "+a:h(i)?t+=" "+a+'="'+i+'"':m(i)?t+=" "+a+'="'+w(i)+'"':i&&(i=i.__raw__?i.__raw__:_(i))&&(t+=" "+a+'="'+i+'"')}var o;var r;m(e.attrs)&&(t+=" "+e.attrs.replace(/</g,"&lt;").replace(/>/g,"&gt;"));return t}(e);return function(e){return r.includes(e.toLowerCase())}(n)?"<"+n+a+" />":"<"+n+a+">"+i+"</"+n+">"}function c(e){return h(e)?e.toString():m(e)?w(e):v(e)?e.__raw__?e.__raw__:l(e):""}function u(e){return C(e).filter(b).join(" ").trim().replace(/\s+/g," ")}function d(e){if(!(e=y(e)).length)return null;var t=e[0];if(!m(t))throw"Invalid handler";return t+"("+e.slice(1).map(f).join(", ")+")"}function f(e){return h(e)||"this"===e||"event"===e||void 0===e?e:w(JSON.stringify(e))}function _(e){return void 0===e&&(e=""),e="boolean"==typeof e?e:h(e)?e:m(e)?w(e,!0):A(e)?e.__raw__:w(JSON.stringify(e),!0)}function p(e){return o.includes(e)}function h(e){return"number"==typeof e&&!isNaN(e)}function m(e){return"string"==typeof e}function A(e){return Array.isArray(e)}function v(e){return"[object Object]"===Object.prototype.toString.call(e)}function g(e){return"[object Function]"===Object.prototype.toString.call(e)}function b(e){return m(e)&&e}function y(e){return A(e)?e:[e]}function w(e,t){return t?e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):(e=e.replace(/&(?!(#\d{0,4};|quot;|lt;|gt;|amp;))/g,"&amp;",e)).replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function C(e){return A(e)?function e(t){var n=[];t.forEach(function(t){A(t)?n=n.concat(e(t)):n.push(t)});return n}(e):[e]}function k(e,t){for(var n=t.split("."),i=n.length,a=e,o=0;o<i;o++)try{a=a[n[o]]}catch(e){return}return a}},"29dZ":function(e,t,n){"use strict";n.r(t);var i=n("UvyM"),a=n("myok");Object.assign(i.default,a.default),window.Btn=i.default,t.default=i.default},"2IoG":function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P");function o(){var e=Object(i.default)(["\n    <",' class="','" '," ",">\n      ","\n    </",">\n  "]);return o=function(){return e},e}t.default=function(e){void 0===e&&(e={});var t,n,i=a.default.list(e.inner);e.url?(t="a",n=a.default.attr("href",e.url)):(t=e.tag||"div",n="");return a.default.html(o(),t,e.mix,n,e.attrs,i,t)}},"4fRq":function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);e.exports=function(){return n(i),i}}else{var a=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}},"4qiT":function(e,t){var n={init:function(e){var t=this;this.store?addEvent(window,"scroll touchstart",this._onScrollHandler):(this.store=extend({},e),this.loadCount=20,this.store.offset=this.loadCount,this.isLoading=!1,this.elems={wrap:geByClass1("author-page"),nav:geByClass1("author-page-nav",this.wrap),header:geByClass1("author-page-header",this.wrap),content:geByClass1("author-page__inner",this.wrap),spinner:geByClass1("author-page__spinner",this.wrap)},this._onScrollHandler=this._onScrollHandler.bind(this),addEvent(window,"scroll touchstart",this._onScrollHandler),e.isStandalone&&(window.al=!1),window.cur.destroy.push(function(){removeEvent(window,"scroll touchstart",t._onScrollHandler)}))},_getLoadOffset:function(){return this.store.offset},_showLoader:function(){this.isLoading=!0,addClass(this.elems.spinner,"active")},_hideLoader:function(){this.isLoading=!1,removeClass(this.elems.spinner,"active")},_onScrollHandler:function(){var e=this,t=this.elems,n=t.nav,i=t.header,a=t.content,o=this.store.totalCount>this._getLoadOffset();toggleClass(n,"author-page-nav_shown",i.getBoundingClientRect().bottom-n.clientHeight<0),o&&window.scrollTop()+2*window.innerHeight>a.offsetHeight&&this._loadMore(this.store.sortBy,this._getLoadOffset(),function(t){e.elems.content.innerHTML+=t})},_loadMore:function(e,t,n){var i=this;void 0===e&&(e=!1),void 0===t&&(t=!1),this.isLoading||(e&&(this.store.sortBy=e),isFunction(n)||(n=function(){}),this._showLoader(),ajax.post("author_page.php",{act:"load_more",author_id:this.store.authorId,sort_by:e||this.store.sortBy,count:this.loadCount,offset:void 0!==t?t:this._getLoadOffset()},{onFail:function(){i._hideLoader()},onDone:function(e){i._hideLoader(),i.store.offset+=20,e&&n(e)}}))},subscribe:function(e,t,n){ajax.post("author_page.php",{act:"subscribe",author_id:t,hash:n},{onDone:function(t,n){toggleClass(e,"Btn_theme_secondary",t),e.innerHTML=n}})},sortBy:function(e,t){e.preventDefault(),Unfold.setActive(e.target.parentNode),this._closeUnfold(e),t!==this.store.sortBy&&this.updateList(t)},updateList:function(e,t){var n=this;void 0===t&&(t=!1),e=e||this.store.sortBy,addClass(this.elems.content,"loading"),t&&Unfold.setActive(geByClass1("Unfold__item")),this._loadMore(e,0,function(e){n.elems.content.innerHTML=e,n.store.offset=n.loadCount,removeClass(n.elems.content,"loading")})},_closeUnfold:function(e){if(e){var t=e.target.closest(".Unfold");t&&removeClass(t,"Unfold_open")}},addToBookmark:function(e,t,n,i,a){e.preventDefault(),this._closeUnfold(e);var o=+domData(t,"is-bookmarked"),r=o?"bookmark_remove":"bookmark_add",s=geByClass1("Unfold__itemText",t);ajax.post("bookmarks.php",{_ajax:1,act:r,item_type:5,item_oid:n,item_id:i,hash:a},{onDone:function(e,n,i){domData(t,"is-bookmarked",o?0:1),o?s&&(s.innerHTML=lang.mobile_bookmarks_actions_add):s&&(s.innerHTML=lang.mobile_bookmarks_actions_remove),i&&Bookmarks.showSuccessSnack(i)}})},pinArticle:function(e,t,n,i,a){var o=this;e.preventDefault(),this._closeUnfold(e),ajax.post("author_page.php",{act:"pin_article",article_owner_id:t,article_id:n,do_pin:i?0:1,hash:a},{onDone:function(){o.updateList("date",!0)}})},hideArticle:function(e,t,n,i){var a=this;e.preventDefault(),this._closeUnfold(e),ajax.post("author_page.php",{act:"hide_article",article_owner_id:t,article_id:n,hash:i},{onDone:function(){a.updateList()}})}};window.AuthorPage=n},"5qQ6":function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=(n("KMpi"),n("/Id8")),r=n("fdw3");function s(){var e=Object(i.default)(['\n    <div class="msg__newMsgsDivider">\n      <span class="msg__newMsgDividerText">',"</span>\n    </div>\n  "]);return s=function(){return e},e}function l(){var e=Object(i.default)(["\n    ","\n    ","\n  "]);return l=function(){return e},e}var c=function(e){var t,n=e.msgId,i=e.withDivider?function(){var e=window.lang;return a.default.html(s(),e.mobile_mail_new_msgs)}():"",c=store.mail,u=Object(r.isForwardedMessageId)(n)?c.forwards[n]:c.msgs[n],d=c.members[u.authorId],f=u.peerId,_=c.peers[f];if(!e.detailed){var p=store.mail.presend,h=(p=p&&p.msgs)&&p["edit"+n];h&&(u=h)}_&&(_.isIncomingMR||_.isRejectedMR)&&(i="");if(u.isService)t=Object(o.default)({id:n,text:u.service,service:!0,unread:u.isUnread});else{var m=Object(o.Msg__authorName)(d,f,c.cur.userId),A={id:n,text:u.text,important:u.isImportant,unread:u.isUnread,authorPhoto:d.avatar,authorName:m,authorUrl:d.url,date:u.date,removed:c.cur.msgRemoved[n],admin:u.adminName?{name:u.adminName,url:u.adminUrl}:null,edited:u.edited,channel:_.isChannel&&_.ownerId!==c.cur.viewerId,attaches:u.attaches,attachesHTML:u.attachesHTML,attachesLoading:u.attachesLoading,forwards:u.forwards,reply:u.reply,pending:u.pending,waiting:u.waiting,failed:u.failed,sendId:u.sendId,sticker:u.sticker,keyboard:u.keyboard,maxDepth:e.detailed?c.cur.maxDetailedMsgDepth:c.cur.maxMsgDepth};t=e.detailed?Object(o.Msg_detailed)(A):Object(o.default)(A)}return a.default.html(l(),i,t)};t.default=c;window.uMsg=c},6:function(e,t,n){e.exports=n("75Qd")},"75Qd":function(e,t,n){"use strict";n.r(t);n("XCiN");var i=n("OcsD"),a=(n("CQvH"),n("a0wW")),o=n("z9sQ"),r=n("+cqQ"),s=n("TYsd"),l=n("Cbap"),c=n("tgcV"),u=n("BZzM"),d=(n("eGQV"),n("uQjJ"),n("jk6M")),f=(n("wcVR"),n("kr3z")),_={isUploading:!1,onBeforeRemove:Object(r.default)(),onRemove:Object(r.default)("removeElem"),onStart:Object(r.default)(),onError:Object(r.default)("response"),onComplete:Object(r.default)("response"),_uploadData:{},_uploadQueue:[],_readerQueue:[],_processUploadQueue:!1,_processReaderQueue:!1,fallback:function(e,t){var n=window.post;return e&&n.add_attach(e,t),!1},getLastAttachId:function(){if(!ge("attached_wrap"))return 0;var e,t=0;return each(geByTag("input"),function(){if(e=this.name.match(/^attach(\d+)_type$/i)){var n=intval(e[1]);t<n&&(t=n)}}),t},refreshAttachIds:function(e){var t=ge("attached_wrap");if(t){var n,i=gpeByClass("mr_x_wrap",e),a=geByTag1("input",i),o=intval((a&&a.name.match(/^attach(\d+)(_type)?$/i)||[])[1]);if(gpeByClass("mr_timer",e)){var r=attr("add_post_btn","data-value");r&&val("add_post_btn",r)}else o&&each(geByTag("input",t),function(){if(n=this.name.match(/^attach(\d+)(_type)?$/i)){var e=intval(n[1]);e==o?this.disabled=!0:e>o&&(this.name="attach"+(e-1)+(n[2]||""))}})}},getAttachesCount:function(e){void 0===e&&(e=!0);var t=0;return window.ThumbsEdit&&window.ThumbsEdit.initialized&&e&&(t=ThumbsEdit.getThumbsCount()),t+=geByClass("mr_x_wrap","attached_wrap").length},refreshUploadState:function(e){isUndefined(e)&&(e=_.getAttachesCount(!0));var t=ge("attached_wrap"),n=geByClass1("mr_timer",t),i=geByClass1("pi_medias",t),a=ge("attach_photo_btn");if(toggle(i,e>0||isVisible(n)),toggleClass("attached_wrap_empty",t,e<=0),a){toggleClass("cp_attachBtnEl_sel",a,e>0);var o=geByClass1("inline_upload",a);if(o||(o=geByClass1("inline_upload",a.parentNode)),o){var r=attr(o,"data-max-attaches")||10;o.disabled=e>=r}}show("attached_options"),show("attached_flush")},checkUploading:function(e){return!_._processUploadQueue||cancelEvent(e)},attachedPhotoTpl:function(e){var t=[{id:"upload_item_"+e,class:"medias_thumb thumb_item mr_x_wrap thumb_upload",inner:[{id:"upload_image_"+e,class:"tu_img"},{id:"item_progress_wrap_"+e,class:"tu_progress_wrap",inner:[{id:"item_progress_"+e,class:"tu_progress"}]},{id:"item_cancel_wrap_"+e,class:"tu_cancel_wrap",onclick:"return mediaUpload.reset(this, event, '"+e+"');",inner:[{id:"item_cancel_"+e,class:"tu_progress"}]}]}];return ceFromString(s.default.html(t))},onUploadProgress:function(e){var t=ge("item_progress_"+this.id);window.ThumbsEdit&&ThumbsEdit.initialized?ThumbsEdit.onUploadProgress(this.id,e.loaded/e.total*100):setStyle(t,{width:e.loaded/e.total*100+"%",visibility:"visible"})},onUploadComplete:function(e){var t=this,n=e.target.responseText,i=!1;try{i=parseJSON(n)}catch(e){i={error:"ERR_CLIENT_BAD_RESPONSE: bad request response"}}if(i.error)_.onUploadError.call(t,e);else{var a=ThumbsEdit.initialized;t.xhr=ajax.post(t.done_url,{_ajax:1,_query:n,te:intval(a)},{onDone:function(e){var n,i=ge("item_progress_wrap_"+t.id),o=_.getLastAttachId()+1;if(a?(ThumbsEdit.replaceTemp(t.id,e.photo_raw,e.list||"",e.sizes),n=$('[data-media="phototemp_'+t.id+'"]')):n=ge("upload_image_"+t.id),n&&e.src)var r=ce("img",{id:"upload_image_"+t.id,className:"ph_img",onload:function(){if(a&&(n.src=e.src,n.classList.remove("Thumb__wrap--temp"),n.setAttribute("data-media","photo"+e.photo_raw),n.setAttribute("data-upload",t.id)),replace(r,n),t.iw&&t.ih){if(t.iw>t.ih==r.width>r.height)var i=Math.min(130,Math.floor(75/t.ih*t.iw));else i=Math.min(130,Math.floor(75/t.iw*t.ih));setStyle(r,"width",i)}reflow(r),setStyle(r,"opacity",1)},src:e.src});after(ce("input",{type:"hidden",name:"attach"+o,value:e.photo_raw}),n),after(ce("input",{type:"hidden",name:"attach"+o+"_type",value:"photo"}),n),setStyle(i,"opacity",0),t.attached=!0,t.delete_url=e.delete_url,_._processUploadQueue||(_.isUploading=!1,_.onComplete(e))}}),addClass("tu_progress_request","item_progress_wrap_"+t.id),t.uploaded=!0,_.uploadQueueNext()}},onUploadError:function(e){clog("upload error.",e.target.responseText),_.uploadQueueNext(),_.onError(e.target.responseText)},uploadFile:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){e.xhr=uploadFile(e.upload_url,{photo:e.file},{onProgress:bind(_.onUploadProgress,e),onComplete:bind(_.onUploadComplete,e),onError:bind(_.onUploadError,e)})}),readFile:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){readFile(e.file,function(t){var n=ge("upload_image_"+e.id);if(n)var i=ce("img",{id:"upload_image_"+e.id,className:"ph_img",onload:function(){replace(i,n),e.iw=i.width,e.ih=i.height},src:t});_.readerQueueNext()})}),addFile:function(e){var t=ge("attached_wrap"),n=geByClass1("pi_medias",t),i=n?geByClass("medias_thumb",n):[],a=n?geByClass1("medias_row",n):null,o=i[i.length-1],r=_.attachedPhotoTpl(e.id);if(t){if(!n){var s=geByClass1("AddedAttach",t);n=ce("div",{className:"pi_medias"}),append(n,s||t)}window.ThumbsEdit&&ThumbsEdit.initialized?readFile(e.file,function(t){var n=ce("img");n.src=t,n.onload=function(){var i=n.width,a=n.height;window.fakeImg=n;var o=getImageOrientation(t);t="/images/blank.gif";var r=!1;o>4&&o<9&&(r=!0);var s=["photo",e.id,{sizes:{temp:[t,r?a:i,r?i:a]}},{remove:e.id}];ThumbsEdit.addTempPreview(s),CreatePost.checkAttaches()}}):o?after(r,o):a?before(r,a):append(r,n),_._processReaderQueue||_.readerQueueNext()}},uploadQueueNext:function(){clog("next upload"),_._processUploadQueue=!0;var e=_.uploadQueueRemove();if(!e)return clog("empty upload"),_._processUploadQueue=!1,void(_.isUploading=!1);_.uploadFile(e)},readerQueueNext:function(){clog("next reader"),_._processReaderQueue=!0;var e=_.readerQueueRemove();if(!e)return clog("empty reader"),void(_._processReaderQueue=!1);_.readFile(e)},queueInsert:function(e){var t=srand();return _.getUploadDataById(t)?_.queueInsert(e):(_._uploadData[t]=extend(e,{id:t}),_._uploadQueue.push(t),_._readerQueue.push(t),_._uploadData[t])},uploadQueueRemove:function(){var e=_._uploadQueue.shift();return!!e&&_.getUploadDataById(e)},readerQueueRemove:function(){var e=_._readerQueue.shift();return!!e&&_.getUploadDataById(e)},getUploadDataById:function(e){return _._uploadData[e]||!1},delUploadDataById:function(e){delete _._uploadData[e]},start:function(e,t){if(!e||!canUploadFile())return _.fallback(e,t);var n=e.files,i=e.form||gpeByTag("form",e),a=submitBtn(i),o=ge("attach_photo_btn"),r=attr(e,"data-upload-url"),s=attr(e,"data-done-url"),l=attr(e,"data-max-attaches")||10,c=_.getAttachesCount();return r&&s?(each(n,function(){var e={upload_url:r,done_url:s,file:this,uploaded:!1,attached:!1};if(c>=l)return!1;_.queueInsert(e),_.addFile(e),c++}),removeEvent(i,"submit",_.checkUploading),addEvent(i,"submit",_.checkUploading),removeEvent(a,"click",_.checkUploading),addEvent(a,"click",_.checkUploading),removeEvent(o,"click",_.checkUploading),addEvent(o,"click",_.checkUploading),_.refreshUploadState(c),replace(clone(e),e),_._processUploadQueue||_.uploadQueueNext(),window.isNewMail&&_.onStart(),_.isUploading=!0,!1):_.fallback(e,t)},reset:function(e,t,n,i){if(cancelEvent(t),window.isNewMail&&_.onBeforeRemove(e),"/"==n[0]){ajax.post(n,{_ajax:1}),_.refreshAttachIds(e);var a=gpeByClass("mr_x_wrap",e)||gpeByClass("mr_timer",e);i?i():remove(a)}else{var o=n,r=_.getUploadDataById(o);if(!r)return!1;r.attached?r.delete_url&&(ajax.post(r.delete_url,{_ajax:1}),_.refreshAttachIds(e)):(r.xhr&&r.xhr.abort&&r.xhr.abort(),r.loaded||_.uploadQueueNext()),i?i():remove("upload_item_"+o),_.delUploadDataById(o)}return _.refreshUploadState(),window.isNewMail&&_.onRemove(e),Replies.abortTimer("editing"),!1}};window.mediaUpload=_;var p=n("cGUQ"),h={onUploadedDone:Object(r.default)("resp"),fallback:function(e,t){var n=window.nav,i=e.nextSibling;return!!i&&!n.go(i)},onUploadProgress:function(e){window.photoview.updateUpload({progress:e.loaded/e.total})},onUploadComplete:function(e){var t=window.photoview,n=e.target.responseText,i=!1;try{i=parseJSON(n)}catch(e){i={error:"ERR_CLIENT_BAD_RESPONSE: bad request response"}}if(i.error)h.onUploadError.call(this,e);else{this.xhr=null,this.photo_res=n,this.photo_size=i.size;var a=this.static_url+i.x_src,o=i.size[0],r=i.size[1],s=Math.min(o,r);t.onClose=bind(h.onClose,this),t.openCrop({src:a,max_scale:s/200,onSelect:bind(h.onCropSelected,this)})}},onUploadError:function(e){var t=window.photoview;clog("upload error.",e.target.responseText),t.close()},onClose:function(e){this.xhr&&this.xhr.abort&&this.xhr.abort()},onCropSelected:function(e,t,n){var i=window.photoview,a=this,o=a.photo_res,r=a.photo_size,s=r[0],l=r[1],c=Math.min(s,l),u=Math.round(e*s),d=Math.round(t*l),f=Math.round(n*c);if(a.upload_edit_url)var _=a.upload_edit_url;else _=a.base_url+"upload.php?"+Object(p.toQueryString)({act:"owner_photo_edit",_query:o,_origin:location.protocol+"//"+location.host},!0);a.xhr=ajax.plainpost(_,{_crop:[u,d,f].join(",")},function(e){h.onCropSuccess.call(a,e)},function(e){h.onCropCancel.call(a)},!0),i.updateCrop({saving:!0})},onCropSuccess:function(e){var t=window.photoview,n=this;n.xhr=ajax.post("/photos.php?act=done_photo",{_ajax:1,_query:e,_from:n.from},{onDone:function(e){h.onUploadedDone(e),t.close()},onFail:function(){h.onCropCancel.call(n)}})},onCropCancel:function(){window.photoview.updateCrop({saving:!1})},prepareInput:function(e){e.files&&e.files.length&&(e.value="")},start:function(e,t){var n=window.photoview;if(!e||!canUploadFile())return h.fallback(e,t);var i=e.files[0]||!1,a=attr(e,"data-upload-url"),o=attr(e,"data-base-url"),r=attr(e,"data-static-url"),s=attr(e,"data-from");if(!i)return!1;if(!a)return h.fallback(e,t);var l={upload_url:a,base_url:o,static_url:r,file:i,from:s};return l.xhr=uploadFile(a,{photo:i},{onProgress:bind(h.onUploadProgress,l),onComplete:bind(h.onUploadComplete,l),onError:bind(h.onUploadError,l)}),readFile(i,function(e){n.updateUpload({thumb:e})}),replace(clone(e),e),n.onClose=bind(h.onClose,l),n.openUpload({src:null}),!1},getCropFromTag:function(e,t,n){if(!e)return!1;if(3==e.length)var i=+e[0],a=+e[1],o=+e[2];else{i=+e[0]*t/1e4,a=+e[1]*n/1e4,o=+e[2]*t/1e4;var r=+e[3]*n/1e4;if(o>r&&(i+=(o-r)/2,o=r),o<200){var s=(200-o)/2;i-=s,a-=s,o=200}o=Math.min(Math.max(o,200),Math.min(t,n)),i=Math.min(Math.max(i,0),t-o),a=Math.min(Math.max(a,0),n-o)}return[i/t,a/n,o/Math.min(t,n)]},crop:function(e){if(!e||!e.size&&!e.url)return!1;var t=window.photoview,n={upload_edit_url:e.upload_url};if(e.size){n.photo_size=e.size;var i=Math.min(e.size[0],e.size[1]);t.onClose=bind(h.onClose,n),t.openCrop({src:e.thumb,max_scale:i/200,rect:h.getCropFromTag(e.rect,e.size[0],e.size[1]),onSelect:bind(h.onCropSelected,n)})}else{var a=ce("img",{src:e.url,onload:function(){n.photo_size=[a.width,a.height];var i=Math.min(a.width,a.height);t.updateCrop({src:e.thumb,max_scale:i/200,rect:h.getCropFromTag(e.rect,a.width,a.height),onSelect:bind(h.onCropSelected,n)})}});t.onClose=bind(h.onClose,n),t.openCrop({src:!0})}return!0}};window.ownerPhotoUpload=h;n("+YbT"),n("T24x");var m=n("W9Tc"),A=n("wMVj"),v=n("UxAg"),g=n("BoyB"),b=n("V4qE");var y={onDone:function(e,t,n,a){var o=Object(i.ge)(e)||Object(i.geByClass1)("like_box","z")||Object(i.geByClass1)("like_box")||Object(i.geByClass1)("wall_item_for_like_"+e);if(o&&e){var r,s,l=Object(i.geByClass1)("item_repost",o);Object(i.hasClass)("wall_item",o)||Object(i.hasClass)("market_item",o)?s=Object(i.geByClass1)("wi_like_wrap",o):Object(i.hasClass)("ReplyItem",o)?r=Object(i.geByClass1)("ReplyItem__likeWrap",o):s=Object(i.geByClass1)("item_like",o),r||(r=Object(i.geByClass1)("like_wrap",o)),s&&(s.innerHTML=t||"",Object(i.toggleClass)("is_empty",s,!t),Object(i.toggle)(s,t)),l&&(l.innerHTML=n||"",Object(i.toggle)(l,n)),r&&Object(i.val)(r,a||"")}},onFail:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();switch(t){case 2:nav.hard_go(e[0])}}},w={onDone:function(e,t,n,a,o){var r=window,s=r.photo;if(y.onDone.apply(this,arguments),this.photo_id){var l=s.get(this.photo_id);if(l){var c=Object(i.ce)("div",{innerHTML:l.likes});Object(i.val)(Object(i.geByClass1)("item_like",c),t),l.likes=Object(i.val)(c),l.publish='<span class="item_repost">'+n+"</span>",l.likes_cnt=Object(i.intval)((Object(i.attr)(Object(i.geByClass1)("v_like",c),"data-like_count")||"").replace(/\D+/g,"")),l.likes_me=o;c=Object(i.ce)("div",{innerHTML:l.actions});var u=Object(i.geByClass1)("like_wrap",c);Object(i.val)(u,a),l.actions=Object(i.val)(c),s.save(l)}}},onFail:y.onFail},C={onDone:function(e){var t=window.photo;if(this.photo_id){if(!e.error){var n={};"confirm"===e.type?n={type:b.SNACKBAR_TYPE_SUCCESS,text:getLang("mobile_msg_photos_tag_confirmed")}:"delete"===e.type&&(n={type:b.SNACKBAR_TYPE_SUCCESS,text:getLang("mobile_msg_photos_tag_deleted")}),Snackbar.init(n)}var a=t.get(this.photo_id);a&&(a.tag_info="",t.save(a));var o=Object(i.geByClass1)("photo_view"),r=Object(i.geByClass1)("pv_tag_wrap",o);Object(i.val)(r,"")}}},k={onDone:function(e,t,n){var a=window.photo,o=window.menu,r=Object(i.geByClass1)("photo_view"),s=Object(i.geByClass1)("photo_msg"),l=!!t;if(r&&s){Object(i.val)(s,t||""),Object(i.toggleClass)("photo_deleted",r,l);var c=a.get(e);c&&(c.deleted=t,a.save(c)),n&&o&&o.refresh({pp:n})}}},S={onDone:function(e,t){var n=window.isNewMail&&Object(v.$)(".messenger")&&this.link.closest(".msg");if(Object(i.val)(e,t),n){var a=Number(n.className.match(/msg_id_(\d+)/)[1]);store.mail.msgs[a].textFull=n.$(".msg__text").innerHTML}}},E={onDone:function(e){this.link&&(Object(i.after)(cdf(e),Object(i.gpeByClass)("pic_body_wrap",this.link)),Object(i.hide)(this.link))}},O={onStart:function(){Object(i.addClass)("cm_item_loading",this.link)},onDone:function(e){this.link&&Object(i.val)(this.link.parentNode,e)}},T={onDone:function(e,t){if(e){var n=window.photo;Object(i.remove)(e+"_msg");var a=Object(i.ge)(e);if(a){if(t){var o=Object(i.ce)("div",{id:e+"_msg",className:(a.className||"")+" post_message_item"});Object(i.val)(o,'<div class="pi_cont">'+t+"</div>"),Object(i.after)(o,a),Object(i.hide)(a),Object(i.geByClass1)("rtm_reply_wrap",a)&&window.reply&&window.reply.edithide()}else Object(i.show)(e);if(this.photo_id){var r=n.get(this.photo_id);if(r){var s=Object(i.geByClass1)("photoview"),l=Object(i.geByClass1)("comments_wrap",s);r.comments_html=Object(i.val)(l)}}}}}},D={onDone:function(e,t,n,a){if(e){Object(i.remove)(e+"_msg");var o=Object(i.ge)(e);if(o)if(t){var r=(/^([a-z]+)_item$/i.exec(n||"")||[])[1]||"inline",s=Object(i.ce)("div",{id:e+"_msg",className:r+"_item "+r+"_message_item"}),l=a||"message_item_cont";Object(i.val)(s,'<div class="'+l+'">'+t+"</div>"),Object(i.after)(s,o),Object(i.hide)(o)}else!1===t?Object(i.hide)(o):Object(i.show)(o)}}},j={onDone:function(e,t,n){if(e){var a=Object(i.ge)(e),o=Object(i.getY)(a)||Object(i.getY)(e+"_msg"),r=Object(i.getH)(a)||Object(i.getH)(e+"_msg"),s=o+(u<320?r:0)-Object(i.scrollTop)();if(Object(i.remove)(e+"_msg"),a){var l=Object(i.hasClass)("wall_item",a)||Object(i.hasClass)("post",a)?"wall":"post";if(n){var c=Object(i.ce)("div",{id:e+"_msg",className:l+"_item post_message_item"});Object(i.val)(c,'<div class="pi_cont">'+n+"</div>"),Object(i.after)(c,a)}if(t){Object(i.each)(Object(i.geByClass)(l+"_item"),function(){var e=!!this.id&&this.id.match(/^wall((-?\d+)_(-?\d+)(_\d+)?)$/),a=Object(i.attr)(this,"data-copy"),o=!!a&&a.match(/^(-?\d+)_(-?\d+)$/);if(!e)return!0;(!e[4]&&e[2]==t||e[4]&&e[3]==t||o&&o[1]==t)&&Object(i.toggleClass)("post_item_ignored",this,n)});var u=Object(i.getCw)(),d=(o=Object(i.getY)(a)||Object(i.getY)(e+"_msg"),r=Object(i.getH)(a)||Object(i.getH)(e+"_msg"),o+(u<320?r:0)-s);Object(i.geByClass1)("wall_item")===a&&(d=0),Object(i.scrollTop)(d)}}}}},I={onDone:function(e,t){if(e){var n=Object(i.ge)(e);if(Object(i.remove)(e+"_msg"),n&&t){var a=Object(i.hasClass)("wall_item",n)||Object(i.hasClass)("post",n)?"wall":"post",o=Object(i.ce)("div",{id:e+"_msg",className:a+"_item post_message_item"});Object(i.val)(o,'<div class="pi_cont">'+t+"</div>"),Object(i.after)(o,n)}Object(i.toggleClass)("post_item_ignored",n,t)}}},M={onDone:function(e,t,n){if(e){var a=Object(i.ge)(e);if(Object(i.remove)(e+"_msg"),a){if(n){var o=Object(i.ce)("div",{id:e+"_msg",className:"wall_item post_message_item"});Object(i.val)(o,'<div class="pi_cont">'+n+"</div>"),Object(i.after)(o,a)}Object(i.toggleClass)("post_item_ignored",a)}}}},x={onStart:function(){var e=Object(i.gpeByClass)("show_more_wrap",this.link),t=Object(i.geByClass1)("show_more",e)||this.link,n=Object(i.ce)("div",{id:"show_more_loading",className:"show_more_loading",innerHTML:'<i class="i_loading">&nbsp;</i>'}),a=Object(i.ce)("div",{id:"show_more_wrap",className:"show_more_wrap"});Object(i.attr)(n,"data-href",Object(i.getHref)(t)),a.appendChild(n),Object(i.before)(a,e),Object(i.remove)(e)},onDone:function(e){var t=window.cur;ajax.tAlProcess=(new Date).getTime();var n=Object(i.ge)("show_more_wrap"),a=cdf(e);Object(i.before)(a,n),Object(i.remove)(n),ajax.prepare_click("mcont"),Object(i.onBodyScrollForce)(100),ajax.tAlModule=t.module,ajax.tAlRender=(new Date).getTime(),Gif.onUpdate(),Object(u.resizePosters)()}},B={onStart:x.onStart,onDone:function(e,t){x.onDone.apply(null,arguments),Bookmarks.pushItemsToStore(t)}},P={onStart:x.onStart,onDone:function(e,t){var n=window.cur;ajax.tAlProcess=(new Date).getTime();var a=Object(i.geByClass1)("photos_page","mcont"),o=Object(i.ge)("show_more_wrap"),r=cdf(t);e=e.replace(/<img src="([^"]+)" class="/gi,'<img data-src="$1" class="_image ');var s=cdf(e);a&&a.appendChild(s),Object(i.before)(r,o),Object(i.remove)(o),ajax.prepare_click("mcont"),Object(i.onBodyScrollForce)(100),ajax.tAlModule=n.module,ajax.tAlRender=(new Date).getTime(),Object(u.resizePosters)()}},L={onStart:x.onStart,onDone:function(e,t){var n=window.cur;ajax.tAlProcess=(new Date).getTime();var a=Object(i.geByClass1)("audios_block",Object(i.geByClass1)("audios","mcont")),o=Object(i.ge)("show_more_wrap"),r=cdf(t),s=cdf(e);a&&a.appendChild(s),Object(i.before)(r,o),Object(i.remove)(o),ajax.prepare_click("mcont"),ajax.tAlModule=n.module,ajax.tAlRender=(new Date).getTime()}},R={onDone:function(e){var t=this.link.parentNode;Object(i.val)(t,e)}},N={onStart:function(){Object(i.addClass)("mva_item_loading",this.link)},onDone:function(e,t){Object(i.removeClass)("mva_item_loading",this.link),e.upload_url||t&&nav.hard_go(t),ownerPhotoUpload&&ownerPhotoUpload.crop(e)||t&&nav.hard_go(t)},onFail:function(){Object(i.removeClass)("mva_item_loading",this.link)}},F={onStart:function(){var e=this.link,t=Object(i.gpeByClass)("notify_lite",e);if(t)return Object(i.remove)(t);for(;e=e.parentNode;)if(Object(i.hasClass)("notify_item",e)){Object(i.hasClass)("notify_panel",e.parentNode)?Object(i.remove)(e.parentNode):Object(i.remove)(e);break}}},H={onStart:function(){var e=Object(i.geByClass)("pagination","mcont");Object(i.each)(e,function(e,t){Object(i.before)(Object(i.ce)("div",{className:"summary_loading",innerHTML:'<i class="i_loading"></i>'}),t.firstChild)})},onDone:function(e,t,n){var a=window.mail,o=Object(i.ge)("messages"+t);o&&(Object(i.val)(o,e),a.onMessagesRepainted(!0),!this.save&&Object(i.scrollToEl)()),this.save&&a.saveDialog({messages:e},t),this.clear&&(Object(i.val)(Object(i.geByTag1)("textarea","write_form"),""),Object(i.remove)(Object(i.geByClass1)("pi_medias","write_form"))),Object(i.removeClass)("cp_attach_btn_sel",Object(i.geByClass1)("cp_attach_btn")),window.isNewMail&&MailScrap.clearSystemMessage2(),n&&n.play_animation_msg_id&&StickersSettings.getAutoplay()&&StickersAnimation.loadStickerInMvkIMAndPlay(n.play_animation_msg_id)},onFail:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();switch(t){case 2:this.link.form&&this.link.form.submit()}}},U={onStart:function(){var e=Object(i.geByClass)("pagination","mcont");Object(i.each)(e,function(e,t){Object(i.before)(Object(i.ce)("div",{className:"summary_loading",innerHTML:'<i class="i_loading"></i>'}),t.firstChild)})},onDone:function(e,t){var n=window.mail,a=Object(i.ge)("dialogs");a&&(Object(i.val)(a,e),!this.no_scroll&&Object(i.scrollToEl)(),n.cacheDialogsPage()),n.save(t)}},V={onFail:function(e,t){if(e===ajax.RESPONSE_CAPTCHA){var n=this.link&&this.link.form;t+="&code="+(n&&n.code?n.code.value:""),nav.hard_go(t)}}},q={onStart:function(){var e=Object(i.gpeByClass)("friendsList__showMoreBtnWrap",this.link),t=Object(i.geByClass1)("friendsList__showMoreBtn",e)||this.link,n=Object(i.ce)("div",{id:"show_more_loading",className:"wait_loading"}),a=Object(i.ce)("div",{id:"show_more_wrap",className:"friendsList__showMoreBtnWrap"});Object(i.attr)(n,"data-href",Object(i.getHref)(t)),a.appendChild(n),Object(i.before)(a,e),Object(i.remove)(e)},onFail:function(){var e=this,t=this.link.getAttribute("data-href")||this.link.getAttribute("href");setTimeout(function(){ajax.post(t,{_ajax:1},{onDone:q.onDone.bind(e),onFail:q.onFail.bind(e)})},500)},onDone:x.onDone},W={onDone:function(e,t){if(e){var n=Object(i.ge)(e);n&&n.parentNode&&t&&Object(i.replace)(cdf(t),n.parentNode)}}},z={onDone:function(e,t){if(e){var n=Object(i.geByClass)(e);if(n.length&&t)for(var a=0,o=n.length;a<o;a++)n[a].parentNode&&Object(i.replace)(cdf(t),n[a].parentNode)}}},Q={onStart:function(){var e=this.link;e.classList.contains("wia_item")&&e.classList.add("wia_item--loading")},onDone:function(e,t,n,a,o){if(e){var r=Object(i.geByClass)(e);if(r.length&&t)for(var s=0,l=r.length;s<l;s++)r[s].parentNode&&Object(i.replace)(cdf(t),r[s].parentNode);Share.setBookmarkState(a,o),n&&Bookmarks.showSuccessSnack(n)}}},Y={onDone:function(e,t,n,a){if(e){var o=Object(i.ge)(e);if(o){var r=Object(i.geByClass1)("wia_close",o);if(r&&(Object(i.val)(r,n),r.href=t),Object(i.hasClass)("single_wall_item",o)){var s=Object(i.ge)("nc_form"),l=Object(i.geByClass1)("wall_replies");s?Object(i.toggle)(s,!!a):a&&(l?domInsert(l,a):(domInsertAfter(Object(i.ce)("div",{innerHTML:a}),o),l=Object(i.geByClass1)("wall_replies"))),Object(i.toggleClass)("closed_comments",l,!a)}}}}},X={onStart:function(){var e=domPN(this.link),t=Object(i.geByClass1)("Loading",e);t||(t=Object(i.ceFromString)(Object(g.default)({})),append(t,e)),Object(i.addClass)("RepliesThreadNext_loading",e)},onDone:function(e,t,n,a){var o,r=domPN(this.link),s=Object(i.hasClass)("RepliesThreadNext_prev",r),l=0,c=cdf(e);if(domChildren(c).forEach(function(e){Object(i.ge)(e.id)&&re(e)}),s?(o=Object(i.gpeByClass)("wall_replies",r),l=Object(i.getH)(o),Object(i.after)(c,r)):Object(i.before)(c,r),a?(this.link.href=a,Object(i.removeClass)("RepliesThreadNext_loading",r)):re(r),Gif.onUpdate(),Object(u.resizePosters)(),n&&(cur.replyNames=Object(i.extend)(cur.replyNames||{},n)),t&&t.length&&Mention.addItems(t),s){var d=Object(i.getH)(o)-l;Object(i.scrollTop)(Object(i.scrollTop)()+d)}Object(i.onBodyScrollForce)()},onFail:function(){var e=domPN(this.link),t=Object(i.geByClass1)("i_loading",e);Object(i.hide)(t),Object(i.show)(this.link),Object(i.removeClass)("RepliesThreadNext_loading",e)}},G={onDone:function(e,t,n){var a=Object(i.geByClass1)("RepliesWrap");a.innerHTML=e,Gif.onUpdate(),Object(u.resizePosters)(),n&&Object(i.extend)(cur.replyNames,n),t&&t.length&&Mention.addItems(t),Object(i.scrollTop)(Object(i.getH)(a)+Object(i.getY)(a))}},K={onDone:function(e,t,n,a){if(e){var o=Object(i.ge)(e);if(o){if(a)Object(i.geByClass)("ReplyItem__message_type_"+a,o).forEach(function(e){re(e)});var r=Object(i.geByClass1)("ReplyItem__wrap",o),s=Object(i.geByClass)("ReplyItem__message",o),l=s.pop();if(t){var c=cdf(t);Object(i.hide)(l||r),Object(i.after)(c,l||r),Object(i.geByClass1)("rtm_reply_wrap",o)&&window.reply&&window.reply.edithide()}else a||(re(l),l=s.pop()),Object(i.show)(l||r);if(n){var u=Object(i.ge)("RepliesThread"+n);u&&Object(i.toggle)(u,!t)}}}}};window.Like=y,window.PhotoLike=w,window.PhotoTag=C,window.PhotoDelete=k,window.Poll=S,window.CopyHistory=E,window.ToggleMenu=O,window.Comment=T,window.ItemDelete=D,window.FeedIgnore=j,window.FeedIgnoreItem=I,window.FeedIgnoreComments=M,window.Wall=x,window.Bookmark=B,window.BookmarkToggle=Q,window.Photos=P,window.Audios=L,window.FixPost=R,window.ProfileMove=N,window.Notify=F,window.Dialog=H,window.Dialogs=U,window.LoginCheckAuthCodePage=V,window.WallSubscribe=W,window.FeedSubscribe=z,window.ImportedFriends=q,window.CloseComments=Y,window.RepliesNext=X,window.RepliesLast=G,window.ReplyAction=K,window.MiniAppsCatalogResetRecent=function(e){if(e.dataset.section){var t={act:"mini_apps_reset_recent",hash:e.dataset.hash||""};ajax.post("/apps.php",t,{onDone:function(){var t=Object(i.ge)("mini_apps_"+e.dataset.section);t&&t.remove()}})}};n("AeId"),n("Gzds"),n("kYGI");var J=n("Qz23"),Z=function(){return!window.al||!window.al.menu||window.isNewNavigation},ee=!1,te={NEED_MENU_PARAM:"_nlm",NEED_MENU:1,FORCE_NEED_MENU:2,enabled:function(e){return Z()?(window.isNewNavigation||(Object(i.removeClass)("_lm",window.bodyNode),Object(i.removeClass)("_lms",window.bodyNode)),!1):(void 0!==e&&(e?Object(i.replaceClass)("_lms","_lm",window.bodyNode):(Object(i.replaceClass)("_lm","_lms",window.bodyNode),te.qsClose())),Object(i.hasClass)("_lm",window.bodyNode))},opened:function(){return Object(i.hasClass)("lm_opened",window.bodyNode)},toggle:function(e,t){return!!Object(i.checkEvent)(e)||(!!Z()||(te.opened()?te.close(e,t):te.open(e,t),!1))},open:function(e){var t=window.zlayer;if(Object(i.checkEvent)(e))return!0;if(Z())return!0;if(te.opened())return!1;if(t&&t.opened())return!1;if(!te.enabled())return nav.go("/"),!1;te.clear_hover();var n=Object(i.ce)("div",{id:"m_helper",onclick:te.close}),a=te._st||0,o=Object(i.scrollTop)(),r=Object(i.ge)("l"),s=Object(i.ge)("m"),l=Object(i.ge)("vk_wrap"),c=(Object(i.geByClass1)("head_search",r),l.offsetWidth),u=s.offsetWidth,d=s.offsetHeight;if(!(c>=882)){Object(i.append)(n,"m"),te.fixed?(Object(i.addClass)("lm_opened",window.bodyNode),Object(i.addClass)("lm_anim_start",l),setTimeout(function(){Object(i.replaceClass)("lm_anim_start","lm_anim lm_anim_end",l)},5),setTimeout(function(){Object(i.removeClass)("lm_anim_end",l),Object(i.removeClass)("lm_anim",l)},200),Object(i.addEvent)(s,"touchmove",te.blockScroll)):Object(i.addClass)("lm_opened",window.bodyNode);var f=r.offsetHeight;return c>=480?a=o<=f-Object(i.getCh)()?Math.min(o,f-Object(i.getCh)()):0:o<a?a=o:o-a>d-f&&d>f&&(a=o-d+f),te._st=Math.max(0,o-a),te._mw=u,te.fix_size(!1),te.fixed||Object(i.scrollTop)(a),ajax.post("/",{_ajax:1,act:"ping"}),window.lm_qsearch_counter?window.lm_qsearch_counter--:window.lm_qsearch_counter=-1,window.lm_qsearch_counter>0&&te.cancelSearch(),!1}},close:function(e){if(Object(i.checkEvent)(e))return!0;if(Z())return!0;if(!te.opened())return!1;Object(i.remove)("m_helper"),te.clear_hover();var t=Object(i.scrollTop)(),n=te._st+t,a=Object(i.ge)("l"),o=Object(i.ge)("m"),r=Object(i.ge)("vk_wrap"),s=(Object(i.geByClass1)("head_search",a),Object(i.ge)("vk_wrap").offsetWidth>=480);return te.fixed?(Object(i.addClass)("lm_anim_end",r),setTimeout(function(){Object(i.replaceClass)("lm_anim_end","lm_anim lm_anim_start",r)},5),setTimeout(function(){Object(i.removeClass)("lm_anim_start",r),Object(i.removeClass)("lm_anim",r),Object(i.removeClass)("lm_opened",window.bodyNode)},200),Object(i.removeEvent)(o,"touchmove",te.blockScroll)):Object(i.removeClass)("lm_opened",window.bodyNode),te._st=s?0:t,te.fix_size(!0),te.fixed||Object(i.scrollTop)(n),window.lm_qsearch_focused&&te.cancelSearch(),!1},fix_size:function(e){var t=Object(i.ge)("l"),n=Object(i.ge)("m"),a=Object(i.ge)("mhead"),o=a&&a.offsetHeight||0,r=te._st||0;t&&n&&(e?n.style.minHeight="0":(r=r>o?r:0,n.style.minHeight=t.offsetHeight+r+"px"),!te.fixed||Object(i.getCw)()<320?e?n.style.marginTop="0":(t.style.minHeight=Object(i.getCh)()+"px",n.style.marginTop=-r+"px"):t.style.minHeight="0")},clear_hover:function(){thover.clear()},refreshCounters:function(e){if(window.isNewNavigation&&(Tabbar.setCounter(Tabbar.TAB_ID_NOTIFICATION,e[2]),Tabbar.setCounter(Tabbar.TAB_ID_MESSAGES,e[3])),!e||!e.length)return!0;if(!window.al||!window.al.menu)return!0;if(e.length!=window.al.menu.length)return!1;var t=window.al,n=Object(i.geByClass1)("main_menu","l"),a=e[2];return"number"==typeof a&&isFinite(a)&&(Bell.setCount(a),window.store&&(store.notificationsCount=a)),Object(i.each)(e,function(e,a){if(void 0===a)return!0;var o=t.menu[e],r=Object(i.geByClass1)("mmi_"+o[0],n),s=Object(i.geByClass1)("mm_item",r),l=Object(i.geByClass1)("mmi_wrap",r),c=Object(i.geByClass1)("mm_counter",l);Object(i.attr)(s,"data-href",!1),a?(o[3]&&Object(i.attr)(s,"href",o[3]),c?Object(i.val)(c,a):Object(i.append)(Object(i.ce)("em",{className:"mm_counter",innerHTML:a}),l)):(o[2]&&Object(i.attr)(s,"href",o[2]),Object(i.remove)(c)),ajax.prepare_click(s)}),!0},refresh:function(e){e=e||{},ajax.refreshLinks(e.fv_link,e.app_link),void 0!==e.pp&&!1!==e.pp&&Object(i.val)("lm_prof_panel",e.pp),void 0!==e.tn&&!1!==e.tn&&Object(i.val)("lm_top_notify",e.tn),void 0!==e.bn&&!1!==e.bn&&Object(i.val)("lm_bottom_notify",e.bn),e.lm&&Object(i.val)("l",e.lm),e.counters&&te.refreshCounters(e.counters),e.tab&&Tabbar.setCurrentId(e.tab),e.topbar||Object(i.remove)("vk_topbar")},initEvents:function(){Object(i.onBodyResize)(function(){var e=Object(i.ge)("vk_wrap").offsetWidth,t=Object(i.hasClass)("_hfixed",window.bodyNode);e>=882&&te.close(),te.fix_size(!te.opened(),t)})},init:function(){te.fixed=Object(i.hasClass)("_hfixed",window.bodyNode),te.initEvents(),Object(i.addEvent)(window,"orientationchange",function(){var e=Object(i.ge)("vk_wrap").offsetWidth,t=te._st||0;e>=882&&t>44&&te.close()});var e=Object(v.$)(".leftMenu__content");e&&Object(J.setScrollView)(e,{topBanner:!!d.default.ipad&&void 0,overscrollY:!1,standalone:!0})},blockScroll:function(e){var t=Object(i.ge)("vk_wrap");te.opened()&&Object(i.getW)(t)<882&&Object(i.preventEvent)(e)},qsOpened:!1,qsOpen:function(){te.qsOpened||(te.qs_st=Object(i.scrollTop)(),Object(i.addClass)("qs_opened","vk_wrap"),Object(i.addClass)("qs_opened",window.bodyNode),Object(i.getW)("vk_wrap")<882&&Object(i.scrollTop)(0),te.qsOpened=!0)},qsClose:function(){te.qsOpened&&(Object(i.removeClass)("qs_opened","vk_wrap"),Object(i.removeClass)("qs_opened",window.bodyNode),Object(i.getW)("vk_wrap")<882&&Object(i.scrollTop)(te.qs_st||0),te.qsOpened=!1)},initSearch:function(){ee||(ee=!0,Object(i.addEvent)("lm_search_items","mousedown touchstart",function(e){e.stopPropagation()},{passive:!0}),Object(i.addEvent)(Object(i.geByClass1)("head_search","l"),"mousedown touchstart",function(e){e.stopPropagation()},{passive:!0}),Object(i.addEvent)(document,"mousedown touchstart",function(e){Object(i.ge)("vk_wrap");te.qsOpened&&(te.qsClose(),Object(i.elblur)("lm_search_field"))},{passive:!0}))},closeSearch:function(){return!!Z()||(window.lm_qsearch&&window.lm_qsearch.blur(),te.qsClose(),!1)},cancelSearch:function(){return!!Z()||(window.lm_qsearch&&window.lm_qsearch.clear(),te.qsClose(),!1)},headerAction:function(e,t){return Object(i.getW)("vk_wrap")>=882?nav.go(e,t):te.toggle()}};window.menu=te;var ne=n("wTgh"),ie=function(){var e={},t={},n=null,a=!1,o={},r={},s={},l=null;function c(){if(n){var t=[],i=!1;if(each(geByClass("_unread"),function(){var e=+attr(this,"data-id");e&&t.push(e),i=ie.getPeerByMsg(e),replaceClass("_unread","_read",this)}),i){var a=ge("messages"+i);a&&e[i]&&(e[i].messages=val(a))}t.length&&ie.sendMarkAsRead(n,t)}}function u(e,t){t?(addClass("lvi",e),toggleClass("mlvi",e,!!d.mobPlatforms[t])):(removeClass("lvi",e),removeClass("mlvi",e))}function f(e){(0,e.updater)(document.body),each(e.caches,function(t,n){var i=n.storage,a=n.getter,o=function(e,t){var n,i=t.split("."),a=i.length,o=e;for(n=0;n<a;n++)if(!(o=o[i[n]]))return null;return o}(i,a);if(o){var r="string"==typeof o;r&&(o=ce("div",{innerHTML:o})),e.updater(o),function(e,t,n){var i,a,o=t.split("."),r=o.length-1,s=e;for(a=0;a<r;a++)s=s[i=o[a]]||(s[i]={});s[o[r]]=n}(i,a,r?o.innerHTML:o)}})}return!window.isNewMail&&window.nav&&window.nav.onBeforeGo(function(e,t,n){if(nav.getQuery("community")&&(!n||!n.ignore_cur_process)&&"/mail"===("string"==typeof e?e:attr(e,"href")||attr(e,"data-href")))return nav.go(e,t,{ignore_cur_process:!0}),!0}),!window.isNewMail&&window.nav&&window.nav.onBeforeGo(function(){if(nav.getQuery("community"))var e=ajax.post("/",{_ajax:1,act:"ping"},{onDone:function(){try{var t=JSON.parse(e.response),n=t&&t[1]&&t[1][2];ie.actualizeMessagesCornerCounter(n)}catch(e){}}})}),{wrapLinks:ne.wrapLinks,wrapMention:oe,onShowDialogFromCache:Object(i.se)(),onShowWritePageFromCache:Object(i.se)(),onShowDialogsPageFromCache:Object(i.se)(),onMessagesRepainted:Object(i.se)(),init:function(t,i){var o=window.im;window.cur.destroy.push(function(){AudioMessagePlayer.detachPlayer()}),i&&(cur.ref=i.ref,cur.refSource=i.ref_source),t&&(n=t,i&&(ie.saveDialog(i,t),e[t])),a||(a=!0,addEvent(document,d.isTouch?"touchstart":"mousedown",c)),setTimeout(function(){o.on()})},unpinMessage:function(t){f({caches:[{storage:e,getter:t+".write_form"}],updater:function(e){e.$$(".cm_unpin").forEach(hide),e.$$(".head_actions_wrap").forEach(function(e){return e.classList.remove("head_actions_has_pinned")}),e.$$(".pinnedMsg_peer_"+t).forEach(function(e){return e.classList.add("pinnedMsg_hidden")})}})},pinMessage:function(t,n){f({caches:[{storage:e,getter:t+".write_form"}],updater:function(e){e.$$(".cm_unpin").forEach(show),e.$$(".head_actions_wrap").forEach(function(e){return e.classList.add("head_actions_has_pinned")}),$$(".pinnedMsg_peer_"+t).forEach(function(e){return e.outerHTML=n})}})},clear:function(){nav.clear();var i=window.im;e={},t={},o={},n=null,removeEvent(document,d.isTouch?"touchstart":"mousedown",c),a=!1,i.off()},send:function(e,t){if(mediaUpload&&!mediaUpload.checkUploading())return!1;var n=ajax.click(e,extend({clear:!0,save:!0},Dialog),{lock:!0,url_params:{ref_source:cur.refSource,ref:cur.ref}});return cur.ref=void 0,cur.refSource=void 0,n},save:function(t){each(t,function(t,n){e[t]&&n.last_msg==e[t].last_msg&&delete n.messages,ie.saveDialog(n,t)})},saveDialog:function(t,n){e[n]||(e[n]={});var i=e[n];extend(i,t),i.msgs&&each(i.msgs,function(e,t){o[t]=n})},getPeerByMsg:function(e){return o[e]||!1},cacheDialogsPage:function(){nav.getQuery("community")&&nav.getQuery("tab")||(t.page=val("m"),nav.getQuery().act?t.link=ae("/mail"):t.link=nav.cur)},keyup:function(e,t,n){var i=l||"",a=e.value||"";i.length==a.length&&i==a||(ie.myTyping(t,n),l=a)},myTyping:function(e,t){if(!(e<=-2e9)){var n=vkNow();s[e]&&n-s[e]<5e3||(s[e]=n,ajax.post("/mail",{_ajax:1,act:"typing",peer:e,hash:t,community:nav.getQuery("community")}))}},typing:function(e,t){t=t||e;e>2e9?(r[e]||(r[e]={}),r[e][t]=vkNow()):r[e]=vkNow(),ie.updateTyping(e)},updateTyping:function(e){var t=function(e,t){return e.getAttribute&&e.getAttribute(t)},n=window.lang,i=ge("dialog_near"+e),a=geByClass1("di_current_peer",i),o=geByClass1("di_typing",i);if(i){var s=[],l=vkNow();if(e>2e9)each(r[e]||{},function(e,n){t(o,"data-u"+e)&&n&&l-n<6e3&&s.push(e)});else{var c=r[e];t(o,"data-u"+e)&&c&&l-c<6e3&&s.push(e)}if(s.length){if(1==s.length){var u=s[0],d=t(o,"data-u"+u),f=t(o,"data-s"+u);val(o,'<i class="i_typing"></i>'+(n.mobile_mail_typing[f]||"").replace("{user}",d))}else{each(s,function(e,n){s[e]=t(o,"data-u"+n)});var _=s.pop();val(o,'<i class="i_typing"></i>'+(n.mobile_mail_multi_typing||"").replace("{users}",s.join(", ")).replace("{last_user}",_))}a.offsetWidth&&setStyle(o,"minWidth",a.offsetWidth),addClass("di_typing_now",i),setTimeout(function(){addClass("di_typing_animated",i)},10),setTimeout(function(){ie.updateTyping(e)},2e3)}else val(o,""),setStyle(o,"minWidth",0),removeClass("di_typing_animated",i),removeClass("di_typing_now",i)}},updateOnline:function(t,n){var i=ge("messages"+t);if(i&&remove(geByClass1("di_activity",i)),each(geByClass("_lv"+t,"mcont"),function(e,t){u(t,n)}),e[t]){if(e[t].write_form){var a=ce("div",{innerHTML:e[t].write_form});each(geByClass("_lv"+t,a),function(e,t){u(t,n)}),e[t].write_form=val(a)}if(e[t].messages){a=ce("div",{innerHTML:e[t].messages});remove(geByClass1("di_activity",a)),e[t].messages=val(a)}}},updateImportantMessages:function(n,i,a){f({caches:[{storage:t,getter:"page"},{storage:nav.page_get(ae("/mail")),getter:"html"}],updater:function(e){var t=geByClass1("dialogs_filter_button_important",e);if(t){var n=intval(val(t))+a;val(t,n),toggleClass("dialogs_filter_without_important",geByClass1("dialogs_filter",e),0===n)}}}),f({caches:[{storage:e,getter:n+".messages"}],updater:function(e){var t=geByClass1("_msg"+i,e);t&&toggleClass("msg_item_important",t,1===a)}})},updateImportantDialog:function(e,n){nav.getQuery("community")&&f({caches:[{storage:t,getter:"page"},{storage:nav.page_get(ae("/mail")),getter:"html"}],updater:function(t){var i=geByClass1("_peer"+e,t);i&&toggleClass("dialog_item_important",i,n)}})},markAsListened:function(t){var i=+t.getAttribute("data-msg");if(i&&n){var a=e[n];a&&a.hash&&ajax.post("/mail",{_ajax:1,act:"listen_audiomsg",msg_id:i,hash:a.hash},{onDone:function(){var e=$$('.audio-msg-track[data-msg="'+i+'"]');if(e&&(e.forEach(function(e){e.closest(".im_msg_audiomsg").classList.add("im_msg_audiomsg_listened")}),a&&a.messages)){var t=ce("div",{innerHTML:a.messages}),n=geByClass1("_msg"+i,t),o=$('.audio-msg-track[data-msg="'+i+'"]',n);o&&o.closest(".im_msg_audiomsg").classList.add("im_msg_audiomsg_listened"),a.messages=val(t)}}})}},sendMarkAsRead:function(t,n){isArray(n)||(n=[n]);var i=e[t];i&&i.hash&&ajax.post("/mail",{_ajax:1,act:"mark_read",peer:t,msgs:n.join(","),hash:i.hash,community:nav.getQuery("community")},{onDone:function(e){e&&each(n,function(e,n){ie.markAsRead(t,n)})}})},markAsRead:function(t,n){window.im;var i=ge("messages"+t);if(i){var a=geByClass1("_msg"+n,i);hasClass("_read",a)||removeClass("mi_unread",a);var o=e[t];if(o&&o.messages){var r=ce("div",{innerHTML:o.messages});a=geByClass1("_msg"+n,r);hasClass("_read",a)||removeClass("mi_unread",a),o.messages=val(r)}}},markPeerAsRead:function(n,i,a){var o=ge("messages"+n);if(o&&(each(geByClass("msg_item",o),function(){if(!a==!hasClass("_unread",this))return!0;+attr(this,"data-id")<=i&&!hasClass("_read",this)&&removeClass("mi_unread",this)}),(c=e[n])&&c.messages)){var r=ce("div",{innerHTML:c.messages});each(geByClass("msg_item",r),function(){if(!a==!hasClass("_unread",this))return!0;+attr(this,"data-id")<=i&&!hasClass("_read",this)&&removeClass("mi_unread",this)}),c.messages=val(r)}var s=ge("dialogs"),l=a?"di_unread_outbox":"di_unread_inbox";if(s)(c=geByClass1("_peer"+n,s))&&hasClass(l,c)&&(removeClass(l,c),remove(geByClass1("di_unread_cnt",c)));else if(t.page){var c;r=ce("div",{innerHTML:t.page});(c=geByClass1("_peer"+n,r))&&hasClass(l,c)&&(removeClass(l,c),remove(geByClass1("di_unread_cnt",c))),t.page=val(r)}f({caches:[{storage:nav.page_get(ae("/mail")),getter:"html"}],updater:function(e){var t=geByClass1("_peer"+n,e);t&&hasClass(l,t)&&(removeClass(l,t),remove(geByClass1("di_unread_cnt",t)))}})},markAsDeleted:function(t,n){var i=ge("messages"+t);if(i){remove(geByClass1("_msg"+n,i));var a=e[t];if(a&&a.messages){var o=ce("div",{innerHTML:a.messages});remove(geByClass1("_msg"+n,o)),a.messages=val(o)}}ajax.click(ae(nav.path),extend({no_scroll:!0},Dialogs))},addMessage:function(t,n,i,a){if(window.isNewNavigation||nav.clear(),t<2e9?delete r[t]:r[t]&&delete r[t][i],ie.updateTyping(t),!0!==a){if(t&&n&&(o[n]=t),!geByClass1("_msg"+n)){var s=e[t];if(s&&s.messages){s.msgs&&s.msgs.push(n);var l=ce("div",{innerHTML:s.messages});(u=geByClass1("di_activity",l))?(after(cdf(a),u),s.messages=val(l)):s.messages=a+s.messages,(c=ge("messages"+t))&&(val(c,s.messages),ie.onMessagesRepainted(!0))}else{var c,u;if(c=ge("messages"+t))(u=geByClass1("di_activity",c))?after(cdf(a),u):val(c,a+val(c))}}}else if(ge("dialogs")&&"/mail"==nav.path){var d=nav.getQuery();d.act||d.offset||d.q||ajax.click(ae(nav.path),extend({no_scroll:!0},Dialogs))}},replaceMessage:function(t,n,i,a){var o=ge("messages"+t),r=e[t];if(r&&r.messages){var s=ce("div",{innerHTML:r.messages}),l=geByClass1("_msg"+n,s);l&&(l.outerHTML=a),r.messages=val(s),val(o,r.messages)}else geByClass1("_msg"+n).outerHTML=a},getMsgHTML:function(t,n,i,a,o,r,s,l){var c=window,u=c.vk,d=c.lang,f=2&n?u.id:s&&s.from||i;if(!f)return!1;if(!ge("messages"+i))return!0;if(s.attach1||s.fwd||s.geo||s.emoji)return!1;if(s.source_act)return!1;if(!e[i]||!e[i].hash)return!1;var _="_u"+f,p=geByClass1(_,"mcont","a"),h=stripTags(attr(p,"data-name")||val(p)||""),m=getHref(p),A=geByClass1(_,"mcont","img"),v=A&&A.src||"";if(!h||!m||!v)return!1;i=intval(i),t=intval(t),o=o&&-1==o.toString().indexOf(" ... ")&&i<2e9?o:"";var g,b,y,w=1&n?" mi_unread":"";return!(2&n)&&1&n&&(w+=w?" _unread":""),r=ie.wrapLinks(r,n),r=ie.wrapMention(r),('<a name="msg{{msgId}}"></a><div  class="msg_item _msg{{msgId}}{{msgClass}}"  data-id="{{msgId}}"  onclick="return MessagesActions.onMessageClick(event);">  <div class="mi_iwrap">    <a class="al{{cl}}" href="{{href}}">      <img src="{{photo}}" class="mi_img {{cl}}" />    </a>  </div>  <div class="mi_cont">    <div class="mi_head">      <a class="mi_date" href="'+ae("/mail?act=msg&id={{msgId}}").replace(/\&/g,"&amp;")+'">        {{time}}      </a>      {{edited}}\n      <a class="mi_author al{{cl}} {{cl}}" href="{{href}}" data-name="{{dataName}}">        {{name}}      </a>    </div>    <div class="mi_body">      {{mi_title}}      <div class="mi_text">{{text}}</div>    </div>  </div></div>').replace(/{{msgId}}/g,t).replace(/{{cl}}/g,_).replace(/{{href}}/g,m).replace("{{msgClass}}",w).replace("{{edited}}",l?'<span class="mi_edited">'+d.mobile_mail_edited+"</span>":"").replace("{{photo}}",v).replace("{{time}}",(g=new Date(1e3*a),b=g.getHours(),y=g.getMinutes(),b+":"+(y<10?"0":"")+y)).replace("{{dataName}}",escapeAttr(h)).replace("{{name}}",h.split(" ").shift()).replace("{{mi_title}}",o?'<div class="mi_title">'+o+"</div>":"").split("{{text}}").join(r)},updateStickers:function(){var t=window.cur,i=window.post,a=e[n];if(a){var o=a.write_form?(t.sticker_panel||"").split("mail-0").join("mail"+n):"",r=ge("stickers_panel");r&&(replace(cdf(o),r),r=null,i.stickersInit())}},showDialog:function(i,a,o){var r=window.cur,s=window,c=s.MessagesActions,u=s.Mention,d=s.Dialog,f=window.post;if(c.hasFwdMessages())return c.attachFwdMessages(a),!1;t.scroll_top=scrollTop();var _=e[a];if(_){var p=ce("div",{innerHTML:val("m")}),h=geByClass1("mhb_back",p);if(h&&_.header){var m=ce("div");val(m,_.header),before(m.firstElementChild,h),remove(h)}var A=_.write_form?(r.sticker_panel||"").split("mail-0").join("mail"+a):"";val(geByClass1("pcont",geByClass1("mcont",p)),_.write_form+A+(a?'<div id="messages'+a+'" class="messages bl_cont">'+(_.messages||"")+'<div id="al_loading"></div></div>':"")),val("m",p.innerHTML),f.stickersInit(),ajax.refreshLinks(_.fv_link,_.app_link),alLoadingFix(),n=a,_;var v=getHref(i);nav.go(v,null,{push_only:!0,no_push:o}),a?(l=null,ie.updateTyping(a),ajax.click(v,extend({save:a},d),{scroll:!0})):ie.onShowWritePageFromCache(!0),ie.onShowDialogFromCache(!0),scrollTop(0,10)}else nav.al_go(_&&_.cur_link||getHref(i)||nav.cur);nav.getQuery("community")&&"unread"===nav.getQuery("ctab")&&removeClass("al_back",geByClass1("mhb_back"));var g=geByClass1("MentionContainer"),b=parseJSON(attr(g,"data-mentions"))||[];return b.length&&u.init({url:!1,appendTo:g,defaultItems:b,items:b,preferDomain:!0}),AudioMessagePlayer.events.on("listened",ie.markAsListened),!1},backToDialogs:function(e){if(t.page)nav.go(t.link,null,{push_only:!0,no_push:e}),ajax.click(t.link,extend({no_scroll:!0},Dialogs)),val("m",t.page),ajax.refreshLinks(attr("fv_link","href")||attr("fv_link","data-href"),"vkontakte://vk.com/mail"),n=null,scrollTop(t.scroll_top||0),ie.onShowDialogsPageFromCache(!0);else{var i=ae(t.link||"/mail");nav.go(i,null,{push_only:!0,no_push:e}),nav.al_go(i)}},actualizeMessagesCornerCounter:function(e){f({caches:[{storage:t,getter:"page"},{storage:nav.page_get(ae("/mail")),getter:"html"}],updater:function(t){var n=geByClass1("mhi_notify",t),i=geByClass1("mh_notify_counter",n);i||(i=ce("em",{className:"mh_notify_counter"}),append(i,n)),e?i.innerText=e:n.innerHTML="&nbsp;"}})}}}();function ae(e){var t=window.nav.getQuery(),n=t.community,i=t.ctab,a=n&&-1===e.indexOf("community=")?"community="+n:"",o=n&&i&&-1===e.indexOf("ctab=")?"&ctab="+i:"";return a?e+(e.indexOf("?")>=0?"&":"?")+a+o:e}function oe(e){return e.replace(/\[(id|club)(\d+)(?:\:([a-z0-9_\-]+))?\|([^\$]+?)\]/g,function(e,t,n,i,a){return'<a href="/'+(t+n)+'" class="mem_link">'+a+"</a>"})}window.mail=ie,window.makeUrl=ae,window.Scroller=function(e,t){var n,i,a,o,r,s=t&&t.ignoreMouseWheel,l=t&&t.noAutoScroll,c=!isUndefined(document.ontouchmove),u=!0,f=!1,_=!1,p=!1,h=!1,m=0,A=0,v=!1,g=0,b=!1,y=!1,w=!1,C=!1;function k(e){var t=e.touches,n=getX(i),a=getY(i);return{x:((t&&t[0]?t[0].pageX:e.pageX)||0)-n,y:((t&&t[0]?t[0].pageY:e.pageY)||0)-a}}function S(e){v||(v=[]),v.push([vkNow(),e]),v=v.slice(-20)}function E(){v=!1}function O(){if(!v||v.length<2)return[0,0,0];for(var e=vkNow(),t=!1,n=v.pop(),i=v.length-1;i>=0;i--){if((a=e-v[i][0])>150)break;t=v[i]}if(!t||!n)return[0,0,0];var a,o=n[1].x-t[1].x,r=n[1].y-t[1].y,s=Math.sqrt(o*o+r*r);return(a=n[0]-t[0])?[s/a,o/a,r/a]:[0,0,0]}function T(e){"touchstart"==e.type?u=!e.touches||1==e.touches.length:"touchmove"==e.type?u=!1:"click"==e.type&&(u||(cancelEvent(e),u=!0))}function D(e){if(!(window.isNewMail&&e.target.closest(".stickers_panel")&&e.target.closest(".messenger")||C&&e.touches&&e.touches.length>1)){if(E(),_){if(A<=1)return}else if(getW(i)-getW(a)>=0)return;p=k(e),S(h=p),w=!0,setStyle.animate(a)}}function j(e){if(p&&(C||w)){thover&&thover.cancel(e);var t=k(e);if(S(h=t),w){var n=p.x-t.x,o=p.y-t.y;if(Math.abs(n)>=Math.abs(o)&&(cancelEvent(e),C=!0),w=!1,C){var r=getY(i),s=getH(i),c=scrollTop(),u=getCh();!l&&(r-7<c?scrollTop(r-7):r+s+7>c+u&&scrollTop(r+s+7-u))}}if(C)if(cancelEvent(e),_){var d=getW(i);n=p.x-t.x;(m<=0&&n<0||m>=A-1&&n>0)&&(n/=3);var v=-m-n/d,b=f?100*v+"%":v*d;setStyle.transform(a,{translate:[b,0]})}else{var y=getW(i)-getW(a);n=p.x-t.x;if(y>0&&(y=0),(v=g-n)<y)b=y-(y-v)/3;else if(v>0)b=0+(v-0)/3;else b=g-n;B(b),setStyle.transform(a,{translate:[b,0]})}}}function I(e){if(p&&C){if(cancelEvent(e),_){var t=4.7*O()[1],n=p.x-h.x,o=getW(i),r=Math.abs(n)>=o/2;(m>0&&(r&&n<0||t>1)||m<A-1&&(r&&n>0||t<-1))&&(m+=n>0?1:-1);var s=-m,l=f?100*s+"%":s*o;p=!1,E(),P(),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[l,0]})}else{var c=function(){if(!v)return!1;var e=O(),t=e[0],n=e[1];if(E(),!t)return!1;var i=t/4.7,a=n*i-4.7*i*i/2;return i*=530,a*=140,clog("dx",a,"t",i),!(t<.1||!a)&&{dx:a,t:i}}(),u=getW(i)-getW(a);n=p.x-h.x,s=g-n;c&&(s+=c.dx),u>0&&(u=0),g=s<u?u:s>0?0:s;var d={duration:200,func:"ease"};c&&(d={duration:c.t,func:"cubic-bezier(0, 1, 1, 1)"}),B(g),setStyle.animate(a,"transform",d),setStyle.transform(a,{translate:[g,0]})}C=!1}}function M(e){if(!(s||window.isNewMail&&e.target.closest(".stickers_panel")&&e.target.closest(".messenger"))){if(preventEvent(e),_){if(A<=1)return}else if((n=getW(i)-getW(a))>=0)return;var t=(e.detail?e.detail:e.wheelDelta)>0?3:-3;if(!1===b&&(b=0),b+=t,!_){var n=getW(i)-getW(a),o=g-b;if(n>0&&(n=0),o<n)var r=n-(n-o)/3;else if(o>0)r=0+(o-0)/3;else r=g-b;B(r),setStyle.transform(a,{translate:[r,0]})}clearTimeout(y),y=setTimeout(function(){if(_){(m>0&&b<0||m<A-1&&b>0)&&(m+=b>0?1:-1);var e=-m,t=getW(i),n=f?100*e+"%":e*t;P(),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[n,0]})}else{var o=getW(i)-getW(a);o>0&&(o=0),(e=g-b)<o?g=o:e>0?g=0:g-=b,B(n),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[g,0]})}b=!1},200)}}function x(e){if(_){var t=m;if(e&&e.target){var n=hasClass("sp_ppt",e.target)?e.target:gpeByClass("sp_ppt",e.target),o=+attr(n,"data-i");m=o<0?0:o>A-1?A-1:o}p=!1,E(),C=!1;var r=getW(i),s=-m,l=f?100*s+"%":s*r;P(),t!=m&&setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[l,0]})}}function B(e){if(!_){e=e||g;var t=getW(i)-getW(a);toggleClass("sw_left",i,e<0),toggleClass("sw_right",i,e>t)}}function P(){if(_){var e=geByClass1("sp_ppt_sel",n);e&&e===r[m]||(removeClass("sp_ppt_sel",e),addClass("sp_ppt_sel",r[m]))}}extend(this,{init:function(){i=geByClass1("scroller_wrap",n),a=geByClass1("scroller_cont",i),_?(o=geByClass1("sp_pages_pts",n),r=geByClass("sp_ppt",o),A=(geByClass("scroller_page",a)||[]).length,m=0,P()):B(g=0),v=!1,setStyle.transform(a,{translate:[0,0]}),c?(addEvent(i,"touchstart touchmove click",T),addEvent(i,"touchstart",D),addEvent(i,"touchmove",j),addEvent(i,"touchend touchcancel",I)):(addEvent(i,"mousewheel",M),addEvent(o,"click",x)),f||onBodyResize(x)},destroy:function(){c?(removeEvent(i,"touchstart touchmove click",T),removeEvent(i,"touchstart",D),removeEvent(i,"touchmove",j),removeEvent(i,"touchend touchcancel",I)):(removeEvent(i,"mousewheel",M),removeEvent(o,"click",x)),f||onBodyResize("__clear",x)},onShow:function(){_?P():B(g)},canClick:function(){return u}}),n=e,(t=t||{}).byPage?(_=!0,f=!d.default.android):(_=!1,f=!1,this.showElem=function(e){if(!_){var t=getX(e)-getX(i),n=t+g,o=n+getW(e),r=getW(i),s=!1;n<0?s=0-t+20:o>r&&(s=r-getW(e)-t-20);var l=getW(i)-getW(a);if(l>0&&(l=0),s<l)s=l;else if(s>0)s=0;clog(t,g,n,o,0,r,s),!1!==s&&(B(g=s),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[g,0]}))}})};var le=n("izth"),ue=function(){var e=null,t={},n=1,i=null,a=!1,o=!1;function s(){n<64&&(n*=2)}function l(e,t){var n=window.al;if(!1===e&&(e=getNotify()+(t||1)),setNotify(e),window.al&&window.al.menu){var i=new Array(n.menu.length);i[3]=e,menu.refreshCounters(i)}}function c(e){return Object.keys(e).some(function(e){return-1!==e.indexOf("attach")})||e.fwd||e.emoji||e.geo}function u(e,t,n){var i=toInt(e.from_admin)||null,a=toInt(nav.getQuery("community"));return i&&a?a:2&t?window.vk.id:toInt(e.from)||n}function d(){return Number(nav.getQuery("offset"))>0}function f(e){try{return JSON.parse(e)}catch(e){return null}}return{onNewMsg:Object(r.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags, isService }"),onEditMsg:Object(r.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags }"),onMsgReadByMe:Object(r.default)("msgId","dialogId"),onMsgReadByOther:Object(r.default)("msgId","dialogId"),onOnlineChange:Object(r.default)("{ userId, isOnline, onlinePlatform, lastActionTime }"),onTyping:Object(r.default)("dialogId","authorId"),onMultiTyping:Object(r.default)("peerId","userIds","totalCount"),onMsgImportantRemove:Object(r.default)("msgId"),onMsgImportantAdd:Object(r.default)("msgId"),onMsgRemove:Object(r.default)("msgId"),onMsgRestore:Object(r.default)("msgId"),onPeerKeyboard:Object(r.default)("peerId"),onPeerBanner:Object(r.default)("peerId"),onDialogImportant:Object(r.default)("peerId","isImportant"),onUnreadCount:Object(r.default)("count"),onResync:Object(r.default)(),isLongPollingEnabled:function(){return!!a},init:function(t){e||(Object(le.setDocumentDomain)(),e=ce("iframe",{src:t.frameUrl},{display:"none"}),onDOMReady(function(){append(e,window.bodyNode),!0})),ue.refreshParams(t),setTimeout(ue.check,1e3)},on:function(){clog("[longpoll] start"),a=!0,setTimeout(ue.check,1e3)},off:function(){clog("[longpoll] pause"),a=!1},refreshParams:function(e){extend(t,e||{}),extend(ue,t)},getKey:function(){if(i)try{i.abort()}catch(e){}i=ajax.post("/mail",{_ajax:1,act:"im_get_key",community:nav.getQuery("community")},{onDone:function(e){/[0-9a-f]{40}/i.test(e)?(ue.refreshParams({key:e}),ue.check()):clog("[longpoll] invalid key")},onFail:function(e){setTimeout(ue.getKey,1e3*n),clog("[longpoll] from getKey delaying getKey for "+n+"secs"),s()}})},check:function(){if(a&&!o)if(ue.makeRequest)try{ue.makeRequest(function(e,t){if(o=!1,a)if(window.vk.__debug)ue.checked(parseJSON(t))&&(ue.check(),n=1);else try{ue.checked(parseJSON(t))&&(ue.check(),n=1)}catch(e){try{clog("[longpoll] error",e.message||"no message",e.type||"no type",e.stack||"no stack")}catch(e){}setTimeout(ue.check,1e3*n),s()}},function(){o=!1,setTimeout(ue.check,1e3*n),s()}),o=!0}catch(e){clog("[longpoll] makeRequest failed")}else setTimeout(ue.check,1e3)},checked:function(e){var i,a,o,r=e.failed;if(1==r||t.ts>=e.ts+256){if(ue.refreshParams({ts:e.ts}),r)return!0}else{if(2==r)return clog("[longpoll] delaying getKey for "+n+"secs"),setTimeout(ue.getKey,1e3*n),s(),!1;if(r)return void clog("[longpoll]",e)}if(ue.refreshParams({ts:e.ts}),e.updates){var _=[],p=!1;for(var h in e.updates){if(116==e.updates[h][0])var m=e.updates[h][1],A=[e.updates[h][0],m.id,m.flags,m.peer_id,m.date,m.title||"",m.message,m.kludges,m.random_id];else A=e.updates[h];var v=intval(A[0]),g=intval(A[1]),b=intval(A[2]),y=intval(A[3]);if(1===b){if(10===v){mail.updateImportantDialog(g,!1);continue}if(12===v){mail.updateImportantDialog(g,!0);continue}}if(8&b){if(2===v){if(window.isNewMail){ue.onMsgImportantAdd(g);continue}mail.updateImportantMessages(y,g,1);continue}if(3===v){if(window.isNewMail){ue.onMsgImportantRemove(g);continue}mail.updateImportantMessages(y,g,-1);continue}}if(51!=v)if(61!=v)if(62!=v)if(8!=v)if(9!=v)if(6!=v&&7!=v)if(80!=v||!g||nav.getQuery("community"))if(52!=v){if(y)if(4!=v&&5!=v&&116!=v)if(0!=v)if(2!=v);else{if(128&b){if(window.isNewMail){ue.onMsgRemove(g);continue}mail.markAsDeleted(y,g)}window.isNewMail&&64&b&&ue.onMsgRemove(g)}else{if(window.isNewMail){ue.onMsgRemove(g);continue}mail.markAsDeleted(g)}else{var w=5==v||116==v;if(window.isNewMail){var C=A,k=C[1],S=C[3],E=C[4],O=C[6],T=C[7],D=void 0===T?{}:T,j=C[8],I=c(D),M=(i=void 0,a=void 0,o=void 0,i=new Date(1e3*E),a=i.getHours(),o=i.getMinutes(),a+":"+(o<10?"0":"")+o),x=toInt(D.from_admin)||null,B=(toInt(nav.getQuery("community")),u(D,b,S)),P=!!D.source_act,L=D.keyboard?f(D.keyboard):null;if(w){var R={peerId:S,msgId:k,authorId:B,text:O,date:M,hasAttachments:I,flags:b,adminId:x,randomId:j};116==v?R.refreshed=1:R.edited=Math.floor(Date.now()/1e3),ue.onEditMsg(R)}else ue.onNewMsg({peerId:S,msgId:k,authorId:B,text:O,date:M,hasAttachments:I,flags:b,adminId:x,randomId:j,isService:P,keyboard:L});continue}var N=window.vk,F=2&b?N.id:A[7]&&A[7].from||y,H=A[7]&&A[7].source_act;p||(p=!!need("PinnedMsg").getByMsgId(g));var U=A[7].from_admin||H||p?null:mail.getMsgHTML(g,b,y,A[4],A[5],A[6],A[7],116!=v?w:"");if(U&&(w?mail.replaceMessage(y,g,F,U):d()||mail.addMessage(y,g,F,U),2&b||nav.getQuery("community")||l(!1,1)),"chat_kick_user"===H&&A[7].source_mid==N.id){var V=A[3];mail.unpinMessage(V)}U&&"chat_pin_message"!==H&&"chat_unpin_message"!==H||_.push({peer:y,msg_id:g,from_id:F,source_act:H,edited:w})}}else{var $=A,q=$[1],W=$[2];if(!window.isNewMail)continue;11==q&&ue.onPeerKeyboard(W),10==q&&ue.onPeerBanner(W)}else l(g);else{if(window.isNewMail){var z=A[1],Q=A[2];6===v?ue.onMsgReadByMe(Q,z):ue.onMsgReadByOther(Q,z);continue}mail.markPeerAsRead(g,b,7==v)}else{if(window.isNewMail){ue.onOnlineChange({userId:-g,isOnline:!1,lastActionTime:y});continue}mail.updateOnline(-g,0)}else{if(window.isNewMail){ue.onOnlineChange({userId:-g,isOnline:!0,onlinePlatform:7===(b||7)?"desktop":"mobile"});continue}mail.updateOnline(-g,b||7)}else{if(window.isNewMail){var Y=2e9+b,X=g;ue.onTyping(Y,X);continue}mail.typing(2e9+b,g)}else{if(window.isNewMail){var G=g,K=g;ue.onTyping(G,K);continue}mail.typing(g)}}if(_.length){var J=[];each(_,function(e,t){J.push(t.msg_id)});var Z={_ajax:1,act:"get_messages",msgs:J.join(","),community:nav.getQuery("community")};p&&(Z.force_pinned=1),ajax.post("/mail",Z,{onDone:function(e,t){var n=window.cur,i=d();each(_,function(t,n){var a=e[n.msg_id],o=n.peer;a.text&&!i&&(n.edited?mail.replaceMessage(n.peer,n.msg_id,n.from_id,a.text):mail.addMessage(n.peer,n.msg_id,n.from_id,a.text)),a.unpin&&mail.unpinMessage(o),a.pinned&&mail.pinMessage(o,a.pinned)}),t&&(t.play_animation_msg_id&&StickersAnimation?StickersAnimation.loadStickerInMvkIMAndPlay(t.play_animation_msg_id):(extend(n,t),mail.updateStickers()))}})}}return!0}}}(),de=ue,fe=n("WwUR");window.isNewLongpoll?window.im=fe.default:window.im=de;n("gNTM"),n("eoxF");var _e={};function pe(e){var t,n,i;pe.getQueryREs=$;var a,o,r,s,l,c,u,d,f,_,p=!1,h=[],m={},A={},v={},g={},b=!1,y=null,w=null,C=null,k=0,S=[],E=null,O=null,T=null,D=!1,j=!1,I=10,M=30,x=[],B=!0,P=!1,L=!1,R=!1,N=0,F=0,H=!1,U={},V=e&&"au_search_field"===e.field&&attr(ge(e.field),"data-newsearch");function $(e){e=e.replace(/https?:\/\/(m\.)?vk\.com\/([^#]+#\/)?/,"");for(var t,n,i,a=j,o=[e,n=parseRusKeys(e,a)||e,i=parseLatKeys(e,a)||e,parseLat(n),parseCyr(i)],r={},s=[],l=0,c=o.length;l<c;l++)o[l]&&!r[o[l]]&&(r[o[l]]=!0,t=(t=escapeRE(o[l])).replace(/[]/gi,"[]").replace(/(e|yo)/gi,"(?:e|yo)"),s.push(new RegExp("(^|\\s|\\(|>)("+t+")","gi")));return s}function q(e,n,i,o){if(clearTimeout(w),!i)return w=setTimeout(function(){q(e,n,!0)},10),!1;var r=val(e)||"";if(y===r&&!o)return!1;var s,f="_"+r,_=A[f],p=$(r);if(!V&&!_&&r.length>2&&A["_"+r.slice(0,-2)]){var b="_"+r.slice(0,-2);A[b]&&g[b]&&!A[b].length&&(!R||R&&!v[b])&&(g[f]=!0,_=A[f]=[],R&&(v[f]=""))}o&&(delete g[f],delete A[f],delete v[f]);var S=0;if(!_){_=[];if(he.isCachedPage)S=(geByClass1("_si_container",a)||a).childNodes.length;if(!r&&h.length)for(var E=k,O=k+Math.min(Math.max(I,S),h.length);E<O;E++)_.push([h[E]]),0;else{var T={},j=0;for(E=0,O=h.length;E<O;E++){var x=h[E];if(m[x]){if(T[x]=!0,(s=W(p,m[x][0]))&&(_.push([x,s]),++j>=M))break;0}}if(j<M)for(var x in m)if(!T[x]&&(s=W(p,m[x][0]))){if(_.push([x,s]),++j>=M)break;0}}g[f]=g[f]||!r&&h.length||_.length>2*I,g[f]=g[f]||R&&_.length>I}return(g[f]||!B&&!R)&&!o||c||function e(n,i,o){var r=V?800:200;clearTimeout(C);if(!o)return C=setTimeout(function(){e(n,i,!0)},r),!1;ajax.post(t,{_ajax:1,q:i},{onDone:function(e,t,a){u&&u.apply(null,arguments);for(var o,r="_"+i,s=A[r]||[],c={},d=$(i),f=0;f<s.length;f++)c[s[f][0]]=!0;for(var _=0;_<t.length;_++){var p=t[_];c[p]||((o=W(d,e[p][0]))||D||!i)&&s.push([p,o])}g[r]=!0,A[r]=s,R&&(v[r]=a||""),m=extend(e,m),U._cache=m,B=!P||len(m)<P,y===i?(z(s,v[r]),onBodyScrollForce()):delete A[r],B||removeClass("input_loading",n),l&&(B=!1,P=Object.keys(m).length)},onFail:function(){delete A["_"+i],removeClass("input_loading",n)}});geByClass1("al_loading",a)||addClass("input_loading",n)}(e,r),A[f]=_,y=r,z(_,v[f]),d&&d(r),L&&!y&&(N=Math.max(I,S)),onBodyScrollForce(),!1}function W(e,t){if(!t)return!1;"string"!=typeof t&&(t=t.toString());var n=[t],i=/([])/gi;-1!==t.search(i)&&n.push(t.replace(i,""));for(var a=0;a<n.length;a++)for(var o=0,r=e.length;o<r;o++)if(-1!==n[a].search(e[o]))return e[o];return!1}function z(e,t){var n="";if(O&&a){var i=Object.keys(x).filter(function(e){return!!x[e]}).map(function(e){return e+""});i.length&&""===y&&(e=e.filter(function(e){return!i.includes(String(e[0]))}),i.forEach(function(t){e.unshift([t,!1])}));for(var r=function(t){var i=e[t],a=i[0],o=i[1];if(!m[a])return"continue";var r=m[a].slice(1);if(o)for(var s in S){var l=S[s];r[l]&&(r[l]=r[l].replace(o,'$1<em class="found">$2</em>'))}n+=O.apply({id:a,q:y,highlight:function(e){if("string"!=typeof e)throw new Error("Highlighting expected string but got "+typeof e);return e.replace(o,'$1<em class="found">$2</em>')},template:function(e,t){var n=this;return e.replace(/%(\d+)%|#(\d+)#/g,function(e,i,a){return a&&t[a-1]?n.highlight(t[a-1]):i&&t[i-1]?t[i-1]:""})}},r)},l=0;l<e.length;l++)r(l);n||g["_"+y]||!B&&!R||c||(removeClass("input_loading",o),removeClass("_si_container_loading",a),n=y?'<div class="al_loading qs_loading">&nbsp;</div>':'<div id="al_loading"></div>'),!n&&T&&(n=T(y)),val(a,E?E(n,y,L,t):n+(t||"")),s&&(y?show(s):hide(s)),!y&&alLoadingFix(),f&&f(y)}}extend(this,{go:function(e){return!o||(q(o,e,!0,!0),o.blur(),cancelEvent(e),!1)},redraw:function(){var e="_"+y;z(A[e],v[e]),onBodyScrollForce()},clear:function(e,t){return val(o,""),t?elfocus(o):elblur(o),q(o,e,!0),cancelEvent(e),!1},blur:function(){elblur(o)},toggleAttach:function(e,t){x[e]=t},init:function(e){if(e=e||{},a=ge(e.container)||null,o=ge(e.field)||null,r=ge(e.btn)||null,s=ge(e.clear_btn)||null,y=null,!b||t!=e.action||!e.init_once){A={},v={},g={},t=e.action||"",p=null!==e.next_from,i=e.next_from,n=e.al_action||t,h=e.top_items||[],m=e._cache||{},S=e.hl_fields||[],E=e.tpl||null,O=e.item_tpl||null,T=e.null_tpl||null,D=e.soft_filter||!1,j=e.need_invalid_keys||!1,I=e.top_len||10,P=e.load_limit||!1,u=e.onLoaded||!1,d=e.onFiltered||!1,f=e.onRendered||!1,_=e.onFocusChanged||!1,L=e.al_need||!1,k=!L&&e.init_offset||0,R=e.global_search||!1,c=e.no_search_query||!1,l=e.load_once||!1;var w=e.action+e.container;_e[w]?U=_e[w]:(U._cache=m,U.top_items=h,_e[w]=U),he.isCachedPage&&(h=U.top_items,m=U._cache)}var C=null;t&&a&&o&&O&&(B=!0!==t&&(!P||len(m)<P),addEvent(o,"focus",function(e){e&&e.preventDefault();clearTimeout(C),_&&_.call({q:y},!0),function t(n){!n&&q(o,e,!0),C=setTimeout(t,100)}(!0)}),addEvent(o,"keydown keypress change blur",function(e){"blur"==e.type&&(clearTimeout(C),_&&_.call({q:y},!1)),q(o,e,"keydown"!=e.type&&"keypress"!=e.type)}),e._new||r&&!attr(r,"onclick")&&attr(r,"onclick","return qsearch.go(event);"),!L||b&&e.init_once||(N=I,F=len(m),initAutoScroll(function(){var e=(geByClass1("_si_container",a)||a).childNodes;return e[N]||e[e.length-1]},function(){var e=geByClass1("_si_container",a)||a;if(!H&&!y){if(p?!!i:N+I>F&&B)H=!0,addClass(e,"_si_container_loading"),ajax.post(n,{_ajax:1,offset:F,next_from:i},{onDone:function(n,a,o){i=o,u&&u.apply(null,arguments);var r=len(n);if(H=!1,removeClass(e,"_si_container_loading"),P||(h=h.slice(0,F).concat(a),U.top_items=h),F+=r,m=extend(n,m),U._cache=m,B=!0!==t&&(!P&&r||len(m)<P),!y){N+=I;for(var s=[],l=0,c=Math.min(N,h.length);l<c;l++)s.push([h[l]]);z(s,v._),onBodyScrollForce()}},onFail:function(){H=!1,removeClass(e,"_si_container_loading")}});else if(N<h.length){N+=I;for(var o=[],r=0,s=Math.min(N,h.length);r<s;r++)o.push([h[r]]);z(o,v._),onBodyScrollForce()}}})),!e.skip_init_filter&&q(o,null,!0),b=!0)}}),e&&this.init(e)}var he=new pe;window.QuickSearch=pe,window.QuickSearchCache=_e,window.qsearch=he;var me={onClose:Object(r.default)(),inited:!1,width:!1,height:!1,onResize:null,_lastNav:!1,_opened:!1,_destroy:!1,init:function(){me.inited||(me.inited=!0,me.initEvents())},initEvents:function(){var e=function(e){me.fixHeight(vkNow()+2e3,e)};addEvent(window,"orientationchange",e),onBodyResize(e),e(!0)},opened:function(){return hasClass("z_opened",window.bodyNode)!==me.opened&&toggleClass("z_opened",window.bodyNode,me._opened),me._opened},toggle:function(e,t){return!!checkEvent(e)||(me.opened()?me.close(e,t):me.open(e,t),!1)},open:function(e,t){return!!checkEvent(e)||!me.opened()&&(thover.clear(),me.init(),me._st=scrollTop(),me._lastNav=!1,addClass("z_opened",window.bodyNode),me._opened=!0,me.fixHeight(vkNow()+2e3,!0),scrollTop(0),!1)},close:function(e,t){return!!checkEvent(e)||!!me.opened()&&(thover.clear(),val("z",""),removeClass("z_opened",window.bodyNode),me._lastNav={cur:nav.cur,path:nav.path,params:nav.params,hash:nav.hash},me._opened=!1,me._destroy&&(me._destroy(),me._destroy=!1),scrollTop(me._st,1),me._st=!1,me.onResize=null,me.onClose(),!1)},updateSize:function(){var e=ge("z");e&&e.offsetWidth&&e.offsetHeight&&(me.width=e.offsetWidth,me.height=e.offsetHeight,me.onResize&&me.onResize())},fixHeight:function(e,t){if((me._opened||t)&&(e&&!(vkNow()>e)||t)){var n=getCw(),i=getCh();(me._lastWidth!=n||me._lastHeight!=i||t)&&(me._lastWidth=n,me._lastHeight=i,setStyle("z","height",i),me.updateSize(),scrollTop()||scrollTop(0)),clearTimeout(me._fixTo),me._fixTo=setTimeout(me.fixHeight,50,e)}},create:function(e,t){val("z",e),me._destroy=t}};window.zlayer=me;n("vZUn");var Ae="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMN0PQRSTUVWXYZO123456789+/=",ve={v:function(e){return e.split("").reverse().join("")},r:function(e,t){var n;e=e.split("");for(var i=Ae+Ae,a=e.length;a--;)~(n=i.indexOf(e[a]))&&(e[a]=i.substr(n-t,1));return e.join("")},s:function(e,t){var n=e.length;if(n){var i=function(e,t){var n=e.length,i=[];if(n){var a=n;for(t=Math.abs(t);a--;)t=(n*(a+1)^t+a)%n,i[a]=t}return i}(e,t),a=0;for(e=e.split("");++a<n;)e[a]=e.splice(i[n-1-a],1,e[a])[0];e=e.join("")}return e},i:function(e,t){return ve.s(e,t^vk.id)},x:function(e,t){var n=[];return t=t.charCodeAt(0),each(e.split(""),function(e,i){n.push(String.fromCharCode(i.charCodeAt(0)^t))}),n.join("")}};function be(e){if((!window.wbopen||!~(window.open+"").indexOf("wbopen"))&&~e.indexOf("audio_api_unavailable")){var t,n,i=e.split("?extra=")[1].split("#"),a=""===i[1]?"":ye(i[1]);if(i=ye(i[0]),"string"!=typeof a||!i)return e;for(var o=(a=a?a.split(String.fromCharCode(9)):[]).length;o--;){if(t=(n=a[o].split(String.fromCharCode(11))).splice(0,1,i)[0],!ve[t])return e;i=ve[t].apply(null,n)}if(i&&"http"===i.substr(0,4))return i}return e}function ye(e){if(!e||e.length%4==1)return!1;for(var t,n,i=0,a=0,o="";n=e.charAt(a++);)~(n=Ae.indexOf(n))&&(t=i%4?64*t+n:n,i++%4)&&(o+=String.fromCharCode(255&t>>(-2*i&6)));return o}var we=n("lkNA"),Ce=function(){function e(){}return e.follow=function(t,n,i,a){lockButton(a),ajax.post("/audio",{_ajax:1,act:"artist_follow",ref:n,hash:i,artist_id:t},{onDone:function(i){unlockButton(a),a.classList.add("ArtistCover__followBtn__followed"),a.onclick=function(o){o.preventDefault(),e.unfollow(t,n,i,a)}},onFail:function(){return unlockButton(a)}})},e.unfollow=function(t,n,i,a){lockButton(a),ajax.post("/audio",{_ajax:1,act:"artist_unfollow",ref:n,hash:i,artist_id:t},{onDone:function(i){unlockButton(a),a.classList.remove("ArtistCover__followBtn__followed"),a.classList.contains("ArtistCover__followBtn__canFollow")&&(a.onclick=function(o){o.preventDefault(),e.follow(t,n,i,a)})},onFail:function(){return unlockButton(a)}})},e.trackToOfficial=function(e,t){ajax.post("/audio",{_ajax:1,act:"artist_track_to_official",hash:e,url:t})},e}(),ke={CURRENT_CHANGED:"curr",PLAY:"start",PLAY_REQUESTED:"request_play",PAUSE:"pause",STOP:"stop",UPDATE:"update",LOADED:"loaded",ENDED:"ended",FAILED:"failed",BUFFERED:"buffered",PROGRESS:"progress",VOLUME:"volume",PLAYLIST_CHANGED:"plchange",ADDED:"added",REMOVED:"removed",FREQ_UPDATE:"freq",SEEK:"seek",PLAY_NEXT:"play_next",AD_READY:"ad_ready",AD_DEINITED:"ad_deinit",AD_STARTED:"ad_started",AD_COMPLETED:"ad_completed",START_LOADING:"start_load",CAN_PLAY:"actual_start",SELECT:"select",DESELECT:"deselect",EMPTY_PLAYLIST:"empty_playlist",NOT_FOUND_PLAYLIST:"not_found_playlist",INIT:"init"},Se={AUDIO_ITEM_INDEX_ID:0,AUDIO_ITEM_INDEX_OWNER_ID:1,AUDIO_ITEM_INDEX_URL:2,AUDIO_ITEM_INDEX_TITLE:3,AUDIO_ITEM_INDEX_PERFORMER:4,AUDIO_ITEM_INDEX_DURATION:5,AUDIO_ITEM_INDEX_ALBUM_ID:6,AUDIO_ITEM_INDEX_AUTHOR_LINK:8,AUDIO_ITEM_INDEX_LYRICS:9,AUDIO_ITEM_INDEX_FLAGS:10,AUDIO_ITEM_INDEX_CONTEXT:11,AUDIO_ITEM_INDEX_EXTRA:12,AUDIO_ITEM_INDEX_HASHES:13,AUDIO_ITEM_INDEX_COVER_URL:14,AUDIO_ITEM_INDEX_ADS:15,AUDIO_ITEM_INDEX_SUBTITLE:16,AUDIO_ITEM_INDEX_MAIN_ARTISTS:17,AUDIO_ITEM_INDEX_FEAT_ARTISTS:18,AUDIO_ITEM_INDEX_ALBUM:19,AUDIO_ITEM_INDEX_TRACK_CODE:20,AUDIO_ITEM_INDEX_RESTRICTION:21,AUDIO_ITEM_INDEX_ALBUM_PART:22,AUDIO_ITEM_ACCESS_KEY:24,AUDIO_ITEM_HAS_LYRICS_BIT:1,AUDIO_ITEM_CAN_ADD_BIT:2,AUDIO_ITEM_CLAIMED_BIT:4,AUDIO_ITEM_HQ_BIT:16,AUDIO_ITEM_LONG_PERFORMER_BIT:32,AUDIO_ITEM_UMA_BIT:128,AUDIO_ITEM_REPLACEABLE:512,AUDIO_ITEM_EXPLICIT_BIT:1024,AUDIO_ENOUGH_LOCAL_SEARCH_RESULTS:500,AUDIO_RECOMS_TYPE_LISTENED:"recoms6",AUDIO_PLAYING_CLS:"audio_row__playing",AUDIO_CURRENT_CLS:"audio_row__current",AUDIO_DURATION_CLS:"audio_row__duration",AUDIO_LAYER_HEIGHT:550,AUDIO_LAYER_MIN_WIDTH:400,AUDIO_LAYER_MAX_WIDTH:1e3,AUDIO_HQ_LABEL_CLS:"audio_hq_label_show",AUDIO_MAX_AUDIOS_IN_SNIPPET:5,AUDIO_ROW_COVER_SIZE:40,AUDIO_ROW_PLAY_SIZE:24,AUDIO_ROW_ACTION_ROW_ITEM:'<a role="button" class="audio_row__more_action audio_row__more_action_%0% _audio_row__more_action_%0% %3%">%2%</a>',LOG_LS_KEY:"audiolog"};function Ee(e){if(!e)return!1;var t=isObject(e)?e.extra:e[Se.AUDIO_ITEM_INDEX_EXTRA];return isObject(t)||(t=JSON.parse(t||"{}")),!!t.podcast}var Oe=function(){function e(e,t,n){this._isPlaying=!1,this._adsCurrentProgress=0,this._adman=null,this._admanLoaded=!1,this._adEvents=[],this.player=e||{},this.playerVersion=t||null,this._startAdsTO=null,this._adsConfig=null,this._duration=0,this.isMvk=Boolean(n),this.adsStatUrl=this.isMvk?"audio":"al_audio.php"}var t=e.prototype;return t.isPlaying=function(){return this._isPlaying},t.setAdsConfig=function(e){this._adsConfig=e},t.getCurrentProgress=function(){return this._adsCurrentProgress},t.getDuration=function(){return this._duration},t.loadAdman=function(t){var n=this,i=function(e){return t&&t(e)};if(this._admanLoaded)i();else{var a=0;Object(we.loadScript)(e.ADMAN_SRC,{onLoad:function(){n._admanLoaded=!0,i()},onError:function(){window.abp?(n._admanLoaded=!0,i()):(3===(a+=1)&&(n._admanLoaded=!0),i("script_load_fail"))}})}},t._fetchAd=function(t,n,i,a,o){var r=this;this.loadAdman(function(s){if(!window.AdmanHTML)return r._sendEvent("no_adman",n,e.AD_TYPE,s),a&&a();r._adman=new AdmanHTML;var l={_SITEID:276,ver:251116,vk_id:vk.id,duration:t.duration,content_id:Te(t.ownerId,t.id),vk_catid:e.CAT_IDS[n]||e.CAT_IDS.other};extend(l,t.ads||{}),nav.objLoc&&nav.objLoc.preview&&(l.preview=intval(nav.objLoc.preview)),cur.adsPreview&&(l.preview=1,l.vk_id=398724832),r._adman.setDebug(!!l.preview),r._adman.onError(function(){return a&&a()}),r._adman.onReady(function(){if(r._adman){var t=r._adman.getBannersForSection(e.AD_TYPE);t&&t.length?"statistics"===t[0].type?(r._play(!0,n),a&&a()):(r._sendEvent("received",n),i?(r._sendEvent("rejected",n,e.AD_TYPE,o),r.deinit(),a&&a()):(r._sendEvent("ready",n),r.player.notify(ke.AD_READY),r._play(!1,n,a))):(i||r._sendEvent("not_received",n),a&&a())}}),r._adman.init({slot:3514,wrapper:r.isMvk?ce("div"):se("<div></div>"),params:l,browser:{adBlock:!!window.abp,mobile:!1}}),r._sendEvent("requested",n)})},t._sendEvent=function(e,t,n,i){var a=this,o=n?"/"+n:"",r=i?"/"+i:"";this._adEvents.push(e+"/"+t+o+r),clearTimeout(this._adEventDelay),this._adEventDelay=setTimeout(function(){ajax.post(a.adsStatUrl,{act:"ad_event",events:a._adEvents.join(","),v:a.playerVersion,abp:intval(window.abp)},{onFail:function(){return!0}}),a._adEvents=[]},500)},t._play=function(t,n,i){var a=this;this._adman.onCompleted(function(){a.deinit(!0),t?a._sendEvent("statistics",n):(a.player.notify(ke.PROGRESS,0),a.player.notify(ke.AD_COMPLETED),a._isPlaying=!1,a._adsCurrentProgress=0,a._sendEvent("completed",n),window.setDocumentTitle&&window.setDocumentTitle(a._adsPrevTitle),i&&i())}),this._adman.onStarted(function(){t||(a.player.setIsPlaying(!0),a.player.notify(ke.PLAY),a.player.notify(ke.PROGRESS,0),a.player.notify(ke.AD_STARTED),a.updateVolume(),a._sendEvent("started",n))}),this._adman.onPaused(function(){a.player.setIsPlaying(!1),a.player.notify(ke.PAUSE)}),this._adman.onPlayed(function(){a.player.setIsPlaying(!0),a.player.notify(ke.PLAY)});var o=[.25,.5,.75];if(this._adman.onTimeRemained(function(e){a._duration=isNaN(e.duration)?0:e.duration,a._adsCurrentProgress=(isNaN(e.percent)?0:e.percent)/100,a.player.notify(ke.PROGRESS,a._adsCurrentProgress,a._duration),each(o,function(e,t){if(a._adsCurrentProgress>=t)return o.shift(),a._sendEvent("progress_"+intval(100*t),n),!1})}),this._adman.start(e.AD_TYPE),t)return i&&i();this._isPlaying=!0,this._adsPrevTitle=document.title,this.isMvk||setDocumentTitle(getLang("global_audio_ad"))},t.updateVolume=function(){this._adman&&this._adman.setVolume(.7*this.player.getVolume())},t.deinit=function(e){this._adman=null,!e&&this.player.notify(ke.AD_DEINITED)},t.pause=function(){this._adman&&(this.player.setIsPlaying(!1),this._adman.pause())},t.resume=function(){this._adman&&(this.player.setIsPlaying(!0),this._adman.resume(),this.player.notify(ke.PLAY))},t.checkPlay=function(t,n){var i=this.player._getPlayingContextSection(),a=this._isAllowed(t),o=a.type,r=a.reason,s=function(){return n&&n()};switch(o){case e.ALLOW_ALLOWED:this._fetchAd(t,i,!1,s);break;case e.ALLOW_DISABLED:s();break;case e.ALLOW_REJECT:this._fetchAd(t,i,!0,!1,r),s()}},t._isAllowed=function(t){if(vk.widget)return{type:e.ALLOW_DISABLED};if(Ee(t))return{type:e.ALLOW_DISABLED};if(window.browser&&window.browser.safari)return{type:e.ALLOW_DISABLED};var n=this._adsConfig||vk.audioAdsConfig||window.audioAdsConfig;if(n){if(!n.enabled)return{type:e.ALLOW_DISABLED};if(cur.adsPreview)return{type:e.ALLOW_ALLOWED};if(n.day_limit_reached)return{type:e.ALLOW_REJECT,reason:e.REJECT_REASON_LIMIT};var i=this.player._getPlayingContextSection();return n.sections.indexOf(i)>-1?{type:e.ALLOW_ALLOWED}:{type:e.ALLOW_REJECT,reason:e.REJECT_REASON_SECTION}}return{type:e.ALLOW_REJECT,reason:e.REJECT_REASON_UNKNOWN}},t.startPlay=function(e,t,n){var i=this;this._startAdsTO&&function(e){if(!e)return!1;isFinite(e)?clearTimeout(e):e.terminate()}(this._startAdsTO),t?this._startAdsTO=function(e,t){if(!window.Worker||!window.Blob)return setTimeout(e,t);var n=new Blob(["\n      var timeout;\n      onmessage = function(e) {\n        clearTimeout(timeout);\n        if (e.data == 'start') {\n          timeout = setTimeout(function() { postMessage({}); }, "+t+");\n        }\n      }\n    "]);try{var i=new Worker(window.URL.createObjectURL(n));return i.onmessage=function(){i.terminate(),e()},i.postMessage("start"),i}catch(n){return setTimeout(e,t)}}(function(){return i.checkPlay(e,n)},0):this.checkPlay(e,n)},e}();function Te(e,t){for(var n=e.toString(16),i=t.toString(16);i.length<8;)i="0"+i;return n+i}Oe.ADMAN_SRC="//ad.mail.ru/static/admanhtml/rbadman-html5.min.js",Oe.CAT_IDS={my:101,my_playlists:101,audio_feed:109,recent:113,user_wall:104,group_wall:104,user_list:102,group_list:103,user_playlists:102,group_playlists:103,feed:105,search:110,global_search:110,replies:104,im:106,group_status:104,user_status:104,recs:107,recs_audio:107,recs_album:107,other:114},Oe.AD_TYPE="preroll",Oe.ALLOW_DISABLED=1,Oe.ALLOW_ALLOWED=2,Oe.ALLOW_REJECT=3,Oe.REJECT_REASON_UNKNOWN="unknown",Oe.REJECT_REASON_LIMIT="track_limit_exceeded",Oe.REJECT_REASON_SECTION="section_not_allowed";var De=function(){function e(e){this.audioplayer=e}var t=e.prototype;return t.notify=function(e){var t,n=this.audioplayer.getCurrent();switch(e){case ke.AD_COMPLETED:case ke.AD_STARTED:this.audioplayer.notify(e,n);break;case ke.PAUSE:case ke.PLAY:this.audioplayer.notify(e,n.fullId);break;case ke.PROGRESS:for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(t=this.audioplayer).notify.apply(t,[e,n.fullId].concat(a))}},t.setIsPlaying=function(e){this.audioplayer.setIsPlaying(e)},t.getVolume=function(){var e=Object(i.ssGet)("audio_vol");return null===e?1:e},t._getPlayingContextSection=function(){return window.playerAdapter.getContext()},e}(),je=n("Po+v");function Ie(e,t){function n(e){var t=["Webkit","Moz","O","ms"],n=document.createElement("div");if(void 0!==n.style[e])return!0;for(var i in e=e.charAt(0).toUpperCase()+e.slice(1),t)if(void 0!==n.style[t[i]+e])return!0;return!1}function i(e,t){new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)||(e.className+=" "+t)}function a(e,t){e.className=e.className.replace(new RegExp("(\\s+|^)"+t+"(\\s+|$)","g")," ").replace(/^\s+|\s+$/g,"")}function o(e,t){0>e?e=0:e>A-1&&(e=A-1);for(var n=C.dots.length-1;n>=0;n--)a(C.dots[n],O.activeDot);return i(C.dots[e],O.activeDot),S=e,r(-e*C.width,void 0===t?E.speed:t),f(),E.onSlideChange&&E.onSlideChange(e),e}function r(e,t){var n=t?t+"ms":"";g.style.webkitTransitionDuration=g.style.MozTransitionDuration=g.style.msTransitionDuration=g.style.OTransitionDuration=g.style.transitionDuration=n,l(e)}function s(e,t){if(w&&clearInterval(w),t){var n=+new Date,i=C.left;w=setInterval(function(){function a(e,t){return(t-e)*s+e}var o,r,s=(+new Date-n)/t,c=[0,.7,1,1];return s>=1?(l(e),void clearInterval(w)):(o=e-i,r=a(a(a(c[0],c[1]),a(c[1],c[2])),a(a(c[1],c[2]),a(c[2],c[3]))),void l(Math.floor(r*o+i)))},15)}else l(e)}function l(e){g.style.webkitTransform="translate("+e+"px,0) translateZ(0)",g.style.msTransform=g.style.MozTransform=g.style.OTransform=g.style.transform="translateX("+e+"px)",C.left=e}function c(e){g.style.left=e+"px",C.left=e}function u(){var e=S+1;return e>A-1&&(e=0),o(e)}function d(){y=!0,f()}function f(){y&&(b&&clearTimeout(b),b=setTimeout(function(){u()},E.slideshowInterval))}function _(){b&&clearTimeout(b)}function p(){y=!1,b&&clearTimeout(b)}function h(){C.width=e.offsetWidth,g.style.width=C.width*A+"px";for(var t=0;A>t;t++)C.slides[t].style.width=C.width+"px";r(-S*C.width)}function m(e,t,n,i){t&&(e.addEventListener?e.addEventListener(t,n,!!i):e.attachEvent("on"+t,n))}var A,v,g,b,y,w,C={slides:[],dots:[],left:0},k=200,S=0,E={speed:300,touchSpeed:300,slideshow:!1,slideshowInterval:4e3,stopSlideshowAfterInteraction:!1,startSlide:0,mouseDrag:!0,disableIfOneSlide:!0,cssPrefix:"peppermint-",dots:!1,dotsPrepend:!1,dotsContainer:void 0,slidesContainer:void 0,onSlideChange:void 0,onSetup:void 0};t&&function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}(E,t);var O={inactive:E.cssPrefix+"inactive",active:E.cssPrefix+"active",mouse:E.cssPrefix+"mouse",drag:E.cssPrefix+"drag",slides:E.cssPrefix+"slides",dots:E.cssPrefix+"dots",activeDot:E.cssPrefix+"active-dot",mouseClicked:E.cssPrefix+"mouse-clicked"},T={transforms:n("transform"),transitions:n("transition")};return function(){var t=E.slidesContainer||e,n=E.dotsContainer||e;if(!(E.disableIfOneSlide&&t.children.length<=1)){(!T.transforms||window.opera)&&(l=c),(!T.transitions||window.opera)&&(r=s),i(g=E.slidesContainer||document.createElement("div"),O.slides);for(var u=0,f=t.children.length;f>u;u++){var b=t.children[u],y=document.createElement("li");C.slides.push(b),y.setAttribute("tabindex","0"),y.setAttribute("role","button"),y.innerHTML="<span></span>",function(t,n){m(n,"click",function(){o(t),E.stopSlideshowAfterInteraction&&p()}),m(n,"keyup",function(e){13==e.keyCode&&(o(t),E.stopSlideshowAfterInteraction&&p())}),m(n,"mouseup",function(){i(n,O.mouseClicked)}),m(n,"blur",function(){a(n,O.mouseClicked)},!0),m(b,"focus",b.onfocusin=function(){e.scrollLeft=0,setTimeout(function(){e.scrollLeft=0},0),o(t)},!0)}(u,y),C.dots.push(y)}A=C.slides.length,100/A,i(e,O.active),a(e,O.inactive),E.mouseDrag&&i(e,O.mouse),C.width=e.offsetWidth,g.style.width=C.width*A+"px";for(u=0;A>u;u++)C.slides[u].style.width=C.width+"px",g.appendChild(C.slides[u]);if(E.slidesContainer||e.appendChild(g),E.dots&&A>1){i(v=document.createElement("ul"),O.dots);for(u=0,f=C.dots.length;f>u;u++)v.appendChild(C.dots[u]);E.dotsPrepend?n.insertBefore(v,n.firstChild):n.appendChild(v)}m(window,"resize",h),m(window,"orientationchange",h),setTimeout(function(){o(E.startSlide,0)},0),E.slideshow&&d(),Me(g,{mouse:E.mouseDrag,start:function(){i(e,O.drag)},move:function(e,t,n){_(),n.x=n.x/(!S&&n.x>0||S==A-1&&n.x<0?Math.abs(n.x)/C.width*2+1:1),r(n.x-C.width*S)},end:function(t,n,i){if(i.x){var r=Math.abs(i.x)/C.width,s=Math.floor(r)+(r-Math.floor(r)>.25?1:0);s+=i.time<k+k*s/1.8&&Math.abs(i.x)-s*C.width>(s?-C.width/9:20)?1:0,i.x<0?o(S+s,E.touchSpeed):o(S-s,E.touchSpeed),E.stopSlideshowAfterInteraction&&p()}a(e,O.drag)}}),setTimeout(function(){E.onSetup&&E.onSetup(A)},0)}}(),{slideTo:function(e,t){return o(parseInt(e,10),t)},next:u,prev:function(){var e=S-1;return 0>e&&(e=A-1),o(e)},start:d,stop:p,pause:_,getCurrentPos:function(){return S},getSlidesNumber:function(){return A},recalcWidth:h}}function Me(e,t){function n(e,t,n,a){return t?(e.addEventListener?e.addEventListener(t,n,!!a):e.attachEvent("on"+t,n),{remove:function(){i(e,t,n,a)}}):void 0}function i(e,t,n,i){t&&(e.removeEventListener?e.removeEventListener(t,n,!!i):e.detachEvent("on"+t,n))}function a(e){}function o(e){if((m={x:(f?e.clientX:e.touches[0].clientX)-h.x,y:(f?e.clientY:e.touches[0].clientY)-h.y,time:Number(new Date)-h.time}).time-v[v.length-1].time){for(var t=0;t<v.length-1&&m.time-v[t].time>80;t++);A={x:(m.x-v[t].x)/(m.time-v[t].time),y:(m.y-v[t].y)/(m.time-v[t].time)},v.length>=5&&v.shift(),v.push({x:m.x,y:m.y,time:m.time})}}function r(e,t){b=!0,C[f=t](e)||(n(document,w[f][1],s),n(document,w[f][2],l),n(document,w[f][3],l),u.preventDefault,h={x:f?e.clientX:e.touches[0].clientX,y:f?e.clientY:e.touches[0].clientY,time:Number(new Date)},d=void 0,m={x:0,y:0,time:0},A={x:0,y:0},v=[{x:0,y:0,time:0}],u.start(e,h))}function s(e){!u.preventScroll&&d||C[f](e)||(o(e),(Math.abs(m.x)>u.clickTolerance||Math.abs(m.y)>u.clickTolerance)&&(b=!1),void 0===d&&3!==f&&(d=Math.abs(m.x)<Math.abs(m.y)&&!u.preventScroll)||(u.preventDefault,u.move(e,h,m,A)))}function l(e){f&&o(e),!b&&e.target&&e.target.blur&&e.target.blur(),i(document,w[f][1],s),i(document,w[f][2],l),i(document,w[f][3],l),u.end(e,h,m,A)}var c=function(){},u={preventDefault:!0,clickTolerance:0,preventScroll:!1,mouse:!0,start:c,move:c,end:c,click:c};t&&function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}(u,t);var d,f,_=!!window.navigator.pointerEnabled,p=!!window.navigator.msPointerEnabled,h={},m={},A={},v=[],g=[],b=!0,y=_?1:p?2:0,w=[["touchstart","touchmove","touchend","touchcancel"],["pointerdown","pointermove","pointerup","pointercancel"],["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerCancel"],["mousedown","mousemove","mouseup",!1]],C=[function(e){return e.touches&&e.touches.length>1||e.scale&&1!==e.scale},function(e){return!e.isPrimary||e.buttons&&1!==e.buttons||!u.mouse&&"touch"!==e.pointerType&&"pen"!==e.pointerType},function(e){return!e.isPrimary||e.buttons&&1!==e.buttons||!u.mouse&&e.pointerType!==e.MSPOINTER_TYPE_TOUCH&&e.pointerType!==e.MSPOINTER_TYPE_PEN},function(e){return e.buttons&&1!==e.buttons}];return g.push(n(e,w[y][0],function(e){r(e,y)})),g.push(n(e,"dragstart",a)),u.mouse&&!y&&g.push(n(e,w[3][0],function(e){r(e,3)})),g.push(n(e,"click",function(e){b&&u.click(e)})),{getClicksAllowed:function(){return b},kill:function(){for(var e=g.length-1;e>=0;e--)g[e].remove()}}}window.jQuery&&function(e){e.fn.Peppermint=function(t){return this.each(function(){e(this).data("Peppermint",Ie(this,t))}),this}}(window.jQuery),window.Peppermint=Ie,window.EventBurrito=Me;var xe=Ie,Be=function(){function e(){this.initPopup(),this.popup&&(this.connectEvents(),this.initSlider(),e.sendStat("show_screen"))}e.sendStat=function(e){Object(i.statlogsValueEvent)("audio_onboarding",e)};var t=e.prototype;return t.initPopup=function(){var e=document.querySelector(".audioRestrictionSplash");e&&(this.popup=je.default.open(e,!0,{forceScrollDisable:!0}))},t.connectEvents=function(){var t=this;this.popup.querySelectorAll(".audioRestrictionSplash__closeIcon").forEach(function(n){n.addEventListener("click",function(n){gpeByClass("audioRestrictionSplash__firstScreen",n.target)?e.sendStat("skip_1screen"):gpeByClass("audioRestrictionSplash__secondScreen",n.target)&&e.sendStat("skip_2screen"),t.close()})}),this.popup.querySelector(".audioRestrictionSplash__explain").addEventListener("click",function(){return e.sendStat("click_more")}),this.popup.querySelector(".audioRestrictionSplash__continueFreeLink").addEventListener("click",function(){e.sendStat("continue_free"),t.close()}),this.popup.querySelector(".audioRestrictionSplash__continueButton").addEventListener("click",function(){t.slider.next(),e.sendStat("next_1screen")}),this.popup.querySelector(".audioRestrictionSplash__specialLink").addEventListener("click",function(){return e.sendStat("get_offer")})},t.initSlider=function(){this.screens=this.popup.querySelector(".audioRestrictionSplash__screens"),this.slider=xe(this.screens,{dots:!0,speed:500})},t.close=function(){je.default.close(this.popup)},e}(),Pe=n("r/ag"),Le=function(){function e(){this.visibleCallbacks=[],this.hiddenCallbacks=[],this.visibilityPrefix="",this.hiddenStateName="hidden",this.isHidden=!1,this.listen()}e._supports=function(e){return e+"Hidden"in document};var t=e.prototype;return t.onVisible=function(e){this.visibleCallbacks.push(e)},t.onHidden=function(e){this.hiddenCallbacks.push(e)},t.listen=function(){var e=this,t=arguments;try{var n=d.default.version.split(".")[0];if(d.default.safari_mobile&&n<=7)return window.addEventListener("pagehide",function(){return e._hidden()}),void window.addEventListener("pageshow",function(){return e._visible()});var i=d.default.android&&d.default.safari&&n<5,a=!i&&this.isSupported();a?(document.addEventListener(this.visibilityPrefix+"visibilitychange",function(){return e._nativeSwitch(t)}),window.addEventListener(this.visibilityPrefix+"visibilitychange",function(){return e._nativeSwitch(t)})):document.addEventListener?(window.addEventListener("focus",function(){return e._visible()},1),window.addEventListener("blur",function(){return e._hidden()},1)):(document.attachEvent("onfocusin",function(){return e._visible()}),document.attachEvent("onfocusout",function(){return e._hidden()}))}catch(e){}},t.isSupported=function(){for(var t=0;t<e.prefixes.length;t++){var n=e.prefixes[t];if(e._supports(n))return this.hiddenStateName=(n?n+"H":"h")+"idden",this.visibilityPrefix=n,!0}return!1},t._visible=function(){this.isHidden=!1,this.visibleCallbacks.forEach(function(e){return e()})},t._hidden=function(){this.isHidden=!0,this.hiddenCallbacks.forEach(function(e){return e()})},t._nativeSwitch=function(){!0===document[this.hiddenStateName]?this._hidden():this._visible()},e}();function Re(e){var t=null;if(e.action_button){var n=e.action_button;t={class:"AudioPopup__actionButtonWrapper",inner:{class:["AudioPopup__actionButton","button"],onclick:n.onclick,href:n.href,inner:n.text}}}var i=["AudioPopup"];e.popupClass&&i.push(e.popupClass);var a={class:"AudioPopup__content",inner:[{class:"AudioPopup__title",inner:e.title},{class:"AudioPopup__description",inner:e.description},t,e.additional_link]};return new Pe.default({content:a,class:i.join(" ")})}Le.prefixes=["webkit","o","ms","moz",""];var Ne=n("J8bf"),Fe=function(){function e(){audioSubscribe||(this.isIdle=!1,this.showAlertCountToday=function(e,t){void 0===t&&(t=0);var n=parseInt(Object(Ne.getCookie)(e),10);if(isNaN(n,10))return t;return n}(e.SHOW_ALERT_COOKIE),this.initVisibilityChangeEvent())}e.writePopupStat=function(e){statlogsValueEvent("mvk_audio_background_popup",e)},e.createPopup=function(){var t={href:e.EXPLANATION_LINK,onclick:'AudioBackgroundRestriction.writePopupStat("explanation_click");',class:"AudioPopup__explanation",inner:getLang("mobile_audio_background_restriction_explanation")};return Wd.elem(Re({popupClass:"AudioRestrictionPopup",title:getLang("mobile_audio_background_restriction_title"),description:getLang("mobile_audio_background_restriction_description"),action_button:{href:e.REMOVE_RESTRICTION_LINK,onclick:'AudioBackgroundRestriction.writePopupStat("link_click");',text:getLang("mobile_audio_background_restriction_button")},additional_link:t}))};var t=e.prototype;return t.onIdle=function(){window.audio.playing()&&this.triggerRestriction()},t.showBackgroundMessage=function(){var t=e.createPopup();this.showAlertCountToday+=1,Object(Ne.setCookie)("remixaudio_show_alert_today",this.showAlertCountToday,1),this.showAlertCountToday%3||(Pe.default.open(t,!0),e.writePopupStat("show"))},t.triggerRestriction=function(){audio.pause(),this.showBackgroundMessage()},t.initVisibilityChangeEvent=function(){var e=this;this.pageVisibility=new Le,this.pageVisibility.onVisible(function(){e.isIdle=!1}),this.pageVisibility.onHidden(function(){e.isIdle=!0,e.onIdle()})},e}();Fe.SHOW_ALERT_COOKIE="remixaudio_show_alert_today",Fe.REMOVE_RESTRICTION_LINK="/offermusic",Fe.EXPLANATION_LINK="https://vk.cc/9uFgyl";var He=n("L9Nh"),Ue=null,Ve=null,$e=0,qe=function(){function e(){}return e.connect=function(t){if(void 0===t&&(t=!1),He.QueueManager.initialized){var n=window.audio.getCurrent();n&&!(!t&&Ue)&&ajax.post("/audio",{act:"queue_params",audio_id:n.id,owner_id:n.ownerId,hash:n.actionHash},{onDone:function(t){var n=t&&t.queues&&t.queues[0];n&&e.subscribe(n)},onFail:function(){return $e<2&&($e++,setTimeout(e.connect,5e3)),!0}})}},e.update=function(t,n){if(t===Ue)if(n.failed)e.connect(!0);else for(var i=window.audio.playing(),a=0;a<n.events.length;a++){var o=n.events[a].data;if("start"===o.type&&window.audio.getDeviceId()!==o.uuid&&!e.startPlaybackBox&&i){window.audio.pause(),e.showMultipleStreamPopup(o);break}}},e.showMultipleStreamPopup=function(t){var n=e.createPopup(t.device_name);Pe.default.open(n,!0,{oncloseCallback:function(){return e.startPlaybackBox=!1}}),document.querySelector(".AudioPopup__actionButton").addEventListener("click",function(){Pe.default.close()}),e.startPlaybackBox=!0},e.subscribe=function(t){Ve&&clearTimeout(Ve),Ue=t.key,He.QueueManager.addQueue({key:t.key,ts:t.timestamp},function(n,i){return e.update(t.key,i)}),He.QueueManager.start(),Ve=setTimeout(function(){return e.connect(!0)},25e3)},e.createPopup=function(e){return Wd.elem(Re({title:getLang("mobile_audio_start_playback_title"),description:getLang("mobile_audio_start_playback_body").replace("{device_name}",e),action_button:{text:getLang("mobile_audio_continue")}}))},e}();qe.startPlaybackBox=!1;var We="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA",ze=n("xk4V"),Qe=n.n(ze),Ye=function(){function e(){this.subscriptions=null,this.precheck=null,this.onAnyCallBack=null,this.subscriptions={}}var t=e.prototype;return t.subscribe=function(e,t){var n=this;return Array.isArray(e)&&e.forEach(function(e){return n.subscribe(e,t)}),this.subscriptions[e]||(this.subscriptions[e]=[]),this.subscriptions[e].push(t),{unsubscribe:function(){return n.unsubscribe(e,t)}}},t.unsubscribe=function(e,t){if(this.subscriptions[e]){var n=this.subscriptions[e].indexOf(t);n>=0&&this.subscriptions[e].splice(n,1)}},t.emit=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.precheck&&!this.precheck.apply(this,[e].concat(n))||(this.onAnyCallBack&&this.onAnyCallBack.apply(this,[e].concat(n)),this.subscriptions[e]&&this.subscriptions[e].forEach(function(e){return e.apply(void 0,n)}))},e}(),Xe=function(){if(!HTMLAudioElement)return{init:function(){},playing:function(){},onInit:function(){},onSelect:function(){},pause:function(){},onAdStart:function(){},onAdComplete:function(){}};var e=new Ye,t=!1,n=!1,i=!1,a=!1,o=!1,s=function e(n){(t||!1!==o)&&(t=!1,g&&!1===o||(a=!0,E.pause.call(u))),cancelEvent(n),removeEvent(u,"play",e),removeEvent(document,d.isTouch?"touchstart":"click",c)},l=function(){!1!==o&&o()},c=function e(){i&&(i=!1,t=!0,O(u),removeEvent(document,d.isTouch?"touchstart":"click",e))},u=function(e){var n=window.Audio?new Audio:ce("audio");n.autobuffer=!0,n.muted=!1,n.preload="none",e&&(n.volume=e.volume,removeEvent(e,"play",T),removeEvent(e,"pause",D),removeEvent(e,"progress",j),removeEvent(e,"timeupdate",I),removeEvent(e,"ended",M),removeEvent(e,"play",s),removeEvent(e,"progress canplaythrough",l),removeEvent(document,d.isTouch?"touchstart":"click",c),e.muted=!0,e.pause(),e.src=null);return y=!1,b=!1,!1,t=!1,a=!1,o=!1,addEvent(n,"play",T),addEvent(n,"pause",D),addEvent(n,"progress",j),addEvent(n,"timeupdate",I),addEvent(n,"ended",M),addEvent(n,"play",s),addEvent(n,"progress canplaythrough",l),addEvent(document,d.isTouch?"touchstart":"click",c),n}(),f=srand(),_=[],p=null,h={},A="",v=null,g=!1,b=!1,y=!1,w=null,C=!1,k=!1,S=0;delete HTMLAudioElement.prototype.play,delete HTMLAudioElement.prototype.pause,delete HTMLAudioElement.prototype.load,delete HTMLAudioElement.prototype.canPlayType;var E={play:HTMLAudioElement.prototype.play,pause:HTMLAudioElement.prototype.pause,load:HTMLAudioElement.prototype.load,canPlayType:HTMLAudioElement.prototype.canPlayType};function O(e){var t=E.play.call(e);void 0!==t&&t.catch(function(e){e.code!==e.ABORT_ERR&&window.audio.pause()})}function T(){g||(g=!0,ssSet("audio_play","1"),clearTimeout(w),w=setTimeout(L,100)),audioBackgroundRestriction&&audioBackgroundRestriction.isIdle?Xe.pause():e.emit(ke.PLAY,B())}function D(){e.emit(ke.PAUSE,B()),a?a=!1:g&&(g=!1,ssSet("audio_play","0"),clearTimeout(w))}function j(){e.emit(ke.BUFFERED,B(),Xe.loaded(),Xe.duration())}function I(){if(!a&&!Ge.isPlaying()){var t=Xe.getCurrentProgress(),n=Xe.played();e.emit(ke.PROGRESS,B(),t,Xe.duration(),n),t>.01&&(S=n),ssSet("audio_pos",Xe.getPosition()),!y&&u.duration-u.currentTime<.5&&(y=!0),b&&(b=!1,Xe.next())}}function M(){e.emit(ke.ENDED,B()),y?(y=!1,u.src!==We&&Xe.next()):b=!0}function x(){return _[p]||!1}function B(){return x().fullId||!1}function P(t,n){if(t){var i,a=be(t.url),o=function(){return e.emit(ke.SELECT,t)};i=t.url,/\.m3u8/.test(be(i))?function e(t,n,i){var a=window,o=a.Hls,r=a.browser;var s=function(){isFunction(i)&&i()};if(!o)return r.safari&&O(u),void Object(we.loadScript)("/js/lib/hls.min.js",{onLoad:function(){return e(t,n,i)}});if(o.isSupported()&&!r.msie_edge){N&&N.destroy();var l=new o({maxBufferHole:3,nudgeOffset:.5,nudgeMaxRetry:5,maxBufferLength:240});l.attachMedia(t),l.loadSource(n),l.on(o.Events.ERROR,function(e,t){t.details===o.ErrorDetails.BUFFER_STALLED_ERROR&&(l.stopLoad(),l.startLoad())}),l.on(o.Events.MANIFEST_PARSED,function(){return s()}),N=l}else t.canPlayType("application/vnd.apple.mpegurl")&&(t.src=n,s())}(u,a,o):(u.src=a,n||E.load.call(u),o())}}function L(){if(g){var e=lsGet("audio_current_player");f!=e?Xe.pause():w=setTimeout(L,100)}}function R(){var e=B();ssSet("audio_id",e),C&&(Object(Ne.setCookie)(C,e,1),Object(Ne.setCookie)(C+"_playlist",v,1))}var N=null;return{onInit:Object(r.default)(),init:function(t){if(!k&&Xe.support){k=!0,t.cookie&&(C=t.cookie,t.cookie_path||"/");var n=ssGet("audio_pos"),i=ssGet("audio_vol");onDOMReady(function(){t.playlist&&Xe.playlist(t.playlist,{q:t.playlist_q||""});var a=ssGet("audio_id");if(a){u.addEventListener("loadeddata",function e(){a===B()&&(null!==n&&Xe.setPosition(n),null!==i&&Xe.volume(i)),u.removeEventListener("loadeddata",e)}),P(_[p]),Xe.select(a),null!==n&&e.emit(ke.SEEK,B(),n,Xe.duration())}Xe.onInit()})}},support:u.canPlayType&&E.canPlayType.call(u,"audio/mpeg")&&"no"!=E.canPlayType.call(u,"audio/mpeg")||!1,subscribe:function(t,n){return e.subscribe(t,n)},unsubscribe:function(t,n){return e.unsubscribe(t,n)},notify:function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];e.emit.apply(e,[t].concat(i))},getCurrent:x,getCurrentId:B,operate:function(e){if(!Xe.support)return!1;!e||_[p]&&e==_[p].fullId?g?Xe.pause():Xe.play():Xe.play(e)},playing:function(){return g},select:function(t){if(!Xe.support)return!1;if(t){if(!_.length)return e.emit(ke.EMPTY_PLAYLIST,t),!1;if(!_[h[t]])return e.emit(ke.NOT_FOUND_PLAYLIST,t),!1;B()&&e.emit(ke.DESELECT,x()),p=h[t];var n=audioplayer.getPlaylistByAudioId(t);return v!==n&&e.emit(ke.PLAYLIST_CHANGED),v=n,P(_[p],!0),R(),!0}},autoplay:function(e){Xe.play(e),u.paused&&Xe.pause()},getCurrentPlaylistId:function(){return v},play:function(t){var n=this;if(!Xe.support)return!1;if(t){if(g&&Xe.pause(),!Xe.select(t))return;try{u.currentTime=.01}catch(e){}}Ge.isPlaying()?g?Ge.pause():Ge.resume():g||(u.muted=!1,u.preload="auto",g=!0,e.emit(ke.PLAY_REQUESTED,B()),t&&Object(m.partConfigEnabled)("mvk_audio_ads")?(browser.safari&&E.load.call(u),Ge.startPlay(_[h[t]],!1,function(){n._play()})):this._play())},_play:function(){O(u),ssSet("audio_play","1"),lsSet("audio_current_player",f),qe.connect()},pause:function(){if(!Xe.support)return!1;g&&(E.pause.call(u),Ge.isPlaying()&&Ge.pause(),g=!1,ssSet("audio_play","0"))},getDeviceId:function(){var e=lsGet("audio_player_device_id");return e||(e=Qe()(),lsSet("audio_player_device_id",e)),e},getPosition:function(){return Xe.isAdsPlaying()?Ge.getCurrentProgress()*Ge.getDuration():u.currentTime},getCurrentProgress:function(){var e=u;return isNaN(e.duration)?0:Math.max(0,Math.min(1,e.currentTime/e.duration))},setPosition:function(t,n){if(!Xe.support)return!1;var i;i=t,n&&(i=Xe.duration()*t),i=Math.max(0,Math.min(i,Xe.duration())),u.currentTime=i,ssSet("audio_pos",i),e.emit(ke.SEEK,B(),i,Xe.duration())},volume:function(t){if(!Xe.support)return!1;if(void 0===t)return u.volume;try{u.volume=t||0,Ge.updateVolume()}catch(e){}e.emit(ke.VOLUME,B(),u.volume),ssSet("audio_vol",t||0)},loaded:function(){return u.buffered&&u.buffered.length&&u.buffered.end(u.buffered.length-1)||0},duration:function(){if(this.isAdsPlaying())return Ge.getDuration();var e=isFinite(u.duration)?u.duration:0,t=_[p]&&_[p].duration;return e||t||0},played:function(){for(var e=u.played,t=0,n=0;n<e.length;n++)t+=e.end(n)-e.start(n);return t},getListenedTime:function(){return S},next:function(){if(!Xe.support)return!1;g&&Xe.pause(),e.emit(ke.DESELECT,x()),++p>=_.length&&(p=0),P(_[p]),R(),i=!0,Xe.play(B())},prev:function(){if(!Xe.support)return!1;g&&Xe.pause(),e.emit(ke.DESELECT,x()),--p<=0&&(p=_.length-1),P(_[p]),R(),i=!0,Xe.play(B())},playlist:function(t,n){return!!Xe.support&&(void 0===t?_:(g&&!Ge.isPlaying()&&Xe.pause(),x()&&e.emit(ke.DESELECT,x()),_=t,A=n&&n.q||"",p=null,h={},each(t,function(e,t){h[t.fullId]=e}),void function(e){ssSet("audio_query",e),C&&Object(Ne.setCookie)(C+"q",encodeURIComponent(e),1)}(A)))},addToPlaylist:function(e,t){var n={},i=t||_.length;_.forEach(function(e){return n[e.fullId]=!0}),e.forEach(function(e){n[e.fullId]||(t?_.splice(i,0,e):_.push(e))})},playlist_q:function(){return A},setIsPlaying:function(e){g=e},isAdsPlaying:function(){return Ge.isPlaying()},initSplash:function(){n||(window.audioRestrictionSplash=new Be,n=!0)},playNothing:function(){u.src=We,E.load.call(u)},events:ke}}();window.Artist=Ce,window.audio=Xe,window.AudioBackgroundRestriction=Fe;var Ge=new Oe(new De(Xe),null,!0);window.audioBackgroundRestriction=null,document.addEventListener("DOMContentLoaded",function(){Object(m.partConfigEnabled)("audio_mvk_background_restriction_enabled")&&(window.audioBackgroundRestriction=new Fe)}),document.addEventListener("DOMContentLoaded",function(){"audio"===cur.module&&Xe.initSplash()}),window.page.onChange(function(){"audio"===cur.module?Xe.initSplash():window.audioRestrictionSplash&&window.audioRestrictionSplash.popup&&window.audioRestrictionSplash.close()});var Ke=n("wx14"),Je=function(){function e(e){this.player=e,this.listeners=[]}var t=e.prototype;return t.listen=function(e,t,n){var i=t.bind(n||this);this.listeners.push({event:e,fn:t,listener:i}),this.playerListen(e,i)},t.unListen=function(e,t){var n=-1;if(each(this.listeners,function(i,a){if(a.event===e&&a.listener===t)return n=i,!1}),!(n<0)){var i=this.listeners[n];this.playerUnListen(e,i.listener),this.listeners.splice(n,1)}},t.unListenAll=function(){for(var e;e=this.listeners[0];)this.unListen(e.event,e.listener)},t.listenPlay=function(e,t){this.listen(ke.PLAY,e,t)},t.listenPause=function(e,t){this.listen(ke.PAUSE,e,t)},t.listenStop=function(e,t){this.listen("stop",e,t)},t.listenProgress=function(e,t){this.listen(ke.PROGRESS,e,t)},t.listenVolume=function(e,t){this.listen(ke.VOLUME,e,t)},t.listenSeek=function(e,t){this.listen(ke.SEEK,e,t)},t.listenPlaylistChanged=function(e,t){this.listen(ke.PLAYLIST_CHANGED,e,t)},t.listenEnded=function(e,t){this.listen(ke.ENDED,e,t)},t.listenPlayNext=function(e,t){this.listen(ke.PLAY_NEXT,e,t)},t.listenAdCompleted=function(e,t){this.listen(ke.AD_COMPLETED,e,t)},t.playerListen=function(e,t){this.player.subscribe(e,t)},t.playerUnListen=function(e,t){this.player.unsubscribe(e,t)},t.getPausedBy=function(){return null},t.getState=function(){return document.hidden?1:3},t.getProgress=function(){return this.player.playerGetProgress()},t.getProgressInSeconds=function(){return this.player.getProgressInSeconds()},t.getVolume=function(){return this.player.getVolume()},t.getAudioId=function(){return this.player.getAudioId()},t.getAudio=function(){return this.player.getAudio()},t.getAudioTrackCode=function(){return this.player.getAudioTrackCode()},t.getPrevAudioId=function(){return this.player.getPrevAudioId()},t.getPrevPlaylistId=function(){return this.player.getPrevPlaylistId()},t.getPlaylistId=function(){return this.player.getPlaylistId()},t.getContext=function(){return this.player.getContext()},t.getSequence=function(){return this.player.getSequence()},t.getType=function(){return this.player.getType()},t.getListenedTime=function(){return isNaN(this.player.getListenedTime())?0:Math.round(this.player.getListenedTime())},t.getSearchParams=function(){return this.player.getSearchParams()},t.isPlaying=function(){return this.player.isPlaying()},t.isAutoPlayed=function(){return this.player.isAutoPlayed()},t.isRepeatCurrentAudio=function(){return this.player.isRepeatCurrentAudio()},t.isRepeatAll=function(){return this.player.isRepeatAll()},t.isShuffledPlaylist=function(){return this.player.isShuffledPlaylist()},t.isRealPlaylist=function(){return this.player.isRealPlaylist()},t.isRealPrevPlaylist=function(){return this.player.isRealPrevPlaylist()},t.isPodcast=function(){return this.player.isPodcast()},t.isAdPlaying=function(){return this.player.ads.isPlaying()},t.isLastTrack=function(){return this.player.isLastTrack()},t.hasPrevAudio=function(){return this.player.hasPrevAudio()},t.hasPrevPlaylist=function(){return this.player.hasPrevPlaylist()},t.hasPlaylist=function(){return this.player.hasPlaylist()},t.hasSearchParams=function(){return this.player.hasSearchParams()},t.isDebug=function(){return!1},t.sendListenedData=function(e){return this.player.sendListenedData(e)},e}();var Ze,et,tt=n("DM2o"),nt=((Ze={}).start=1,Ze.stop=2,Ze.volume=3,Ze.rewind=4,Ze.play_further=5,Ze.added=6,Ze.removed=7,Ze.recommendation_removed=8,Ze.show_album=9,Ze.share_audio=10,Ze),it=((et={}).default=1,et.next_track=2,et.prev_track=3,et.auto=4,et.interruption=5,et.pause=6,et.new=7,et.close_app=8,et.queue=9,et.pause=10,et.upload=11,et),at=300,ot=function(){function e(e){var t,n,i,a;this.playerAdapter=e,this.listenedData=null,this.sendTimeout=null,this.currentAudioId=null,this.currentAudio=null,this.currentAudioTrackCode=null,this.pausedAudioId=null,this.playlistChanged=!1,this.currentPosition=0,this.currentListened=0,this.playedTime=0,this.adsCompleted=!1,this.wasEnded=!1,this.debug=e.isDebug(),this.onVolume=(t=this.onVolume.bind(this),n=at,function(){var e=this,o=arguments,r=function(){a=null,i||t.apply(e,o)},s=i&&!a;clearTimeout(a),a=setTimeout(r,n),s&&t.apply(this,o)}),this.playerAdapter.listenPlay(this.onPlay,this),this.playerAdapter.listenPause(this.onPause,this),this.playerAdapter.listenStop(this.onPause,this),this.playerAdapter.listenProgress(this.onProgress,this),this.playerAdapter.listenVolume(this.onVolume,this),this.playerAdapter.listenSeek(this.onSeek,this),this.playerAdapter.listenPlaylistChanged(this.onPlaylistChanged,this),this.playerAdapter.listenEnded(this.onEnded,this),this.playerAdapter.listenPlayNext(this.onPlayNext,this),this.playerAdapter.listenAdCompleted(this.onAdCompleted,this),this.onPageClose=this.onPageClose.bind(this),addEvent(window,"beforeunload",this.onPageClose)}var t=e.prototype;return t.canOperate=function(){return!this.playerAdapter.isPodcast()&&!this.playerAdapter.isAdPlaying()},t.getCurrentAudioParams=function(){var e=this.currentAudioId||this.playerAdapter.getAudioId();if(e){var t=e.split("_");return{ownerId:t[0],audioId:t[1],trackCode:this.currentAudioTrackCode||this.playerAdapter.getAudioTrackCode()}}return{}},t.getEnvParams=function(){return{state:this.playerAdapter.getState(),context:this.playerAdapter.getContext(),ref:window.cur&&vk.widget?String(cur.widgetReferrer||"").substring(0,20):""}},t.getListenedTime=function(){return Math.round(this.playerAdapter.getListenedTime())||0},t.getPlaySubtype=function(){if(this.playerAdapter.isAutoPlayed())return"auto";var e=this.playerAdapter.getSequence();if(e)return e>0?"next_track":"prev_track";var t=this.pausedAudioId,n=this.playerAdapter.getAudioId();return t&&n===t?"pause":"new"},t.onPlay=function(){if(this.canOperate()){var e=this.playerAdapter.getAudio(),t=e.fullId,n=this.currentAudioId===t||!this.currentAudioId,i=this.playerAdapter.getListenedTime();n||this.onTrackSwitch(this.currentAudio,this.currentPlaylistId),this.playedTime=vkNow(),this.currentAudioId=t,this.currentAudio=e,this.currentAudioTrackCode=this.playerAdapter.getAudioTrackCode(),this.currentPlaylistId=this.playerAdapter.getPlaylistId(),this.wasEnded||this.playerAdapter.hasPrevAudio()&&(!this.pausedAudioId||this.playerAdapter.isAutoPlayed())?(this.currentPosition=0,i=0):this.currentPosition=this.playerAdapter.getProgressInSeconds(),this.currentListened=i,this.sendCurrentAudioEvent({type:"start",subtype:this.getPlaySubtype(),position:this.currentPosition,listened:i}),this.pausedAudioId=null,this.playlistChanged=!1,this.wasEnded=!1}},t.onPause=function(){var e=this;if(this.pausedAudioId=this.playerAdapter.getAudioId(),this.canOperate()&&this.pausedAudioId){var t=this.collectListenedData();this.sendListenedDataDelayed(1e3,t),setTimeout(function(){if(!(vkNow()-e.playedTime<150)){var t=e.playerAdapter.getPausedBy(e.playedTime);e.sendCurrentAudioEvent({type:"stop",subtype:t?"queue"===t?"queue":"interruption":"pause"})}})}},t.onProgress=function(){this.playerAdapter.getProgress()<.01||(this.currentPosition=this.playerAdapter.getProgressInSeconds(),this.currentListened=this.playerAdapter.getListenedTime(),!this.pausedAudioId&&vkNow()-this.playedTime>150&&this.collectListenedData(),this.adsCompleted&&(this.sendCurrentAudioEvent({type:"start",subtype:this.getPlaySubtype(),position:this.currentPosition}),this.adsCompleted=!1))},t.onVolume=function(){this.canOperate()&&this.sendCurrentAudioEvent({type:"volume",subtype:"default"})},t.onSeek=function(){if(this.canOperate()){var e={position:this.currentPosition,positionTo:this.playerAdapter.getProgressInSeconds()};e.position!==e.positionTo&&this.sendCurrentAudioEvent(Object(Ke.default)({type:"rewind",subtype:"default"},e))}},t.onPlaylistChanged=function(){this.canOperate()&&(this.playlistChanged=!0)},t.onEnded=function(){this.listenedData&&this.playerAdapter.isLastTrack()&&(this.listenedData.end_stream_reason="session_end"),this.wasEnded=!0,this.playerAdapter.isRepeatCurrentAudio()?(this.sendCurrentAudioEvent({type:"stop",subtype:"auto"}),this.collectListenedData(),this.sendListenedData()):this.sendListenedDataDelayed(150)},t.onPlayNext=function(e,t){if(this.canOperate()){var n=t.split("_"),i=n[0],a=n[1];this.sendAudioEvent({type:"play_further",subtype:"default",ownerId:i,audioId:a})}},t.onAdCompleted=function(){this.adsCompleted=!0},t.onTrackSwitch=function(e,t){if(e){var n="new",i=this.playerAdapter.getSequence(),a=e.fullId.split("_"),o=a[0],r=a[1];this.playerAdapter.isAutoPlayed()?n="auto":i&&(n=i>0?"next_track":"prev_track"),this.sendCurrentAudioEvent({type:"stop",subtype:n,position:this.currentPosition,listened:this.currentListened,trackCode:e.trackCode,playlistId:t,ownerId:o,audioId:r}),this.wasEnded=!0,this.collectListenedDataSwitch(),this.sendListenedData()}},t.onPageClose=function(){this.playerAdapter.isPlaying()&&(this.sendCurrentAudioEvent({type:"stop",subtype:"close_app"}),this.sendListenedData())},t.collectListenedDataSwitch=function(){if(this.listenedData){if("session_end"===this.listenedData.end_stream_reason)return;var e=this.playerAdapter.isAutoPlayed(),t=this.getListenedTime(),n=this.playerAdapter.getSequence(),i=null;n&&!e?i=n>0?"next_btn":"prev":this.playlistChanged&&(i="playlist_change"),!i&&e&&(i="playlist_next"),this.listenedData.end_stream_reason=i||"new",t&&(this.listenedData.listened=t)}},t.collectListenedData=function(){if(this.canOperate()){var e=this.playerAdapter.getAudioId(),t=this.playerAdapter.getAudioTrackCode(),n=this.getListenedTime(),i=this.currentAudio&&this.currentAudio.urlHash;if(i||console.log("no url hash"),n&&i){var a={audio_id:e,listened:n,context:this.playerAdapter.getContext(),hash:i};return window.cur&&vk.widget&&(a.ref=cur.widgetReferrer||""),this.playerAdapter.hasSearchParams()&&(a.search_params=JSON.stringify(this.playerAdapter.getSearchParams())),this.playerAdapter.hasPlaylist()&&(this.playerAdapter.isRealPlaylist()&&(a.playlist_id=this.playerAdapter.getPlaylistId()),this.playerAdapter.isShuffledPlaylist()&&(a.shuffled=1)),t&&(a.track_code=t),this.playerAdapter.isRepeatCurrentAudio()?a.repeat="one":this.playerAdapter.isRepeatAll()&&(a.repeat="all"),this.playerAdapter.isAutoPlayed()&&(a.auto=1),this.playerAdapter.hasPrevAudio()&&(a.prev_audio_id=this.playerAdapter.getPrevAudioId()),this.playerAdapter.hasPrevPlaylist()&&this.playerAdapter.isRealPrevPlaylist()&&(a.prev_playlist_id=this.playerAdapter.getPrevPlaylistId()),this.playerAdapter.isPlaying()||(a.end_stream_reason="stop_btn"),a.state=document.hidden?"background":"app",this.listenedData=a,this.sendListenedDataDelayed(1e4,a),a}}},t.sendListenedData=function(e){void 0===e&&(e=null),clearTimeout(this.sendTimeout);var t=e||this.listenedData;this.listenedData=null,t&&t.listened&&this.playerAdapter.sendListenedData(t)},t.sendListenedDataDelayed=function(e,t){var n=this;void 0===e&&(e=0),void 0===t&&(t=null),clearTimeout(this.sendTimeout),this.sendTimeout=setTimeout(function(){return n.sendListenedData(t)},e)},t.serializeEvent=function(e){var t=[nt[e.type],it[e.subtype],1];return e.audioId?t.push(e.ownerId+"_"+e.audioId):t.push(0),e.trackCode?t.push(e.trackCode):t.push(0),e.state?t.push(e.state):t.push(0),e.ref?t.push(e.ref):t.push(""),e.context?t.push(e.context):t.push("other"),e.volume||0===e.volume?t.push(e.volume):t.push(this.playerAdapter.getVolume()),e.position||0===e.position?t.push(e.position):t.push(this.playerAdapter.getProgressInSeconds()),e.shuffle?t.push(e.shuffle?1:0):t.push(0),e.repeat?t.push(e.repeat):t.push(0),e.listened?t.push(Math.max(e.listened,0)):t.push(0),e.playlistId?t.push(e.playlistId):t.push(0),e.positionTo&&t.push(e.positionTo),t},t.sendEvent=function(e){this.debug&&(console.log("audio stats event",e.type,e.subtype,e),window._statForTest||(window._statForTest=[]),window._statForTest.push(e)),tt.statlogsValueEvent.apply(void 0,["audio_sts"].concat(this.serializeEvent(e)))},t.sendCurrentAudioEvent=function(e){this.sendEvent(Object(Ke.default)({shuffle:this.playerAdapter.isShuffledPlaylist(),repeat:this.playerAdapter.isRepeatCurrentAudio()?1:this.playerAdapter.isRepeatAll()?2:0,volume:this.playerAdapter.getVolume(),position:this.playerAdapter.getProgressInSeconds(),listened:this.getListenedTime(),playlistId:this.playerAdapter.getPlaylistId()},this.getEnvParams(),this.getCurrentAudioParams(),e))},t.sendAudioEvent=function(e){this.sendEvent(Object(Ke.default)({},e,this.getEnvParams()))},t.destroy=function(){this.playerAdapter.unListenAll(),removeEvent(window,"beforeunload",this.onPageClose),this.playerAdapter=null,this.listenedData=null,clearTimeout(this.sendTimeout)},e}(),rt=n("dI71"),st=function(e){function t(){return e.apply(this,arguments)||this}Object(rt.default)(t,e);var n=t.prototype;return n.getPausedBy=function(e){return ge("StoriesView")?"stories":null},n.getState=function(){var t=e.prototype.getState.call(this),n=this.getAudioId();return n&&ge("audio"+n)?2:t},n.getProgress=function(){var e=this.player.getCurrent();return e?this.player.getPosition()/e.duration:0},n.getProgressInSeconds=function(){return Math.round(this.player.getPosition())},n.getVolume=function(){return Math.round(100*this.player.volume())},n.getAudioId=function(){return this.player.getCurrentId()},n.getAudio=function(){return this.player.getCurrent()},n.getAudioTrackCode=function(){try{return this.player.getCurrent().trackCode}catch(e){return!1}},n.getPrevAudioId=function(){var e=this.getAudioId(),t=window.audioplayer.getPlaybackQueue();if(e){var n=t.lastIndexOf(e);if(-1!==n)return t[n-1]}},n.getPlaylistIdFromAudioId=function(e){return window.audioplayer.getPlaylistByAudioId(e)},n.getPlaylistTypeFromAudioId=function(e){if(e&&isString(e)){var t=e.split("_"),n=t[0],i=t[1],a=t[2],o=t[3];return n&&i?a&&0===a.indexOf("playlist")?a.replace("playlist","")+"_"+o:a:void 0}},n.getPrevPlaylistId=function(){return this.getPlaylistIdFromAudioId(this.getPrevAudioId())},n.getPlaylistId=function(){return this.getPlaylistIdFromAudioId(this.getAudioId())},n.updateContext=function(){var e=this.getPlaylistTypeFromAudioId(this.getAudioId());if(e){var t=this.getContextByType(e);"other"===t&&nav.getQuery("from")?this.context=this.getContextByType(nav.getQuery("from")):this.context=t}else this.context="other"},n.getContextByType=function(e){if(void 0===e&&(e=""),0===e.indexOf("recoms"))return nav.getQuery("q")?"search":"recs";if(0===e.indexOf("audios")){var t=intval(e.replace("audios",""));return t===vk.id?"my":t<0?"group_list":"user_list"}return 0===e.indexOf("popular")?"recs_audio":0===e.indexOf("search")?"search":0===e.indexOf("wall")?"group_list":0===e.indexOf("mail")?"im":0===e.indexOf("feed")?"feed":"other"},n.getContext=function(){return this.context||"other"},n.getSequence=function(){return 0},n.getSearchParams=function(){return null},n.getType=function(){return"html5"},n.isPlaying=function(){return this.player.playing()},n.isAutoPlayed=function(){return window.audioplayer.isAutoPlayed()},n.isRepeatCurrentAudio=function(){return!1},n.isRepeatAll=function(){return!1},n.isShuffledPlaylist=function(){return!1},n.isPodcast=function(){return!1},n.isAdPlaying=function(){return!1},n.isRealPlaylist=function(){return!0},n.isRealPrevPlaylist=function(){return!0},n.isLastTrack=function(){var e=this.player.getCurrent(),t=this.player.playlist();return!!e&&(!(!e||t&&t.length)||t.indexOf(e)+1===t.length)},n.hasPrevPlaylist=function(){return!1},n.hasPlaylist=function(){var e=this.player.playlist();return Boolean(e&&e.length>1)},n.hasPrevAudio=function(){var e=this.getAudioId(),t=window.audioplayer.getPlaybackQueue();return Boolean(e&&t.length>1)},n.hasSearchParams=function(){return!1},n.isDebug=function(){return Boolean(lsGet("audio_stats_debug"))},n.sendListenedData=function(e){var t=nav.getQuery("from");ajax.post("/audio",{_ajax:1,act:"playback",audio:e.audio_id,track_code:e.track_code,prev:e.prev_audio_id,state:e.state,from_block:t,listened:e.listened,hash:e.hash,end_stream_reason:e.end_stream_reason,auto:e.auto})},t}(Je),lt=n("jE6c");function ct(e,t){var n="";return e.forEach(function(i,a){var o="/audio?performer=1&q="+encodeURIComponent(i.name),r=window.getWebHost?window.getWebHost():"";i.id&&(o="/artist/"+i.id),n+=t?'<a class="artist_link" href="'+r+o+'">'+i.name+"</a>":i.name,a<e.length-1&&(n+=", ")}),n}function ut(e){if(!e)return null;if(isObject(e))return e;if("string"==typeof e)return{id:e};var t=(e[Se.AUDIO_ITEM_INDEX_HASHES]||"").split("/"),n=(e[Se.AUDIO_ITEM_INDEX_COVER_URL]||"").split(","),i=function(e,t){void 0===t&&(t=!0);var n="",i=!Ee(e)&&t;if(isArray(e[Se.AUDIO_ITEM_INDEX_MAIN_ARTISTS])&&(n=ct(e[Se.AUDIO_ITEM_INDEX_MAIN_ARTISTS],i)),isArray(e[Se.AUDIO_ITEM_INDEX_FEAT_ARTISTS])&&(n+=" feat. ",n+=ct(e[Se.AUDIO_ITEM_INDEX_FEAT_ARTISTS],i)),!n){var a=e[Se.AUDIO_ITEM_INDEX_PERFORMER]?e[Se.AUDIO_ITEM_INDEX_PERFORMER].replace(/<\/?em>/g,""):"";if(i)n='<a class="artist_link" data-performer="'+a+'" href="'+("/audio?performer=1&q="+encodeURIComponent(a))+'">'+a+"</a>";else n=a}return n}(e,!1);return{id:intval(e[Se.AUDIO_ITEM_INDEX_ID]),owner_id:intval(e[Se.AUDIO_ITEM_INDEX_OWNER_ID]),ownerId:e[Se.AUDIO_ITEM_INDEX_OWNER_ID],fullId:e[Se.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[Se.AUDIO_ITEM_INDEX_ID],title:e[Se.AUDIO_ITEM_INDEX_TITLE]||"",subTitle:e[Se.AUDIO_ITEM_INDEX_SUBTITLE],performer:i,duration:intval(e[Se.AUDIO_ITEM_INDEX_DURATION]),lyrics:intval(e[Se.AUDIO_ITEM_INDEX_LYRICS]),url:e[Se.AUDIO_ITEM_INDEX_URL],flags:e[Se.AUDIO_ITEM_INDEX_FLAGS],context:e[Se.AUDIO_ITEM_INDEX_CONTEXT],extra:e[Se.AUDIO_ITEM_INDEX_EXTRA],accessKey:e[Se.AUDIO_ITEM_ACCESS_KEY],addHash:t[0]||"",editHash:t[1]||"",actionHash:t[2]||"",deleteHash:t[3]||"",replaceHash:t[4]||"",urlHash:t[5]||"",restoreHash:t[6]||"",canEdit:!!t[1],canDelete:!!t[3],isLongPerformer:e[Se.AUDIO_ITEM_INDEX_FLAGS]&Se.AUDIO_ITEM_LONG_PERFORMER_BIT,canAdd:!!(e[Se.AUDIO_ITEM_INDEX_FLAGS]&Se.AUDIO_ITEM_CAN_ADD_BIT),coverUrl_s:n[0],coverUrl_p:n[1],isClaimed:!!(e[Se.AUDIO_ITEM_INDEX_FLAGS]&Se.AUDIO_ITEM_CLAIMED_BIT),isExplicit:!!(e[Se.AUDIO_ITEM_INDEX_FLAGS]&Se.AUDIO_ITEM_EXPLICIT_BIT),isUMA:!!(e[Se.AUDIO_ITEM_INDEX_FLAGS]&Se.AUDIO_ITEM_UMA_BIT),isReplaceable:!!(e[Se.AUDIO_ITEM_INDEX_FLAGS]&Se.AUDIO_ITEM_REPLACEABLE),ads:e[Se.AUDIO_ITEM_INDEX_ADS],album:e[Se.AUDIO_ITEM_INDEX_ALBUM],albumId:intval(e[Se.AUDIO_ITEM_INDEX_ALBUM_ID]),albumPart:intval(e[Se.AUDIO_ITEM_INDEX_ALBUM_PART]),trackCode:e[Se.AUDIO_ITEM_INDEX_TRACK_CODE],restrictionStatus:e[Se.AUDIO_ITEM_INDEX_RESTRICTION]}}var dt="ad_placeholder",ft="ad_mode",_t=window.audio,pt=function(){if(!HTMLAudioElement)return{init:function(){},initAudio:function(){}};var e=!1,t="1"==lsGet("audio_time_left"),n={},i=!1,a=!1,l=!1,c=[];window.playerAdapter=new st(_t);new ot(window.playerAdapter);function u(e,t){e&&cancelEvent(e);var n=_t.getCurrent(),i=gpeByClass("_audioPlaylist",t),a=n?n.fullId:null;if(!a||!geByClass1("ai_current",i)){var o=(i||ge("mcont")).$(".audio_item");a=o&&o.getAttribute("data-id")}a&&N(e,a)}function f(e){if(e){$$("#lm_player").forEach(function(e){show(e)}),$$("#lm_audio").forEach(function(t){t&&(t.querySelector(".ai_artist").innerHTML=e.performer,t.querySelector(".ai_title").innerHTML=e.title,t.querySelector(".ai_play").style.backgroundImage=e.coverUrl_p?"url("+e.coverUrl_p+")":""),_t.isAdsPlaying()&&U(e,!0)});var t=A(e.fullId);t&&each(t,function(t,n){_t.isAdsPlaying()?H(e,!0):(T(n,0),D(n,0),O(n,M(0,_t.duration()))),j(n,_t.volume()),addClass("ai_current",n)})}else $$("#lm_player").forEach(function(e){hide(e)})}function _(e){var t=e.fullId,i=e.duration;$$("#lm_audio").forEach(function(e){removeClass("ai_playing",e)});var a=A(t);a&&(each(a,function(e,t){O(t,I(i)),removeClass("ai_playing",t),removeClass("ai_current",t)}),n[t]&&delete n[t],_t.isAdsPlaying()&&H(e,!1))}function p(e,t,i,a){var o=A(e);if(o.length){var r=t*(i||0);each(o,function(e,n){y||D(n,t),O(n,pt.getFormatedTime(r,i))}),r>1&&(n[e]=1)}}function h(e){var t=g(e);if(!t)return null;if(t.dataset&&t.dataset.playlistId)return t.dataset.playlistId;var n=gpeByClass("AudioPlaylistRoot",t);if(!n)return console.log("no playlist Element found"),null;var i=n.dataset.playlistId;return i||(console.log("no playlist Id found"),null)}function m(e,t){ajax.post("/audio",{act:"block_playlist",block_id:e},{onDone:function(e){if(e){var n=e.map(function(e){return ut(e)});_t.playlist(n),t&&t(n)}}})}function A(e){return geByClass("audio_item_"+e)}function g(e){return A(e)[0]}function b(e){var t=g(e),n=gpeByClass("audios_list",t)||gpeByClass("AudioBlock",t),i=geByClass("audio_item",n),a=[],o=!1;each(i,function(t,n){var i=JSON.parse(domData(n,"audio"));if(i){var r=ut(i);a.push(r),r.fullId===e&&(o=!0)}}),_t.playlist(a,{q:attr(n,"data-query")}),o&&_t.play(e)}_t.subscribe(ke.PLAY,function(e){var t=_t.getCurrent();t&&_t.playing()&&!_t.isAdsPlaying()&&ajax.post("/audio",{act:"start_playback",audio_id:t.id,owner_id:t.ownerId,hash:t.actionHash,uuid:_t.getDeviceId()});e,$$("#lm_audio").forEach(function(e){addClass("ai_playing",e)});var n=A(e);if(!n)return;each(n,function(e,t){_t.isAdsPlaying()||(addClass("ai_playing",t),addClass("ai_current",t))}),c[c.length-1]!==e&&c.push(e);l?l=!1:(a=i,i=!1,pt.onPlay(e))}),_t.subscribe(ke.PAUSE,function(e){$$("#lm_audio").forEach(function(e){removeClass("ai_playing",e)});var t=A(e);if(!t.length)return;each(t,function(e,t){removeClass("ai_playing",t),addClass("ai_current",t)}),l||pt.onPause(e)}),_t.subscribe(ke.SELECT,f),_t.subscribe(ke.DESELECT,_),_t.subscribe(ke.PROGRESS,p),_t.subscribe(ke.BUFFERED,function(e,t,n){F(e,t,n)}),_t.subscribe(ke.AD_STARTED,function(e){H(e,!0),U(e,!0)}),_t.subscribe(ke.AD_COMPLETED,function(e){H(e,!1),U(e,!1),p(e.id,0,0)}),_t.subscribe(ke.NOT_FOUND_PLAYLIST,b),_t.subscribe(ke.EMPTY_PLAYLIST,b),_t.subscribe(ke.ENDED,function(e){var t=geBySel('.audio_item[data-id="'+e+'"]');t&&(each(t,function(e,t){D(t,1)}),i=!0,pt.onEnded(e))}),_t.subscribe(ke.VOLUME,function(e,t){var n=geBySel('.audio_item[data-id="'+e+'"]');n&&(each(n,function(e,n){j(n,t)}),pt.onVolume(e,t))});var y=null,w=null,C=!1,k=!1;function S(e){if(y){var t=gpeByClass("audio_item",y),n=E(y,e);e&&cancelEvent(e);var i=A(attr(t,"data-id"));each(i,function(e,t){C&&D(t,n),k&&(j(t,n),_t.volume(n))}),w=n}}function E(e,t){var n=gpeByClass("Slider__scroll",e),i=hasClass("touch",window.bodyNode)?10:8,a=(t.pageX||t.touches&&t.touches[0]&&t.touches[0].pageX||0)-(n?e.getBoundingClientRect().left:getX(e))-i/2,o=e.offsetWidth-i;return o?Math.max(0,Math.min(a/o,1)):0}function O(e,t){if(e){var n=geByClass1("ai_dur",e);val(n,t)}}function T(e,t){if(e){var n=geByClass1("aic_progress_wrap",e),i=geByClass1("aic_load_line",n);i&&(i.style.width=100*Math.max(0,Math.min(t,1))+"%")}}function D(e,t){if(e){var n=geByClass1("aic_progress_wrap",e),i=geByClass1("aic_progress_line",n);i&&(i.style.width=100*t+"%")}}function j(e,t){if(e){var n=geByClass1("aic_volume_wrap",e),i=geByClass1("aic_progress_line",n);i&&(i.style.width=100*t+"%")}}function I(e){var t,n,i,a=e<0;return t=(n=(e=Math.round(a?-e:e))%60)<10?"0"+n:n,t=(i=(e=Math.floor(e/60))%60)+":"+t,(e=Math.floor(e/60))>0&&(i<10&&(t="0"+t),t=e+":"+t),a&&(t="-"+t),t}function M(e,n){return I(t&&n?e-n:e)}function x(e){var t=window.cur;t.deletedAudios||(t.deletedAudios={}),t.deletedAudios[e]=!0}function B(e){var t=window.cur;t.deletedAudios&&delete t.deletedAudios[e]}function P(e,t){t?function(e){var t=window.cur;t.addedAudios||(t.addedAudios={}),t.addedAudios[e]=!0}(e):function(e){var t=window.cur;t.addedAudios&&delete t.addedAudios[e]}(e);var n=geBySel('.audio_item[data-id="'+e+'"]');each(n,function(e,n){toggleClass("ai_added",n,t),val(geByClass1("ai_add",n),t?lang.global_delete_audio:lang.global_add_to_audio)});var i=geBySel1('body > [id="ai_menu_'+e+'"]'),a=geByClass1("ai_add",i);val(a,t?lang.global_delete_audio:lang.global_add_to_audio),ActionMenu.update()}function L(e,t){t?x(e):B(e);var n=geBySel('.audio_item[data-id="'+e+'"]');each(n,function(e,n){toggleClass("ai_deleted",n,t),val(geByClass1("ai_del",n),t?lang.global_add_to_audio:lang.global_delete_audio)});var i=geBySel1('body > [id="ai_menu_'+e+'"]'),a=geByClass1("ai_del",i);val(a,t?lang.global_add_to_audio:lang.global_delete_audio),ActionMenu.update()}function R(){var e=window.audio.getCurrentId(),t=A(e),n=[],i=window.audio.playing();i&&e&&t.length&&t.forEach(function(e){var t=gpeByClass("audios_list",e)||gpeByClass("mcont",e);n.push(t)}),each(geByClass("_AudioPlayStatus"),function(e,t){removeClass("playing",t)}),i&&n.forEach(function(t){geByClass("_AudioPlayStatus",t).forEach(function(t){addClass("playing",t),t.dataset.id=e})})}function N(e,t,n){if(window.isArticleWebView)return Article.audioPlay(_t.getCurrentId(),_t.playlist()),cancelEvent(e),!1;var i=window.lang;if(_t.support){var a=g(t);if(a&&hasClass("ai_deleted",a)&&!hasClass("ai_current",a))return!0;n&&t!=_t.getCurrentId()?b(t):_t.operate(t),R()}else alert(i.mobile_audio_player_not_support);return cancelEvent(e),!1}function F(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var i=A(e);_t.playing()?(each(i,function(e,t){addClass("ai_playing",t)}),$$("#lm_audio").forEach(function(e){addClass("ai_playing",e)})):(each(i,function(e,t){removeClass("ai_playing",t)}),$$("#lm_audio").forEach(function(e){removeClass("ai_playing",e)})),null!==t&&null!==n&&each(i,function(e,i){T(i,t/n),addClass("ai_current",i)})}function H(e,t){var n=g(e.fullId);toggleClass(ft,n,t);var i=geByClass1("ai_title",n);val(i,t?getLang("global_audio_ad"):e.title),toggleClass(dt,i,t)}function U(e,t){geBySel(".audio_item.al_player.ai_playing").forEach(function(n){if(n){var i=geByClass1("ai_title",n);val(i,t?getLang("global_audio_ad"):e.title),toggleClass(dt,i,t),toggleClass(ft,n,t),toggle(geByClass1("ai_artist"),!t)}})}return addEvent(document,d.isTouch?"touchend touchcancel":"mouseup",function(e){if(!y)return;var t=gpeByClass("audio_item",y),n=E(y,e)||w;e&&cancelEvent(e);var i=geBySel('.audio_item[data-id="'+attr(t,"data-id")+'"]');each(i,function(e,i){C&&(D(i,n),_t.setPosition(n,!0)),k&&j(t,n)}),C&&(l=_t.playing(),pt.onSeek(n));y=w=null,C=k=!1}),addEvent(document,d.isTouch?"touchmove":"mousemove",S),{init:function(t){e||(e=!0,onDOMReady(function(){window.nav&&window.audio&&window.audioplayer&&"#player"==nav.hash&&_t.playlist().length&&pt.openPlayer(ge("lm_audio"),!0)}))},initAudio:function(){each(geByClass("ai_current"),function(e,t){_(t=function(e){if(!(e=ge(e))||!e.dataset.audio)return null;var t=null;try{t=JSON.parse(e.dataset.audio)}catch(e){return null}return ut(t)}(t))});var e=_t.loaded(),t=_t.getPosition(),n=_t.duration(),i=n?t/n:0;F(_t.getCurrentId(),e,n),f(_t.getCurrent()),p(_t.getCurrentId(),i,n),setTimeout(function(){R()},1)},getDOMFromAudio:function(e,t,n){if(!Object.keys(e).length)return'<div class="audio_item audio_item_disabled"></div>';var i=ut(e);if(!i)return"";var a=Object(lt.htsc)(i.ownerId+"_"+i.id),r=Object(lt.htsc)(i.url||""),l=i.duration,c=i.performer,u=i.title,f=i.subTitle,_=i.isExplicit,p=i.canAdd,h=i.canDelete,m=u?'<span class="divider"> &ndash; </span>':"",A=d.isTouch?"ontouchstart":"onmousedown",v=["audio_item_"+a],g="",b=i.coverUrl_p||i.coverUrl_s,y=b?"background-image: url("+b+")":"",w=i.isClaimed,C=o.default.class("audio_item"),k=Object(lt.escapeAttr)(JSON.stringify(e));if(w)return'<div class="audio_item audio_item_disabled"></div>';if(function(e){var t=window.cur;return!!t.deletedAudios&&t.deletedAudios[e]}(a)){if(n)return"";v.push(" ai_deleted")}(function(e){var t=window.cur;return!!t.addedAudios&&t.addedAudios[e]})(a)&&v.push("ai_added"),vk.id&&(h?(v.push("ai_has_btn"),g='<div class="ai_del wia_item" onclick="audioplayer.del(\''+a+"', event);\">"+lang.global_delete_audio+"</div>"):p&&(v.push("ai_has_btn"),g='<div class="ai_add wia_item" onclick="audioplayer.add(\''+a+"', false, event);\">"+lang.global_add_to_audio+"</div>")),a===_t.getCurrentId()&&(_t.playing()&&v.push("ai_playing"),v.push("ai_current")),_&&v.push("audio_item_explicit");var S="";g?S='<div class="ai_menu_wrap"><i class="i_pointer"></i><a href="#" class="ai_menu_toggle_button" onclick="ActionMenu.toggleMenu(event, this);"></a>\n  <div class="ai_menu wi_actions" id="ai_menu_'+a+'">'+g+"</div>\n</div>":v.push("ai_no_menu");var E=f?" "+s.default.html({tag:"span",class:"ai_subtitle",inner:f}):"";return'<div\n      data-id="'+a+'"\n      data-audio="'+k+'"\n      class="'+v.join(" ")+" "+C+'"\n      onclick="audioplayer.playPause(event, \''+a+"' "+(t?", true":"")+');">\n  <div class="ai_info">\n    <div class="ai_play" style="'+y+'">\n      <i class="i_play"></i>\n    </div>\n    '+S+'\n    <div class="ai_body">\n      <div class="ai_dur" data-dur="'+l+'" onclick="audioplayer.switchTimeFormat(this, event);">\n        '+I(l)+'\n      </div>\n      <div class="ai_label">\n        <span class="ai_title">'+u+E+"</span>"+m+'<span class="ai_artist">'+c+'</span>\n      </div>\n      <input type="hidden" value="'+r+'">\n    </div>\n  </div>\n  <div class="ai_controls">\n    <table class="row_table">\n      <tr>\n        <td class="aic_progress_wrap">\n          <div class="aic_line" '+A+'="audioplayer.setPosition(this, event);" onclick="cancelEvent(event);">\n            <div class="aic_ln aic_back_line" onclick="cancelEvent(event);"></div>\n            <div class="aic_ln aic_load_line" onclick="cancelEvent(event);"></div>\n            <div class="aic_ln aic_pl_wrap" onclick="cancelEvent(event);">\n              <div class="aic_ln aic_progress_line" onclick="cancelEvent(event);">\n                <div class="aic_slider" onclick="cancelEvent(event);"></div>\n              </div>\n            </div>\n          </div>\n        </td>\n        <td class="aic_volume_wrap">\n          <div class="aic_line" '+A+'="audioplayer.setVolume(this, event);" onclick="cancelEvent(event);">\n            <div class="aic_ln aic_back_line" onclick="cancelEvent(event);"></div>\n            <div class="aic_ln aic_pl_wrap" onclick="cancelEvent(event);">\n              <div class="aic_ln aic_progress_line" onclick="cancelEvent(event);">\n                <div class="aic_slider" onclick="cancelEvent(event);"></div>\n              </div>\n            </div>\n          </div>\n        </td>\n      </tr>\n    </table>\n  </div>\n</div>'},add:function(e,t,n){void 0===t&&(t=null);var i=g(e);if(!hasClass("ai_ajax",i)){var a=ut(JSON.parse(i.dataset.audio)),o=hasClass("ai_added",i);P(e,!o),addClass("ai_ajax",i),pt.onAdd(),ajax.post("/audio",{_ajax:1,act:o?"delete":"add",audio:o?attr(i,"data-deleteid"):e,hash:o?attr(i,"data-delete-hash"):a.addHash,access_key:t,track_code:a.trackCode},{redirectToLoginPage:!0,onDone:function(t,n){removeClass("ai_ajax",i),t?(attr(i,"data-deleteid",t),attr(i,"data-delete-hash",n)):P(e,o)},onFail:function(){removeClass("ai_ajax",i),P(e,o);var n=Array.prototype.slice.call(arguments),r=n.shift();switch(r){case 2:nav.go("/audio?act=add&audio="+e+"&hash="+(o?a.deleteHash:a.addHash)+"&access_key="+t)}}}),n&&cancelEvent(n)}},del:function(e,t){var n=g(e);if(n){var i=hasClass("ai_deleted",n);L(e,!i);var a=ut(JSON.parse(n.dataset.audio));i?B(e):x(e),pt.onDel(),ajax.post("/audio",{_ajax:1,act:i?"restore":"delete",audio:e,playlist_id:h(e),hash:i?a.restoreHash:a.deleteHash},{redirectToLoginPage:!0,onDone:function(t){t||L(e,i)},onFail:function(){L(e,i);var t=Array.prototype.slice.call(arguments),n=t.shift();switch(n){case 2:nav.go("/audio?act="+(i?"restore":"delete")+"&audio="+e+"&hash="+(i?a.restoreHash:a.deleteHash))}}}),t&&cancelEvent(t)}},playPause:N,getFormatedTime:M,switchTimeFormat:function(e,n){var i=gpeByClass("audio_item",e);return!(hasClass("ai_current",i)&&!hasClass("ai_select",i))||(t=!t,lsSet("audio_time_left",t?"1":"0"),O(g(_t.getCurrentId()),M(_t.getPosition(),_t.duration())),n&&cancelEvent(n),!1)},setPosition:function(e,t){y||_t.isAdsPlaying()||(y=e,C=!0,S(t))},setVolume:function(e,t){y||(y=e,k=!0,S(t))},openPlayer:function(e,t){var n=window.audio,i=nav.path,a=n.getCurrentPlaylistId(),o=nav.params;a&&!o.includes("playlist_id")&&(o=(o?o+"&":"")+"playlist_id="+a);var r=i+(o?"?":"")+o+"#player";return nav.al_go(r,null,{local:!0,target:e,nav:{push:r,path:i,params:o,hash:"#player"},no_push:t})},getCurrentElem:function(){return Object(v.$)(".ai_current")},playFirst:u,hasArticleWebViewClientAudioSupport:function(){return window.clientWebviewAudioSupport},getPlaybackQueue:function(){return c},isAutoPlayed:function(){return a},playBlock:function(e,t,n){n.dataset.id?u(t,n):m(e,function(e){if(e.length){var t=e[0].fullId;_t.select(t),_t.play(t),n.classList.add("playing"),n.dataset.id=t}})},playShuffledBlock:function(e,t){e.preventDefault(),browser.safari&&window.audio.playNothing(),m(t.dataset.blockId,function(e){if(e.length){var t=e[0].fullId;window.audio.play(t)}})},getPlaylistByAudioId:h,onAdd:Object(r.default)(),onDel:Object(r.default)(),onPlay:Object(r.default)(),onPause:Object(r.default)(),onProgress:Object(r.default)(),onVolume:Object(r.default)(),onSeek:Object(r.default)(),onPlaylistChanged:Object(r.default)(),onEnded:Object(r.default)()}}();window.audioplayer=pt;var ht=n("Y6JH");var mt=function(e){var t=e.y<.5,n=100*e.x,i=100*e.y;return{class:"Photo__marketTag",attrs:{"data-url":e.url,style:"left: "+n+"%; top: "+i+"%"},inner:[{class:"Photo__marketTagInner "+(t?"Photo__marketTagInner--down":""),inner:[{class:"Photo__marketTagTitle",inner:e.title},{class:"Photo__marketTagPrice",inner:Wd.wrap(e.price)},{class:"Photo__marketTagIcon",inner:Object(ht.default)("market","goto_arrow_black")}]},{class:"Photo__marketTagArrow "+(t?"Photo__marketTagArrow--down":"")}]}};var At=function(e){return{class:"Photo__marketShowMoreButton",attrs:{"data-items-json":e.items},inner:[{class:"Photo__marketShowMoreButtonIcon",inner:Object(ht.default)("market","market_16")},getLang("mobile_photos_show_market_items")]}};var vt=function(e){return{tag:"a",attrs:{"data-is-fave":e.isFave?"fave":""},class:"PhotoMarketItem__fave "+(e.isFave?"PhotoMarketItem__fave--added":""),onclick:["ItemsList._toggleFave","event","this",e.type,e.typeInt,e.ownerId,e.itemId,e.href,e.faveHash]}};var gt=function(e){return{class:"PhotoMarketItem",attrs:{"data-item-id":e.item_id},inner:[{class:"PhotoMarketItem__thumb",tag:"img",src:e.thumb},{class:"PhotoMarketItem__title",inner:e.title},{class:"PhotoMarketItem__price",inner:Wd.wrap(e.price)},vt({type:e.type,typeInt:e.type_int,isFave:e.is_fave,itemId:e.item_id,ownerId:e.owner_id,href:e.href,faveHash:e.fave_hash})]}};var bt=function e(t){var n=[],i=JSON.parse(unescape(t.itemsJSON)),a=Array.isArray(i),o=0;for(i=a?i:i[Symbol.iterator]();;){var r;if(a){if(o>=i.length)break;r=i[o++]}else{if((o=i.next()).done)break;r=o.value}var s=r,l=e._faveCache[s.item_id];void 0===l&&(l=s.is_fave),n.push({onclick:["ItemsList._goToItem",s],class:"PhotoItemsList__item",inner:gt(Object.assign({},s,{is_fave:l}))})}for(var c=0;c<10;c++)n.push({class:"PhotoItemsList__item PhotoItemsList__item--filler"});return{class:"PhotoItemsList",inner:[{class:"PhotoItemsList__header",inner:[{class:"PhotoItemsList__closeIcon",onclick:t.onClose},getLang("mobile_photos_market_items_title")]},{class:"PhotoItemsList__body",inner:n}]}},yt=n("wTbK");bt._faveCache={},bt._onClose=function(){bt._itemsPopup&&(Pe.default.close(bt._itemsPopup),delete bt._itemsPopup)},bt._goToItem=function(e){-1===cur.destroy.indexOf(bt._onClose)&&cur.destroy.push(bt._onClose),nav.go(e.url)},bt._toggleFave=function(e,t,n,i,a,o,r,s){e.stopPropagation();var l=t.dataset.isFave;ajax.post("/bookmarks.php",{_ajax:1,item_type:i,act:l?"bookmark_remove":"bookmark_add",hash:s,item_oid:a,item_id:o,link_url:r},{onDone:function(e){e&&(bt._faveCache[o]=!l,Object(v.$)(".PhotoItemsList").$$(".PhotoMarketItem").forEach(function(e){e.dataset.itemId===o.toString()&&(e.$(".PhotoMarketItem__fave").outerHTML=Wd.html(vt({type:n,typeInt:i,isFave:!l,ownerId:a,itemId:o,href:r,faveHash:s})))}))}})},bt._openItemsPopup=function(e){var t=Object(yt.default)({class:"Photo__marketItemsModal",body:bt({itemsJSON:e,onClose:["ItemsList._onClose"]})});bt._itemsPopup=Pe.default.open(Wd.elem(t),!0)},window.ItemsList=bt;var wt=bt,Ct=browser.meizu||browser.mi||browser.uc_mini||0!==browser.ios&&browser.ios<10||browser.chrome&&browser.version.split(".")[0]<53,kt=!Ct&&!!a.default.getFlag(a.FLAG_MP4);onDOMReady(function(){Et.onUpdate(),page.onChange(function(){Et.onUpdate()})});var St={gifs:[],currentAutoplayElement:null,ignore:[]},Et={isBadBrowser:Ct,isMp4Supports:function(){return kt},openPopup:function(e,t,n){if(void 0===n&&(n={}),this.autoplayTest(),e&&cancelEvent(e),function(e){cur.loadedGifs||(cur.loadedGifs={});return!cur.loadedGifs[e.raw]}(n)&&n.needConfirm){var a=function(e){return Object(i.ceFromString)(s.default.html(Object(je.default)({scrollable:!0,header:{title:getLang("mobile_wall_gif_size_warning_popup_title")},content:[getLang("mobile_wall_gif_size_warning").replace("{size}",e.size),{class:"Popup__buttons",inner:[Ot(getLang("mobile_continue"),"regular",'Gif.confirm(this, "'+e.raw+'")'),Ot(getLang("mobile_cancel"),"secondary","Popup.close(this)")]}]})))}(n,t.getAttribute("data-media"));return domInsertBefore(a,t),void je.default.open(a,!0)}var o=Object(Ke.default)({},nav.getQuery(),{z:"doc"+n.raw+"/"+(n.hash||"")});nav.path,Object(i.obj2qs)(o),nav.hash;photo.zopen(null,null,n.raw,"",{no_push:!1,isDoc:!0,hasVideo:n.hasVideo,hash:n.hash})},init:function(e){zlayer.create(Tt()),zlayer.open()},close:function(){var e=Object(Ke.default)({},nav.getQuery());delete e.z;var t=nav.path+Object(i.obj2qs)(e)+nav.hash;nav.go(t,null,{push_only:!1,nav_incr:!0})},confirm:function(e,t){cur.loadedGifs[t]=!0,je.default.close(e),Object(i.geBySel1)('[data-media="'+t+'"]').click()},autoplayTest:function(){a.default.detectAutoplay().then(function(e){kt=a.default.getFeatures().mp4&&e&&a.default.getFlag(a.FLAG_MP4)&&!Ct})},activateGIF:function(){if("/mail"!==nav.path){var e=scrollTop(),t=e+window.innerHeight,n=e+window.innerHeight/2,i={};Array.from(St.gifs||[]).forEach(function(a){var o=getXY(a)[1],r=o>=e&&o<=t,s=Math.abs(n-o);r&&(i[s]=a)});var a=i[Math.min.apply(Math,Object.keys(i))];a?a.classList.contains("current_gif")||-1===St.ignore.indexOf(a)&&(post.toggleGif(a,!1,!1,!0),St.currentAutoplayElement=a):post.hidePlayingGifs(!1,!0)}},onUpdate:function(){a.default.getFlag(a.FLAG_GIF_AUTOPLAY)&&(St.gifs=[].concat(Array.from($$(".doc_preview_rows_1 .doc_preview_gif")||[])),onBodyScroll(Object(i.throttle)(Et.activateGIF,200)))},getState:function(){return St},setState:function(e,t){St[e]=t}};function Ot(e,t,n){return{class:["Popup__button",o.default.class("Btn",{theme:t||"regular"})],tag:"button",inner:e,onclick:n}}function Tt(e){void 0===e&&(e=!1);var t='<img class="zpv_img" alt="">';return e&&(t='<video class="zpv_img" alt="" autoplay preload="metadata" crossorigin="anonymous" poster="/images/blank.gif" webkit-playsinline playsinline controls loop muted>'),'\n    <div id="z_photoview">\n      <div class="zpv_siblings">\n        <div id="zpv_left" class="zpv_thumb_item">\n          <img class="zpv_img" alt="">\n        </div>\n        <div id="zpv_right" class="zpv_thumb_item">\n          <img class="zpv_img" alt="">\n        </div>\n      </div>\n      <div class="zpv_body">\n        <div id="zpv_center" class="zpv_thumb_item">\n          '+t+'\n        </div>\n      </div>\n      <div class="zpv_close_msg_wrap">\n        <div class="zpv_close_msg"> '+lang.mobile_zphoto_move_to_close+'</div>\n      </div>\n      <div class="zpv_controls">\n        <div class="mhead zpv_header">\n          <a class="zpv_close_btn" onclick="return photoview.closePhoto(event);"><i class="zpv_close_icon"></i></a>\n          <div class="hb_wrap"><h1 id="zpv_summary" class="hb_btn mh_header"></h1></div>\n        </div>\n      </div>\n      <div class="zpv_tags"></div>\n      <div class="zpva zpv_crop"><div class="zpv_crop_box"></div><div class="zpv_crop_loading"></div></div>\n    </div>\'\n  '}window.Gif=Et;function Dt(e){return void 0===e&&(e={}),Object(Pe.default)({on_overlay_click_native:"QRPhotoPosting.back();",class:"QRPhotoPosting",content:[{class:"QRPhotoPosting__img",inner:Wd.wrap(e.svg)},{class:"QRPhotoPosting__title",inner:Wd.wrap(e.title)}]})}function jt(){return{inner:[Object(ht.default)({sprite:"common",name:"qr_24"})],class:"QRPhotoPosting__button",onclick:"QRPhotoPosting.show();",tag:"div"}}var It,Mt=n("wZQE"),xt=n.n(Mt);function Bt(e){var t=/photo(-?\d+)_(\d+)/i.exec(e||nav.cur);return Array.isArray(t)||(t=["",0,0]),{album:Object(i.intval)(t[1]),photo:Object(i.intval)(t[2])}}function Pt(e){return-86529522===Bt(e).album&&Object(m.partConfigEnabled)("mvk_photo_fest_qr_sharing")?jt():""}function Lt(e){var t=Object(v.$)("#z_photoview .zpv_values"),n=s.default.elem(Pt(e));Object(i.append)(n,t)}window.QRPhotoPosting=Dt,extend(Dt,{show:function(){var e=Bt(),t="https://vk.com/fest?publish_photo="+e.photo,n=xt.a.createQR(t,271,"QRPhotoPosting__svg",{isShowLogo:!0});It=Pe.default.open(s.default.elem(Dt({svg:n,title:lang.mobile_photo_qr_popup_title})),!0),nav.go(nav.path+"?z=publish_photo"+e.photo,null,{push_only:!0,nav_init:!1,nav_incr:!0})},close:function(){It&&Pe.default.close(It)},back:function(){window.history?window.history.back():window.location="/"},getQRPhotoButton:Pt,QRPhotoPosting:Dt,QRPhotoPostingButton:jt,appendQRPhotoButton:Lt});var Rt=2,Nt=window.ajax,Ft=window.thover,Ht=window.nav,Ut=window.page,Vt=window.PhotoLike,$t=window.zlayer,qt=window.photo,Wt=300,zt=function(){var e=!1,t=!1,n=!1,i=!1,a=!1,o=!1,l=!1,c=!1,u=!1,d=!1,f=!1,_=!1,p=!1,h=!1,m=!1,A=!1,v=!1,g=!1,b=!1,y=!1,w=!1,C=!1,k=!1,S={},E={min_scale:1,max_scale:3,min_scale_limit:.5,max_scale_limit:5,anim_duration:Wt,inertia_duration:300,bounce_diff:1.5,crop_padding:20,crop_size:250,fps:0};function O(e){var t=getCw()/2,n=getCh()/2;if(e.touches){for(var i=0,a=0,o=0,r=Math.min(2,e.touches.length);i<r;i++)a+=e.touches[i].pageX,o+=e.touches[i].pageY,0;return r?{pageX:a/r-t,pageY:o/r-n}:{pageX:-t,pageY:-n}}return{pageX:e.pageX-t,pageY:e.pageY-n}}function T(e,t){var n=null,i=t?attr(f,"data-original-src")||f.src:e.src;if(S[i])return S[i];if(t&&(e=function(){var e=ce("img");return e.src=attr(f,"data-original-src")||f.src,e}()),void 0!==e.naturalWidth)n={width:e.naturalWidth,height:e.naturalHeight};else if("VIDEO"===e.tagName)n={width:e.clientWidth,height:e.clientHeight};else{(new Image).src=e.src,n={width:e.width,height:e.height}}return n.width&&n.height&&(S[i]=n),n}function D(e){var t=attr(e,"data-id");return j((on(Jt).tags||{})[t]||[])}function j(e){return e[0]?{coords:{x:e[0][0],y:e[0][1],w:e[0][2],h:e[0][3]},name:e[1],href:e[2],al:e[3]}:{}}function I(e){setStyle(t,"overflow",e?"visible":"hidden")}var M=null,x=null;function B(e,n,i,o,r,s,l,c,u){if(!E.fps||u){var d=!1,_=!!c&&function(){d||(d=!0,c())};s?(t&&setStyle.animate(t,"transform",{duration:s,func:l},_),f&&setStyle.animate(f,!1===r?"transform":"transform, opacity",{duration:s,func:l},_),h&&setStyle.animate(h,!1===r?"transform":"transform, opacity",{duration:s,func:l},_),m&&setStyle.animate(m,!1===r?"transform":"transform, opacity",{duration:s,func:l},_),a&&setStyle.animate(a,!1===r?"transform":"transform, opacity",{duration:s,func:l},_),De=!0):De&&(t&&setStyle.animate(t),f&&setStyle.animate(f),h&&setStyle.animate(h),m&&setStyle.animate(m),a&&setStyle.animate(a),De=!1),setStyle.transform(t,{translate:[n,0]}),setStyle.transform(f,e,[i,o]),Dt(e,i,o),!1!==r&&(setStyle(f,"opacity",r),de||fe?(setStyle(h,"opacity",r),_e=!0):(setStyle(m,"opacity",r),me=!0),function(e,t){var n=window.lang;if(e){var i=$t.height,o=i/5,r=i/3.5,s=Math.abs(e),l=s>20?e+(e>0?20-e:-20-e)/E.bounce_diff:e,c=0===t?0:Math.max(0,Math.min((s-20)/o,.75));t>0&&setStyle.transform(a,{translate:[0,l]}),setStyle(a,"opacity",c);var u=s>r,d=u?"":e>0?" zpv_close_move_down":" zpv_close_move_up",f=u?n.mobile_zphoto_release_to_close:n.mobile_zphoto_move_to_close;val(a,'<div class="zpv_close_msg'+d+'">'+f+"</div>"),(a.is_down&&e<0||!a.is_down&&e>0)&&kt(e>0)}else setStyle.transform(a,{translate:[0,0]}),setStyle(a,"opacity",0)}(o,r)),Ct(e)}else M=[e,n,i,o,r,s,l,c,!0],x||P()}function P(){M&&(B.apply(window,M),M=null),clearTimeout(x),x=E.fps?setTimeout(P,1e3/E.fps):null}function L(e,t,n){at(!0),B(J,z,G,K,je,e,t,n),je=!1}function R(e,t,n,i){B(e.currentScale,e.curBodyX,e.currentX,e.currentY,!1,t,n,i)}function N(e){e=function(e){if(!e)return e;var t={width:f.width||f.clientWidth,height:f.height||f.clientHeight},n=t.width/2,i=t.height/2;return[e[0]+n,e[1]+i]}(e||[0,0]),setStyle.transformOrigin(f,e)}function F(){(k=en.max_src&&J>2)?f.src!==en.max_src&&(attr(f,"data-original-src",en.src),attr(f,"data-src",en.max_src),sn(en.max_src)):!k&&f.src!==en.src&&f&&(attr(f,"data-src",en.src),ln(en.src),f.style.width="")}var H,U,V,$,q,W,z,Q,Y,X,G,K,J,Z,ee,te,ne,ie,ae,oe,re,se,le,ue,de,fe,_e,pe,he,me,Ae,ve,be,ye,we,Ce,ke,Se,Ee,Oe,Te,De,je,Ie=!1,Me=!1,xe=null;function Be(e){var t=e[1].pageX-e[0].pageX,n=e[1].pageY-e[0].pageY;return{distance:Math.sqrt(t*t+n*n),angle:180*Math.atan2(n,t)/Math.PI}}function Pe(e){var t=Be(e);if(Ie){var n=t.distance/Ie.scale,i=t.angle-Ie.rotation;i<-180&&(i+=360),i>180&&(i-=360),extend(Ie,{startDistance:n,startAngle:i})}else Ie={startDistance:t.distance,startAngle:t.angle,scale:1,rotation:0}}function Le(e){return extend({originalEvent:e},e,function(e){if(!Ie)return{scale:1,rotation:0};if(e.length<2)return{scale:Ie.scale,rotation:Ie.rotation};var t=Be(e),n=t.distance/Ie.startDistance,i=t.angle-Ie.startAngle;i<-90&&(i+=360),i>270&&(i-=360);var a={scale:n,rotation:i};return extend(Ie,a),a}(e.touches),O(e))}function Re(e){var t=e.touches;t&&(t.length>5||t.length<2?Ie&&(yt(Le(e)),Ie=!1):Ie?Pe(t):(gt(Le(e)),Pe(t)))}function Ne(e){var t=e.touches;t&&(t.length>5||t.length<2?Ie&&(yt(Le(e)),Ie=!1):Ie&&bt(Le(e)))}function Fe(e){var t=e.touches;t&&((t.length>5||t.length<2)&&Ie&&(yt(Le(e)),Ie=!1),Ie&&Pe(t))}function He(e){preventEvent(e);var t=(e.detail?e.detail:e.wheelDelta)>0?1.05:.95,n=extend({originalEvent:e},e);Me||(Me=1,pt(e),gt(extend(n,{scale:Me}))),Me*=t,bt(extend(n,{scale:Me})),clearTimeout(xe),xe=setTimeout(function(){yt(extend(n,{scale:Me})),vt(e),Me=!1},200)}function Ue(){H=0,U=0,V=0,$=0,q=1,W=!0,z=0,Q=0,Y=0,X=1,G=0,K=0,J=1,Z=!1,ee=!1,te=!1,ne=!1,ie=!1,ae=!1,oe=!1,re=!1,se=!1,_e=!1,pe=!1,he=!1,me=!1,Ae=!1,ve=!1,be=!1,!1,Se=!1,Ee=!1,Oe=!1,Te=!1}function Ve(){return{lastScale:q,deltaX:H,deltaY:U,pointX:V,pointY:$,curScale:X,currentScale:J,curX:Q,curY:Y,currentX:G,currentY:K,curBodyX:z}}function $e(e,t,n){n=n||Ve(),e=e||{};var i=extend({},n,e);if(isUndefined(e.deltaX)||isUndefined(e.deltaY)?isUndefined(e.pointX)||isUndefined(e.pointY)?isUndefined(e.lastScale)?isUndefined(e.currentScale)?isUndefined(e.curScale)||(i.currentScale=i.lastScale*i.curScale,i.curX=i.pointX-i.deltaX*i.curScale,i.curY=i.pointY-i.deltaY*i.curScale,i.currentX=i.curX/i.currentScale,i.currentY=i.curY/i.currentScale):(i.curScale=i.currentScale/i.lastScale,i.curX=i.pointX-i.deltaX*i.curScale,i.curY=i.pointY-i.deltaY*i.curScale,i.currentX=i.curX/i.currentScale,i.currentY=i.curY/i.currentScale):(i.curScale=1,i.currentScale=i.curScale*i.lastScale):(i.curX=i.pointX-i.deltaX*i.curScale,i.curY=i.pointY-i.deltaY*i.curScale,i.currentX=i.curX/i.currentScale,i.currentY=i.curY/i.currentScale):(i.pointX=i.curX+i.deltaX*i.curScale,i.pointY=i.curY+i.deltaY*i.curScale),isUndefined(e.curX)||(i.curX=e.curX,i.currentX=i.curX/i.currentScale),isUndefined(e.curY)||(i.curY=e.curY,i.currentY=i.curY/i.currentScale),t)return i;H=i.deltaX,U=i.deltaY,V=i.pointX,$=i.pointY,q=i.lastScale,X=i.curScale,J=i.currentScale,Q=i.curX,Y=i.curY,G=i.currentX,K=i.currentY,z=i.curBodyX}function qe(){var e=$t.width||getCw(),t=$t.height||getCh();if(C)var n=e,i=Math.min(E.crop_size,n-2*E.crop_padding),a=i,o=i;else a=e,o=t;return{width:a,height:o}}function We(e){var t=qe().width,n=((f.width||f.clientWidth)*e-t)/2,i=-n;return n<=0&&(i=n=0),{min:i,max:n}}function ze(e){var t=qe().height,n=((f.height||f.clientHeight)*e-t)/2,i=-n;return n<=0&&(i=n=0),{min:i,max:n}}function Qe(){var e=1,t=E.max_scale;if(C){e=1,t=(Gt?Gt[0]:{max_scale:E.max_scale}).max_scale}else{var n=T(f,!0);e=E.min_scale,t=Math.max(E.max_scale,n.width/getCw(),(n.height||n.clientHeight)/getCh())}return{min:e,max:t}}function Ye(e){var t=$t.height||getCh(),i=Math.abs(Zt)>=10,a=Math.abs(e)>1,o=t/3.5,r=Math.abs(Y);return Y*e<0&&(i=!0),e=e||0,r>o||!i&&a?(function(e){var t=$t.height||getCh(),i=2*Math.abs(K)>t?.85:1.7;$e({curY:(e>1?t:e<-1?-t:Y>0?t:-t)/i}),je=0,L(150,"ease-in",Xe),setStyle(n,"width",0),Ce=!0}(e),!0):(ft()&&(je=1,L(300),ne=!1,fe&&(fe=!1,It(!0))),!1)}function Xe(){b&&zt.close()}function Ge(){!1!==ye&&(I(!1),fn(ye),setStyle.transform(_),setStyle.transform(p),B(1,0,0,0,1),N(),ye=!1)}function Ke(){var e=1.05*($t.width||getCw());G-=(e+z)/J,z=-e,ye=Jt+1,Zt--,L(Wt,"ease-out",Ge),Qt(!1,!0),fe=!1,zt.onPhotoChange&&zt.onPhotoChange(Jt+1,{no_open:!0,local:y,crop:C})}function Je(){var e=1.05*($t.width||getCw());G+=(e-z)/J,z=e,ye=Jt-1,Zt++,L(Wt,"ease-out",Ge),Qt(!1,!0),fe=!1,zt.onPhotoChange&&zt.onPhotoChange(Jt-1,{no_open:!0,local:y,crop:C})}function Ze(){if(!Ee)return!1;var e=function(){if(!Ee||Ee.length<2)return[0,0,0];for(var e=vkNow(),t=!1,n=Ee.pop(),i=Ee.length-1;i>=0;i--){if((a=e-Ee[i][0])>150)break;t=Ee[i]}if(!t||!n)return[0,0,0];var a,o=n[1].pageX-t[1].pageX,r=n[1].pageY-t[1].pageY,s=Math.sqrt(o*o+r*r);return(a=n[0]-t[0])?[s/a,o/a,r/a]:[0,0,0]}(),t=e[0],n=e[1],i=e[2];if(tt(),!t)return!1;var a=te||ne?5.1:4.7,o=t/a,r=n*o-a*o*o/2,s=i*o-a*o*o/2;if(o*=530,r*=140,s*=140,t<.1||!r&&!s)return!1;if(!ne){var l={};te||(l.curX=Q+r,l.curY=Y+s),$e(l);var c=We(J);l={},Q<c.min?l.curBodyX=W?Q-c.min:0:Q>c.max&&(l.curBodyX=W?Q-c.max:0),$e(l)}return te?4.7*n:ne?4.7*i:o}function et(e){Ee||(Ee=[]),Ee.push([vkNow(),e]),Ee=Ee.slice(-20)}function tt(){Ee=!1}function nt(e,t){var n,i,a,o,r,s,l,c,u,d=(n=[e.curX,e.curY],i=e.currentScale,a=[t.curX,t.curY],o=t.currentScale,r=n[0],s=n[1],l=a[0],c=a[1],1!=(u=o/i)&&[r+(r-l)/(u-1),s+(s-c)/(u-1)]);if(!d)return!1;var f=d[0],_=d[1];return e.deltaX=f-e.curX,e.deltaY=_-e.curY,e.currentX=e.curX/e.currentScale+f-f/e.currentScale,e.currentY=e.curY/e.currentScale+_-_/e.currentScale,t.deltaX=f-t.curX,t.deltaY=_-t.curY,t.currentX=t.curX/t.currentScale+f-f/t.currentScale,t.currentY=t.curY/t.currentScale+_-_/t.currentScale,d}function it(e,t,n){var i,a,o,r,s,l,c,u,d,_,p,h,m,A,v,g=$t.width||getCw(),b=$t.height||getCh(),y=!1,w=(Math.min(50,g/7),T(f)),C=g/w.width,k=b/w.height,S=Math.min(1,C,k),E=D(e).coords,O=geByClass1("zpv_tl",e),j=getW(O),I=getH(O),M=(Math.min((g-30)/Math.max(E.w*w.width*S/100,j),(b-30)/(E.h*w.height*S/100+I+5)),function(){a=w.width*S*n.currentScale,o=w.height*S*n.currentScale,r=g/2-a/2+n.currentX*n.currentScale,s=b/2-o/2+n.currentY*n.currentScale,u=r+E.x*a/100,d=s+E.y*o/100,l=E.w*a/100,c=E.h*o/100,i=u+l/2-j/2,d+c+5,p=Math.min(u,i),_=Math.max(l,j),m=p+_,A=(h=d)+(c+I+5),v={}});return n=(n=$e(v,t,n))||Ve(),M(),p<15?(v.curX=n.curX+(15-p),y=!0):m>g-15&&(v.curX=n.curX-(m-g+15),y=!0),h<15&&(v.curY=n.curY+(15-h),y=!0),n=(n=$e(v,t,n))||Ve(),M(),A>b-15&&(v.curY=n.curY-(A-b+15),y=!0),n=$e(v,t,n),t?n:y}function at(e){Te&&(Te=!1,N(),e||L(),St(de,!0),Et(!de,!0),setTimeout(function(){F()},300))}function ot(e,t,n){var i={};return n=n||Ve(),i.lastScale=e,n=$e(i,t,n),!!t&&n}function rt(e,t,n){var i={};if(n=n||Ve(),!_t())return!!t&&n;i.curScale=e,n=(n=$e(i,t,n))||Ve();var a=Qe();return i={currentScale:n.currentScale},n.currentScale<a.min?i.currentScale=n.currentScale+(a.min-n.currentScale)/E.bounce_diff:n.currentScale>a.max&&(i.currentScale=n.currentScale+(a.max-n.currentScale)/E.bounce_diff),n=$e(i,t,n),!!t&&n}function st(e,t){if(!_t())return!1;var n=!1,i={};t=t||Ve();var a=Qe();return t.currentScale<a.min?(i.currentScale=a.min,n=!0):t.currentScale>a.max&&(i.currentScale=a.max,n=!0),t=$e(i,e,t),e?t:n}function lt(e){if(!_t())return!1;var t={pageX:0,pageY:0},n=Ve(),i=null,a=nt(n,i=ft(!0,i=dt(t,!0,i=st(!0,i=rt(e=1==e?1/q:e,!0,i=ut(t,!0,n))))));a&&(N(a),R(n),Te=!0),Te&&(St(!1,!0),Et(!1,!0)),ut(t),rt(e),st(),dt(t),ft(),Te?R(i,Wt,!1,at):L(300),ot(J)}function ct(e){if(!_t())return!1;var t=Ve(),n=null,i=nt(t,n=ft(!0,n=st(!0,n=it(e,!0,t))));i&&(N(i),R(t),Te=!0),it(e)&&(he||(he=t)),Te&&(St(!1,!0),Et(!1,!0)),st(),ft(),Te?R(n,Wt,!1,at):L(Wt),ot(J)}function ut(e,t,n){var i={};return n=n||Ve(),i.deltaX=(e.pageX-n.curX)/n.curScale,i.deltaY=(e.pageY-n.curY)/n.curScale,n=$e(i,t,n),!!t&&n}function dt(e,t,n){var i={};n=n||Ve(),i.pointX=e.pageX,i.pointY=e.pageY;var a=We(n.currentScale),o=ze(n.currentScale),r=(!Z&&!o.max&&!o.min||te||!_t())&&!ne;(ne||C&&!Z&&!a.max&&!a.min)&&(i.curX=0),r&&(i.curY=n.curY),n=$e(i,t,n),i={};var s=!1;return(n=n||Ve()).curX<=a.min?ie?(s=!0,i.curBodyX=n.curX-a.min):(i.curX=n.curX+(a.min-n.curX)/E.bounce_diff,i.curBodyX=W?i.curX-a.min:0):n.curX>=a.max&&(ae?(s=!0,i.curBodyX=n.curX-a.max):(i.curX=n.curX+(a.max-n.curX)/E.bounce_diff,i.curBodyX=W?i.curX-a.max:0)),n.curY<o.min?r?i.curY=o.min:ne||(i.curY=n.curY+(o.min-n.curY)/E.bounce_diff):n.curY>o.max&&(r?i.curY=o.max:ne||(i.curY=n.curY+(o.max-n.curY)/E.bounce_diff)),n=$e(i,t,n),t?n:s}function ft(e,t){var n=!1,i={},a=We((t=t||Ve()).currentScale),o=ze(t.currentScale),r=!Z&&!o.max&&!o.min||te||!_t()&&!ne;return ne&&(i.curX=0),r&&(i.curY=t.curY),t.curX<a.min?(i.curX=a.min,i.curBodyX=0,n=!0):t.curX>a.max&&(i.curX=a.max,i.curBodyX=0,n=!0),t.curY<o.min?(i.curY=o.min,n=!0):t.curY>o.max&&(i.curY=o.max,n=!0),t=$e(i,e,t),e?t:n}function _t(){return!g&&(!!C||Kt[en.src])}function pt(e){if(scrollTop()||scrollTop(0),!Ce){if(e&&"mousedown"==e.type&&preventEvent(e),e.touches&&e.touches.length||!A){if(Ge(),!ee&&!Z){Se=O(e);var t=We(J);Q<=t.min&&(ie=!1!==on(Jt+1)),Q>=t.max&&(ae=!1!==on(Jt-1))}if(ee||g)oe=re=se=!1,le=!1;else{clearTimeout(ue);var n=O(e);oe&&vkNow()-oe<500&&re&&(i=n,o=(a=re).pageX-i.pageX,r=a.pageY-i.pageY,Math.sqrt(o*o+r*r)<50)?(se=vkNow(),le=!1):(oe=vkNow(),re=n,le=vkNow())}g||(ee=!0)}var i,a,o,r;Z||(W=!0,I(!0)),ve=O(e),tt(),et(ve),ut(ve)}}function ht(e){if(!Ce&&(preventEvent(e),ee)){if(oe=re=se=!1,le=!1,et(ve=O(e)),Oe){if(!(Oe<vkNow()))return void tt();Oe=!1,ut(ve),L()}if(Se&&!te&&!ne){var t=Math.abs(ve.pageX-Se.pageX),n=Math.abs(ve.pageY-Se.pageY),i=ze(J);if(!(n>5||t>5))return;n>5&&t<=5&&(1!=J||Z||g||C?(i.max||i.min)&&(ie=ae=!1):(ne=!0,de&&(fe=!0),It(!1),kt(ve.pageY-Se.pageY>0))),Se=!1,ut(ve)}!dt(ve)||te||ne||g||(te=!0,ve.pageX),function(){if(!ne)return;var e=Math.abs(Y),t=$t.height/2;je=1-.5*e/t}(),L(),te&&Math.abs(z)>getCw()&&vt(extend({originalEvent:e},e,{touches:[]}))}}function vt(e){if(!Ce)if(ke)ke=!1;else{if(preventEvent(e),e.touches&&!e.touches.length||!A){var t=Ze();if(te)l=t,c=($t.width||getCw())/2,l=l||0,((z<-c||l<-1)&&ie?(Ke(),1):(z>c||l>1)&&ae?(Je(),1):(ft()&&L(300),0))&&(Ue(),I(!0));else if(ne)Ye(t);else if(se&&vkNow()-se<1e3){!function(e){if(!_t())return!1;var t=Qe(),n={pageX:V,pageY:$},i=(J>1?1:t.max)/q,a=Ve(),o=null;o=ft(!0,o=dt(n,!0,o=rt(i,!0))),e&&(o=ft(!0,o=it(e,!0,o)));var r=nt(a,o);r&&(N(r),R(a),Te=!0),Te&&(St(!1,!0),Et(!1,!0)),rt(i),dt(n),ft(),e&&(it(e),ft()),Te?R(o,Wt,!1,at):L(Wt),ot(J),Mt()}(o=e&&_e&&(hasClass("zpv_tag",e.target)?e.target:gpeByClass("zpv_tag",e.target))),oe=re=se=!1}else ft()?L(300):t&&(ft(),L(t,"cubic-bezier(0, 1, 1, 1)"));if(setTimeout(function(){F()},300),le)if(vkNow()-le>700||e&&"touchcancel"==e.type)le=!1;else{if(le=!1,e)var n=hasClass("zpv_header",e.target)?e.target:gpeByClass("zpv_header",e.target),i=hasClass("zpv_zoom_btns",e.target)?e.target:gpeByClass("zpv_zoom_btns",e.target),a=hasClass("zpv_bottom_body",e.target)?e.target:gpeByClass("zpv_bottom_body",e.target),o=_e&&(hasClass("zpv_tag",e.target)?e.target:gpeByClass("zpv_tag",e.target)),r=me&&e.target.closest(".Photo__marketTag"),s=_e&&e.target.closest(".Photo__marketShowMoreButton");e&&(n||i||a||o||r||s)?o?function(e,t){if(!we)return!1;if(!_e)return!0;D(e);if(hasClass("zpv_tag_selected",e))return hasClass("zpv_tl_wrap",t.target)||gpeByClass("zpv_tl_wrap",t.target)?Ht.go(e,t):(ct(e),cancelEvent(t),!1);pe&&(oe=re=se=!1),removeClass("zpv_tag_selected",pe),pe=e,jt(e),addClass("zpv_tag_selected",pe);de&&(fe=!0);It(!1),ct(e),cancelEvent(t)}(o,e):i?(oe=re=se=!1,hasClass("zpv_zoomin",e.target)||gpeByClass("zpv_zoomin",e.target)?function(e){!!we&&(Ft.highlight=!1,Ft.end(e),!Z&&!te&&(!(Qe().max<=J)&&(cancelEvent(e),lt(C?1.25:1.45))))}(e):function(e){!!we&&(Ft.highlight=!1,Ft.end(e),!Z&&!te&&(!(Qe().min>=J)&&(cancelEvent(e),lt(C?.8:1))))}(e)):r?Ht.go(r.dataset.url):s&&wt._openItemsPopup(s.dataset.itemsJson):pe?Qt(e):C||(ue=setTimeout(function(){It(),St(de),Et(!de)},500))}ee=!1,te=ie=ae=!1,tt()}var l,c;e.touches&&(e.touches.length>1||1==e.touches.length&&te)&&ut(ve=O(e)),(e.touches&&!e.touches.length||!A)&&(Se=!1)}}function gt(e){if(!Ce&&(preventEvent(e),oe=re=se=!1,le=!1,tt(),!te&&!ne)){X=1,q=J,Z=!0,ie=ae=!1;var t=We(J);(t.min>=-5||t.max<=5)&&(W=!1,I(!1)),ut(O(e)),St(!1,!0),Et(!1,!0)}}function bt(e){Ce||(preventEvent(e),oe=re=se=!1,le=!1,tt(),te||ne||(be=O(e),rt(e.scale),dt(be),L(),Mt()))}function yt(e){Ce||(preventEvent(e),oe=re=se=!1,le=!1,tt(),te||ne||(st()&&((e.touches&&e.touches.length||!A)&&dt(be),ft(),L(100),Oe=vkNow()+100),Z=!1,St(de,!0),Et(!de,!0)))}function Ct(e){var t=Qe(),n=e<t.max,i=e>t.min;toggleClass("zpv_zb_disabled",u,!n),toggleClass("zpv_zb_disabled",d,!i)}function kt(e){e?setStyle(a,{top:-35,bottom:"auto"}):setStyle(a,{top:"auto",bottom:-35}),a.is_down=e}function St(e,t){var n=_e;if(e){if(!_t())return;if(!de&&!fe||Z)return}_e=e,e&&Dt(J,G,K,t||n!==e),n!==e&&(e&&jt(pe),Ot(h,e,t))}function Et(e,t){var n=me;me=e,e&&Dt(J,G,K,t||n!==e),Ot(m,e,t)}function Ot(e,t,n){e&&setStyle.animate(e,!n&&"opacity",{duration:200,func:"linear"},function(){setStyle(e,"visibility",t?"visible":"hidden")}),e&&setStyle(e,"visibility",t||!n?"visible":"hidden"),e&&setStyle(e,"opacity",t?1:0)}function Dt(e,t,n,i){if(!Z){var a=$t.width||getCw(),o=$t.height||getCh(),r=T(f),s=a/r.width,l=o/r.height,c=Math.min(1,s,l),u=r.width*c*e,d=r.height*c*e,_=a/2-u/2+t*e,p=o/2-d/2+n*e;_e&&(i&&h&&setStyle.animate(h),setStyle(h,{width:Math.round(u),height:Math.round(d)}),setStyle.transform(h,{translate:[Math.round(_),Math.round(p)]})),me&&(i&&m&&setStyle.animate(m),setStyle(m,{width:Math.round(u),height:Math.round(d)}),setStyle.transform(m,{translate:[Math.round(_),Math.round(p)]}),Ae||(!function(){function e(e,t){var n=e.getBoundingClientRect(),i=m.getBoundingClientRect();n.left<i.left+t?e.style.left=i.left-n.left+t+"px":n.right>i.left+i.width-t&&(e.style.left=i.left+i.width-n.right-t+"px")}Array.from(m.children).forEach(function(t){if(t.classList.contains("Photo__marketTag")){var n=t.$(".Photo__marketTagInner"),i=t.$(".Photo__marketTagArrow");e(n,10),e(i,20)}})}(),Ae=!0))}}function jt(e){if(e){var t=T(f),n=$t.width||getCw(),i=$t.height||getCh(),a=n/t.width,o=i/t.height,r=Math.min(1,a,o),s=t.width*r*J,l=t.height*r*J,c=D(e).coords,u=geByClass1("zpv_tl",e),d=getW(u),_=getH(u),p=c.x*s/100,h=c.y*l/100,m=c.w*s/100,A=c.h*l/100,v=p+m/2-d/2,g=h+A+5,b=n>s?0-(n-s)/2:0,y=n>s?s+(n-s)/2:s,w=i>l?l+(i-l)/2:l,C=0,k=0;v<b+2?C=b+2-v:v+d>y-2&&(C=y-2-v-d),g+_>w-5&&(k=A>3*_?w-5-g-_:-A-_-10),setStyle.transform(u,{translate:[Math.ceil(C),Math.ceil(k)]})}}function It(e){if(void 0!==e){if(de===e)return;de=!e}else fe=!1;setStyle(n,"width","auto"),n&&setStyle.animate(n,"opacity",{duration:200,func:"linear"},function(){setStyle.animate(n),setStyle(n,"width",de?"auto":0)}),de?(setStyle(n,"opacity",0),de=!1):(setStyle(n,"opacity",1),de=!0)}function Mt(){$t.height<604&&!pe&&!C&&(J>1.25?(de&&(fe=!0),It(!1)):fe&&(fe=!1,It(!0)))}function xt(e){we&&(ee||Z||te||e&&e.touches&&e.touches.length>1||(cancelEvent(e),zt.close()))}function Bt(e){if(!(ee||Z||te||!e||e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)){var t=We(J);37==e.keyCode?(cancelEvent(e),Q>=t.max&&!1!==on(Jt-1)&&(I(!0),Je())):39==e.keyCode?(cancelEvent(e),Q<=t.min&&!1!==on(Jt+1)&&(I(!0),Ke())):27==e.keyCode&&xt(e)}}function Pt(){C?pn():(St(_e,!0),Et(me,!0))}function Qt(e,t){return!(!we&&!t)&&(!pe||(removeClass("zpv_tag_selected",pe),pe=!1,fe&&J<=1.25&&(fe=!1,It(!0)),cancelEvent(e),!1))}function Yt(e){"touchstart"==e.type?we=!e.touches||1==e.touches.length:"touchmove"==e.type?(we=!1,preventEvent(e)):"click"==e.type&&(we||(cancelEvent(e),we=!0))}function Xt(e){"touchstart"==e.type?Ce=!0:"touchmove"==e.type?(Ce=!0,preventEvent(e)):(Ce=e.touches&&e.length,ke=!Ce)}var Gt=!1,Kt={},Jt=!1,Zt=!1,en=!1,tn=!1,nn=!1;function an(e,t,n,i){var a=t||len(e);if(e&&!n||(Gt=null),Gt||(Gt=new Array(a)),Gt.length!=a){var o=Gt;Gt=new Array(a),extend(Gt,o)}extend(Gt,e);var r=function(e){for(var t in Gt)if(Gt[t].id==e)return+t;return-1}(en.id);-1==r&&(r=Jt),i||fn(r)}function on(e){return!(e>=Gt.length)&&(!(e<0)&&(Gt[e]||{src:!0}))}function rn(e,t,n){var i=T(e),a=qe();C&&(Gt[0].loaded=t,t&&(i.width>i.height?setStyle(e,{height:a.height}):setStyle(e,{width:a.width}),setStyle(e,{minWidth:0,maxWidth:"none"})),pn(!0));if(dn()){if(i.width*Rt>=a.width){var o=a.width/(i.width||i.clientWidth);if(i.height*o>=a.height)return;X=o,q=o,J=o,setStyle.transform(f,o)}"VIDEO"===e.tagName&&e.play()}show(e),f===e&&(St(t,!t),Et(t&&!de,!t))}function sn(e,t){if(void 0===t&&(t=!1),Kt[e])ln(e);else if(t){var n=ce("video",{src:e}),i=!1,a=function(){i||(i=!0,Kt[e]=!0,ln(e),n=null)};addEvent(n,"canplay",a),addEvent(n,"onload",a),n.load()}else{var o=new Image;o.addEventListener("load",function t(){Kt[e]=!0,ln(e),o.removeEventListener("load",t),o=null},!1),o.src=e}}function ln(e){[f,_,p].forEach(function(t){var n=gpeByClass("zpv_thumb_item",t),i=attr(t,"data-src");i===e&&(t.src=i,rn(t,!0),"VIDEO"!==t.tagName&&removeClass("zpv_ti_loading",n),attr(t,"data-src",!1),dn()&&statlogsValueEvent("gif_play",0,"VIDEO"===t.tagName?"mp4":"gif"))})}function cn(e,t,n,i){void 0===i&&(i=!1);var a=gpeByClass("zpv_thumb_item",e);i&&(addClass("zpv_ti_loading",a),setTimeout(function(){setStyle(f,{display:"block"})})),i&&(n=!1),t?!0!==t?e.src===t?rn(e,!0):Kt[t]?(e.src=t,rn(e,!0)):(n?(e.src=n,rn(e,!1)):hide(e),attr(e,"data-src",t),sn(t,i),addClass("zpv_ti_loading",a)):(n?(e.src=n,rn(e,!1)):hide(e),addClass("zpv_ti_loading",a)):hide(e)}function un(){if(b){!function(){window.lang;var e="";if(dn())e=getLang("mobile_gif_popup_title");else{e=getLang("mobile_photos_photoview_header")||"";var t=!1!==ye?ye:Jt;e=(e=e.replace("%s",t+1)).replace(/%s|{count}/,Gt.length)}val("zpv_summary",e)}(),Ct(J);var e=on(!1!==ye?ye:Jt);if(e&&!0!==e.src){var t="";each(e.tags,function(e,n){if(!e||0==e)return!0;var i=j(n),a=i.coords,o=i.href?' data-href="'+i.href+'" data-name="'+escapeAttr(i.name)+'"':"",r=i.al?(i.href?" al"+i.al:"")+" "+i.al:"";t+='<div class="zpv_tag'+r+'" style="left: '+a.x+"%; top: "+a.y+"%; width: "+a.w+"%; height: "+a.h+'%;" data-id="'+e+'"'+o+'><div class="fill"></div><div class="zpv_tl_wrap" id="zpv_tl_wrap"><div class="zpv_tl'+(i.href?"":" zpv_tl_plain")+'">'+htsc(i.name)+"</div></div></div>"});var n="",a=e.market_tags&&e.market_tags.tags,r=a&&a.length,c="";r&&(c=s.default.html(At({items:escape(JSON.stringify(a))})),a.forEach(function(e){n+=s.default.html(mt(e))})),val(h,t),val(m,n),val(o,'<div class="zpv_photo_desc">'+(e.caption||"")+"</div>"+c+'<div class="zpv_bottom_bg"></div>'),toggle(o,!!e.caption||r);var u="";if(y||Ht.getQuery("community"))u="";else{var d=e.tags&&e.tags[0]||0;u="<tr>"+('<td class="row_table_column"><a href="'+e.like_url+'" class="item_button item_like'+(e.likes_me?" item_likes_me":"")+'" onclick="return photoview.likePhoto(this, \''+e.id+'\');"><i class="i_icon i_like"></i>'+(e.likes_cnt?'<b class="v_value v_like">'+formatNum(e.likes_cnt)+"</b>":"")+"</a></td>")+('<td class="row_table_column"><a href="'+e.photo_url+'#comments" class="item_button item_replies al_photo" onclick="return photoview.openPhoto(this, event, true);"><i class="i_icon i_replies"></i>'+(e.replies_cnt?'<b class="v_value v_replies">'+e.replies_cnt+"</b>":"")+"</a></td>")+('<td class="row_table_last_column"><a href="'+e.photo_url+'" class="item_button item_tags al_photo" onclick="return photoview.openPhoto(this, event);"><i class="i_icon i_tags"></i>'+(d?'<b class="v_value v_tags">'+d+"</b>":"")+"</a></td>")+"</tr>"}val(l,u),Lt(e.photo_url),show(i)}else hide(i)}}function dn(){return en.isDoc}function fn(e){b&&(Jt=Math.max(0,Math.min(e||0,Gt.length)),en=on(Jt),nn=on(Jt-1),tn=on(Jt+1),cn(f,en.src,"/images/mobile/blank.gif",en.hasVideo),cn(p,tn.src),cn(_,nn.src),un(),zt.onUpdate&&zt.onUpdate())}function _n(){if(b&&w&&Gt){var e=Gt[0];if(!e.loaded&&e.progress){var t=geByClass1("zpvu_progress","zpv_center");setStyle(t,{width:100*e.progress+"%",visibility:"visible"})}if(!e.read&&e.thumb){e.read=!0;var n=geByClass1("zpv_upload_box","zpv_center"),i=geByClass1("zpv_upload_img",n);setStyle(i,{backgroundImage:"url("+e.thumb+")"}),removeClass("zpv_thumb_uploading",n)}}}function pn(t){if(b&&C&&Gt){var n=Gt[0],i=!!n.saving;if(toggleClass("item_disabled","zpv_save_button",i||!n.loaded),toggleClass("item_disabled","zpv_cancel_button",i),toggleClass("zpv_crop_saving",e,i),g=i,t||cn(f,n.src,"/images/mobile/blank.gif"),n.loaded&&n.rect&&!n.rect_inited){n.rect_inited=!0;var a=qe(),o=n.rect[0],r=n.rect[1],s=n.rect[2],l={};l.currentScale=1/s,$e(l),st(),ft(),l={};var c=(f.width||f.clientWidth)*J,u=(f.height||f.clientHeight)*J,d=o*c,_=r*u;l.curX=(c-a.width)/2-d,l.curY=(u-a.height)/2-_,$e(l),ft(),L(0)}}}function hn(r,s){void 0===r&&(r=!1),void 0===s&&(s=!1),b||(le=!1,ue=!1,de=!0,fe=!1,ye=!1,we=!0,Ce=!1,ke=!1,De=!1,je=!1,g=!1,y=!1,w=!1,C=!1,Ue(),function(r,s){void 0===r&&(r=!1),void 0===s&&(s=!1);var A=window.lang,v="";v=r?Tt(s):'<div id="z_photoview"><div class="zpv_siblings"><div id="zpv_left" class="zpv_thumb_item"><img class="zpv_img" alt=""></div><div id="zpv_right" class="zpv_thumb_item"><img class="zpv_img" alt=""></div></div><div class="zpv_body"><div id="zpv_center" class="zpv_thumb_item"><img class="zpv_img" alt=""></div></div><div class="zpv_close_msg_wrap"><div class="zpv_close_msg">'+A.mobile_zphoto_move_to_close+'</div></div><div class="zpv_controls"><div class="mhead zpv_header"><a class="zpv_close_btn" onclick="return photoview.closePhoto(event);"><i class="zpv_close_icon"></i></a><div class="hb_wrap"><h1 id="zpv_summary" class="hb_btn mh_header"></h1></div></div><div class="zpv_zoom_btns"><a class="zpv_zoom_btn zpv_zoomin"><b class="zpv_zb_wrap"><i class="i_icon"></i></b></a><a class="zpv_zoom_btn zpv_zoomout"><b class="zpv_zb_wrap"><i class="i_icon"></i></b></a></div><div class="zpv_bottom"><div class="zpv_photo_desc_wrap"></div><div class="zpv_bottom_body"><table class="zpv_values like_box row_table"></table></div></div></div><div class="zpv_tags"></div><div class="zpv_market_tags"></div><div class="zpva zpv_crop"><div class="zpv_crop_box"></div><div class="zpv_crop_loading"></div></div></div>';var g="/images/mobile/zpv_icons"+(hasClass("x2",window.bodyNode)?"_2x":"")+".png?2";(new Image).src=g,$t.create(v,mn),e=ge("z_photoview"),geByClass1("zpv_body",e),t=geByClass1("zpv_siblings",e),n=geByClass1("zpv_controls",e),c=geByClass1("zpv_zoom_btns",e),a=geByClass1("zpv_close_msg_wrap",e),i=geByClass1("zpv_bottom",e),o=geByClass1("zpv_photo_desc_wrap",e),l=geByClass1("zpv_values",i),u=geByClass1("zpv_zoomin",c),d=geByClass1("zpv_zoomout",c),h=geByClass1("zpv_tags",e),m=geByClass1("zpv_market_tags",e),geByClass1("zpv_crop",e),f=geByClass1("zpv_img","zpv_center"),_=geByClass1("zpv_img","zpv_left"),p=geByClass1("zpv_img","zpv_right"),"VIDEO"===f.tagName&&(f.controls=!1)}(r,s),function(){if(A=void 0!==document.ontouchmove,v=!1,A){var t=geByClass1("zpv_header",e),n=geByClass1("zpv_bottom_body",e);addEvent(t,"touchstart touchmove touchend touchcancel",Xt),addEvent(n,"touchstart touchmove touchend touchcancel",Xt),addEvent(e,"touchstart touchmove click",Yt),addEvent(e,"touchstart",pt),addEvent(e,"touchmove",ht),addEvent(e,"touchend touchcancel",vt),v?(addEvent(e,"gesturestart",gt),addEvent(e,"gesturechange",bt),addEvent(e,"gestureend",yt)):(addEvent(e,"touchstart",Re),addEvent(e,"touchmove",Ne),addEvent(e,"touchend touchcancel",Fe),addEvent(e,"gesturestart gesturechange gestureend",cancelEvent))}else addEvent(e,"mousedown",pt),addEvent(e,"mousemove",ht),addEvent(window,"mouseup",vt),addEvent(window,"mousewheel",He),addEvent(window,"keydown",Bt)}(),b=!0,reflow(e),scrollTop()||scrollTop(0))}function mn(){b&&(!function(){if(A){var t=geByClass1("zpv_header",e),n=geByClass1("zpv_bottom_body",e);removeEvent(t,"touchstart touchmove touchend touchcancel",Xt),removeEvent(n,"touchstart touchmove touchend touchcancel",Xt),removeEvent(e,"touchstart touchmove click",Yt),removeEvent(e,"touchstart",pt),removeEvent(e,"touchmove",ht),removeEvent(e,"touchend touchcancel",vt),v?(removeEvent(e,"gesturestart",gt),removeEvent(e,"gesturechange",bt),removeEvent(e,"gestureend",yt)):(removeEvent(e,"touchstart",Re),removeEvent(e,"touchmove",Ne),removeEvent(e,"touchend touchcancel",Fe),removeEvent(e,"gesturestart gesturechange gestureend",cancelEvent))}else removeEvent(e,"mousedown",pt),removeEvent(e,"mousemove",ht),removeEvent(window,"mouseup",vt),removeEvent(window,"mousewheel",He),removeEvent(window,"keydown",Bt)}(),e=t=n=a=!1,i=l=!1,c=u=d=!1,f=_=p=h=!1,b=!1,Gt=null)}return{onShow:Object(r.default)(),onHide:Object(r.default)(),likePhoto:function(e,t){return!!we&&(Ft.highlight=!1,Ft.end(),en.likes_me?(en.likes_me=!1,--en.likes_cnt):(en.likes_me=!0,++en.likes_cnt),un(),Nt.click(e,extend({photo_id:t},Vt)))},openPhoto:function(e,t,n){var i=window.cur;if(!we)return!1;var a=i.replyNames,o=i.sticker_panel,r=i.stickers,s=Ht.go(e,t,{local:!0,fast:!0,beforeAppend:function(e){val(geByClass1("mcont",e),'<div class="pcont"><div class="media_view photo_view"><div class="pv_summary"><div class="summary_loading" style="display: none;"><i class="i_loading"></i></div></div><div class="pv_tag_wrap"></div><div class="pv_body pv_touch pv_touch_full pv_hidden_icons"><a class="thumb_item"><div class="pv_photo_wrap" id="pv_photo_tags" onclick="return photo.closeTags(event);"><img src="/images/mobile/blank.gif" class="ph_img" alt="" /></div></a><div class="pv_nav"><table class="row_table pv_nav_cont"><tr><td class="pv_nav_left"><a class="pv_nav_link"><span class="pv_icon"><i class="i_icon"></i></span></a></td><td class="pv_nav_z"><a class="pv_nav_link"><span class="pv_icon"><i class="i_icon"></i></span></a></td><td class="pv_nav_right"><a class="pv_nav_link"><span class="pv_icon"><i class="i_icon"></i></span></a></td></tr></table></div></div><div class="pv_footer"></div></div></div>'),val("m",e.innerHTML)}});extend(i,{replyNames:a,sticker_panel:o,stickers:r,processNav:function(e){var t;if(t=/^\/photo(-?\d+_\d+)$/i.exec(e.nav.path)){var n=qs2obj(e.nav.params),i=qs2obj(Ht.params);if(n.act)return!1;if(n.offset!=i.offset)return!1;if(n.list!=i.list&&!i.z)return!1;e.onPreNav&&e.onPreNav();var a=n.list||"",o=n.rev?"/rev":"";return!qt.open(t[1],a+o,null,n.from,!0)}return!1}}),i.destroy.push(function(){qt.clear()});var l=window.lang;if(!s&&!(s=Ht.go(e,t,{force:!0}))){var c=!0;if($t._lastNav){var u=$t._lastNav,d=qs2obj(u.params);delete d.z,c=u.path+obj2qs(d)+u.hash}Ut.setMhead("m",l.mobile_photos_photo_head_title,c),qt.showIcons()}return!0},closePhoto:xt,savePhoto:function(e,t){if(!we)return!1;if(Ft.highlight=!1,Ft.end(),hasClass("item_disabled",e))return!1;if(!C||!Gt)return!1;var n=Gt[0],i=qe(),a=f.width*J,o=(f.height||f.clientHeight)*J,r=(a-i.width)/2-Q,s=(o-i.height)/2-Y,l=1/J,c=r/a,u=s/o;return n.onSelect&&n.onSelect(c,u,l),!1},cancelPhoto:function(e,t){return!!we&&(Ft.highlight=!1,Ft.end(),!hasClass("item_disabled",e)&&xt())},onClose:null,onUpdate:null,onPhotoChange:null,saveSource:an,opened:function(){return b},openCrop:function(t,n){n=n||{};var a=!b;w?w=!1:hn(),C=!0,g=!1,Gt=[t],a&&($t.open(),$t.onResize=Pt),function(){if(b&&C){var t=window.lang;val("zpv_summary",t.mobile_zphoto_owner_crop_header),removeClass("zpv_mode_[a-z]+",e,!0),addClass("zpv_mode_crop",e),Ct(J),f.parentNode||(val("zpv_center",""),append(f,"zpv_center"));var n='<tr><td class="row_table_column"><a class="item_button" id="zpv_save_button" onclick="return photoview.savePhoto(this);"><i class="i_icon i_save"></i><span class="v_value">'+t.mobile_zphoto_save_btn+'</span></a></td><td class="row_table_last_column" width="50%"><a class="item_button" id="zpv_cancel_button" onclick="return photoview.cancelPhoto(this);"><i class="i_icon i_cancel"></i><span class="v_value">'+t.mobile_zphoto_cancel_btn+"</span></a></td></tr>";val(l,n),show(i),pn()}}()},updateCrop:function(e){if(!Gt)return!1;e=extend(Gt[0]||{},e),Gt=[e],pn()},openUpload:function(t,n){n=n||{},hn(),w=!0,g=!0,Gt=[t],$t.open(),$t.onResize=Pt,function(){if(b&&w){var t=window.lang;val("zpv_summary",t.mobile_zphoto_upload_header),removeClass("zpv_mode_[a-z]+",e,!0),addClass("zpv_mode_upload",e);remove(f),val("zpv_center",'<div class="zpva zpv_upload_box zpv_thumb_uploading"><div class="zpv_upload_img"></div><div class="zpvu_progress_wrap"><div class="zpvu_progress"></div></div></div>');var n='<tr><td class="row_table_column" width="50%"><a class="item_button item_disabled" onclick="return false;"><i class="i_icon i_save"></i><span class="v_value">'+t.mobile_zphoto_save_btn+'</span></a></td><td class="row_table_last_column" width="50%"><a class="item_button" onclick="return photoview.cancelPhoto(this);"><i class="i_icon i_cancel"></i><span class="v_value">'+t.mobile_zphoto_cancel_btn+"</span></a></td></tr>";val(l,n),show(i),_n()}}()},updateUpload:function(e){if(!Gt)return!1;e=extend(Gt[0]||{},e),Gt=[e],en=!1,_n()},open:function(e,t,n){var i,o;zt.onShow(),hn((n=n||{}).isDoc,n.hasVideo),y=n.local||!1,t&&an(t,!1,!1,!0),fn(e),Zt=0,$t.open(),$t.onResize=Pt,i=geByClass1("zpv_close_msg",a),o=getW(i),setStyle(a,{width:o||250})},close:function(){zt.onHide(),zt.onClose&&zt.onClose({local:y})||$t.close()}}}();window.photoview=zt;n("ldCb");window.FeedNotifications={webActionsAcceptHandlers:{reveal_bdya:function(e,t,n,i,a){var o=gpeByClass("_block",e);return ajax.post("profileEdit.php",{act:"reveal_birthday",from:"feed_assistance",hash:a},{onDone:function(e){var t=window.Snackbar;t&&t.init&&t.init({text:e.msg}),remove(o)}}),!0}},webActionsDeclineHandlers:{},withoutNavActions:["enable_browser_notifications","reveal_bdya"],hide:function(e){function t(t,n,i,a,o,r,s,l){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t,n,i,a,o,r,s){var l={_ajax:1,act:"hide_internal_notification",reason:i,id:t,hash:n},c={},u=gpeByClass("_block",e),d=!0;if("decline"==i){var f=this.webActionsDeclineHandlers[o];d=this.runActionHandler(f,e,l,c,r,n),hide(u)}else{var _=this.webActionsAcceptHandlers[o];d=this.runActionHandler(_,e,l,c,r,n),lockButton(e),"add_custom_newsfeed"==o&&(Object(Ne.setCookie)("remixcustom_feed_added",r),l.action=o,l.action_section=r.section,l.action_hash=r.hash)}return c.onDone=function(){"compact"===s&&"accept"===i||cur.destroy.push(function(){return remove(u)}),~this.withoutNavActions.indexOf(o)||nav.go(e,a)}.bind(this),c.onFail=function(){unlockButton(e)},Promise.resolve(d).then(function(e){(e||isUndefined(e))&&ajax.post("/index.php",l,c)}),!1}),runActionHandler:function(e,t,n,i,a,o){return!isFunction(e)||e(t,n,i,a,o)},addWebActionAcceptHandler:function(e,t){this.webActionsAcceptHandlers[e]=t},addWebActionDeclineHandler:function(e,t){this.webActionsDeclineHandlers[e]=t}},function(){function e(){if(geByClass1("tabs_block_hideable")){var e=geByClass1("tabs_block");geByClass1("tabs_list").offsetHeight>geByClass1("tabs_list_more").offsetHeight?removeClass("tabs_block_without_show_more",e):addClass("tabs_block_without_show_more",e)}}onDOMReady(e),onBodyResize(e),window.Tabs={actualizeShowMoreVisibility:e,toggle:function(e){var t=gpeByClass("tabs_block",e);hasClass("tabs_block_opened",t)?Object(Ne.setCookie)("remixm_tabs_expanded","",-1):Object(Ne.setCookie)("remixm_tabs_expanded",1),toggleClass("tabs_block_opened",t)}}}(),window.Podcast={toggleFave:function(e,t,n){var i="snippet__favorite_active",a=hasClass(e,i);ajax.post("fave.php",{act:"fave_podcast",add:!a,hash:n,audio_id:t,ref:cur.module}),a?removeClass(e,i):addClass(e,i)},onOpenClick:function(e,t){var n=$(".snippet__popup",e.closest(".snippet")),i="";cur&&cur.module?i=cur.module:nav&&"/feed"===nav.cur?i="feed":!nav||"/feed?section=podcasts"!==nav.cur&&"/feed/podcasts"!==nav.cur||(i="feed_podcasts"),statlogsValueEvent("mvk_podcasts_actions","mvk_open_popup",t,i),Pe.default.open(n,!0)}};var Qt=n("p5n7");function Yt(e,t){var n=ge("select-copyright"),i=$('input[name="copyright"]'),a=$(".create_post__source-option"),o=$(".Btn__text",a);e?(n.style.display="inline-block",n.onclick=function(n){return posting.openCopyright(n,!0,t,encodeURIComponent(e))},a.onclick=function(n){return posting.openCopyright(n,!0,t,encodeURIComponent(e))},o.innerHTML=getLang("mobile_wall_post_copyright_edit_button")):(a.onclick=function(n){return posting.openCopyright(n,!1,t,encodeURIComponent(e))},setStyle(a,"display","table"),o.innerHTML=getLang("mobile_wall_post_copyright_add_button"),hide(n)),val(i,e),post.checkCopyright()}var Xt={open:function(e,t,n){void 0===e&&(e=!1),void 0===n&&(n="");var a=new RegExp("{link}(.*){/link}"),o=a.exec(getLang("mobile_wall_post_copyright_mb_text"))[1],r="/@adminsclub-citation?from="+encodeURIComponent(nav.cur),s=getLang("mobile_wall_post_copyright_mb_text").replace(a,"<a onclick=\"Popup.close(this); nav.go('"+r+'\', null)" href="'+r+'">'+o+"</a>"),l=Object(je.default)({class:"AddCopyrightPopup",header:{title:e?getLang("mobile_wall_post_copyright_mb_title_text_edit"):getLang("mobile_wall_post_copyright_mb_title_text")},content:{inner:[!e&&{tag:"span",inner:Wd.wrap(s)},Object(Qt.default)({class:"AddCopyrightPopup__input",placeholder:getLang("mobile_post_copyright_input_placeholder"),value:decodeURIComponent(n),spellcheck:!1,on_key_down:["posting.saveSource",t]}),{class:"AddCopyrightPopup__error",style:"display: none;"},{class:"Popup__buttons",inner:[Btn({class:"Popup__button",inner:e?getLang("mobile_wall_post_copyright_edit_button"):getLang("mobile_wall_post_copyright_add_button"),theme:"regular",use_native_onclick:!0,on_click:'posting.saveSource("'+t+'", this)'}),e?Btn({class:"Popup__button",inner:getLang("mobile_delete"),theme:"secondary",use_native_onclick:!0,on_click:'posting.deleteSource(event, this, "'+t+'")'}):{}]}]}});je.default.open(Wd.elem(l),!0);var c=$(".AddCopyrightPopup__input input");c&&Object(i.elfocus)(c)},submit:function(e,t,n){var i=$(".Btn",n.parentNode);i.disabled=!0,ajax.post("/wall?act=check_copyright_link",{_ajax:1,link:e},{onDone:function(a){var o=$(".AddCopyrightPopup__error");a.status?(n.classList.remove("TextInput_error"),hide(o),Yt(e,t),je.default.close(n)):(n.classList.add("TextInput_error"),show(o),val(o,a.error)),post.saveDraft(null,t),i.disabled=!1}})},remove:function(e,t){t&&je.default.close(t),Yt("",e),e&&post.saveDraft(null,e)}};window.AddCopyrightPopup=Xt;var Gt=Xt,Kt={getHash:function(){var e=Object(v.$)("#feed_add_form"),t=qs2obj(e.action.split("?")[1]);return e.getAttribute("data-hash")||t.hash},openCopyright:function(e,t,n,i){cancelEvent(e);var a=!1;if("BUTTON"===e.target.tagName)a=e.target.disabled;else if("LABEL"===e.target.tagName){a=Object(v.$)("button",e.target).disabled}a||Gt.open(t,n,i)},saveSource:function(e,t){if(t.target){if(13!==t.keyCode)return;t=t.target}var n=Object(v.$)(".AddCopyrightPopup__input",t.closest(".AddCopyrightPopup")),i=n.querySelector("input");Gt.submit(i.value,e,n)},deleteSource:function(e,t,n){var i=Object(v.$)(".AddCopyrightPopup__input",t.closest(".AddCopyrightPopup"));event&&cancelEvent(e),Gt.remove(n,i)},deleteObject:function(e){e&&cancelEvent(e);var t=nav.params,n=qs2obj(t);delete n.object,delete n.list,n.delete_object=1,post.saveDraft(null,Kt.getHash(),""+nav.path+obj2qs(n))}};window.posting=Kt;n("wyHI");var Jt={},Zt=function(e,t,n,i){delete Jt[t],1===i?Emoji.favorite.addFavoriteSticker(e,t,n):-1===i&&Emoji.favorite.deleteFavoriteSticker(e,t,n)};var en,tn={toggleFavorite:function(e,t,n){if(t&&t.stopPropagation(),!hasClass(e,"on")&&Emoji.stickers[Emoji.TAB_FAVORITE_STICKERS].stickers.length>=Emoji.favoriteLimit&&!Emoji.favoriteLimitNoticed){var i=langStr(getLang("purchases_stickers_favorite_limit_notice"),"%s",Emoji.favoriteLimit);return setTimeout(showFastBox(getLang("global_error"),i).hide,3e3),ajax.post("stickers.php",{act:"favorite_limit_noticed",value:1}),Emoji.favoriteLimitNoticed=!0,!1}var a=attr(e,"data-sticker-id"),o=attr(e,"data-hash");return!(!a||!o)&&(!Jt[a]&&(Jt[a]=1,toggleClass(e,"on"),void ajax.post("/stickers.php",{act:"toggle_favorite",sticker_id:a,hash:o},{onDone:Zt.pbind(n,a,e)})))},getStickerUrl:function(e,t){var n={id:e,size:t};return window.isMVK?rs(window.store.stickers.url_template,n):getTemplate("stickers_sticker_url",n)}},nn=function(){var e,t,n,i=!1,a=!1,o={},r={},s={},l={};function c(e){var t=f(e),n=1;if(t){hasClass(e,"animation_play")||(hide(geByClass1("sticker_img",e)),addClass(e,"animation_play")),t.play();var i=attr(e,"data-loop-count");i=parseInt(i),isNaN(i)&&(i=3),-1!==i&&(!t._cbs.loopComplete||t._cbs.loopComplete&&0===t._cbs.loopComplete.length)&&t.addEventListener("loopComplete",function a(o){var r=!0;i>=++n&&(r=!1),r&&(d(e,!1),""!==t._cbs.loopComplete&&t.removeEventListener("loopComplete",a),t.stop())})}}function u(e){var t=attr(e,"data-uid");return t||(t=attr(e,"data-uid",Math.random().toString(32).substr(2))),t}function d(e,t){l[u(e)]=t}function f(e){var t=attr(e,"data-uniq-id");if(!geByClass1("svg_sticker_animation",e))return!1;var n=r[t];return n||!1}function _(e,t){var i=f(e);if(i)"function"==typeof t&&t(i);else{var a=attr(e,"data-uniq-id");if(!l[u(e)]){d(e,!0);var s=attr(e,"data-animation-path"),c=attr(e,"data-sticker-id"),_=!1;if(c&&(_=o[c]?h(e):s&&h(e)),_){var p={container:e,renderer:"svg",loop:!0,autoplay:!1,name:a,rendererSettings:{scaleMode:"noScale",progressiveLoad:!0,hideOnTransparent:!0,className:"svg_sticker_animation"}};o[c]?p.animationData=o[c]:p.path=s;var m=geByClass1("svg_sticker_animation",e);if(m&&re(m),i=n.loadAnimation(p),!o[c])return void i.addEventListener("data_ready",function(){o[c]=i.animationData,r[a]=i,"function"==typeof t&&t(i)})}"function"==typeof t&&(r[a]=i,"function"==typeof t&&t(i))}}}function p(){return t().then(function(e){return n=e,e})}return{init:function(e){t=e.animatorLoader},checkSettingsAndLoadInWeb:function(e){if(StickersSettings.getAutoplay()){var t=ge("fc_msg"+e),n=geByClass1("sticker_animation",t);nn.loadAndPlaySticker(n)}},checkSettingsAndLoad:function(e){if(StickersSettings.getAutoplay()){var t=$(".msg_id_"+e+" .sticker_animation");nn.loadAndPlaySticker(t)}},loadStickerInMvkIMAndPlay:function(e,t){var n="_msg"+e;t&&(n="msg_id_"+e);var i=geByClass1("sticker_animation",geByClass1(n));nn.loadAndPlayStickerWithTimer(i,500)},loadAutoplayAnimationStickers:function(e){if(n){if(e){if(a)return;a=!0}if(!i){i=!0;var t=geByClass("sticker_animation_autoplay");t&&each(t,function(e,t){_(t,function(){c(t)})}),i=!1}}else p().then(function(){nn.loadAutoplayAnimationStickers(e)})},loadAndPlaySticker:function(e){e&&(n?requestAnimationFrame(function(){_(e,function(){c(e)})}):p().then(function(){nn.loadAndPlaySticker(e)}))},loadAndPlayStickerWithTimer:function(e,t){if(e&&!s[e]){t||(t=1e3);var n=ge(e);hasClass(n,"sticker_animation_disabled_timer")||(s[e]=setTimeout(function(){!n&&(n=ge(e),hasClass(n,"sticker_animation_disabled_timer"))||(nn.loadAndPlaySticker(n),clearTimeout(s[e]),s[e]=!1)},t))}},reloadStickers:function(){r={}},touchStartSticker:function(t){t.addEventListener("contextmenu",nn.preventContextMenu,!1),e=setTimeout(function(){nn.loadAndPlaySticker(t)},500)},touchEndSticker:function(){e&&clearTimeout(e)},preventContextMenu:function(e){event.preventDefault(),event.stopPropagation()}};function h(e){var t=e.getBoundingClientRect().top,n=e.getBoundingClientRect().bottom;return t<window.innerHeight&&n>=0&&isVisible(e)}}(),an={autoplay:0,setAutoplay:function(e){this.autoplay=e},getAutoplay:function(){return an.autoplay}};function on(){return qs2obj(nav.params)}function rn(e){return"dialogs"===e.tab||!e.q}function sn(e){var t=nav.getQuery("community");return t?(e?"?":"&")+"community="+t:""}function ln(){var e=window.lang;qsearch.init({init_once:!0,action:"/mail?act=write&fast=1",container:ge("ma_search_items"),field:ge("ma_search_field"),btn:ge("ma_search_btn"),top_items:[],_cache:{},item_tpl:function(e,t,n,i,a){return this.id>2e9||-1===this.id?'<a href="'+(e||"")+'" class="simple_item'+(-1==this.id?" simple_item_create":"")+'">'+(t||"")+'<div class="si_body"><span class="si_owner">'+this.highlight(n||"")+"</span>"+(i||"")+(a?'<div class="si_slabel">'+a+"</div>":"")+"</div></a>":'<a href="'+(e||"")+'" class="inline_item"><div class="ii_body">'+(t||"")+'<span class="ii_owner">'+this.highlight(n||"")+"</span>"+(i||"")+"</div></a>"},null_tpl:function(){return'<div class="service_msg_box"><div class="service_msg service_msg_null">'+e.mobile_mail_no_peers+"</div></div>"},need_invalid_keys:d.default.desktop,onLoaded:function(e){for(var t in e)mail.saveDialog(e[t][e[t].length-1],t)}})}nn.init({animatorLoader:function(){return n.e(0).then(n.bind(null,"P3dz")).then(function(e){return e.default})}}),window.Stickers=tn,window.StickersAnimation=nn,window.StickersSettings=an,im.clearSearchInput=function(e){if(preventEvent(e),rn(on())){var t=ge("ma_search_field");val(t,""),im.onFilterKeyDown(t)}else nav.go("/mail"+sn(!0))},im.onFilterKeyDown=function(e){setTimeout(function(){var t=window.lang,n=encodeURIComponent(e.value),i=on();if(toggle(geByClass1("mail_search_clear_button"),n),attr(geByClass1("tab_dialogs_search"),"href",n?"/mail?tab=dialogs&q="+n+sn():"/mail"+sn(!0)),attr(geByClass1("tab_messages_search"),"href","/mail?q="+n+sn()),rn(i)){var a,o=ge("mail_tabs"),r=ge("ma_search_items"),s=ge("dialogs"),l=i.offset;if(removeClass("mail_show_filtered",geByClass1("mail")),en&&clearTimeout(en),toggleClass("dialogs_filter_without_important",ge("dialogs_filter"),n||0===intval(val(geByClass1("dialogs_filter_button_important")))),n)show(o),show(r),hide(s),en=setTimeout(function(){a="/mail?tab=dialogs&q="+n+(l?"&offset="+l:"")+sn(),"/mail"!==nav.path||on().act||nav.go(a,null,{push_only:!0})},200);else{if(hide(o),hide(r),show(s),!nav.getQuery("community")){var c=geByClass1("mhb_back"),u=geByClass1("mh_header");val(u,t.mobile_mail_head_title),removeClass("mhi_back",u),c.outerHTML=c.outerHTML.replace("<a","<div").replace("</a>","</div>")}a="/mail"+(l?"?offset="+l:"")+sn(!l),nav.go(a,null,{push_only:!0})}}},40)},mail.onShowWritePageFromCache(ln),mail.onShowDialogsPageFromCache(ln);var cn=n("vuIU");function un(e,t){var n=e.play();n&&n.catch&&n.catch(function(e){Object(lt.isFunction)(t)&&t(e)})}var dn="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=",fn=function(){function e(e){this.opts=e||{},this._trackOptions={},this._audioNodes=[],this._currentAudioEl=this._createAudioNode(),this._prefetchAudioEl=this._createAudioNode()}e.isSupported=function(e){var t=document.createElement("audio");return!!t.canPlayType&&(e=e||'audio/mpeg; codecs="mp3"',!!t.canPlayType(e).replace(/no/,""))};var t=e.prototype;return t.destroy=function(){},t.getPlayedTime=function(){for(var e=this._currentAudioEl.played,t=0,n=0;n<e.length;n++)t+=e.end(n)-e.start(n);return t},t._setAudioNodeUrl=function(e,t){window.data&&window.data(e,"setUrlTimesetUrlTime",t==dn?0:vkNow()),e.src=t},t._createAudioNode=function(e){var t=new Audio,n=this;return this.opts.onBufferUpdate&&addEvent(t,"progress",function(){n._currentAudioEl==t&&n.opts.onBufferUpdate(n.getCurrentBuffered());var e=t.buffered;1==e.length&&0==e.start(0)&&e.end(0)==t.duration&&(t._fullyLoaded=!0)}),addEvent(t,"stalled",function(){n._currentAudioEl==t&&n._isInvalidDuration()&&n._currentAudioEl.currentTime>=n.duration-1&&n._currentAudioEl.dispatchEvent(new Event("ended"))}),this.opts.onProgressUpdate&&addEvent(t,"timeupdate",function(){n._currentAudioEl==t&&n.opts.onProgressUpdate(n.getCurrentProgress())}),this.opts.onEnd&&addEvent(t,"ended",function(){n._currentAudioEl==t&&n.opts.onEnd()}),this.opts.onSeeked&&addEvent(t,"seeked",function(){n._currentAudioEl==t&&n.opts.onSeeked()}),this.opts.onSeek&&addEvent(t,"seeking",function(){n._currentAudioEl==t&&n.opts.onSeek()}),addEvent(t,"error",function(){n._prefetchAudioEl==t?n._prefetchAudioEl=n._createAudioNode():n._currentAudioEl==t&&n.opts.onFail&&n.opts.onFail()}),addEvent(t,"canplay",function(){if(window.data){var e=window.data(t,"setUrlTime");e&&(cur.audioLoadTimings=cur.audioLoadTimings||[],cur.audioLoadTimings.push(vkNow()-e),window.data(t,"setUrlTime",0))}n._prefetchAudioEl,n._currentAudioEl==t&&(n.opts.onCanPlay&&n.opts.onCanPlay(),n._seekOnReady&&(n.seek(n._seekOnReady),n._seekOnReady=!1))}),e&&(this._setAudioNodeUrl(t,e),t.preload="auto",t.volume=this._volume||1,t.load()),this._audioNodes.push(t),t},t.onReady=function(e){e(!0)},t.prefetch=function(e){this._prefetchAudioEl&&this._setAudioNodeUrl(this._prefetchAudioEl,dn),this._prefetchAudioEl=this._createAudioNode(e)},t.seek=function(e){var t=this._currentAudioEl;this.duration?t.currentTime=this.duration*e:this._seekOnReady=e},t.setVolume=function(e){void 0===e&&(e=this._currentAudioEl.volume),this._currentAudioEl.volume=e,this._prefetchAudioEl&&(this._prefetchAudioEl.volume=e),this._volume=e},t._isInvalidDuration=function(){var e=this._currentAudioEl;return isNaN(e.duration)||e.duration==1/0||0==e.duration},t.getCurrentProgress=function(){var e=this._currentAudioEl;return this.duration?Math.max(0,Math.min(1,e.currentTime/this.duration)):0},t.getCurrentBuffered=function(){var e=this._currentAudioEl;return e&&e.buffered.length?Math.min(1,e.buffered.end(0)/e.duration):0},t.isFullyLoaded=function(){return this._currentAudioEl._fullyLoaded},t.setUrl=function(t,n){var i=this._currentAudioEl;if(this._seekOnReady=!1,this._trackOptions={},n&&"object"==typeof n&&(this._trackOptions=n,n=n.callback),i.src==t)return this.opts.onCanPlay&&this.opts.onCanPlay(),n&&n(!0);if(this._prefetchAudioEl&&this._prefetchAudioEl.readyState>e.STATE_HAVE_NOTHING)if(this._prefetchAudioEl.src==t){this._currentAudioEl.pause(0),this._setAudioNodeUrl(this._currentAudioEl,dn);var a=this;this._prefetchAudioEl.readyState>=e.STATE_HAVE_FUTURE_DATA&&setTimeout(function(){a.opts.onCanPlay&&a.opts.onCanPlay()}),i=this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=!1}else this._prefetchAudioEl.src&&this._setAudioNodeUrl(this._prefetchAudioEl,dn);return i.src!=t&&(this._setAudioNodeUrl(i,t),i.load()),n&&n(!0)},t.play=function(t){this._prefetchAudioEl.src==t&&this._prefetchAudioEl.readyState>e.STATE_HAVE_NOTHING&&(this._setAudioNodeUrl(this._currentAudioEl,dn),this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=this._createAudioNode(),this.opts.onCanPlay&&this.opts.onCanPlay());var n=this._currentAudioEl;if(n.src)try{un(n)}catch(e){debugLog("Audio: url set failed (html5 impl)")}},t.pause=function(){var e=this._currentAudioEl;e.src&&e.pause()},t.stop=function(){var e=this._currentAudioEl;this._setAudioNodeUrl(e,dn)},t._setFadeVolumeInterval=function(e){if(e){if(!this._fadeVolumeWorker&&window.Worker&&window.Blob){var t=new Blob(["\n        var interval;\n        onmessage = function(e) {\n          clearInterval(interval);\n          if (e.data == 'start') {\n            interval = setInterval(function() { postMessage({}); }, 20);\n          }\n        }\n      "]);try{this._fadeVolumeWorker=new Worker(window.URL.createObjectURL(t))}catch(e){this._fadeVolumeWorker=!1}}this._fadeVolumeWorker?(this._fadeVolumeWorker.onmessage=e,this._fadeVolumeWorker.postMessage("start")):this._fadeVolumeInterval=setInterval(e,60)}else this._fadeVolumeWorker&&(this._fadeVolumeWorker.terminate(),this._fadeVolumeWorker=null),this._fadeVolumeInterval&&clearInterval(this._fadeVolumeInterval)},t.fadeVolume=function(e,t){e=Math.max(0,Math.min(1,e));var n=this._currentAudioEl,i=0;if(i=e<n.volume?-.04:.001,Math.abs(e-n.volume)<=.001)return this._setFadeVolumeInterval(),t&&t();var a=n.volume;this._setFadeVolumeInterval(function(){i>0&&(i*=1.2),a+=i;if(i<0?a<=e:a>=e)return this.setVolume(e),this._setFadeVolumeInterval(),t&&t();this.setVolume(a)}.bind(this))},Object(cn.default)(e,[{key:"type",get:function(){return"html5"}},{key:"loaded",get:function(){return!0}},{key:"duration",get:function(){var e=this._currentAudioEl,t=isNaN(e.duration)||e.duration==1/0?0:e.duration;return!t&&this._trackOptions.duration&&(t=parseInt(this._trackOptions.duration)),t}}]),e}();fn.STATE_HAVE_NOTHING=0,fn.STATE_HAVE_FUTURE_DATA=3,fn.HAVE_ENOUGH_DATA=4,fn.AUDIO_EL_ID="ap_audio";var _n=function(){function e(e){this.opts=e||{},window._flashVoiceInstance=this}var t=e.prototype;return t.fadeVolume=function(e,t){return this.setVolume(e),t()},t.destroy=function(){re(e.PLAYER_EL_ID)},t.onReady=function(t){if(this._player)return t(!0);if(!1===this._player)return t(!1);this._onReady=t;ge(e.PLAYER_EL_ID)||document.body.appendChild(ce("div",{id:e.PLAYER_EL_ID,className:"fixed"}));var n=this;renderFlash(e.PLAYER_EL_ID,{url:"/swf/audio_lite.swf",id:"flash_voice_player",height:2},{swliveconnect:"true",allowscriptaccess:"always",wmode:"opaque"},{onPlayFinish:"VoicePlayerFlash.onAudioFinishCallback",onLoadProgress:"VoicePlayerFlash.onAudioLoadProgressCallback",onPlayProgress:"VoicePlayerFlash.onAudioProgressCallback"})&&setTimeout(function(){n._checkFlashLoaded()},50)},t.setUrl=function(e,t){this._trackOptions={},t&&"object"==typeof t&&(this._trackOptions=t,t=t.callback),this._url!=e?(this._url=e,this._player&&this._player.loadAudio(e),t&&t(!0)):t&&t(!0)},t.setVolume=function(e){this._player&&this._player.setVolume&&this._player.setVolume(e)},t.play=function(){this._player&&this._player.playAudio()},t.seek=function(e){var t=(this._total||0)*e;this._player&&this._player.playAudio(t)},t.pause=function(){this._player&&this._player.pauseAudio()},t.isFullyLoaded=function(){return!1},t.getPlayedTime=function(){return 0},t.getCurrentProgress=function(){return this._currProgress||0},t.getCurrentBuffered=function(){return this._currBuffered||0},t.stop=function(){this._player&&this._player.stopAudio()},t._checkFlashLoaded=function(){var e=ge("flash_voice_player");if(this._checks=this._checks||0,this._checks++,this._checks>10){this._player=!1;var t=this._onReady;return t&&t(!1)}if(e&&e.paused){this._player=e;var n=this._onReady;n&&n(!0),this._onReady=null}else{var i=this;setTimeout(function(){i._checkFlashLoaded()},100)}},e.onAudioFinishCallback=function(){var e=window._flashVoiceInstance;e.opts.onEnd&&e.opts.onEnd()},e.onAudioProgressCallback=function(e,t){var n=window._flashVoiceInstance;t&&(n._total=t,n._currProgress=e/t,n.opts.onProgressUpdate&&n.opts.onProgressUpdate(n._currProgress))},e.onAudioLoadProgressCallback=function(e,t){var n=window._flashVoiceInstance;n._currBuffered=e/t,n.opts.onBufferUpdate&&n.opts.onBufferUpdate(n._currBuffered)},Object(cn.default)(e,[{key:"type",get:function(){return"flash"}},{key:"loaded",get:function(){return!!this._player}}]),e}();window.VoicePlayerFlash=_n,_n.PLAYER_EL_ID="flash_voice";var pn=35;void 0===window.isTouch&&(window.isTouch=!1);var hn,mn=function(){function e(e,t){if(!e)throw new Error("No element was provided for Slider");e=ge(e),this.options=t||{size:1},void 0===this.options.logfbase&&(this.options.logfbase=pn),this.options.backValue=this.options.backValue||0;var n=100*this.options.backValue,i='<div class="slider_slide"><div class="slider_loading_bar" style="opacity: 0; display: none;"></div> '+(this.options.withBackLine?'<div class="slider_back" style="width:'+n+'%"></div>':"")+' <div class="slider_amount"></div> <div class="slider_handler"></div> </div>';this._el=ce("div",{innerHTML:i,className:"slider",id:e.getAttribute("id")||""});var a=this;if(e.classList)for(var o=e.classList,r=0,s=o.length;r<s;r++)addClass(this._el,o[r]);else this._el.className=e.className;each(this._el.attributes,function(e,t){"id"==t.name&&"class"==t.name||a._el.setAttribute(t.name,t.value)}),e.parentNode.replaceChild(this._el,e),this._amountEl=geByClass1("slider_amount",this._el),this._handlerEl=geByClass1("slider_handler",this._el),this._slideEl=geByClass1("slider_slide",this._el),this._backEl=geByClass1("slider_back",this._el),this._progressEl=geByClass1("slider_loading_bar",this._el),this.options.color&&(setStyle(this._amountEl,{backgroundColor:this.options.color}),setStyle(this._handlerEl,{backgroundColor:this.options.color})),this.options.backColor&&setStyle(this._slideEl,{backgroundColor:this.options.backColor}),addClass(this._el,"slider_size_"+this.options.size),this.options.debounce&&(this._onValueChangeDebounced=debounce(this._onValueChange,this.options.debounce)),!isTouch&&t.formatHint&&(addEvent(this._el,"mousemove",this._ev_onMouseOver=this._onMouseOver.bind(this)),addEvent(this._el,"mouseleave",this._ev_onMouseLeave=this._onMouseLeave.bind(this))),addEvent(this._el,isTouch?"touchstart":"mousedown",this._ev_onMouseDown=this._onMouseDown.bind(this)),addEvent(this._el,"click",cancelEvent),this.setValue(this.options.value||0,!this.options.fireChangeEventOnInit,!1),this.setBackValue(this.options.backValue)}var t=e.prototype;return t.toggleLoading=function(e){e=!!e,toggle(this._progressEl,e),setStyle(this._progressEl,"opacity",e?1:0)},t.destroy=function(){!isTouch&&this.options.formatHint&&(removeEvent(this._el,"mousemove",this._ev_onMouseOver),removeEvent(this._el,"mouseleave",this._ev_onMouseLeave),removeEvent(this._el,"mousedown",this._ev_onMouseDown));var e=window.re||window.remove;e(this._el),e(this._currHintEl)},t._updateHint=function(e,t){this._currHintEl||(this._currHintEl=ce("div",{className:"slider_hint",id:"slider_hint"}),this.options.hintClass&&addClass(this._currHintEl,this.options.hintClass),this._el.appendChild(this._currHintEl));var n=this._getPos(),i=Math.round((e.pageX||e.touches[0].pageX)-n[0]),a=this._width;if((i=t?Math.min(Math.max(0,i),a):i)>=0&&i<=a){var o=i/a;this._currHintEl.innerHTML=this.options.formatHint?this.options.formatHint.call(this,o):o;var r=this._currHintEl.getBoundingClientRect();setStyle(this._currHintEl,{left:this._slideEl.offsetLeft+i-(r.right-r.left)/2,top:this._slideEl.offsetTop-(r.bottom-r.top)-10}),!t&&this._toggleHint(!0)}else!t&&this._toggleHint(!1);this.options.formatHint||this._toggleHint(!1)},t._toggleHint=function(e){toggleClass(this._currHintEl,"visible",e)},t._onMouseOver=function(t){e._currenSliderDrag||hasClass(this._el,"active")||this._updateHint(t)},t._onMouseLeave=function(e){hasClass(this._el,"active")||this._toggleHint(!1)},t._onMouseDown=function(t){(0==t.button||t.touches)&&(delete cur._sliderMouseUpNowEl,addEvent(window,isTouch?"touchmove":"mousemove",this._ev_onMouseMove=this._onMouseMove.bind(this)),addEvent(window,isTouch?"touchend touchcancel":"mouseup",this._ev_onMouseUp=this._onMouseUp.bind(this)),this._onMouseMove(t),e._currenSliderDrag=this,addClass(this._el,"active"),cancelEvent(t))},t._onMouseUp=function(t){cur._sliderMouseUpNowEl=this._el,removeEvent(window,isTouch?"touchmove":"mousemove",this._ev_onMouseMove),removeEvent(window,isTouch?"touchend touchcancel":"mouseup",this._ev_onMouseUp),this._onValueChange(),removeClass(this._el,"active"),e._currenSliderDrag=!1,this._toggleHint(!1),this.options.onEndDragging&&this.options.onEndDragging(this._currValue),cancelEvent(t)},t._onMouseMove=function(e){var t=this._getPos(),n=t[0];n=void 0!==e.touches&&e.touches.length>0?e.touches[0].pageX:e.pageX,n=Math.max(n,t[0]),n=Math.min(n,t[0]+this._width),n-=t[0],this.setValue(n/this._width,!0,!0),this._onValueChangeDebounced?this._onValueChangeDebounced():this._onValueChange(),this._toggleHint(!0),this._updateHint(e,!0),cancelEvent(e)},t._getPos=function(){return this._slidePos=getXY(this._slideEl)},t._logf=function(e){if(!this.options.log)return e;var t=this.options.logfbase;return(Math.pow(t,e)-1)/(t-1)},t._unlogf=function(e){if(!this.options.log)return e;var t,n,i=this.options.logfbase;return t=i,n=1+e*(i-1),Math.log(n)/Math.log(t)},t.setValue=function(e,t,n){if(!hasClass(this._el,"active")||n){var i=n?this._logf(e):e;if(this._currValue!=i){this._currValue=i;var a=n?e:this._unlogf(e);a=100*a+"%",setStyle(this._amountEl,{width:a}),setStyle(this._handlerEl,{left:a}),!t&&this._onValueChange()}}},t.setBackValue=function(e){toggleClass(this._backEl,"slider_back_transition",e>this._backValue),this._backValue=e;var t=100*e+"%";setStyle(this._backEl,{width:t})},t._onValueChange=function(){this._lastValue=this._lastValue||0,this._lastValue!=this._currValue&&(this._lastValue=this._currValue,this.options.onChange&&this.options.onChange(this._currValue))},Object(cn.default)(e,[{key:"_width",get:function(){if(!this._widthCache){var e=this._el.getBoundingClientRect();this._widthCache=e.right-e.left}return this._widthCache}}]),e}(),An=n("Xrg9"),vn=!1,gn=function(){function e(e){var t=this,n=(void 0===e?{}:e).onListened;this._reattach=!1,this._audioEl=null,this._playing=!1,this._timer=null,this._duration=0,this._detaching=!1;var i={onEnd:function(){t.detach()},onFail:function(){i.onEnd()},onCanPlay:function(){},onProgressUpdate:function(e){t._updateProgress(e)}};hn=!1,fn.isSupported()?(fn.isSupported('audio/ogg;codecs="opus"')&&!fn.isSupported('audio/ogg;codecs="codec_check"')&&(hn=!0),this._impl=new fn(i)):browser.flash&&window.renderFlash&&(this._impl=new _n(i)),this.onPlayPause=function(e){return cancelEvent(e),t.toggle()},this.onDurationClick=function(e){t.durationType=!t.durationType,cancelEvent(e)},this._onListened=function(){n&&n(t._audioEl)},this._initEvents()}var t=e.prototype;return t._updateProgress=function(e){this._audioEl&&(this._duration*e>=1||this._duration<1)&&!this._audioEl._listened&&(this._audioEl._listened=!0,this._onListened()),this._durationEl&&(this.durationType?this._durationEl.innerHTML="-"+formatTime(Math.round(this._duration*(1-e))):this._durationEl.innerHTML=formatTime(Math.round(this._duration*e))),this._progressSlider&&this._progressSlider.setValue(e)},t._initInterface=function(){var e=this;this._el=ce("div",{innerHTML:'<div class="audio-msg-player audio-msg-track"><button class="audio-msg-track--btn"></button><div class="audio-msg-track--duration"></div><div class="audio-msg-track--wave-wrapper"><div class="audio-msg-track--slider"></div></div></div>'}).firstChild,window.getLang&&attr(this._el,"aria-label",getLang("mail_audio_message")),this._playBtn=geByClass1("audio-msg-track--btn",this._el),window.getLang&&attr(this._playBtn,"aria-label",getLang("global_audio_play")),this._durationEl=geByClass1("audio-msg-track--duration",this._el),this._durationEl.innerHTML=formatTime(this._duration),this._progressSlider=new mn(geByClass1("audio-msg-track--slider",this._el),{value:0,size:0,hintClass:"audio_player_hint",formatHint:function(t){return formatTime(Math.round(t*e._duration))},onEndDragging:function(t){e._impl.seek(t)}});var t=geByClass1("audio-msg-track--wave-wrapper",this._audioEl).children[0];geByClass1("slider_slide",this._el).appendChild(t.cloneNode(!0)),geByClass1("slider_amount",this._el).appendChild(t.cloneNode(!0)),addEvent(this._playBtn,"click",this.onPlayPause),addEvent(this._durationEl,"click",this.onDurationClick),this._audioEl.parentNode.appendChild(this._el)},t._destroyInterface=function(){hide(this._el),this._audioEl.parentNode.removeChild(this._el),removeEvent(this._playBtn,"click",this.onPlayPause),this._progressSlider&&(this._progressSlider.destroy(),this._progressSlider=null),this._playBtn=null,this._durationEl=null,this._el=null},t.attachTo=function(e){var t=this;if(this._audioEl!=e){null!=this._audioEl&&(this._reattach=!0),this.detach(),this._audioEl=e,addClass(this._audioEl,"audio-msg-track_player-attached"),this._duration=attr(e,"data-duration"),this._initInterface();var n=this._audioEl.id.split("_");if(n&&n.length>1&&(this._owner_id=n[1]),this._reattach=!1,!this._impl.loaded)return new Promise(function(n,i){t._impl.onReady(function(){t._impl.setUrl(attr(e,hn?"data-ogg":"data-mp3"),{duration:t._duration,callback:n})})});this._impl.setUrl(attr(e,hn?"data-ogg":"data-mp3"),{duration:this._duration})}return!0},t.detach=function(e){if(void 0===e&&(e=!1),this._audioEl&&this._el&&!this._detaching){if(e&&this.isAttached())return;this._detaching=!0,this.stop(),this._destroyInterface(),removeClass(this._audioEl,"audio-msg-track_player-attached"),this._audioEl._listened=!1,this._audioEl=null}this._detaching=!1},t.play=function(){this._audioEl&&(this._reattach||e.pauseGlobalMedia(),addClass(this._el,"audio-msg-track_playing"),window.getLang&&attr(this._playBtn,"aria-label",getLang("global_audio_pause")),this._playing=!0,this._createTimer(),this._owner_id&&Object(tt.statlogsValueEvent)("audio_message_play",this._owner_id),this._impl.play())},t.pause=function(){this._audioEl&&(!this._reattach&&this._playing&&e.resumeGlobalMedia(),window.getLang&&attr(this._playBtn,"aria-label",getLang("global_audio_play")),removeClass(this._el,"audio-msg-track_playing"),this._playing=!1,this._impl.pause(),this._killTimer())},t.stop=function(){this.pause(),this._impl.stop()},t.toggle=function(){this._playing?this.pause():this.play()},t._createTimer=function(){var e=this;this._duration>0&&(this._killTimer(),this._timer=setInterval(function(){var t=e._impl.getCurrentProgress();e._updateProgress(t)},100))},t._killTimer=function(){this._timer&&(clearInterval(this._timer),this._timer=null)},t._initEvents=function(){var e=this;window.ap?window.ap.on(this,[ke.PLAY_REQUESTED,ke.PLAY],function(){delete window.ap.pausedByMsg,e.pause()}):window.audio&&window.audio.subscribe([ke.PLAY_REQUESTED,ke.PLAY],function(){delete window.audio.pausedByMsg,e.pause()}),window.Notifier&&(window.Notifier.addRecvClbk("audio_start","audio_msg",function(){e.pause()}),window.Notifier.addRecvClbk("video_start","audio_msg",function(){e.pause()}))},t.isAttached=function(){if(this._audioEl){for(var e=this._audioEl;e.parentNode;)e=e.parentNode;return!!e.body}return!1},e.pauseGlobalMedia=function(){window.Notifier&&(vn=!0,window.Notifier.lcSend("video_start")),window.ap&&window.ap.isPlaying()?(window.ap.pause(),window.ap.pausedByMsg=!0):window.audio&&window.audio.playing&&window.audio.playing()&&(window.audio.pause(),window.audio.pausedByMsg=!0)},e.resumeGlobalMedia=function(){window.Notifier&&vn&&(vn=!1,window.Notifier.lcSend("video_hide")),window.ap&&window.ap.pausedByMsg?(window.ap.play(),delete window.ap.pausedByMsg):window.audio&&window.audio.playing&&window.audio.pausedByMsg&&(un(window.audio),delete window.audio.pausedByMsg)},Object(cn.default)(e,[{key:"type",get:function(){return this._impl.type}},{key:"durationType",get:function(){return window.AudioPlayer?!!An.default.get(AudioPlayer.LS_PREFIX+AudioPlayer.LS_DURATION_TYPE):"1"==An.default.get("audio_time_left")},set:function(e){window.AudioPlayer?An.default.set(AudioPlayer.LS_PREFIX+AudioPlayer.LS_DURATION_TYPE,!!e):An.default.set("audio_time_left",e?"1":"0")}}]),e}(),bn={avg:function(){function e(){this.clear()}var t=e.prototype;return t.push=function(e){this._count++,this._accum+=e},t.get=function(){return this._accum/this._count},t.clear=function(){this._count=0,this._accum=0},e}(),peak:function(){function e(){this.clear()}var t=e.prototype;return t.push=function(e){this._max=Math.max(this._max,Math.abs(e))},t.get=function(){return this._max},t.clear=function(){this._max=0},e}(),quad:function(){function e(){this.clear()}var t=e.prototype;return t.push=function(e){this._count++,this._accum+=e,this._accum_q+=e*e},t.get=function(){return 1==this._count?this._accum:Math.sqrt((this._accum_q-this._accum*this._accum/this._count)/this._count)},t.clear=function(){this._count=0,this._accum=0,this._accum_q=0},e}()},yn=function(){function e(e){this._normalizeAlgorithm=!1,bn[e.normalizeAlgorithm]&&(this._normalizeAlgorithm=new bn[e.normalizeAlgorithm]),this._srcSampleRate=parseInt(e.srcSampleRate||0),this._dstSampleRate=parseInt(e.dstSampleRate||0),this._truncateTo=1,void 0!==e.truncateTo&&(this._truncateTo=e.truncateTo),this._dstSampleRate>0?this._sampleRate=this._srcSampleRate/this._dstSampleRate:this._sampleRate=0,bn[e.algorithm]||(e.algorithm="peak"),this._algorithm=new bn[e.algorithm],this._sampleCount=0,this._data=[]}return e.prototype.push=function(e){if(this._sampleRate<=0)return[];for(var t,n=[],i=0;i<e.length;i++)if(this._truncateTo>0&&(e[i]=Math.min(this._truncateTo,Math.abs(e[i]))),this._sampleCount+=1,this._sampleCount>=this._sampleRate)for(;this._sampleCount>=this._sampleRate;)this._sampleCount-=this._sampleRate,this._sampleCount<=.8&&this._algorithm.push(e[i]),t=this._algorithm.get(),n.push(t),this._normalizeAlgorithm&&this._normalizeAlgorithm.push(t),this._algorithm.clear(),this._sampleCount>.2&&this._algorithm.push(e[i]);else this._algorithm.push(e[i]);if(this._normalizeAlgorithm){var a=this._normalizeAlgorithm.get();if(this._normalizeAlgorithm.clear(),a>0)for(var o=0;o<n.length;o++)n[o]=n[o]/a,this._truncateTo>0&&(n[o]=Math.min(this._truncateTo,Math.abs(n[o])))}return n},e}();var wn=null,Cn=4;function kn(e){for(var t=geByClass("audio-msg-track--wave-wrapper",e),n=0,i=0;i<t.length;i++){try{n=parseInt(window.getComputedStyle(t[i],null).getPropertyValue("width"))}catch(e){n=parseInt(t[i].currentStyle.width)}if(n>0)break}return n}function Sn(e,t){var n,i,a;t=Math.round(t),e.length!=t&&(i=t,void 0===a&&(a="peak"),e=new yn({srcSampleRate:(n=e).length,dstSampleRate:i,normalizeAlgorithm:a,truncateTo:0}).push(n));for(var o="",r=0,s=0;s<e.length;s++)0===(r=Math.floor(8*e[s]*.95))&&(r=.5),o+="M"+(s*Cn+1)+","+(10-r)+"v"+2*r+"Z";return'<svg class="audio-msg-track--wave" width="'+e.length*Cn+'px"><path d="'+o+'"></path></svg>'}function En(){for(var e=geByClass("audio-msg-track"),t=0;t<e.length;t++){var n=Object(i.attr)(e[t],"data-wave");Object(i.hasClass)(e[t],"audio-msg-player")&&t>0&&(n=Object(i.attr)(e[t-1],"data-wave"));var a=kn(e[t]);if(n&&a){n=n.split(",");for(var o=geByClass("audio-msg-track--wave",e[t]),r=Sn(n,a/Cn),s=0;s<o.length;s++){var l=Object(i.ce)("div",{innerHTML:r}).firstChild;o[s].parentNode.replaceChild(l,o[s])}}}}function On(){return wn||(wn=new gn({onListened:function(e){AudioMessagePlayer.events.emit("listened",e)}})),wn}addEvent(window,"orientationchange",function(){return setTimeout(En,500)}),window.mail&&window.mail.onMessagesRepainted&&(onDOMReady(En),window.mail.onMessagesRepainted(En)),window.AudioMessagePlayer={loaded:!0,events:new EventEmitter,togglePlay:function(e,t){var n=On(),i=n.attachTo(e);!0===i?n.play():i.then(function(){n.play()})},detachPlayer:function(e){On().detach(e)},pauseGlobalMedia:function(){gn.pauseGlobalMedia()},resumeGlobalMedia:function(){gn.resumeGlobalMedia()},redrawWaves:En,getWave:Sn};n("G0UO"),n("Mc5h"),n("O5lf");var Tn=n("9y81"),Dn=(n("AXyT"),n("gy8s"),n("KMpi"),n("AgBx"),{_onCloseClick:function(e){e.stopPropagation(),e.preventDefault(),remove(geByClass1(Dn.class.btn))},class:{btn:"FloatBtn"}});Dn.class=Object(Ke.default)({},Dn.class,{open:Dn.class.btn+"_open"});var jn=Dn;window.Pad={addContent:function(e,t){t&&Object(v.$$)(In.pad(e)).forEach(function(e){var n=e.$(In.content)||e;e.classList.remove(Mn.empty),n.insertAdjacentHTML("beforeend",t)})}};var In={pad:function(e){return'.Pad[data-id="'+e+'"]'},content:".Pad__content"},Mn={empty:"Pad_empty"};var xn=n("29dZ"),Bn=Object(i.need)("scrollToEl");Object(i.need)("page").onChange(Ln);var Pn={anchorByHash:function(e){return".Anchor#"+e}};function Ln(e){if(e){var t=e.split("#")[1],n=t&&!~t.indexOf("=")&&Object(v.$)(Pn.anchorByHash(t));n&&Bn(n)}}window.Select={},Select._onChange=Nn;var Rn={optionByValue:function(e){return'.Select__option[value="'+e+'"]'}};function Nn(e,t){var n=e.value,i=e.$(Rn.optionByValue(n));s.default.handle(t,{$select:e,$option:i,value:n,name:e.name,label:i.textContent})}var Fn={setChecked:function(e,t){void 0===t&&(t=!0);$n(e).checked=t},isChecked:function(e){return $n(e).checked}},Hn=Fn;Fn._onChange=Vn;var Un={control:".Control",native:".Control__native"};function Vn(e,t){s.default.handle(t,{$control:e.closest(Un.control),name:e.name,checked:e.checked,value:e.value})}function $n(e){return e.$(Un.native)}var qn=Hn;window.Control=Hn;n("DG1x");var Wn=function(e){return{class:["Slider",e.class||e.mix],inner:{class:["Slider__scroll","_preventMenuOpen"],attrs:e.attrs,onwheel:["Slider._onWheel","event","this"],inner:{class:"Slider__line",inner:e.inner}}}},zn=need("page"),Qn=need("onDOMReady");window.Slider={scrollToElem:Xn},Slider._onWheel=Gn,(d.default.ios||d.default.msie_edge)&&(Qn(Jn),zn.onChange(Jn),window.MutationObserver&&Qn(function(){document.body&&new MutationObserver(Kn).observe(document.body,{subtree:!0,childList:!0})}));var Yn={slider:".Slider",scroll:".Slider__scroll"};function Xn(e){var t=e.closest(Yn.scroll);t.scrollLeft=e.offsetLeft-t.offsetWidth/2+e.offsetWidth/2}function Gn(e,t){var n=e.deltaX,i=e.deltaY;Math.abs(n)>Math.abs(i)&&(e.preventDefault(),t.scrollLeft+=n)}function Kn(e){e.forEach(function(e){e.addedNodes.forEach(function(e){e.nodeType===Node.ELEMENT_NODE&&e.$$(Yn.slider).forEach(Zn)})})}function Jn(){Object(v.$$)(Yn.slider).forEach(Zn)}function Zn(e){var t=getComputedStyle(e),n=Number(t.paddingTop.replace("px","")),i=Number(t.paddingBottom.replace("px",""));e.style.overflow="hidden",e.style.height=e.offsetHeight-n-i+"px",e.$(Yn.scroll).style.paddingBottom="20px"}var ei=Wn;window.Slider=Wn,extend(Wn,{scrollToElem:Xn,_onWheel:Gn}),window.SliderTabs={},SliderTabs._onClick=ci,onDOMReady(li),page.onChange(oi),page.onRestore(ri);var ti={container:"SliderTabs",scroll:"Slider__scroll",active:"SliderTabs__tab_selected"},ni={active:".SliderTabs__tab_selected",tab:".SliderTabs__tab",scroll:"."+ti.scroll,container:"."+ti.container},ii="",ai=0;function oi(){var e=ge(ii),t=$(ni.container);if(e){var n=$(ni.scroll,e),a=$(ni.active,e);n.scrollLeft=ai;var o=Object(i.getX)(a);if(ai>o){n.scrollLeft=o-16}}else t?si():(ii="",ai=0)}function ri(){setTimeout(function(){var e=ge(ii);if(e){var t=Array.from($$(ni.tab,e));if(t)t.some(function(e){return e.getAttribute("href")===nav.cur})&&t.forEach(function(e){e.getAttribute("href")===nav.cur?e.classList.add(ti.active):e.classList.remove(ti.active)})}})}function si(){var e=$$(ni.container),t=Math.min(Object(i.getCw)(),882);e.forEach(function(e){var n=$(ni.scroll,e),a=$(ni.active,e);if(a){var o=a.offsetWidth,r=Object(i.getX)(a);r+o>t&&(n.scrollLeft=r-t+o)}})}function li(){si()}function ci(e,t){var n=Object(i.gpeByClass)(ti.container,t),a=Object(i.gpeByClass)(ti.scroll,t),o=$(ni.active,n);return o&&o.classList.remove(ti.active),t.classList.add(ti.active),ai=a.scrollLeft,ii=attr(n,"id"),!0}window.SearchPanel={setQuery:function(e,t){var n=Object(v.$)(di.inputById(e));t=t||"",n.value!==t&&(n.value=t,hi(n,t))}},SearchPanel._onInput=_i,SearchPanel._onClearClick=pi,SearchPanel._onFocus=fi;var ui={hasQuery:"SearchPanel_hasQuery"},di={searchPanel:".SearchPanel",input:".SearchPanel__input",inputById:function(e){return'.SearchPanel[data-id="'+e+'"] .SearchPanel__input'}};function fi(){}function _i(e,t){var n=e.value;hi(e,n),s.default.handle(t,{query:n})}function pi(e){var t=e.closest(di.searchPanel).$(di.input);t.value="",t.oninput()}function hi(e,t){e.closest(di.searchPanel).classList.toggle(ui.hasQuery,!!t)}window.TabRow={setSelectedTab:function(e,t){var n=Object(v.$)(Ai.tabRowById(e)),i=Object(v.$)(Ai.tabSelected,n),a=Object(v.$)(Ai.tabById(t),n);i&&i.classList.remove(mi.selected),a&&a.classList.add(mi.selected)},setTabUrl:function(e,t,n){var i=Object(v.$)(Ai.tabRowById(e)),a=Object(v.$)(Ai.tabById(t),i);a&&a.setAttribute("href",n)}};var mi={selected:"TabRow__tab_selected"},Ai={tabRowById:function(e){return'.TabRow[data-id="'+e+'"]'},tabById:function(e){return'.TabRow__tab[data-id="'+e+'"]'},tabSelected:".TabRow__tab_selected"};window.SwitcherConfirm={},SwitcherConfirm._onSwitcherChange=bi,SwitcherConfirm._onConfirmClick=yi,SwitcherConfirm._onCancelClick=function(e){return wi(e.$btn)},SwitcherConfirm._onPopupOverlayClick=function(e){return wi(e.$popup)};var vi={checked:function(e){return"SwitcherConfirm_checked_"+(e?"yes":"no")}},gi={switcher:".SwitcherConfirm",popup:".SwitcherConfirm__popup",confirm:".SwitcherConfirm__confirm",cancel:".SwitcherConfirm__cancel"};function bi(e){var t=e.$control,n=t.closest(gi.switcher),i=Object(v.$)(gi.popup,n);Pe.default.open(i),n.$popup=i,n.$control=t,n.checked=e.checked}function yi(e,t){var n=t.$btn.closest(gi.switcher),i=Object(v.$)(gi.confirm,n),a=Object(v.$)(gi.cancel,n),o=n.checked;n.isSaving=!0,xn.default.setLoading(i,!0),xn.default.setDisabled(a,!0),Wd.handle(e,{checked:o,onSuccess:function(){n.isSaving=!1,Pe.default.close(n.$popup),xn.default.setLoading(i,!1),xn.default.setDisabled(a,!1),n.classList.toggle(vi.checked(!0),o),n.classList.toggle(vi.checked(!1),!o)}})}function wi(e){var t=e.closest(gi.switcher);t.isSaving||(qn.setChecked(t.$control,!t.checked),Pe.default.close(t.$popup))}var Ci=function(e){var t=e.img?e.img:"",n=!!e.url&&e.url,i=e.title?e.title:"",a=e.subtitle?e.subtitle:"",r=e.verified?e.verified:"",s=e.mix?e.mix:"",l=e.online?e.online:"",c=!!e.actions&&e.actions,u=!!e.attrs&&e.attrs,d=!!e.linkAttrs&&e.linkAttrs;return{attrs:u,class:[o.default.class("OwnerRow",{actions:!!c}),s],inner:[{class:"OwnerRow__content al_artist",href:n,attrs:d,inner:[{class:"OwnerRow__left",inner:{style:t?"background-image: url('"+t+"')":null,class:"OwnerRow__img",inner:l?{class:o.default.class("OwnerRow__online",l)}:null}},{class:"OwnerRow__right",inner:[{class:o.default.class("OwnerRow__header",{verified:r}),inner:[{class:"OwnerRow__title",inner:i},r?{class:"OwnerRow__verified"}:null]},{class:"OwnerRow__subtitle",inner:a}]}]},c?{class:"OwnerRow__actions",inner:c}:null]}};var ki=Ci;window.OwnerRow=Ci;n("QQoL"),n("rKUZ");var Si=Object(i.need)("ajax"),Ei=Object(i.need)("onDOMReady"),Oi=Object(i.need)("onBodyResize");window.CookiePolicy={},Ei(Di),CookiePolicy._onHideClick=Ii;var Ti={body:"body",fixedHeader:"._hfixed",cookiePolicy:".CookiePolicy"};function Di(){Object(v.$)(Ti.cookiePolicy)&&(ji(),Oi(ji))}function ji(){if(Object(v.$)(Ti.fixedHeader)){var e=Object(v.$)(Ti.body),t=Object(v.$)(Ti.cookiePolicy).offsetHeight,n=parseInt(getComputedStyle(e).paddingBottom,10);e.style.paddingBottom=n+t+7+"px"}}function Ii(e,t){e.preventDefault();var n=t.getAttribute("href");t.closest(Ti.cookiePolicy).style.display="none",Oi("__clear",ji),Si.post(n,{_ajax:1})}var Mi=Object(i.need)("Btn");window.PrivacyPolicy={},PrivacyPolicy._onAcceptToggle=Bi;var xi={submit:".PrivacyPolicy__submit"};function Bi(e){var t=e.checked,n=Object(v.$)(xi.submit);Mi.setDisabled(n,!t)}onDOMReady(function(){addEvent(window,"click",function(e){if(Object(v.$$)(".Tooltip").forEach(function(e){return re(e)}),e.target&&e.target.classList.contains("Tooltip")||e.target.closest(".Tooltip")){var t=e.target.getAttribute("tooltip-id");ajax.post("/?act=tooltip_click&id="+t)}})});n("Qg0H");var Pi=function(e){var t=e.bcg,n=t.type;return{class:o.default.class("VotingBcg",{type:n}),style:"photo"===n?Li(t):"gradient"===n?Ri(t):"tile"===n?Ni(t):null,inner:"photo"===n?Fi(e):null}};function Li(e){return Hi({"background-color":e.color})}function Ri(e){var t,n=[],i=e.points.length;for(t=0;t<i;t++){var a=e.points[t];n.push(a.color+" "+a.percent+"%")}return Hi({background:"linear-gradient("+(e.angle-90)+"deg, "+(n=n.join(", "))+")"})}function Ni(e){return Hi({"background-image":"url('"+e.image+"')","background-position":"top center","background-size":e.width+"px "+e.height+"px"})}function Fi(e){var t=e.bcg,n=t.photo,i=t.color;return{class:"VotingBcg__photoBox",style:Hi({height:e.photoHeight+"px"}),inner:[{class:"VotingBcg__photoImage",style:Hi({"background-image":"url('"+n+"')"})},{class:"VotingBcg__photoGradient",style:Hi({background:"linear-gradient(to bottom, rgba(255, 255, 255, 0), "+i+")"})}]}}function Hi(e){var t,n=[],i=Object.keys(e),a=i.length;for(t=0;t<a;t++){var o=i[t],r=e[o];n.push(o+": "+r+";")}return n.join(" ")}var Ui=Pi;window.VotingBcg=Pi;var Vi=function(e,t){return{tag:"label",class:o.default.class("VotingForm__bcg",{light:"default"===t.type}),inner:[{class:"VotingForm__bcgPreview",inner:[Ui({bcg:t,photoHeight:48}),{class:o.default.class("VotingForm__bcgTextGhost",{0:!0})},{class:o.default.class("VotingForm__bcgTextGhost",{1:!0})},{class:o.default.class("VotingForm__bcgTextGhost",{2:!0})},{class:o.default.class("VotingForm__bcgTextGhost",{3:!0})},{class:o.default.class("VotingForm__bcgTextGhost",{4:!0})},{class:o.default.class("VotingForm__bcgTextGhost",{5:!0})}]},{tag:"input",class:"VotingForm__bcgRadio",type:"radio",name:e,checked:t.checked?"checked":null,value:t.id},{class:"VotingForm__bcgControl"}]}};var $i=function(e){return{class:"VotingForm__option","data-created":e.is_created?"1":"0",inner:[Object(Qt.default)({class:"VotingForm__optionInput",name:e.name,value:e.value,on_key_down:"VotingForm._onOptionKeyDown"}),{class:"VotingForm__optionRemove",onclick:["VotingForm._onOptionRemoveClick","this"],inner:s.default.wrap(Object(Tn.default)({icon:"close16"}))}]}};var qi=Object(i.need)("Slider");window.VotingForm={},VotingForm._onInit=Zi,VotingForm._onAddOptionClick=Ji,VotingForm._onExpireChange=ta,VotingForm._onOptionRemoveClick=na,VotingForm._onTitleKeyDown=Xi,VotingForm._onTitleInput=Gi,VotingForm._onOptionKeyDown=Ki,mediaUpload.onComplete(oa),mediaUpload.onStart(ra),mediaUpload.onError(sa);var Wi={uploading:"VotingForm_uploading",withExpire:"VotingForm_withExpire",maxOptions:"VotingForm_maxOptions"},zi={form:".VotingForm",maxOptions:".VotingForm_maxOptions",option:".VotingForm__option",options:".VotingForm__options",upload:".VotingForm__upload",bcg:".VotingForm__bcg",bcgRadioChecked:".VotingForm__bcgRadio:checked"},Qi=13,Yi=8;function Xi(e){e.keyCode===Qi&&e.preventDefault()}function Gi(e){var t=+attr(e,"maxlength"),n=Object(v.$)(".VotingForm__count");t-e.value.length<=20?n.innerHTML=e.value.length+"/"+t:n.innerHTML=""}function Ki(e){if(Xi(e),e.keyCode===Qi){if(!Object(v.$)(zi.maxOptions))if(Object(v.$)(".VotingForm__option:last-child input")===document.activeElement)return ea(),void Object(v.$)(".VotingForm__option:last-child input").focus();if(document.activeElement){var t=document.activeElement.closest(".VotingForm__option"),n=t.nextElementSibling&&t.nextElementSibling.$("input");n&&(n.focus(),n.selectionStart=n.value.length,n.selectionEnd=n.value.length)}}else if(e.keyCode===Yi){if(1===Object(v.$$)(".VotingForm__option").length)return;var i=e.target;i.value||setTimeout(function(){var e=i.closest(".VotingForm__option"),t=e.previousElementSibling;if(e.outerHTML="",aa(),t){var n=t.$("input");n.focus(),n.selectionStart=n.value.length,n.selectionEnd=n.value.length}})}}function Ji(){ea(),Object(v.$)(".VotingForm__option:last-child input").focus()}function Zi(){var e=Object(v.$)(zi.bcgRadioChecked).closest(zi.bcg);qi.scrollToElem(e)}function ea(){var e=Object(v.$)(zi.options),t=$i({});e.insertAdjacentHTML("beforeend",Wd.html(t)),ia(),aa()}function ta(e){var t=e.$control,n=e.checked;t.closest(zi.form).classList.toggle(Wi.withExpire,n)}function na(e){e.closest(zi.option).outerHTML="",ia(),aa()}function ia(){Array.from(Object(v.$$)('.VotingForm__option[data-created="0"] input')).forEach(function(e,t){e.setAttribute("name","answers["+t+"]")})}function aa(){var e=Object(v.$)(zi.form),t=Number(e.getAttribute("data-max-options")),n=Object(v.$$)(zi.option).length;e.classList.toggle(Wi.maxOptions,n===t)}function oa(e){if(Object(v.$)(zi.form)){var t=Object(v.$)(zi.upload),n=Wd.html(Vi("poll_background_id",{id:"photo_"+e.photo_id,type:"photo",photo:e.src,color:e.color,checked:!0}));t.insertAdjacentHTML("beforebegin",n),la()}}function ra(){var e=Object(v.$)(zi.upload);e&&e.classList.add(Wi.uploading)}function sa(e){var t=Object(v.$)(zi.form);if(t){var n=t.getAttribute("data-upload-error-msg");la(),alert(n)}}function la(){var e=Object(v.$)(zi.form);Object(v.$)(zi.upload).outerHTML=e.getAttribute("data-upload-html")}window.VotingStatsFilters={},VotingStatsFilters._onCountryChange=ua;var ca={countrySection:".VotingStatsFilters__section_country",citySection:".VotingStatsFilters__section_city"};function ua(e){var t=e.$option,n=Object(v.$)(ca.countrySection),i=Object(v.$)(ca.citySection),a=t.getAttribute("data-city-section-html");i&&(i.outerHTML=""),a&&n.insertAdjacentHTML("afterend",a)}var da=window.Popup,fa=window.Btn;window.AuthCheck={},AuthCheck._onDropConfirmationClick=ha,AuthCheck._onResetSessionSubmit=ma,AuthCheck._onCurBrowserDropClick=Aa;var _a={popupByIndex:function(e){return".AuthCheck__popup_index_"+e},dropConfirmation:function(e){return'.AuthCheck__dropConfirmation[data-index="'+e+'"]'},dropConfirmationSubmit:".AuthCheck__dropConfirmationSubmit"},pa={dropConfirmationSuccess:"AuthCheck__dropConfirmation_success"};function ha(e){var t=Object(v.$)(_a.popupByIndex(e));da.open(t)}function ma(e,t){e.preventDefault();var n=e.target,i=Object(v.$)('iframe[name="'+e.target.target+'"]'),a=n.$(_a.dropConfirmationSubmit);n.submit(),fa.setLoading(a,!0),addEvent(i,"load",function(){Object(v.$)(_a.dropConfirmation(t)).classList.toggle(pa.dropConfirmationSuccess),da.close(),fa.setLoading(a,!1)})}function Aa(e){var t=e.$btn;fa.setLoading(t,!0),ajax.click(t,{onDone:function(){Object(v.$)(_a.dropConfirmation("0")).classList.toggle(pa.dropConfirmationSuccess),da.close(),fa.setLoading(t,!1)}})}function va(){var e=Object(v.$)(ga.intro),t=new Scroller(e,{byPage:!0,ignoreMouseWheel:!0,noAutoScroll:!0});t.init(),cur.destroy.push(function(){return t.destroy()})}window.AppPasswords=new function(){this.showPopup=function(){return Popup.open(Object(v.$)(".AppPasswordsPopup"))},this.hidePopup=function(){return Popup.close(Object(v.$)(".AppPasswordsPopup"))}},window.AuthCheckIntro={},AuthCheckIntro._onMount=va;var ga={intro:".AuthCheckIntro"};function ba(){Object(v.$)(ya.self).classList.toggle(wa.restCodesShown)}window.ReservedCodes={},ReservedCodes._onShowRestCodesClick=ba;var ya={self:".ReservedCodes"},wa={restCodesShown:"ReservedCodes_restCodesShown"};window.Settings={_privacy:{}},Settings._privacy.onRadioChange=Sa;var Ca={pad:function(e){return'.Settings__privacyPad[data-privacy="'+e+'"]'},submit:".Settings__privacySubmitRow",form:".Settings__privacyForm",forbid:".Settings__privacySelectForbiddenLink"},ka={padVisible:"Settings__privacyPad_visible",submitVisible:"Settings__privacySubmitRow_visible"};function Sa(e,t){if("none"===e)Ea("allowed",!1),Ea("forbidden",!1),Oa(!0);else if("allowed"===e)Ea("allowed",!0),Ea("forbidden",!1),Oa(!1);else if("forbidden"===e){Ea("allowed",!1),Ea("forbidden",!0),Oa(!0);var n=Object(v.$)(Ca.form),i=Object(v.$)(Ca.forbid),a=t.name,o=t.value,r=n.getAttribute("action")+"&"+a+"="+o+"&forbid";i.setAttribute("href",r)}}function Ea(e,t){Object(v.$)(Ca.pad(e)).classList.toggle(ka.padVisible,t)}function Oa(e){Object(v.$)(Ca.submit).classList.toggle(ka.submitVisible,e)}window.SettingsMenu={onClick:function(e,t){return void 0===t&&(t=!1),Object(i.statlogsValueEvent)("settings_menu_click",e),t?A.default.hard_go(e):A.default.go(e),!1}},window.LovinaPromotion={click:function(e,t){var n=t?e?"https://trk.mail.ru/c/e3goc2":"https://trk.mail.ru/c/levhn2":"https://trk.mail.ru/c/i01uk8";Object(i.statlogsValueEvent)("lovina_promotion",t?1:0),window.nav.hard_go(n)}},window.AudioSerp={setView:function(e){return ja("view",e)},setTab:function(e){return ja("tab",e)},toggleTabs:function(e){Object(v.$)(Da.serp).classList.toggle(Ta.noTabs,!e)},setFoundHtml:function(e){Object(v.$)(Da.found).outerHTML=e},getFoundHtml:function(){return Object(v.$)(Da.found).outerHTML}};var Ta={serpMod:function(e){return"AudioSerp_"+e},noTabs:"AudioSerp_noTabs"},Da={serp:".AudioSerp",found:".AudioSerp__found"};function ja(e,t){var n=Object(v.$)(Da.serp);o.default.setMod(n,Ta.serpMod(e),t)}window.AudioSpecialForYou={selector:".AudioSpecialForYou",setPlaying:function(e){var t=Object(v.$)(Ia.special);t&&t.classList.toggle(Ma.playing,e)}};var Ia={special:window.AudioSpecialForYou.selector},Ma={playing:"AudioSpecialForYou_playing"};var xa=n("j80l"),Ba=function(){function e(e){this.store=Stories.getStore(),this.data=e,this.raw_id=e.raw_id,this.can_remove=e.can_remove,this.can_report=e.can_report,this.can_bookmark=e.can_bookmark,this.is_bookmarked=e.is_bookmarked,this.is_narrative=!!e.narrative}var t=e.prototype;return t.needMenu=function(){return this.can_remove||this.can_report},t.render=function(){var e=window.lang;return s.default.html({class:"StoryMenu",inner:[{class:"StoryMenu__trigger",onclick:"Stories.showMenu();",inner:{class:"Story__icon Story__icon_menu"}},{class:"StoryMenu__container",inner:[this.can_bookmark?{class:"StoryMenu__row",inner:{class:"StoryMenu__button",onclick:"Stories.toggleBookmark(this);",inner:this.is_bookmarked?e.mobile_stories_menu_bookmarked_title:e.mobile_stories_menu_bookmark_title}}:null,this.can_remove?{class:"StoryMenu__row",inner:{class:"StoryMenu__button",onclick:"Stories.removeCurrentStory();",inner:this.is_narrative?e.mobile_stories_menu_remove_narrative_title:e.mobile_stories_menu_remove_title}}:null,this.can_report?{class:"StoryMenu__row",inner:{class:"StoryMenu__button",onclick:'Stories.reportCurrentStory("'+this.raw_id+'");',inner:e.mobile_stories_menu_report_title}}:null]}]})},e}(),Pa=function(){function e(e,t,n,i){if(this.store=Stories.getStore(),this.state={authorIndex:n,storyIndex:i},this.date=e.date,this.preview=e.preview_url,this.type=e.type,this.photo_url=e.photo_url,this.video_url=e.video_url,this.first_frame=e.first_frame,this.videoSupport=!!window.HTMLVideoElement,this.views=e.views,this.answers=e.answers,this.link=e.link,this.unread=e.unread,this.raw_id=e.raw_id,this.is_expired=e.is_expired,this.isAds=e.isAds,this.isPromo=e.isPromo,this.promoCaption=e.promoCaption,this.track_code=e.track_code,this.can_comment=e.can_comment,this.can_share=e.can_share,this.can_remove=e.can_remove,this.can_report=!e.can_manage,this.can_ask=e.can_ask,this.can_ask_anonymous=e.can_ask_anonymous,this.isNewQuestions=e.isNewQuestions,this.name=t.name,this.authorId=t.id,this.showPin=t.showPin,this.isOwnerPinned=t.isOwnerPinned,this.firstName=t.firstName,this.avatar=t.photo,this.href=t.href,this.prometheus=t.verify.includes("page_top_author"),this.verified=t.verify.includes("page_verified"),this.authorIcon=this.prometheus||this.verified,this.content=null,this.paused=!0,this.stats=e.stats,this.narrative=e.narrative,this.isNarrativeSlide=this.narrative&&!this.narrative.is_cover,this.isNarrativeMetaStory=!!e.isNarrativeMetaStory,this.isMetaStory=!!e.is_groups_meta_story,this.isOpenNarrativeFromFeed=!!e.isOpenNarrativeFromFeed,this.onAutoPlay=Object(r.default)(),this.onDestroy=Object(r.default)(),this.onVideoBuffering=Object(r.default)(),this.onVideoData=Object(r.default)(),this.onVideoPlayEvent=Object(r.default)(),this.onVideoPauseEvent=Object(r.default)(),this.onVideoEndedEvent=Object(r.default)(),this.reply=e.reply_to,this.reply){var a=this.reply.list;this.reply=extend(this.reply,{onclick:'Stories.openReplies("'+a+'");'})}this.duration=8e3,this.views&&(this.viewsText=this.views),this.answers&&(this.answersText=this.answers.count),this.bookmark_add_hash=e.bookmark_add_hash,this.is_bookmarked=e.is_bookmarked,this.clickable_stickers=e.clickable_stickers,this.stickers=[],this.narrative&&(this.bookmark_add_hash=this.narrative.bookmark_hash,this.is_bookmarked=this.narrative.is_bookmarked),this.StoryMenu=new Ba(extend(e,{can_report:this.can_report,can_bookmark:!!this.bookmark_add_hash,is_bookmarked:this.is_bookmarked})),this.needMenu=this.StoryMenu.needMenu(),this.storyMenuHTML=this.StoryMenu.render()}var t=e.prototype;return t.update=function(e){var t=Stories.getCurrentStoryIndex(),n=Stories.getCurrentAuthorIndex();this.state.authorIndex===n&&this.state.storyIndex===t?(this.loadContent(e),Stories.setHistory(this.raw_id)):(this.destroy(),val(e,""))},t.getDuration=function(){return this.duration},t.getPreview=function(){return this.preview},t.hasLink=function(){return!!this.link},t.getLinkUrl=function(){var e=this.link.url,t=Stories.getFrom(!1);return xa.default.make(e,{from:t})},t.loadContent=function(e){var t=window.lang;if(this.is_expired){Stories.hideLoading();var n={class:"Story__content_expired",inner:s.default.wrap(t.mobile_stories_error_expired)};val(e,s.default.html(n)),Stories.restoreAudio()}else if("photo"===this.type){this.isNarrativeMetaStory||this.isMetaStory||Stories.showLoading(),this.img=new Image,this.onLoadImgBind=this.onLoadImg.bind(this),this.onLoadStory=this.onLoadStory.bind(this),addEvent(this.img,"load",this.onLoadImgBind),addEvent(this.img,"load",this.onLoadStory),this.img.src=this.photo_url;var i={style:"background-image: url("+this.photo_url+")",class:"Story__content_image"};this.narrative&&this.narrative.is_cover?val(e,s.default.html(this.renderNarrativeCover())):this.isNarrativeMetaStory?(val(e,""),e&&e.parentNode.insertAdjacentHTML("beforeend",s.default.html(this.renderNarrativeMetaStory())),addEvent(geByClass1("MetaStory__recommendations"),"scroll wheel touchmove",this.handleRecommendationsScroll.bind(this))):this.isMetaStory?(val(e,""),e&&e.parentNode.insertAdjacentHTML("beforeend",s.default.html(this.renderGroupsMetaStory())),addEvent(geByClass1("MetaStory__recommendations-inner"),"scroll touchmove",this.handleRecommendationsScroll.bind(this)),Stories.hideLoading()):val(e,s.default.html(i)),Stories.restoreAudio()}else if("video"===this.type)if(this.videoSupport&&Stories.isAutoplaySupport())Stories.showLoading(),this.video=ce("video",{src:this.video_url,className:"Story__content_video"}),attr(this.video,"autoplay","autoplay"),attr(this.video,"playsinline","playsinline"),attr(this.video,"webkit-playsinline","webkit-playsinline"),attr(this.video,"muted","muted"),this.onCanPlayBind=this.onCanPlay.bind(this),this.onVideoWaitingBind=this.onVideoBuffer.bind(this),this.onVideoLoadedDataBind=this.onVideoLoadedData.bind(this),this.onVideoPlayBind=this.onVideoPlay.bind(this),this.onVideoPauseBind=this.onVideoPause.bind(this),this.onVideoEndedBind=this.onVideoEnded.bind(this),this.onLoadStory=this.onLoadStory.bind(this),addEvent(this.video,"ended",this.onVideoEndedBind),addEvent(this.video,"play",this.onVideoPlayBind),addEvent(this.video,"pause",this.onVideoPauseBind),addEvent(this.video,"canplaythrough",this.onCanPlayBind),addEvent(this.video,"waiting",this.onVideoWaitingBind),addEvent(this.video,"loadedmetadata",this.onVideoLoadedDataBind),addEvent(this.video,"canplaythrough",this.onLoadStory),append(this.video,e),Stories.restoreAudio(),Stories.pauseAudio();else{var a=Stories.getAuthorElems()[this.state.authorIndex];this.renderError(a,e,t.mobile_stories_inline_video_error)}this.isMetaStory||this.markSeen()},t.onLoadStory=function(){if(this.clickable_stickers){var e=geByClass1("Story",this.authorElem);e&&this.renderStickersLayer.call(this,e)}if(this._loadingStartTime){this.loadingTime=Date.now()-this._loadingStartTime,Stories._sendViewerStartTime(this.raw_id,this.loadingTime),this._loadingStartTime=0;var t=this.isMetaStory?"group_feed_view":"view_story";Stories.sendAnalyticsEvent(t,{preloading_duration:this.loadingTime})}},t.markSeen=function(){var e=this.raw_id;this.track_code&&(e+="_"+this.track_code),this.store.readedStories[e]=!0,this.store.authors[this.state.authorIndex].items[this.state.storyIndex].unread=!1},t.pause=function(){this.paused||(this.paused=!0,this.video&&this.video.pause())},t.play=function(){this.paused&&(this.paused=!1,this.video&&this.video.play())},t.onVideoEnded=function(){this.onVideoEndedEvent()},t.onVideoPlay=function(){this.onVideoPlayEvent()},t.onVideoPause=function(){this.onVideoPauseEvent()},t.onLoadImg=function(){Stories.hideLoading(),this.onVideoData({paused:this.paused,authorIndex:this.state.authorIndex,storyIndex:this.state.storyIndex})},t.onVideoBuffer=function(){this.onVideoBuffering()},t.onVideoLoadedData=function(){if(0===this.video.duration){this.duration=16e3}else this.duration=1e3*this.video.duration+100;this.onVideoData({paused:this.paused,authorIndex:this.state.authorIndex,storyIndex:this.state.storyIndex})},t.onCanPlay=function(){Stories.hideLoading(),this.onAutoPlay({paused:this.paused,authorIndex:this.state.authorIndex,storyIndex:this.state.storyIndex}),this.store.isStopped&&this.video.pause()},t.getType=function(){return this.type},t.getVideoState=function(){return this.video?this.video.readyState:0},t.getVideo=function(){if(this.video)return this.video},t.renderError=function(e,t,n){var i=this,a={class:"Story__content_expired",inner:s.default.wrap(n)};val(t,s.default.html(a)),Stories.hideLoading(),this.type="broken",addClass(e,Na),requestAnimationFrame(function(){i.onVideoData({paused:i.paused,authorIndex:i.state.authorIndex,storyIndex:i.state.storyIndex})})},t.hasSticker=function(e){var t=(this.clickable_stickers||{}).stickers;return!(!t||!isArray(t))&&t.some(function(t){return t.type===e})},t.render=function(){var e,t,n=window,i=n.lang,a=n.winToUtf;addEvent(window,"resize",this._onResizeHandle.bind(this));var o=d.isTouch?"ontouchstart":"onmousedown",r=d.isTouch?"ontouchend":"onmouseup";this._onLoadingStart();var l=this.hasSticker(Fa.storyReply);return s.default.html({class:"Story",inner:[{class:"Story__header",inner:[this.reply&&!l?{class:"Story__reply",inner:this.reply.is_deleted||this.reply.is_private||this.reply.is_expired?{class:"Story__replyDeleted",inner:{class:"Story__replyDeletedContainer",inner:[{class:Bem.class("Story__icon",{deleted:this.reply.is_deleted,private:this.reply.is_private||this.reply.is_expired})},{class:"Story__replyDeletedTitle",inner:this.reply.is_deleted?i.mobile_stories_reply_deleted_title:this.reply.is_expired?i.mobile_stories_reply_expired_title:i.mobile_stories_reply_private_title}]}}:{class:"Story__replyPreview",onclick:this.reply.onclick,style:"background-image: url("+this.reply.photo_url+")",inner:{class:"Story__replyTitle",inner:a(this.reply.name)}}}:null,{class:"Story__table",inner:[this.isMetaStory?{tag:"div",onclick:"Stories.openGroupsSettings();",class:"Story__settings"}:{class:"Story__cell Story__cell_header",inner:[{class:"Story__table Story__link al_empty",href:this.href,onclick:"return Stories.clickAuthor();","data-skiponclick":1,inner:[this.isNarrativeSlide?null:{class:"Story__cell Story__cell_avatar",inner:{class:"Story__avatar",src:this.avatar,tag:"img"}},{class:"Story__cell Story__cell_title",inner:[{class:"Story__title",inner:[{class:"Story__name",inner:this.isNarrativeSlide?a(this.narrative.title):a(this.name)},this.authorIcon?{class:"Story__verified",inner:{class:Bem.class("Story__icon",{verified:this.verified,prometheus:this.prometheus})}}:null]},this.isNarrativeSlide?{class:"Story__date",inner:this.name+"  "+i.global_type_narrative}:{class:"Story__date",inner:this.isPromo?this.promoCaption:this.isAds?i.mobile_stories_is_promo_title:this.date}]}]}]},!this.isMetaStory&&this.authorId<0&&this.showPin?{class:"Story__cell",inner:{tag:"span",onclick:'Stories.togglePin(this, "'+this.authorId+'")',class:Bem.class("Story__pinBtn",{unpin:this.isOwnerPinned},"--"),inner:[{tag:"div",class:"StoriesFeatureTooltip StoriesFeatureTooltip--pin",inner:[i.mobile_stories_groups_tooltip,{tag:"span",class:"StoriesFeatureTooltip__arrow"}]}]}}:null,this.isMetaStory?{class:"Story__cell Story__gridTitle Story__gridTitle--hide",inner:i.mobile_stories_groups_grid_title}:null,{class:"Story__cell"+(this.isMetaStory?"":" Story__cell_close"),onclick:"return Stories.clickClose();",inner:{class:"Story__close"+(this.isMetaStory?" Story__close--grid":""),inner:{class:"Story__icon Story__icon_close"}}}]}]},{class:"Story__footer",inner:this.isNarrativeMetaStory||this.isMetaStory||this.is_expired?null:{class:"Story__table",inner:[this.isNarrativeSlide?null:{class:Bem.class("Story__cell",{empty:!!this.link&&!this.answers&&!this.views,hidden:!this.answers&&!this.views&&!this.link,stats:!0}),inner:this.answers||this.views?{class:Bem.class("Story__stats",{new_questions:this.isNewQuestions}),inner:[this.answers?{class:"Story__replies Story__cell",onclick:'Stories.showViews("'+this.raw_id+'")',inner:[{class:"Story__cell",inner:{class:"Story__icon Story__icon_replies Story__repliesIcon"}},{class:"Story__cell Story__repliesText",inner:this.link?this.answers.count:this.answersText}]}:null,this.views?{class:"Story__views Story__cell",onclick:'Stories.showViews("'+this.raw_id+'")',inner:[{class:"Story__cell",inner:{class:"Story__icon Story__icon_views Story__viewsIcon"}},{class:"Story__cell Story__viewsText",inner:this.link?this.views:this.viewsText}]}:null]}:null},this.link&&this.link.text?{class:"Story__cell Story__cell_moreLink",inner:{class:"Story__moreLink",inner:[{class:"Story__moreLinkText",inner:a(this.link.text)},{class:"Story__icon Story__icon_topArrow"}],href:this.getLinkUrl(),onclick:"Stories.openCustomButton(event, this); return;","data-skiponclick":1}}:this.can_comment?{class:"Story__cell Story__cell_comment",inner:{class:"Story__commentButton",inner:{class:"Story__commentButtonText",inner:i.mobile_stories_comment_placeholder},onclick:"Stories.showComment();"}}:null,this.can_share?{class:"Story__cell Story__cell_share",inner:{class:"Story__share",onclick:'Stories.share("'+(this.narrative?this.narrative.raw_id:this.raw_id)+'", '+!!this.narrative+");",inner:{class:"Story__icon Story__icon_share","data-skiponclick":1}}}:null,this.needMenu?{class:"Story__cell Story__cell_menu",inner:s.default.wrap(this.storyMenuHTML)}:null]}},this.can_comment?{class:"Story__form Story__form_comment",inner:[(e={class:"Story__formOverlay"},e[o]="cancelEvent(event);",e[r]="cancelEvent(event);",e.ontouchmove="cancelEvent(event);",e),{class:"Story__formPopout",ontouchmove:"cancelEvent(event);",onmousedown:"event.stopPropagation();",ontouchend:"event.stopPropagation();",inner:[{class:"Story__formHeader",inner:this.isNarrativeSlide?i.mobile_stories_comment_narrative_title:i.mobile_stories_comment_title},{class:"Story__formBody",inner:{class:"Story__formTextarea Story__commentTextarea",tag:"textarea",placeholder:i.mobile_stories_comment_textarea,oninput:"Stories.onInputComment(this);"}},{class:"Story__formFooter",inner:[{class:"Story__formSend Story__commentSend",onclick:"Stories.sendComment();",inner:i.mobile_stories_comment_ok},{class:"Story__formCancel",inner:i.mobile_stories_comment_cancel,onclick:"Stories.hideComment();"}]}]}]}:null,this.can_ask?this.renderAskForm():null,(t={class:"Story__overlay"},t[o]="cancelEvent(event);",t[r]="cancelEvent(event); Stories.hideMenu();",t.ontouchmove="cancelEvent(event);",t),this.clickable_stickers?{class:"Story__stickers"}:null,{class:"Story__body",style:"background-image: url("+this.preview+")"}]})},t.renderAskForm=function(){var e,t=window.lang,n=d.isTouch?"ontouchstart":"onmousedown",i=d.isTouch?"ontouchend":"onmouseup";return{class:"Story__form Story__form_question",onClick:"Stories.toggleQuestionTooltip(event, true);",inner:[(e={class:"Story__formOverlay"},e[n]="cancelEvent(event);",e[i]="Stories.toggleQuestionTooltip(event, true);",e.ontouchmove="cancelEvent(event);",e),{class:"Story__formPopout",ontouchmove:"cancelEvent(event);",onmousedown:"event.stopPropagation();",ontouchend:"event.stopPropagation();",inner:[{class:"Story__formHeader",inner:{class:"Story__formHeaderInner",inner:[{tag:"button",class:"Btn Btn_theme_none Story__formHeaderBtn Story__questionSelect",inner:t.mobile_stories_ask_question_public,onclick:"Stories.changeAskAnonymous(event);","data-selected":0},{class:"QuestionSupport Icon Icon_menu_support",onclick:"Stories.toggleQuestionTooltip(event);",inner:{class:"QuestionSupport__tooltip"}}]}},{class:"Story__formBody",inner:{class:"Story__formTextarea Story__questionTextarea",tag:"textarea",placeholder:t.mobile_stories_ask_question_placeholder,oninput:"Stories.onInputQuestion(this);",maxlength:80}},{class:"Story__formFooter",inner:[Object(xn.default)({class:"Story__questionSend",theme:"regular",inner:t.mobile_stories_ask_question_ok,on_click:["Stories.sendQuestion"],disabled:!0}),Object(xn.default)({class:"Story__questionSend",theme:"link",inner:t.mobile_stories_ask_question_cancel,on_click:["Stories.hideAskQuestion"]})]}]}]}},t._getStickerStyle=function(e,t){var n=this.clickable_stickers,i=n.original_width,a=n.original_height,o=e.top,r=e.left,s=e.width,l=e.height,c=e.rotate,u=getSize(t),d=u[0],f=u[1],_=d,p=f;return f/d>1.77?_=i*f/a:p=a*d/i,"\n      top: "+(o*p-(p-f)/2)+"px;\n      left: "+(r*_-(_-d)/2)+"px;\n      width: "+s*_+"px;\n      height: "+l*p+"px;\n      transform: rotate("+c+"deg);\n    "},t.renderStickersLayer=function(e){var t=this,n=geByClass1("Story__stickers",e),a=(isObject(this.clickable_stickers)?this.clickable_stickers:{}).stickers;n&&(n.innerHTML=""),a.forEach(function(a){var o,r=a.type,l=a.style,c=void 0===l?"":l;if([Fa.hashtag,Fa.mention,Fa.question,Fa.place,Fa.music,Fa.storyReply,Fa.owner,Fa.link,Fa.marketItem,Fa.post].includes(r)){var u=d.isTouch?"ontouchstart":"onmousedown",f=d.isTouch?"ontouchend":"onmouseup",_=s.default.elem(((o={class:"Story__sticker"})[u]="Stories.onTouchStart(event);",o[f]="Stories.onTouchEnd(event);",o.ontouchcancel="Stories.onTouchEnd(event);",o.style=""+t._getStickerStyle(a,e),o));switch(Object(i.domData)(_,"type",r),Object(i.domData)(_,"style",c),r){case Fa.hashtag:Object(i.domData)(_,"hashtag",a.hashtag);break;case Fa.mention:Object(i.domData)(_,"mention",a.mention);break;case Fa.question:Object(i.domData)(_,"question",a.question);break;case Fa.place:if(t.store.list==="place"+a.placeId)return;Object(i.domData)(_,"place_id",a.placeId);break;case Fa.music:var p=Stories.getCurrentStory(),h=a.audioId,m=a.audioData,A=a.audioRestriction;if(A){var v=t.getVideo();if(v&&p.needMute){var g=Stories.getAuthorElems()[t.state.authorIndex];removeClass(g,Ra),v.muted=!0}n.appendChild(s.default.elem({class:"StoryRestriction",inner:{class:"StoryRestriction__inner",inner:[{class:"StoryRestriction__title",inner:A.title},A.buttonUrl?{class:"StoryRestriction__link",href:A.buttonUrl,inner:A.buttonText}:null]}})),Object(i.domData)(_,"disabled",1)}addClass(_,"audio_item"),addClass(_,"audio_item_"+h),Object(i.domData)(_,"id",h),Object(i.domData)(_,"audio",m);try{Object(i.domData)(_,"track-code",JSON.parse(m).track_code)}catch(e){}_.setAttribute("id","audio"+h);break;case Fa.storyReply:Object(i.domData)(_,"owner-id",a.ownerId),Object(i.domData)(_,"story-id",a.storyId),Object(i.domData)(_,"link",a.link);break;case Fa.owner:Object(i.domData)(_,"owner-id",a.ownerId),Object(i.domData)(_,"link",a.link);break;case Fa.link:Object(i.domData)(_,"link",a.link),Object(i.domData)(_,"tooltip-text",a.tooltipText);break;case Fa.marketItem:Object(i.domData)(_,"photoUrl",a.photoUrl),Object(i.domData)(_,"link",a.link),a.isRestricted&&Object(i.domData)(_,"isRestricted","isRestricted");break;case Fa.post:Object(i.domData)(_,"post-owner-id",a.postOwnerId),Object(i.domData)(_,"post-id",a.postId)}n.appendChild(_),t.stickers.push(_)}})},t._onResizeHandle=function(){var e=this,t=geByClass1("Story",this.authorElem),n=(isObject(this.clickable_stickers)?this.clickable_stickers:{}).stickers;isArray(n)&&n.forEach(function(n,i){e.stickers[i]&&setStyle(e.stickers[i],e._getStickerStyle(n,t))})},t._createStickerLink=function(e){var t=intval(Object(i.domData)(e,"type")),n=intval(Object(i.domData)(e,"disabled"));if(t&&!n){var a,o,r,l="a",c=!0,u=function(){},d={type:t,style:Object(i.domData)(e,"style")};switch(t){case Fa.hashtag:var f=Object(i.domData)(e,"hashtag")||"",_=f.replace("#","%23");a="/feed?section=search&q="+_,o=lang.mobile_stories_show_hashtag_link,r="search",d.text=f;break;case Fa.mention:var p=(Object(i.domData)(e,"mention")||"").slice(1,-1).split("|");a="/"+p[0],o=p[0].startsWith("id")?lang.mobile_stories_go_to_profile:lang.mobile_stories_go_to_group,r="profile";break;case Fa.place:var h=Object(i.domData)(e,"place_id"),m=Stories.getFrom();a="/place"+h,o=lang.mobile_stories_go_to_place,this.store.list.includes("place")?c=!0:(a+="?from="+m,u=function(){l="div",c=!1,Stories._hideTooltips(!0),Stories.showLoading(),nav.go(a)}),r="place";break;case Fa.music:l="div",o=lang.mobile_stories_music_more,u=function(){var t=Object(i.domData)(e,"id"),n=Object(i.domData)(e,"audio");Stories.openMusicStickerActions(t,n)};break;case Fa.storyReply:case Fa.owner:var A=this.reply,v=A.is_expired,g=A.list;if(t===Fa.owner||v)o=Object(i.domData)(e,"owner-id")>0?lang.mobile_stories_go_to_profile:lang.mobile_stories_go_to_group,a=Object(i.domData)(e,"link"),r="profile";else l="div",o=lang.mobile_stories_go_to_story,u=function(){Stories.openReplies(g)};break;case Fa.link:o=Object(i.domData)(e,"tooltip-text"),a=Object(i.domData)(e,"link");break;case Fa.marketItem:var b=Object(i.domData)(e,"photoUrl"),y=!!Object(i.domData)(e,"isRestricted");y&&(u=function(e){e.preventDefault(),window.AlertBox(getLang("mobile_stories_market_access_error_text"),getLang("mobile_stories_market_access_error_title"))}),o=s.default.html([b&&!y?{class:"Stories__marketItemThumb",tag:"img",src:b}:{class:"Stories__marketItemThumb Stories__marketItemThumb--stub",inner:Object(ht.default)("market","item_stub")},{class:"Stories__marketItemText",tag:"span",inner:getLang("mobile_stories_market_item_more")}]),a=Object(i.domData)(e,"link");break;case Fa.post:var w=Object(i.domData)(e,"post-owner-id"),C=Object(i.domData)(e,"post-id");o=lang.mobile_stories_go_to_post,a="/wall"+w+"_"+C}return Stories._requestStickerStat("click",d),Stories.sendAnalyticsEvent("click_on_clickable_sticker"),ce(l,{href:"a"===l?a:null,target:c?"_blank":null,innerHTML:o,className:"Stories__tooltip-link",onclick:function(e){u&&u(e),r&&Stories._requestStickerStat(r,d)}})}},t._onLoadingStart=function(){this._loadingStartTime=new Date},t.renderNarrativeCover=function(){var e=this.photo_url||this.first_frame,t=this.narrative.views?"  "+this.narrative.views:"";return{class:"NarrativeCover",inner:[{style:"background-image: url("+e+")",class:"NarrativeCover__image",onclick:"Stories._showTooltip(event, Stories._createNarrativeTooltipLink());"},{class:"NarrativeCover__views",inner:[{tag:"span",class:"NarrativeCover__label",inner:""+lang.global_type_narrative},{tag:"span",inner:""+t}]},{class:"NarrativeCover__title",innerHTML:""+this.narrative.title},{class:"NarrativeCover__author",inner:""+this.narrative.owner_name}]}},t.renderGroupsMetaStory=function(){var e="groups";window.store.stories[e]||(window.store.stories[e]=Stories._forceSetStore(this.raw_id+"/"+e,e,window.store.storiesLists[e]));var t=window.store.stories[e]&&window.store.stories[e].authors,n=Math.max(document.documentElement.clientHeight,window.innerHeight||0),i=[];return t&&(this.coverItems=t,this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.scrollOffset=0,this.metaStoryGridMarginTop=40.8*n/100,this.coverItems.forEach(function(t){var n=t.items.filter(function(e){return e.unread}),a=!!n.length,o=t.items[0];a&&(o=n[0]);var r={tag:"span",class:"GridStoryPreview",style:"background-image: url("+o.preview_url+")",onclick:'Stories.openNarrative("'+o.raw_id+"/"+e+'")',inner:[{class:"GridStoryPreview__inner",style:"background-image: url("+o.small_preview+")",inner:[{tag:"a",href:t.author.href,attrs:{"data-author-id":t.author.id},class:"GridStoryPreview__author"+(a?" GridStoryPreview__author--unread":""),style:"background-image: url("+t.author.photo+")"},{tag:"span",class:"GridStoryPreview__title",innerHTML:t.author.name}]}]};i.push(r)})),{class:"MetaStory MetaStory--groups",inner:[{class:"MetaStory__infoWrapper",inner:[{class:"MetaStory__info",inner:[{class:"MetaStory__infoTitle",inner:lang.mobile_stories_groups_grid_title},{class:"MetaStory__infoDescription",inner:lang.mobile_stories_groups_grid_text}]}]},i.length?{class:"MetaStory__recommendations",inner:[{class:"MetaStory__recommendations-inner",inner:[{class:"MetaStory__recommendations-items",inner:i}]}]}:null]}},t.renderNarrativeMetaStory=function(){var e=this.store.list+"_recommendations",t=window.store.stories[e]&&window.store.stories[e].authors,n=Math.max(document.documentElement.clientHeight,window.innerHeight||0),i=[];return this.store.list.match(/narrative-?\d+_\d+$/)&&t&&(this.coverItems=t.map(function(e){return e.narrative_cover}),this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.elemOffset=0,1===this.coverRowsCount?this.elemOffset=26.4:this.coverRowsCount>1&&(this.elemOffset=26.4*1.5),this.scrollOffset=n/100*this.elemOffset+53,this.coverItems.forEach(function(n){var a={tag:"span",class:"GridStoryPreview",style:"background-image: url("+n.preview_url+")",onclick:'Stories.openNarrative("'+n.raw_id+"/"+e+'", { narrativeId: '+n.narrative.id+", source: 'narrative_recommendations' })",inner:[{class:"GridStoryPreview__inner",style:"background-image: url("+n.photo_url+")",inner:[{tag:"a",href:t[0].author.href,class:"GridStoryPreview__author",style:"background-image: url("+t[0].author.photo+")"},{tag:"span",class:"GridStoryPreview__title",innerHTML:n.narrative.title}]}]};i.push(a)})),{class:"MetaStory",inner:[{class:"MetaStory__buttons",style:"padding-bottom: "+this.elemOffset+"vh",inner:[{class:"MetaStory__button",onclick:"Stories.narrativeReply();",inner:[{class:"MetaStory__circle MetaStory__circle_replay"},{class:"MetaStory__text",inner:lang.mobile_narratives_repeat_bottom}]},this.isOpenNarrativeFromFeed?{class:"MetaStory__button",onclick:"Stories.narrativeGoToStories();",inner:[{class:"MetaStory__circle MetaStory__circle_back"},{class:"MetaStory__text",inner:lang.mobile_narratives_back_bottom}]}:null]},i.length?{class:"MetaStory__recommendations",inner:[{class:"MetaStory__recommendations-inner",inner:[{class:"MetaStory__recommendations-title",inner:lang.mobile_narratives_more_bottom,style:"margin-top: calc(100vh - "+this.elemOffset+"vh - 70px - 53px)"},{class:"MetaStory__recommendations-items",inner:i}]}]}:null]}},t.handleRecommendationsScroll=function(){event.stopPropagation&&event.stopPropagation(),event.stopImmediatePropagation&&event.stopImmediatePropagation();var e=geByClass1("MetaStory__recommendations"),t=geByClass1("MetaStory__recommendations-inner");if(t&&e){var n=Math.min(t.scrollTop/(this.scrollOffset/100),70)/100;setStyle(e,{backgroundColor:"rgba(0, 0, 0, "+n+")"}),t.scrollTop?(addClass(e,"scroll"),Stories.pauseStory()):(Stories.playStory(),removeClass(e,"scroll")),this.isMetaStory&&(this.blockHeaderEl||(this.blockHeaderEl=geByClass1("Story__gridTitle")),t.scrollTop>this.metaStoryGridMarginTop?removeClass(this.blockHeaderEl,"Story__gridTitle--hide"):addClass(this.blockHeaderEl,"Story__gridTitle--hide"))}},t.pauseAudio=function(){window.Stories.pauseAudio()},t.destroy=function(){this.img&&removeEvent(this.video,"load",this.onLoadImgBind),this.video&&(removeEvent(this.video,"ended",this.onVideoEndedBind),removeEvent(this.video,"play",this.onVideoPlayBind),removeEvent(this.video,"pause",this.onVideoPauseBind),removeEvent(this.video,"canplaythrough",this.onCanPlayBind),removeEvent(this.video,"waiting",this.onVideoWaitingBind),removeEvent(this.video,"loadedmetadata",this.onVideoLoadedDataBind),this.video.src="",this.video.load()),this.onDestroy(),this.onAutoPlay.off(),this.onDestroy.off(),this.onVideoBuffering.off(),this.onVideoData.off(),this.onVideoPlayEvent.off(),this.onVideoPauseEvent.off(),this.onVideoEndedEvent.off(),Stories._hideTooltips()},e}(),La=function(){function e(e,t){var n=Object.assign({},{tick:100,onEnd:function(){},onTick:function(){},onStart:function(){},onPause:function(){},onStop:function(){}},t);this.left=e,this.initialTime=e,this.tick=n.tick,this.onEnd=n.onEnd,this.onTick=n.onTick,this.onStart=n.onStart,this.onPause=n.onPause,this.onStop=n.onStop,this.started=!1}var t=e.prototype;return t.stop=function(e){void 0===e&&(e=!1),this.started&&(this.pause(e),this.left=this.initialTime,e||this.onStop())},t.pause=function(e){void 0===e&&(e=!1),this.timer&&(this.timer=clearInterval(this.timer),this.started=!1,e||this.onPause())},t.start=function(){var e=this;if(this.started)return!1;var t=new Date(Date.now()+this.left).getTime();this.started=!0,this.timer=setInterval(function(){var n=(new Date).getTime();e.left=t-n,e.left<=0?(e.onTick(0),e.onEnd(),e.stop(!0)):e.onTick(e.left)},this.tick),this.onStart()},t.isStarted=function(){return this.started},t.getTimeLeft=function(){return this.left},e}(),Ra="StoryAuthor_videoMuted",Na="StoryAuthor_error",Fa={hashtag:1,mention:2,question:3,place:4,music:5,storyReply:6,owner:7,link:8,marketItem:9,post:10},Ha=function(){function e(e,t){var n=this;this.store=Stories.getStore(),this.data=t,this.state={authorIndex:e};var i=this.getCurrentStoryIndex();this.setCurrentStoryIndex(i),this.story=new Pa(this.data.items[i],this.data.author,e,i),this.authorStoriesHTML=s.default.html(this.story.render()),this.progressItemElems=null,Stories.onRender(function(){n.updateStory()})}var t=e.prototype;return t.getCurrentStory=function(){if(this.story)return this.story},t.destroy=function(){this.story&&this.story.destroy()},t.update=function(){var e=this.data.index;this.destroy(),this.story=new Pa(this.data.items[e],this.data.author,this.state.authorIndex,e),this.authorStoriesHTML=s.default.html(this.story.render())},t.updateHeader=function(){this.authorElems=Stories.getAuthorElems(),this.authorElem=this.authorElems[this.state.authorIndex],this.progressItemElems=Array.from(geByClass("StoryAuthor__progressItem",this.authorElem)),this.drawFilledProgressItems()},t.updateStory=function(){var e=this;this.authorElems=Stories.getAuthorElems(),this.authorElem=this.authorElems[this.state.authorIndex];var t=geByClass1("Story__body",this.authorElem);this.story.update(t),this.story.onVideoData(function(n){n.authorIndex,n.storyIndex;var i=e.story.getDuration(),a=e.story.getType(),o=e.store.isStopped;if(e.countdown=new La(i,{tick:13,onTick:function(t){var n=(100-Math.min(t/i*100,100))/100;e.drawCurrentProgress(n)},onEnd:function(){"video"!==a&&(e.drawCurrentProgress(100),Stories.nextStory(!0),removeClass(e.authorElem,"StoryAuthor_paused"))},onPause:function(){e.story.pause(),addClass(e.authorElem,"StoryAuthor_paused")},onStart:function(){e.story.play(),removeClass(e.authorElem,"StoryAuthor_videoHold"),removeClass(e.authorElem,"StoryAuthor_paused")}}),"photo"!==a&&"broken"!==a||o){if("video"===a){var r=e.story.getVideoState(),s=e.story.getVideo();addClass(t,"Story__body_video"),4!==r||o||s.paused||e.countdown.start()}}else e.countdown.start()}),this.story.onVideoEndedEvent(function(){e.drawCurrentProgress(100),Stories.nextStory(!0)}),this.story.onVideoPauseEvent(function(){e.countdown&&e.countdown.pause()}),this.story.onVideoBuffering(function(){e.countdown&&e.countdown.pause()}),this.story.onVideoPlayEvent(function(){e.countdown&&!e.store.isStopped&&e.countdown.start()}),this.story.onAutoPlay(function(){var t=window.lang,n=e.story.getVideo();Stories.pauseAudio();var i=geByClass1("Story__body",e.authorElem),a=Stories.isGoodBrowser();n.play(),n.paused&&!a?e.story.renderError(e.authorElem,i,t.mobile_stories_inline_video_error):!e.countdown||e.store.isStopped||n.paused?a&&n.paused&&addClass(e.authorElem,"StoryAuthor_videoHold"):e.countdown.start(),n.muted&&addClass(e.authorElem,Ra),Stories._showFeatureTooltipIfNeeded()}),this.story.onDestroy(function(){e.countdown&&(e.countdown.stop(),e.countdown=null)}),Stories._showFeatureTooltipIfNeeded()},t.getCountDown=function(){if(this.countdown)return this.countdown},t.getFirstUnreadStoryIndex=function(){if(Stories._hasContext("all"))return 0;var e=this.data.items.findIndex(function(e){return!0===e.unread});return-1!==e?e:0},t.getCurrentStoryIndex=function(){if(!this.data.index){var e=this.getFirstUnreadStoryIndex();this.setCurrentStoryIndex(e)}return this.data.index},t.drawCurrentProgress=function(e){if(this.progressItemElems){var t=this.progressItemElems[this.data.index];setStyle.transform(geByClass1("StoryAuthor__progressItemCurrent",t),[e,1])}},t.drawFilledProgressItems=function(){var e=this.data.index;if(this.progressItemElems)for(each(this.progressItemElems,function(e,t){removeClass(t,"StoryAuthor__progressItem_filled")});e>=0;)addClass(this.progressItemElems[--e],"StoryAuthor__progressItem_filled")},t.setCurrentStoryIndex=function(e){this.data.index=e,this.drawFilledProgressItems()},t.renderEmpty=function(){var e=this.story.getPreview(),t=Stories.getWidth();return s.default.html({class:"StoryAuthor StoryAuthor_empty",style:"width: "+t+"px;",attrs:{"data-src":e}})},t.render=function(){var e,t,n,i=window.lang,a=Stories.getWidth(),o=d.isTouch?"ontouchstart":"onmousedown",r=d.isTouch?"ontouchend":"onmouseup";return s.default.html({class:"StoryAuthor StoryAuthor_inited",style:"width: "+a+"px;",inner:[{class:"StoryAuthor__header",inner:{class:"StoryAuthor__progress",inner:this.data.items.map(function(){return{class:"StoryAuthor__progressItem",inner:{class:"StoryAuthor__progressItemBar",inner:{class:"StoryAuthor__progressItemCurrent"}}}})}},(e={class:"StoryAuthor__muted"},e[o]="Stories.unMute(this, event);",e.inner=[{class:"Story__icon Story__icon_unmute"},{class:"StoryAuthor__muted_text",inner:i.mobile_stories_unmute}],e),(t={class:"StoryAuthor__next"},t[o]="Stories.onTouchStart(event);",t[r]="Stories.onTouchEnd(event);",t.ontouchcancel="Stories.onTouchEnd(event);",t),(n={class:"StoryAuthor__prev"},n[o]="Stories.onTouchStart(event);",n[r]="Stories.onTouchEnd(event, true);",n.ontouchcancel="Stories.onTouchEnd(event, true);",n),{class:"StoryAuthor__body",inner:this.authorStoriesHTML}]})},e}(),Ua=function(){function e(e){var t=window.lang;this.store=Stories.getStore(),this.viewers=this.store.viewers[e]||[],this.viewersState=this.store.viewersState[e]||[],this.questions=this.store.questions[e]||[],this.replies=this.store.replies[e]||[];var n=this.viewersState,i=n.count,a=n.repliesCountText,o=n.authorCountText;this.raw_id=e,this.count=i,this.countText=langNumeric(this.count,t.mobile_stories_views_title),this.repliesCountText=a,this.repliesAuthorCountText=o,this.questions?this.title=t.mobile_stories_views_title_interactions:this.viewers.length&&this.replies.length?this.title=t.mobile_stories_views_title_replies_and_views:this.viewers.length?this.title=this.countText:this.replies.length&&(this.title=t.mobile_stories_views_title_replies)}return e.prototype.render=function(){var e=this,t=window.winToUtf,n=this.store.questions[this.raw_id]||[];return s.default.html({class:Bem.class("Views",{short:!(this.viewers.length||!this.replies.length)}),inner:[{class:"Views__overlay",onclick:"Stories.hideViews();"},{class:"Views__header",inner:[{class:"Views__table",inner:[{class:"Views__cell",inner:{class:"Views__title",inner:this.title}}]},{class:"Views__close",onclick:"Stories.hideViews();"}]},{class:"Views__body ScrollView",onscroll:'Stories.onScrollViews(this, "'+this.raw_id+'")',ontouchmove:"event.stopPropagation();",inner:[this.replies.length?{class:"Views__replies",inner:[{class:"Views__table Views__repliesHeader",inner:[{class:"Views__cell Views__repliesCount",inner:this.repliesCountText},this.repliesAuthorCountText?{class:"Views__cell Views__repliesAuthorCount",inner:this.repliesAuthorCountText}:null]},{class:"Views__repliesBody",onscroll:'Stories.onRepliesScroll(event, "'+this.raw_id+'")',inner:{class:"Views__repliesScroll",inner:this.replies.map(function(n){return{class:"Views__reply "+(n.has_new?"Views__reply_new":""),onclick:'Stories.openReplies("'+n.owner_id+"/"+n.list+'", "'+e.raw_id+'");',inner:[{class:"Views__replyAvatarWrap",inner:{class:"Views__replyAvatar",src:n.photo_owners_data[0].owner_photo_url,tag:"img"}},{class:"Views__replyName",inner:n.name?t(n.name):lang.mobile_stories_reply_you}]}})}}]}:null,n.length?{class:"Views__questions",inner:[{class:"Views__table Views__questionsHeader",inner:[{class:"Views__cell Views__questionsTitle",inner:lang.mobile_stories_question_title},{class:"Views__cell Views__questionsLink",inner:lang.mobile_stories_question_show_all,onclick:'Stories.showQuestions("'+this.raw_id+'")'}]},{class:"Views__questionsBody",inner:{class:"Views__questionsScroll",inner:n.slice(0,10).map(function(e){return{class:"Question","data-id":e.id,inner:[{class:"Question__content",inner:[{href:e.author.link,class:"Question__author",inner:e.isAnonymous?lang.mobile_stories_question_anonymous:e.author.name,onClick:"Stories.sendAnalyticsEvent('question_go_to_author', { questionId: "+e.id+" });"},{class:Bem.class("Question__text",{small:e.text.length>40}),inner:e.text}]},{class:Bem.class("Question__actions",{published:e.isPublished}),inner:lang.mobile_stories_question_actions,onclick:["Stories.openQuestionActions",e.id]}]}})}}]}:null,{class:"Views__viewers",inner:[this.viewers.length&&(n.length||this.replies.length)?{class:"Views__viewersHeader",inner:this.countText}:null,{class:"Views__viewersBody",inner:this.viewers.map(function(e){return{class:"Views__viewer",href:e.href,inner:{class:"Views__table",inner:[{class:"Views__cell Views__cell_avatar",inner:{class:"Views__avatar",src:e.photo,tag:"img"}},{class:"Views__cell Views__cell_name",inner:{class:"Views__name",inner:e.name}}]}}})}]},this.viewersState.nextFrom?{class:"Views__viewersLoader",onclick:'Stories.loadViews("'+this.raw_id+'")'}:null]}]})},e}(),Va=function(){function e(e){this.store=Stories.getStore(),this.questions=this.store.questions[e]||[]}return e.prototype.render=function(){return s.default.elem({class:Bem.class("Questions",{}),inner:[{class:"Questions__header",inner:[{class:"Questions__table",inner:[{class:"Questions__cell",inner:{class:"Questions__title",inner:lang.mobile_stories_question_title}}]},{class:"Questions__close",onclick:"Stories.hideQuestions();"}]},{class:"Questions__body",inner:[{class:"Questions__inner",ontouchmove:"event.stopPropagation();",inner:this.questions.map(function(e){return{class:"Question","data-id":e.id,inner:[{class:"Question__content",inner:[{href:e.author.link,class:"Question__author",inner:e.isAnonymous?lang.mobile_stories_question_anonymous:e.author.name},{class:Bem.class("Question__text",{small:e.text.length>40}),inner:e.text}]},{class:Bem.class("Question__actions",{published:e.isPublished}),inner:lang.mobile_stories_question_actions,onclick:["Stories.openQuestionActions",e.id]}]}})}]}]})},e}();function $a(){var e=navigator.connection;if(!e)return"";var t=e.effectiveType,n=e.downlink;switch(t){case"slow-2g":return"GPRS";case"2g":return"EDGE";case"3g":return"3G";case"4g":return n>8?"wi-fi":"LTE"}return""}var qa=[];var Wa=[];var za=n("t7Ww"),Qa=0,Ya=1,Xa=3,Ga={opened:!1,init:function(e,t){var n=this;void 0===t&&(t={}),this.params=extend({replace:!1,reply:!1,replyTo:!1,restore:!1,forceAuthorIndex:!0,isOpenNarrativeFromFeed:!1},t);var a=this._parseList(e).split("/"),o=a[0],r=a[1],s=a[2],l=o.split("_")[0];t&&t.narrativeId&&(l=t.narrativeId.toString()),this.initRaw=e,this.storyOwner=Object(i.intval)(l),this.storyRaw=o,this.storyExtra=s,this.storyList=r,this.extra=this.parseExtra(this.storyExtra),this.needAudioRestore=audio.playing(),this.Views={},this.popoutOpen=!1,this.slideTimer=null,this.createLayer(),this._initStore(),this.detectAutoplay().then(function(){n.isRestored?n._init():n._checkPreloadedList()?(n._initPreloadedList(),n._init()):n._requestList().then(function(e){var t=e.items,i=e.list;t&&(n.store.authors=t,n.store.listLoaded=!0,n.store.list=i,n.store.inited=!0,n._init())},function(){})})},parseExtra:function(e){var t={},n=String(e).split(";");for(var i in n)if(n.hasOwnProperty(i)){var a=n[i].split(":"),o=a[0],r=a[1];o&&r&&(t[o]=r)}return t},_checkPreloadedList:function(){return!!(window.store&&window.store.storiesLists&&window.store.storiesLists[this.storyList])},_initPreloadedList:function(){var e=window.store.storiesLists[this.storyList];e&&(this.store.authors=e,this.store.listLoaded=!0,this.store.list=this.storyList,this.store.inited=!0)},pushPreloadedList:function(e){var t=Object(i.parseJSON)(e);window.store||(window.store={}),window.store.storiesLists||(window.store.storiesLists={}),extend(window.store.storiesLists,t),window.store.stories||(window.store.stories={}),Object.keys(t).forEach(function(e){window.store&&window.store.storiesLayers&&window.store.storiesLayers.includes(e)||delete window.store.stories[e]})},_createMetaStory:function(){var e=this;Object(i.each)(this.store.authors,function(t,n){var i=n.items[n.items.length-1];i.isNarrativeMetaStory||n.items.push({type:"photo",raw_id:i.raw_id,preview:i.preview,preview_url:i.preview_url,narrative:i.narrative,photo_url:i.photo_url,isNarrativeMetaStory:!0,isOpenNarrativeFromFeed:e.params.isOpenNarrativeFromFeed})})},_init:function(){var e=this;this.createAuthors(),this.storyList.match(/narrative-?\d+_\d+/)&&this._createMetaStory();var t=this.getFirstStoryIndex();this.setCurrentStory(t);var n=this.getCurrentStory();this.params.restore||this.setHistory(n.raw_id,{nav_init:!0,replace:this.params.replace}),this.sliderEl=ge("StoriesSlider"),this.slider=xe(this.sliderEl,{speed:300,startSlide:this.getCurrentAuthorIndex(),onSlideChange:function(t){t=e.slider&&Object(i.intval)(e.slider.getCurrentPos());var n=e.getCurrentAuthorIndex();e.getCurrentAuthor().data.is_groups||e.setAllAuthorStoriesReaded(n),clearTimeout(e.slideTimer),void 0!==t&&t!==n&&(e.markSeenAllOwners(),!1===e.isTap&&(t>n?e.sendAnalyticsEvent("go_to_next_author"):e.sendAnalyticsEvent("go_to_previous_author")),e.setCurrentAuthor(t),e.slideTimer=setTimeout(function(){e.renderStory()},300)),delete e.isTap},onSetup:function(){Object(i.addClass)(e.layer,"Stories_inited"),e.renderStory()}}),this.Authors&&1===this.Authors.length&&(Object(i.addClass)(this.layer,"Stories_inited"),this.renderStory()),this.store.showViews&&this.showViews(n.raw_id,!0),this._initViewerSource(),this._sendOpeningEvents()},_initStore:function(){window.store||(window.store={stories:{},storiesLayers:[]}),window.store.stories||(window.store.stories={}),window.store.storiesLayers||(window.store.storiesLayers=[]),window.store.stories[this.storyList]&&window.store.stories[this.storyList].inited?(this.store=window.store.stories[this.storyList],this.isRestored=!0):(this.store={authors:[],listLoaded:!1,readedStories:{},_requests:[],viewers:{},questions:{},viewersState:{},replies:{},showMenu:!1,storyList:this.storyList,initRaw:this.initRaw,storyIndex:0,authorIndex:0,isReply:this.params.reply,replyTo:this.params.replyTo,inited:!1},window.store.stories[this.storyList]=this.store,this.isRestored=!1),this.params.restore||window.store.storiesLayers.push(this.store.storyList)},_initViewerSource:function(){var e=this._getSource();switch(e){case"reply":this.viewerSource="replies_list";break;case"feed":this.viewerSource=cur.module;break;default:this.viewerSource=e}},_sendOpeningEvents:function(){var e=this._getSource();if(e){var t;switch(e){case"narrative_story":t="narrative_open_stories";break;case"narrative_snippet":case"narrative_link":t="narrative_open";break;case"narrative_recommendations":t="narrative_other"}if(t&&this._sendNavigationStatEvents(t),"narrative_fave"===e){var n=(this.getCurrentStory()||{}).narrative||{},a=n.owner_id,o=n.id;if(!a||!o)return;statlogsValueEvent("bookmarks_product_analytics",{item_type:"narrative",item_owner_id:Object(i.intval)(a),item_id:Object(i.intval)(o),time:vk.ts+Math.floor(((new Date).getTime()-vk.started)/1e3)})}}},_abortRequests:function(){isArray(this.store._requests)&&Object(i.each)(this.store._requests,function(e,t){t&&t.readyState<4&&t.abort()}),this.store._requests=[]},_saveRequest:function(e){this.store._requests.push(e)},getStore:function(){return this.store},setAllAuthorStoriesReaded:function(e){var t=this;this.store.authors[e].items.forEach(function(e){if(e.unread){var n=e.raw_id;e.track_code&&(n+="_"+e.track_code),t.store.readedStories[n]=!0}})},markSeenAllOwners:function(){var e=this.getCurrentAuthor().data,t=window.store.stories.groups;if(e.is_groups&&t){t.authors.forEach(function(e){return e.items.forEach(function(e){return e.unread=!1})});var n=t.authors.map(function(e){return e.author.id});ajax.post("stories.php",{_ajax:1,act:"mark_owners_seen",hash:this.store.authors[0].read_hash,owners_ids:n.join(",")});this._needFeedUpdate=!0}},togglePin:function(e,t){if(e){this._hideFeatureTooltip();var n=hasClass(e,"Story__pinBtn--unpin"),a=Ga.getCurrentAuthor();this.sendAnalyticsEvent(n?"unpin":"pin"),Object(i.toggleClass)(e,"Story__pinBtn--unpin",!n),ajax.post("stories.php",{_ajax:1,act:"toggle_pin",owner_id:t,need_pin:Object(i.intval)(!n),hash:this.store.authors[0].stories_pin_hash},{onDone:function(t){1!==t?Object(i.toggleClass)(e,"Story__pinBtn--unpin",n):a&&a.data&&a.data.author&&(a.data.author.isOwnerPinned=!n)}})}},createAuthors:function(){var e=this,t="";this.Authors=[];var n=this.getCurrentAuthorIndex();this.isRestored&&!this.params.forceAuthorIndex||(n=this.getFirstAuthorIndex());var a=this.store.authors[n],o=a.items[a.items.length-1].unread;if(this.extra)switch(this.extra.context){case"new":o=!0;break;case"all":o=!1}Object(i.each)(this.store.authors,function(n,i){var a=i.items;if(!n||!o||a[a.length-1].unread){var r=new Ha(n,i);e.Authors.push(r),t+=r.renderEmpty()}}),Object(i.val)(Object(i.geByClass1)("Stories__authors",this.layer),t),this.authors=Array.from(geByClass("StoryAuthor",this.layer)),Object(i.each)(this.Authors,function(e,t){t.updateHeader()}),this.setCurrentAuthor(n)},getFirstStoryIndex:function(){var e=this,t=this.store.authors[this.getCurrentAuthorIndex()];if(this._hasContext("all"))return 0;if(!this._hasContext("new")){var n=t.items.findIndex(function(t){return t.raw_id===e.storyRaw});if(-1!==n)return n}return this.getCurrentStoryIndex()},getFirstAuthorIndex:function(){var e=this,t=this.store.authors.findIndex(function(t){return t.author.index===e.storyOwner});return-1!==t?t:0},getCurrentAuthorIndex:function(){return this.store.authorIndex},getCurrentStoryIndex:function(){return this.store.authors[this.getCurrentAuthorIndex()].index},getCurrentStory:function(){return this.store.authors[this.getCurrentAuthorIndex()].items[this.getCurrentStoryIndex()]},setCurrentAuthor:function(e){this.store.authorPrevIndex=this.store.authorIndex,this.store.authorIndex=e,this.updateCurrentAuthor()},setCurrentStory:function(e){this.store.authors[this.getCurrentAuthorIndex()].index=e},drawSiblingPreview:function(){for(var e=this.getCurrentAuthorIndex(),t=-2;t<=2;t++){var n=e+t;this.authors[n]&&n!==e&&this.drawPreview(this.authors[n])}},drawPreview:function(e){setStyle(e,"background-image","url("+attr(e,"data-src")+")")},updateCurrentAuthor:function(){var e=this.authors[this.store.authorIndex];Object(i.each)(this.authors,function(e,t){Object(i.removeClass)(t,"StoryAuthor_current")}),Object(i.addClass)(e,"StoryAuthor_current")},getSizes:function(){var e,t,n=window.innerHeight,a=window.innerWidth;return a<540?(e=a,t=n,zlayer.open(),zlayer.onResize=this.onResize.bind(this)):(e=Math.floor(Math.min(540,Math.max(320,.563*n))),t=Math.floor(1.78*e),Object(i.addClass)(document.body,"vk__story_open")),[e,t]},createLayer:function(){window.innerWidth<540?(zlayer.open(),zlayer.onResize=this.onResize.bind(this)):Object(i.addClass)(document.body,"vk__story_open"),Ga.opened=!0;var e=this.getSizes(),t=e[0],n=e[1];this.storyW=t;var a=s.default.html({id:"StoriesView",class:"Stories__layer _preventMenuOpen",style:"max-width: "+t+"px; max-height: "+n+"px",inner:[{class:"Stories__loading",inner:{class:"Stories__loadingInner"}},{id:"StoriesSlider",class:"Stories__authors peppermint peppermint-inactive",ontouchmove:"Stories.onTouchMove(event);",inner:""},{class:"Stories__layerClose",inner:{class:"Story__icon Story__icon_close"},onclick:"return Stories.clickClose();"},{class:"Stories__popout"},{class:"Stories__flash",onclick:"Stories.hideFlashPopup()",inner:{class:"Stories__flashText"}},{class:"Stories__swipeText Stories__swipeText_top"}]});this.layer=Object(i.append)(Object(i.ce)("div",{className:"Stories",innerHTML:a}),document.body),attr(this.layer,"ontouchmove","event.preventDefault();"),this.loader=Object(i.geByClass1)("Stories__loading",this.layer),this.popout=Object(i.geByClass1)("Stories__popout",this.layer),this.swipeTextTop=Object(i.geByClass1)("Stories__swipeText_top",this.layer)},onResize:function(){var e=ge("StoriesView"),t=this.getSizes(),n=t[0],i=t[1];attr(e,"style","max-width: "+n+"px; max-height: "+i+"px"),this.storyW=n,this.authors.forEach(function(e){setStyle(e,"width",n+"px")}),this.Authors&&this.Authors.length>1&&this.slider&&this.slider.recalcWidth()},getWidth:function(){return this.storyW},renderStory:function(){var e=this.store.authorPrevIndex,t=this.getCurrentAuthorIndex(),n=this.authors[t],i=this.Authors[t];if(i.update(),!isNaN(e)&&e!==t){var a=this.Authors[e],o=this.authors[e];a.update();var r=a.renderEmpty(),s=ceFromString(r);replace(s,o)}var l=ceFromString(i.render());replace(l,n),this.authors=Array.from(geByClass("StoryAuthor",this.layer)),this.updateCurrentAuthor(),i.updateHeader(),this.onRender(),this.drawSiblingPreview(),"open"===this.extra.replies&&this.showViews(this.getCurrentStory().raw_id)},getCurrentAuthor:function(){var e=this.getCurrentAuthorIndex();return(this.Authors||[])[e]},getCurrentAuthorEl:function(){return this.getCurrentAuthor().authorElem},getAuthorElems:function(){return this.authors},prevStory:function(){var e=this;this.stopStory(),this.store.isStopped=!1,requestAnimationFrame(function(){var t=e.getCurrentStoryIndex(),n=e.getCurrentAuthorIndex();if(t-1<0)if(n-1<0)e.setCurrentStory(0),e.renderStory();else{e.slider.slideTo(n-1);var i=e.store.authors[n-1].items.length-1;e.setCurrentStory(i)}else e.setCurrentStory(t-1),e.renderStory()})},nextStory:function(e){var t=this;this.stopStory(),this.markSeenAllOwners(),this.store.isStopped=!1,requestAnimationFrame(function(){var n=t.store.authors[t.getCurrentAuthorIndex()],i=t.getCurrentStoryIndex(),a=t.getCurrentAuthorIndex(),o=n.items.length,r=t.Authors.length;o-1<=i?r-1<=a?requestAnimationFrame(function(){t.sendAnalyticsEvent("close_auto_by_time"),t.close()}):(e&&t.sendAnalyticsEvent("go_to_next_story_auto_by_time"),t.slider.slideTo(a+1),t.setCurrentStory(0)):(e&&t.sendAnalyticsEvent("go_to_next_story_auto_by_time"),t.setCurrentStory(i+1),t.renderStory())})},stopStory:function(){this.store.isStopped=!0,this.pauseStory()},pauseStory:function(e){var t=this.getCurrentAuthor();if(t){t.getCurrentStory();var n=t.getCountDown();e&&Object(i.addClass)(this.layer,"Stories_paused"),n&&n.pause()}},playStory:function(e){this.store.isStopped=!1;var t=this.getCurrentAuthor();if(t){t.getCurrentStory();var n=t.getCountDown();Object(i.removeClass)(this.layer,"Stories_paused"),n&&n.start()}},pauseAudio:function(){var e=window.audio;this.getCurrentStory().noSound||e&&e.pause()},restoreAudio:function(){var e=window.audio;this.needAudioRestore&&e&&e.play()},showMenu:function(){this.store.showMenu=!0,this._hideTooltips(),this.stopStory(),Object(i.addClass)(this.layer,"Stories_menuOpened")},hideMenu:function(e){void 0===e&&(e=!0),this.store.showMenu=!1,Object(i.removeClass)(this.layer,"Stories_menuOpened"),e&&this.playStory()},showLoading:function(){var e=this;this.loader&&(clearTimeout(this.loaderTimer),this.loaderTimer=setTimeout(function(){show(e.loader)},100))},hideLoading:function(){this.loader&&(clearTimeout(this.loaderTimer),hide(this.loader))},onRepliesScroll:function(e,t){this.Views[t]&&(this.store.viewersState[t].repliesScrollLeft=e.target.scrollLeft)},showViews:function(e,t){var n=this;if(void 0===t&&(t=!1),this.hideMenu(),this.store.showViews=!0,this.stopStory(),this._hideTooltips(),this.Views[e]){this.store.viewersState[e];var a=this.Views[e].render();this.popoutOpen=!0,Object(i.val)(this.popout,a);var o=Object(i.geByClass1)("Views__repliesBody",this.popout);o&&(o.scrollLeft=0),t||this.sendAnalyticsEvent("open_replies_list")}else{var r=this.store.viewersState[e],s=this.store.viewers[e];if(r&&s)return void this.createViews(e,t);this.showLoading(),this._requestFeedback(e).then(function(){n.markQuestionsAsViewed(),n.createViews(e,t),n.hideLoading()})}},markQuestionsAsViewed:function(){(this.getCurrentStory()||{}).isNewQuestions=!1,Object(i.removeClass)(Object(i.geByClass1)("Story__stats"),"Story__stats_new_questions")},createViews:function(e,t){void 0===t&&(t=!1);var n=this.store.viewersState[e],a=new Ua(e),o=a.render();this.popoutOpen=!0,Object(i.val)(this.popout,o),this.Views[e]=a;var r=Object(i.geByClass1)("Views__repliesBody",this.popout);r&&(r.scrollLeft=n.repliesScrollLeft),t||this.sendAnalyticsEvent("open_replies_list")},hideViews:function(e){void 0===e&&(e=!0),e&&this.playStory(),this.store.showViews=!1,this.popoutOpen=!1,Object(i.val)(this.popout,"")},loadViews:function(e){var t=this,n=this.store.viewersState[e],a=n.loading,o=n.nextFrom;!a&&o&&(n.loading=!0,this.showLoading(),this._requestFeedback(e,o).then(function(){var a=new Ua(e),o=a.render();t.popoutOpen=!0;var r=Object(i.geByClass1)("Views__body",t.layer).scrollTop;Object(i.val)(t.popout,o),Object(i.geByClass1)("Views__body",t.layer).scrollTop=r,t.Views[e]=a,t.hideLoading(),n.loading=!1}))},showComment:function(){var e=this,t=this.authors[this.store.authorIndex],n=Object(i.geByClass1)("Story__commentTextarea",t);this.store.showComment=!0,this.stopStory(),Object(i.addClass)(this.layer,"Stories_commentOpened"),this._hideTooltips(),requestAnimationFrame(function(){e.sendAnalyticsEvent("comment_tap"),n&&n.focus()})},hideComment:function(e){void 0===e&&(e=!0),this.store.showMenu=!1,Object(i.removeClass)(this.layer,"Stories_commentOpened"),e&&this.playStory()},onInputComment:function(e){var t=this.authors[this.store.authorIndex],n=Object(i.geByClass1)("Story__commentSend",t),a=Object(i.val)(e);Object(i.toggleClass)("Story__commentSend_active",n,!!a)},sendComment:function(){var e=this.authors[this.store.authorIndex],t=Object(i.geByClass1)("Story__commentTextarea",e),n=Object(i.geByClass1)("Story__commentSend",e),a=Object(i.val)(t);if(hasClass("Story__commentSend_active",n)){Object(i.val)(t,""),Object(i.removeClass)(n,"Story__commentSend_active");var o,r=this.getCurrentAuthorIndex(),s=this.getCurrentStory(),l=s.raw_id,c=s.narrative,u=this.store.authors[r],d=u.send_hash,f=u.author.id;o=c?"narrative"+c.raw_id:"story"+l,this._sendMessage(d,o,a,f),this.hideComment()}},showFlashPopup:function(e,t){var n=this;void 0===t&&(t=!0);this.stopStory();var a=Object(i.geByClass1)("Stories__flash",this.layer);Object(i.val)(Object(i.geByClass1)("Stories__flashText",a),e),setTimeout(function(){Object(i.addClass)(a,"Stories__flash_show")}),clearTimeout(this.flashTimer),clearTimeout(this.flashHideTimer),this.flashTimer=setTimeout(function(){Object(i.removeClass)(a,"Stories__flash_show"),n.flashHideTimer=setTimeout(function(){n.hideFlashPopup(t)},1500)},1500)},hideFlashPopup:function(e){e&&this.playStory(),clearTimeout(this.flashTimer),clearTimeout(this.flashHideTimer);var t=Object(i.geByClass1)("Stories__flash",this.layer);Object(i.removeClass)(t,"Stories__flash_show")},removeCurrentStory:function(){var e=this,t=window.lang,n=this.getCurrentAuthor();if(n){var i=n.getCurrentStory(),a=i.narrative?t.mobile_stories_delete_narrative:t.mobile_stories_delete_story;if(confirm(a.replace(/(<([^>]+)>)/gi,"\n"))){var o=n.data.remove_hash,r=i.can_remove,s=i.raw_id;if(r){this.pauseStory();var l=function(){e._requestFeedBlock(),i.isNarrativeSlide&&e.close(),0===e.getCurrentStoryIndex()?(e.close({closeAll:!1}),location.reload()):(e.store.authors[e.getCurrentAuthorIndex()].items.splice(e.getCurrentStoryIndex(),1),e.hideMenu(),e.prevStory())};if(i.narrative){var c=i.narrative,u=c.owner_id+"_"+c.id;this._requestRemoveNarrative(u,o).then(function(){l()},function(){})}else this._requestRemoveStory(s,o).then(function(){e.sendAnalyticsEvent("delete"),l()},function(){})}}}},onScrollViews:function(e,t){var n=this.store.viewersState[t],i=n.loading,a=n.nextFrom;if(!i&&a){e.scrollHeight-e.offsetHeight-400<=e.scrollTop&&this.loadViews(t)}},unMute:function(e,t){var n=this.getCurrentAuthor().story.getVideo();Object(i.cancelEvent)(t),n&&n.muted&&(n.muted=!1,Object(i.removeClass)(gpeByClass(Ra,e),Ra))},onTouchStart:function(e){var t=this,n=this.getCurrentAuthor().story;if(n&&"video"===n.getType()){var a=n.getVideo();if(a&&a.paused)return void(this.preventedTap=!0)}this.pauseStory(!0),this.isTap=!0,"touchstart"===e.type?(this.tapStartX=e.changedTouches[0].clientX,this.tapStartY=e.changedTouches[0].clientY):(this.tapStartX=e.clientX,this.tapStartY=e.clientY),clearTimeout(this.isTapTimer),this.isYmove=null,Object(i.removeClass)(this.layer,"Stories_touchMove"),this.isTapTimer=setTimeout(function(){t.isTap=!1,t.sendAnalyticsEvent("pause_long_tap")},200)},onTouchMove:function(e){var t=0,n=0;"touchmove"===e.type&&(t=this.tapStartX-e.changedTouches[0].clientX,n=this.tapStartY-e.changedTouches[0].clientY),null===this.isYmove&&(this.isYmove=Math.abs(t)<Math.abs(n),this.isYmove&&Object(i.addClass)(this.layer,"Stories_touchMove")),this.isYmove?this.onVerticalSwipe(-n/1.5):this.onVerticalSwipe(0)},onTouchEnd:function(e,t){clearTimeout(this.isTapTimer);var n=this.getCurrentAuthor().story;this.isTap||this.sendAnalyticsEvent("resume_release");var a,o;if("touchend"===e.type?(a=e.changedTouches[0].clientX,o=e.changedTouches[0].clientY):(a=e.clientX,o=e.clientY),(Math.abs(this.tapStartX-a)>20||Math.abs(this.tapStartY-o)>20)&&(this.isTap=!1),Object(i.removeClass)(this.layer,"Stories_touchMove"),setStyle(this.sliderEl,"opacity",1),setStyle.transform(this.sliderEl,1,[0,0]),setStyle.transform(Object(i.geByClass1)("Story__moreLink"),1,[0,0]),this.needGoToLink){var r=this.getCurrentAuthor().story;if(this.needGoToLink=!1,r&&r.hasLink())return void this.openCustomButton(e)}if(this.needClose)return this.sendAnalyticsEvent("close_swipe_down"),void this.close();if(this.featureTooltip)this._hideFeatureTooltip();else if(this.tooltip)this._hideTooltips();else{if(this.isTap){if(hasClass(e.target,"Story__sticker"))return Object(i.removeClass)(this.layer,"Stories_paused"),void(Object(i.domData)(e.target,"question")?this.askQuestionBox(e):this.tooltip?this._hideTooltips():this._showTooltip(e,n._createStickerLink(e.target)));t?(this.sendAnalyticsEvent("go_to_previous_story"),this.prevStory()):(this.sendAnalyticsEvent("go_to_next_story_tap"),this.nextStory())}this._hideTooltips(!0),this.hideMenu()}},openCustomButton:function(e){e.preventDefault(),e.stopPropagation();var t=this.getCurrentAuthor().story,n=t.getLinkUrl(),i=n.match(/\/narrative(-?\d+)_(\d+)/);if(i){var a={ownerId:i[1],narrativeId:i[2]},o=a.ownerId,r=a.narrativeId;if(!o||!r)return!1;this.openNarrative(o+"/narrative"+o+"_"+r,{source:"narrative_story",isOpenNarrativeFromFeed:!0})}else if(this.stopStory(),this.showLoading(),t.stats&&t.stats.url_view){var s=t.stats.url_view,l=s.event_type,c=s.rhash,u=t.raw_id;this._requestClickStat(u,l,c,function(){nav.go(n)})}else nav.go(n);return!1},onVerticalSwipe:function(e){var t=window.lang;if(this.needClose=!1,this.needGoToLink=!1,e){var n=e>0,a=this.sliderEl.offsetHeight,o=a/3.5,r=Math.abs(e)>o;if(n){var s=r?t.mobile_zphoto_release_to_close:t.mobile_zphoto_move_to_close,l=r?"":n?"zpv_close_move_down":"zpv_close_move_up",c=Math.max(1-.75*e/a,.6);Object(i.val)(this.swipeTextTop,'<div class="zpv_close_msg '+l+'">'+s+"</div>"),setStyle(this.sliderEl,"opacity",c),setStyle.transform(this.sliderEl,1,[0,e/1.5]),setStyle(this.swipeTextTop,"opacity",Math.abs(c-1-.6)),setStyle.transform(this.swipeTextTop,1,[0,e/1.5*.85]),this.needClose=r}else{var u=Math.min(1-.5*e/a,1.1);setStyle(this.sliderEl,"opacity",1),setStyle.transform(this.sliderEl,1,[0,0]),setStyle.transform(Object(i.geByClass1)("Story__moreLink"),u,[0,Math.max(e/(1.5*1.6),-90)]),this.needGoToLink=r}}else setStyle(this.sliderEl,"opacity",1),setStyle.transform(this.sliderEl,1,[0,0]),setStyle.transform(Object(i.geByClass1)("Story__moreLink"),1,[0,0]),this.needClose=!1,this.needGoToLink=!1},preventScroll:function(){return this.popoutOpen},_requestRemoveStory:function(e,t){return new Promise(function(n,i){ajax.post("stories.php",{_ajax:1,act:"remove_story",hash:t,story_raw:e},{onDone:function(){n()},onFail:function(){i()}})})},_requestRemoveNarrative:function(e,t){return new Promise(function(n,i){ajax.post("stories.php",{_ajax:1,act:"remove_narrative",hash:t,narrative_raw:e},{onDone:function(){n()},onFail:function(){i()}})})},_requestList:function(){var e=this;return new Promise(function(t,n){var i={storyOwner:e.storyOwner,list:e.storyList,storyRaw:e.storyRaw,extra:e.storyExtra};if(!e.storyRaw)return n();var a=ajax.post("stories.php",{_ajax:1,act:"get_list",list:i.list,story_raw:i.storyRaw,extra:i.extra},{onDone:function(e){if(i.items=e.list,e.recommendations){var n=i.list+"_recommendations";window.store.stories[n]=Ga._forceSetStore(i.storyRaw,n,e.recommendations)}t(i)},onFail:function(){n()}});e._saveRequest(a)})},_forceSetStore:function(e,t,n){return{authors:n,listLoaded:!0,list:t,readedStories:{},_requests:[],questions:{},viewers:{},viewersState:{},replies:{},showMenu:!1,storyList:t,initRaw:e,storyIndex:0,authorIndex:0,isReply:!1,replyTo:!1,inited:!0}},_requestFeedback:function(e,t){var n=this;void 0===t&&(t=0);var i=this.store;return new Promise(function(a,o){var r=ajax.post("stories.php",{_ajax:1,act:"feedback",offset:t,story_raw:e},{onDone:function(t,n,o,r,s,l,c){var u;(r&&r.length&&(i.replies[e]=r),i.viewers[e])?o&&(u=i.viewers[e]).push.apply(u,t):i.viewers[e]=t;i.viewersState[e]?o&&extend(i.viewersState[e],{count:n,nextFrom:o}):i.viewersState[e]={count:n,nextFrom:o,repliesCountText:s,authorCountText:l,repliesScrollLeft:0},c.length&&(i.questions[e]=c),s&&(i.viewersState[e].repliesCountText=s),l&&(i.viewersState[e].authorCountText=l),a({viewers:t,count:n,nextFrom:o,repliesCountText:s,authorCountText:l,questions:c})},onFail:function(){o()}});n._saveRequest(r)})},_requestReadStories:function(){var e=this.store,t=Object.keys(e.readedStories),n=this._getSource();if(t.length){var i,a,o=ajax.post("stories.php",{_ajax:1,act:"read_stories",hash:this.store.authors[0].read_hash,stories:t.join(","),source:n,navigation_stats:(a=qa.map(function(e){return[e.ownerId,e.storyId,e.source,e.action].join(",")}).join(";"),qa=[],a),loading_stats:(i=Wa.map(function(e){return[e.ownerId,e.storyId,e.source,e.time].join(",")}).join(";"),Wa=[],i),connection_type:$a()},{onDone:function(){e.readedStories={},"feed"===n&&Ga._requestFeedBlock()}});this._saveRequest(o)}else this._needFeedUpdate&&(this._needFeedUpdate=!1,setTimeout(function(){Ga._requestFeedBlock()}))},_getSource:function(){if(this.params&&this.params.source)return this.params.source;var e=this.store&&this.store.list||"",t="";return e.includes("feed")?t="feed":e.includes("replies")&&(t="reply"),t},_sendNavigationStatEvents:function(e){var t=this.getCurrentStory(),n=t&&t.raw_id;n&&function(e){var t=e.storyRawId,n=e.source,i=e.action,a=t.split("_");"reply"===n&&(n="replies_list");var o={ownerId:a[0],storyId:a[1],source:n,action:i};qa.push(o)}({storyRawId:n,source:this._getSource(),action:e})},_sendViewerStartTime:function(e,t){!function(e){var t=e.storyRawId,n=e.source,i=e.time,a=t.split("_"),o={ownerId:a[0],storyId:a[1],source:n,time:i};Wa.push(o)}({storyRawId:e,source:this.viewerSource,time:t})},_requestFeedBlock:function(){var e=nav.getQuery();if(!window.store.storiesLayers.length)ajax.post("stories.php",{_ajax:1,act:"feed_block",q:e.q},{onDone:function(e,t){var n=ge("StoriesFeedBlock");n&&replace(ceFromString(e),n),Ga.pushPreloadedList(t)}})},_requestClickStat:function(e,t,n,i){ajax.post("stories.php",{_ajax:1,act:"stat",source_story:e,event_type:t,rhash:n},{onDone:function(){i&&i()}})},_requestStickerStat:function(e,t){var n=this.getCurrentStory(),i=n.raw_id,a=n.clickable_stickers;i&&a&&ajax.post("stories.php",extend({act:"stickers_stat",story_raw_id:i,action:e,hash:a.hash},t))},_sendMessage:function(e,t,n,i){var a=ajax.post("mail.php",{_ajax:1,act:"send",entrypoint:"stories_comment",hash:e,media:t,message:n,to:i},{onDone:function(){var e=window.lang;Ga.showFlashPopup(e.mobile_stories_comment_success),Ga.sendAnalyticsEvent("comment_send")}});this._saveRequest(a)},_requestFave:function(e,t,n,i){ajax.post("bookmarks.php",{_ajax:1,act:e,item_type:31,item_oid:t,item_id:n,hash:i,ref:cur.module})},_parseList:function(e){var t=(e=decodeURIComponent(e)).match(/^story(-?\d+)_(\d+)(\/([a-z0-9\_\-]+))?(\/([a-z0-9\_\:\;\-]+))?$/i);if(t){var n=t[1],i=t[2],a=t[4],o=t[6],r=n+"_"+i;return e.match(/from_feed\=1/)?a="feed":e.match(/profile\=1/)?a="profile":a||(a=r),r+"/"+a+"/"+o}return e},setHistory:function(e,t){void 0===t&&(t={nav_init:!1,replace:!0});var n=window.nav,i=this.getHistoryURL(e),a=n.getQuery();i.match(/narrative-\d+_\d+/)&&(i="narrative"+this.getCurrentStory().narrative.raw_id),a.z=i;var o=n.path+obj2qs(a)+n.hash,r={push_only:!0,replace:t.replace,nav_init:!t.no_open,nav_incr:!0};n.go(o,null,r)},getFrom:function(e){void 0===e&&(e=!0);var t=window.nav,n=this.store.list,i=t.getQuery(),a="z="+i.z,o="";return"/write"===t.path.substr(0,6)?o="write"+t.path.substr(0,6)+"?"+a:"/mail"===t.path?o="write"+i.peer+"?"+a:"/feed"===t.path?o=i.section&&"notifications"===i.section?"feed?section=notifications&"+a:"feed?"+a:n.startsWith("archive")?o=t.path+"?act=stories":i.from&&(o=i.from),e?encodeURIComponent(o):o},getHistoryURL:function(e){var t=this.store.list;return"story"+e+(t?"/"+t:"")},getParams:function(){return this.params||{}},reportCurrentStory:function(e){var t=window.nav,n=this.getHistoryURL(e),i=(t.getQuery(),"/reports?act=add&object="+n+"&refrom="+this.getFrom());t.go(i)},openGroupsSettings:function(){var e=window.nav,t=this.getFrom(),n="/settings?act=groups_stories&story_raw_id="+this.getCurrentStory().raw_id+"&from="+t+"&hash="+this.getCurrentAuthor().data.stories_get_groups_settings_hash;this.sendAnalyticsEvent("set_group_view"),this.pauseStory(),e.go(n)},toggleBookmark:function(e,t){void 0===t&&(t=!1);var n=this.getCurrentAuthor();if(n){var a=n.getCurrentStory(),o=a.bookmark_add_hash,r=window.store,s=(a.narrative?a.narrative:a).is_bookmarked;Object.keys(r.stories).forEach(function(e){var t=r.stories[e];if(t.authors){var n=!1;t.authors.forEach(function(e){n||(n=e.items.find(function(e){return!!e.narrative&&(e.narrative.bookmark_hash===o&&e.raw_id===a.raw_id)}))}),n&&(n.narrative?n.narrative.is_bookmarked=!s:n.is_bookmarked=!s)}}),Object(i.val)(e,s?lang.mobile_stories_menu_bookmark_title:lang.mobile_stories_menu_bookmarked_title);var l=s?"bookmark_remove":"bookmark_add",c=a.narrative,u=c.owner_id,d=c.id;t||this._requestFave(l,u,d,o),a.narrative&&Share.setBookmarkState(a.narrative.raw_id,!s)}},share:function(e,t){var n=this,i=this.getCurrentAuthor();if(i){var a=i.getCurrentStory(),o=a.bookmark_add_hash,r=(a.narrative?a.narrative:a).is_bookmarked;this.stopStory();this.getFrom();var s=t?"narrative":"story";this.stopStory(),Share(e,{mail_hash:this.getCurrentStory().share_hash,object:s+e,is_bookmarked:r,bookmark_hash:o,bookmark_type:31,can_bookmark:t,can_to_own:t,can_to_club:t}),cur.share.onClose(function(){n.playStory()})}},openReplies:function(e,t){void 0===t&&(t=!1),this.playStory(),t||this.sendAnalyticsEvent("open_parent_story"),this.destroy();var n=e.split("/")[1];if(n)if(~window.store.storiesLayers.indexOf(n)){var i=this.store.list,a=n;this.restore(i,a)}else this.init(e,{reply:!0,replyTo:t});else this.close()},openNarrative:function(e,t){this.playStory(),this.destroy();var n=e.split("/")[1];if(n)if(~window.store.storiesLayers.indexOf(n)){var i=this.store.list,a=n;this.restore(i,a)}else this.init(e,t);else this.close()},clickClose:function(){var e=this;requestAnimationFrame(function(){e.sendAnalyticsEvent("close_tap"),e.close()})},close:function(e){if(void 0===e&&(e={}),extend({isPopState:!1,storyRaw:!1,closeAll:!1},e),this.store&&this.store.list&&this._getSource().indexOf("narrative")>-1&&this._sendNavigationStatEvents("narrative_close"),!e.isPopState){var t=window.nav,n=t.getQuery();if(window.store.storiesLayers[window.store.storiesLayers.length-1-1]){var i=window.store.storiesLayers[window.store.storiesLayers.length-1-1],a=window.store.stories[i],o=a.authorIndex,r=a.authors[o].index,s=a.authors[o].items[r];n.z=this.getHistoryURL(s.raw_id)}else delete n.z;var l=t.path+obj2qs(n)+(t.hash||"");t.go(l,null,{push_only:!0})}if(this.destroy(),e.isPopState&&e.storyRaw){var c=this._parseList(e.storyRaw).split("/")[1];this.store?this.restore(this.store.storyList,c,e.storyRaw,e):this.init(e.storyRaw,{replace:!0})}else this.store&&this.store.storyList&&this.restore(this.store.storyList,!1,!1,e)},hideAllViews:function(){var e=window.store;e&&(e.storiesLayers=[],e.stories&&Object.keys(e.stories).forEach(function(t){e.stories[t].showViews=!1,e.stories[t].isStopped=!1}))},restore:function(e,t,n,a){if(void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===a&&(a={}),window.store.storiesLayers){var o=window.store.storiesLayers.indexOf(e);window.store.storiesLayers.splice(o,1)}if(window.store.storiesLayers.length||t||n){t=t||window.store.storiesLayers[window.store.storiesLayers.length-1];var r=window.store.stories[e],s=window.store.stories[t];if(r&&s){var l=Object.keys(r.readedStories);Object(i.each)(l,function(e,t){var n=t.split("_"),i=n[0],a=(n[1],n[2],s.replies[r.replyTo]);if(a){var o=a.filter(function(e){return e.owner_id==i})[0];o&&(o.has_new=!1)}}),this.init(s.initRaw,{restore:!0,forceAuthorIndex:!1,reply:!0})}else n&&this.init(n,{restore:!0,forceAuthorIndex:!1,reply:!0})}else this.hideAllViews();a.closeAll&&window.store.storiesLayers.length&&this.close(a)},clearStore:function(){this.store=this._initStore()},destroy:function(){var e=this;if(this.restoreAudio(),this.store){this.slider=null,this.hideMenu(!1),this._abortRequests(),this._requestReadStories(),Object(i.removeClass)(this.layer,"Stories_inited");var t=this.getCurrentAuthorIndex();if(void 0!==t&&this.Authors)this.Authors[t].destroy();this.onRender.off(),Object(i.remove)(this.layer),Object.keys(this).forEach(function(t){"store"!==t&&"supportAutoplay"!==t&&"function"!=typeof e[t]&&(e[t]=null,delete e[t])}),zlayer.close(),Object(i.addClass)(ge("StoriesFeedBlock"),"StoriesFeedBlock_been-open"),Object(i.removeClass)(document.body,"vk__story_open"),Ga.opened=!1;var n=Object(i.geByClass1)("Question__popup"),a=Object(i.geByClass1)("Popup__overlay",n);a&&za.default.close(a)}},isAutoplaySupport:function(){return this.supportAutoplay},isGoodBrowser:function(){return d.default.ios&&d.default.safari_mobile&&parseInt(d.default.version,10)>=10},detectAutoplay:function(){var e=this;return new Promise(function(t){if(e.supportAutoplay)t();else{if(e.isGoodBrowser())return e.supportAutoplay=!0,void t();e.supportAutoplay=!1;var n=Object(i.ce)("video"),a=Object(i.ce)("source");a.src="data:video/mp4;base64,AAAAFGZ0eXBNU05WAAACAE1TTlYAAAOUbW9vdgAAAGxtdmhkAAAAAM9ghv7PYIb+AAACWAAACu8AAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAnh0cmFrAAAAXHRraGQAAAAHz2CG/s9ghv4AAAABAAAAAAAACu8AAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAFAAAAA4AAAAAAHgbWRpYQAAACBtZGhkAAAAAM9ghv7PYIb+AAALuAAANq8AAAAAAAAAIWhkbHIAAAAAbWhscnZpZGVBVlMgAAAAAAABAB4AAAABl21pbmYAAAAUdm1oZAAAAAAAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAVdzdGJsAAAAp3N0c2QAAAAAAAAAAQAAAJdhdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAFAAOABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAAEmNvbHJuY2xjAAEAAQABAAAAL2F2Y0MBTUAz/+EAGGdNQDOadCk/LgIgAAADACAAAAMA0eMGVAEABGjuPIAAAAAYc3R0cwAAAAAAAAABAAAADgAAA+gAAAAUc3RzcwAAAAAAAAABAAAAAQAAABxzdHNjAAAAAAAAAAEAAAABAAAADgAAAAEAAABMc3RzegAAAAAAAAAAAAAADgAAAE8AAAAOAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA4AAAAOAAAAFHN0Y28AAAAAAAAAAQAAA7AAAAA0dXVpZFVTTVQh0k/Ou4hpXPrJx0AAAAAcTVREVAABABIAAAAKVcQAAAAAAAEAAAAAAAAAqHV1aWRVU01UIdJPzruIaVz6ycdAAAAAkE1URFQABAAMAAAAC1XEAAACHAAeAAAABBXHAAEAQQBWAFMAIABNAGUAZABpAGEAAAAqAAAAASoOAAEAZABlAHQAZQBjAHQAXwBhAHUAdABvAHAAbABhAHkAAAAyAAAAA1XEAAEAMgAwADAANQBtAGUALwAwADcALwAwADYAMAA2ACAAMwA6ADUAOgAwAAABA21kYXQAAAAYZ01AM5p0KT8uAiAAAAMAIAAAAwDR4wZUAAAABGjuPIAAAAAnZYiAIAAR//eBLT+oL1eA2Nlb/edvwWZflzEVLlhlXtJvSAEGRA3ZAAAACkGaAQCyJ/8AFBAAAAAJQZoCATP/AOmBAAAACUGaAwGz/wDpgAAAAAlBmgQCM/8A6YEAAAAJQZoFArP/AOmBAAAACUGaBgMz/wDpgQAAAAlBmgcDs/8A6YEAAAAJQZoIBDP/AOmAAAAACUGaCQSz/wDpgAAAAAlBmgoFM/8A6YEAAAAJQZoLBbP/AOmAAAAACkGaDAYyJ/8AFBAAAAAKQZoNBrIv/4cMeQ==";var o=Object(i.ce)("source");o.src="data:video/webm;base64,GkXfo49CgoR3ZWJtQoeBAUKFgQEYU4BnAQAAAAAAF60RTZt0vE27jFOrhBVJqWZTrIIQA027jFOrhBZUrmtTrIIQbE27jFOrhBFNm3RTrIIXmU27jFOrhBxTu2tTrIIWs+xPvwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFUmpZuQq17GDD0JATYCjbGliZWJtbCB2MC43LjcgKyBsaWJtYXRyb3NrYSB2MC44LjFXQY9BVlNNYXRyb3NrYUZpbGVEiYRFnEAARGGIBc2Lz1QNtgBzpJCy3XZ0KNuKNZS4+fDpFxzUFlSua9iu1teBAXPFhL4G+bmDgQG5gQGIgQFVqoEAnIEAbeeBASMxT4Q/gAAAVe6BAIaFVl9WUDiqgQEj44OEE95DVSK1nIN1bmTgkbCBULqBPJqBAFSwgVBUuoE87EQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB9DtnVB4eeBAKC4obaBAAAAkAMAnQEqUAA8AABHCIWFiIWEiAICAAamYnoOC6cfJa8f5Zvda4D+/7YOf//nNefQYACgnKGWgQFNANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQKbANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQPoANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQU1ANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQaDANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQfQANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQkdANEBAAEQEBRgAGFgv9AAIiGAAPuC/rOgnKGWgQprANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQu4ANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQ0FANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQ5TANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQ+gANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgRDtANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgRI7ANEBAAEQEAAYABhYL/QACIhgAPuC/rIcU7trQOC7jLOBALeH94EB8YIUzLuNs4IBTbeH94EB8YIUzLuNs4ICm7eH94EB8YIUzLuNs4ID6LeH94EB8YIUzLuNs4IFNbeH94EB8YIUzLuNs4IGg7eH94EB8YIUzLuNs4IH0LeH94EB8YIUzLuNs4IJHbeH94EB8YIUzLuNs4IKa7eH94EB8YIUzLuNs4ILuLeH94EB8YIUzLuNs4INBbeH94EB8YIUzLuNs4IOU7eH94EB8YIUzLuNs4IPoLeH94EB8YIUzLuNs4IQ7beH94EB8YIUzLuNs4ISO7eH94EB8YIUzBFNm3SPTbuMU6uEH0O2dVOsghTM",Object(i.append)(o,n),Object(i.append)(a,n),n.style.position="fixed",n.style.left="5000px",attr(n,"id","base64testvideo"),attr(n,"playsinline","playsinline"),attr(n,"webkit-playsinline","webkit-playsinline"),attr(n,"muted","muted"),attr(n,"autoplay","autoplay"),attr(n,"loop","loop"),Object(i.append)(n,document.body);var r=ge("base64testvideo");if(d.default.android&&d.default.chrome)return e.supportAutoplay=!0,Object(i.remove)(n),t(),void clearTimeout(e.autoDetectTimeout);if(d.default.mobile&&d.default.ios&&d.default.ios<10)return e.supportAutoplay=!1,Object(i.remove)(n),t(),void clearTimeout(e.autoDetectTimeout);if(!d.default.safari_mobile||d.default.safari_mobile&&parseInt(d.default.version,10)>=10){var s=n.play();void 0!==s&&s.then(function(){e.supportAutoplay=!0,Object(i.remove)(n),t(),clearTimeout(e.autoDetectTimeout)}).catch(function(e){})}r.onplay=function(){e.supportAutoplay=!0,Object(i.remove)(n),t(),clearTimeout(e.autoDetectTimeout)},e.autoDetectTimeout=setTimeout(function(){r.paused||(e.supportAutoplay=!0),Object(i.remove)(n),t()},250)}})},narrativeReply:function(){this.setCurrentStory(0),this.renderStory(),this._sendNavigationStatEvents("narrative_replay")},narrativeGoToStories:function(){this.nextStory(),this._sendNavigationStatEvents("narrative_go_to_stories")},_showTooltip:function(e,t){if(this.hideMenu(!1),this.hideFlashPopup(!1),e&&t)if(this.tooltip)this._hideTooltips();else{var n=this.getCurrentAuthorEl();this.tooltip=Object(i.ce)("div",{className:"StoriesTooltip"},{top:0,left:0}),this.tooltipArrow=Object(i.ce)("span",{className:"StoriesTooltip__arrow"}),this.tooltip.appendChild(t),this.tooltip.appendChild(this.tooltipArrow),n.appendChild(this.tooltip);var a=0,o=0;"touchend"===e.type?(a=e.changedTouches[0].clientX,o=e.changedTouches[0].clientY):(a=e.clientX,o=e.clientY);var r=n.getBoundingClientRect(),s=r.top,l=r.left,c=r.width,u=getSize(this.tooltip),d=u[0],f=o-(s+u[1]+10),_=a-(l+d/2);setStyle(this.tooltip,{top:Math.max(f,2),left:Math.min(Math.max(_,2),c-d-2)}),setStyle(this.tooltipArrow,{left:Math.max(Math.min(a-l-Math.min(Math.max(_,0),c-d),d-15),15)}),this.pauseStory()}else this.playStory()},_showFeatureTooltipIfNeeded:function(){var e=this,t=window.store.storiesLists;if(t&&t.needShowFeatureTooltip){var n=Ga.getCurrentAuthorEl(),a=Object(i.geByClass1)("StoriesFeatureTooltip",n);if(a){var o=setTimeout(function(){e.pauseStory(),Object(i.addClass)("StoriesFeatureTooltip--show",a),e.featureTooltip=a,e.featureTooltipHash=t.needShowFeatureTooltipHash},2e3);t.needShowFeatureTooltip=!1,cur&&isArray(cur.destroy)&&cur.destroy.push(function(){clearTimeout(o)})}}},_hideFeatureTooltip:function(e){if(this.featureTooltip){var t=Ga.getCurrentAuthorEl(),n=Object(i.geByClass1)("StoriesFeatureTooltip",t);n&&(e||this.playStory(),Object(i.removeClass)("StoriesFeatureTooltip--show",n),this.featureTooltip=null,ajax.post("stories.php",{_ajax:1,act:"hide_feature_tooltip",type:"stories_pin",hash:this.featureTooltipHash}),this.featureTooltip=null,this.featureTooltipHash=null)}},_hideTooltips:function(e){this._hideFeatureTooltip(e),this.tooltip&&(e||this.playStory(),Object(i.remove)(this.tooltip),delete this.tooltip)},_createNarrativeTooltipLink:function(){var e=this.getCurrentStory().narrative||{};return Object(i.ce)("div",{className:"Stories__tooltip-link",innerHTML:lang.mobile_stories_narrative_show,onclick:function(){Ga._hideTooltips(!0),Ga.openNarrative(e.owner_id+"/narrative"+e.raw_id,{source:"narrative_story",isOpenNarrativeFromFeed:!0})}})},_hasContext:function(e){return!(!this.extra||!this.extra.context||this.extra.context!==e)},sendAnalyticsEvent:function(e,t){void 0===t&&(t={});var n=Ga.getCurrentStory(),i=Ga.getCurrentAuthor(),a=Ga.getCurrentStoryIndex(),o=Ga._getSource(),r=n.is_groups_meta_story,s=n.raw_id.split("_"),l=s[0],c=s[1],u=0;r&&(l=0,c=0),"groups"===this.storyList&&(u=1);var d={event_type:e,story_owner_id:l,story_id:c,time:vk.ts+Math.floor(((new Date).getTime()-vk.started)/1e3),view_entry_point:o,nav_screen:cur.module,story_type:r?"group_feed":"",is_grouped:u};if(i){var f=i.data,_=i.getCountDown();_&&f&&extend(d,{stories_author_before:a,stories_author_after:f.items.length-a,view_event_timeline_position:_.initialTime-_.left})}Object.assign(d,t),statlogsValueEvent("story_product_analytics",d)},clickAuthor:function(){this.sendAnalyticsEvent("go_to_author")},askQuestionBox:function(e){Object(i.cancelEvent)(e);var t=this.getCurrentStory().can_ask;if(this.hideFlashPopup(!1),this.sendAnalyticsEvent("click_on_clickable_sticker"),this._hideTooltips(),!t)return Ga.showFlashPopup(lang.mobile_stories_ask_question_forbidden),!1;this.stopStory(),Object(i.addClass)(this.layer,"Stories_questionOpened");var n=this.authors[this.store.authorIndex],a=Object(i.geByClass1)("Story__questionTextarea",n);requestAnimationFrame(function(){a&&a.focus()})},changeAskAnonymous:function(e){e.preventDefault();var t=document.querySelector(".Story__questionSelect");if(t){var n=+Object(i.domData)(t,"selected"),a=this.getCurrentStory();if(a){var o=[Object(za.ModalMenuBtn)({inner:lang.mobile_stories_ask_question_public,onclick:["Stories.changeQuestionMode","this",Qa],class:n===Qa?"selected":""}),Object(za.ModalMenuBtn)({inner:lang.mobile_stories_ask_question_author_only,onclick:["Stories.changeQuestionMode","this",Ya],class:n===Ya?"selected":""})];a.can_ask_anonymous&&o.push(Object(za.ModalMenuBtn)({inner:lang.mobile_stories_ask_question_anonymous,onclick:["Stories.changeQuestionMode","this",Xa],class:n===Xa?"selected":""}));var r=Object(za.default)({class:"Story__questionSelectModal",close:!0,closeText:lang.mobile_stories_ask_question_cancel,items:o});Pe.default.open(s.default.elem(r),!0)}}},changeQuestionMode:function(e,t){var n=document.querySelector(".Story__questionSelect");switch(t){case Qa:Object(i.val)(n,lang.mobile_stories_ask_question_public),Object(i.domData)(n,"selected",Qa);break;case Ya:Object(i.val)(n,lang.mobile_stories_ask_question_author_only),Object(i.domData)(n,"selected",Ya);break;case Xa:Object(i.val)(n,lang.mobile_stories_ask_question_anonymous),Object(i.domData)(n,"selected",Xa)}za.default.close(e)},hideAskQuestion:function(e){void 0===e&&(e=!0),Ga.store.showMenu=!1,Object(i.removeClass)(Ga.layer,"Stories_questionOpened"),e&&Ga.playStory()},onInputQuestion:function(e){$(".Story__questionSend").disabled=!Object(i.trim)(Object(i.val)(e))},sendQuestion:function(){var e=Ga.getCurrentAuthorEl();if(e){var t=Object(i.geByClass1)("Story__questionTextarea",e),n=Object(i.geByClass1)("Story__questionSend",e),a=Ga.getCurrentStory(),o=a.raw_id,r=a.askQuestionHash,s=a.accessKey,l=o.split("_"),c=l[0],u=l[1],d=Object(i.trim)(Object(i.val)(t)),f=document.querySelector(".Story__questionSelect"),_=+Object(i.domData)(f,"selected"),p=!1,h=!1;_===Qa?p=!0:_===Xa&&(h=!0),Object(i.val)(t,""),n.disabled=!0;var m=ajax.post("stories.php",{_ajax:1,act:"ask_question",story_owner_id:c,story_id:u,question_text:d,is_anonymous:+h,with_mention:+p,hash:r,access_key:s},{onDone:function(e){if(!e)return Ga.showFlashPopup(lang.mobile_stories_question_error),!1;var t=Ga.getCurrentAuthor().data.author;switch(Ga.showFlashPopup(lang.mobile_stories_question_sent.replace("{name}",t.first_name_ins)),_){case Qa:Ga.sendAnalyticsEvent("question_reply_publish");break;case Ya:Ga.sendAnalyticsEvent("question_reply");break;case Xa:Ga.sendAnalyticsEvent("question_reply_anonymous")}}});Ga._saveRequest(m),Ga.hideAskQuestion()}},getQuestionById:function(e){var t=this.getCurrentStory();return this.store.questions[t.raw_id].find(function(t){return t.id===e})},openQuestionActions:function(e){var t=this.getQuestionById(e);if(t){var n=t.canAnswer,i=t.isOwnerBlocked,a=t.canBlocked,o=[Object(za.ModalMenuBtn)({inner:lang.mobile_stories_question_delete,onclick:["Stories.removeQuestion","this",t.id]})];a&&(o.push(Object(za.ModalMenuBtn)({inner:i?lang.mobile_stories_question_unban:lang.mobile_stories_question_ban,onclick:["Stories.banQuestion","this",t.id]})),o.push(Object(za.ModalMenuBtn)({inner:lang.mobile_stories_question_report,onclick:["Stories.reportQuestion","this",t.id]}))),n&&o.unshift(Object(za.ModalMenuBtn)({inner:lang.mobile_stories_question_reply,onclick:["Stories.replyQuestionBox","this",t.id]}));var r=Object(za.default)({class:"Question__popup",items:o});Pe.default.open(s.default.elem(r),!0)}},removeQuestion:function(e,t){var n=this,a=this.getQuestionById(t),o=a.storyOwnerId,r=a.storyId,s=a.id,l=a.removeHash;ajax.post("stories.php",{_ajax:1,act:"remove_question",story_owner_id:o,story_id:r,question_id:s,remove_hash:l},{onDone:function(a){var l=o+"_"+r;if(za.default.close(e),!a)return requestAnimationFrame(function(){return n.showFlashPopup(lang.mobile_stories_question_error)}),!1;$$('.Question[data-id="'+t+'"]').forEach(function(e){return re(e)}),n.store.questions[l]=n.store.questions[l].filter(function(e){return e.id!==t}),$$(".Question").length<1&&re(Object(i.geByClass1)("Views__questions")),Ga.sendAnalyticsEvent("question_delete",{questionId:s})}})},replyQuestionBox:function(e,t){var n=this.getCurrentStory(),i=this.getQuestionById(t),a=i.author,o=i.text,r=lang.mobile_stories_question_reply_title.replace("{name}",a.nameGen),l=s.default.elem({class:"QuestionReplyPopup",inner:[{class:"QuestionReplyPopup__inner",inner:[{class:"QuestionReplyPopup__header",inner:[{class:"QuestionReplyPopup__preview",style:"background-image: url("+n.small_preview+")"},{class:"QuestionReplyPopup__top",inner:[{class:"QuestionReplyPopup__title",inner:r},{class:"QuestionReplyPopup__question",inner:o}]}]},{class:"QuestionReplyPopup__content",inner:[{class:"QuestionReplyPopup__textarea",tag:"textarea",placeholder:lang.mobile_stories_comment_textarea,oninput:"Stories.onInputReplyQuestion(this);"}]},{class:"QuestionReplyPopup__footer",inner:[Object(xn.default)({class:"QuestionReplyPopup__send",theme:"regular",inner:lang.mobile_stories_question_reply_to_message,on_click:["Stories.sendReplyQuestion",t],disabled:!0}),Object(xn.default)({class:"QuestionReplyPopup__cancel",theme:"link",inner:lang.mobile_stories_comment_cancel,on_click:["Stories.hideReplyQuestion"]})]}]}]});this.popout.appendChild(l),za.default.close(e)},hideReplyQuestion:function(){re(Object(i.geByClass1)("QuestionReplyPopup",Ga.popout))},onInputReplyQuestion:function(e){$(".QuestionReplyPopup__send").disabled=!Object(i.trim)(Object(i.val)(e))},sendReplyQuestion:function(e){var t=Object(i.trim)(Object(i.val)(Object(i.geByClass1)("QuestionReplyPopup__textarea"))),n=Ga.getQuestionById(e),a=n.id,o=n.ownerId,r=n.storyOwnerId,s=n.storyId,l=n.sendHash,c="story"+r+"_"+s,u=t+"\n\n "+n.text,d=ajax.post("mail.php",{_ajax:1,act:"send",hash:l,media:c,message:u,to:o},{onDone:function(e){var t=e&&e.error?e.message:lang.mobile_stories_comment_success;Ga.showFlashPopup(t,!1),Ga.sendAnalyticsEvent("question_send_message",{questionId:a})}});Ga._saveRequest(d),Ga.hideReplyQuestion()},showQuestions:function(e){var t=new Va(e).render();this.popout.appendChild(t),Ga.sendAnalyticsEvent("question_show_all")},hideQuestions:function(){re(Object(i.geByClass1)("Questions",this.popout))},banQuestion:function(e,t){var n=this.getQuestionById(t),i=n.storyOwnerId,a=n.storyId,o=n.banHash,r=n.isOwnerBlocked;ajax.post("stories.php",{_ajax:1,act:"ban_question",story_raw:i+"_"+a,question_id:t,ban_hash:o,is_blocked:+r},{onDone:function(i){if(!i)return za.default.close(e),void Ga.showFlashPopup(lang.mobile_stories_question_error,!1);if(!r){var a="question_ban_author";n.isAnonymous&&(a="question_ban_anonymous_author"),Ga.sendAnalyticsEvent(a,{questionId:t})}za.default.close(e),n.isOwnerBlocked=!r,Ga.showFlashPopup(r?lang.mobile_stories_question_author_unblocked:lang.mobile_stories_question_author_blocked,!1)}})},reportQuestion:function(e,t){var n=this.getQuestionById(t),i=this.getFrom();za.default.close(e);var a="story_question"+n.storyOwnerId+"_"+n.id;nav.go("/reports?act=add&object="+a+"&refrom="+i)},toggleQuestionTooltip:function(e,t){var n=this.getCurrentAuthor().getCurrentStory(),a=$(".QuestionSupport"),o=$(".Story__questionSelect"),r=+Object(i.domData)(o,"selected");if(Object(i.cancelEvent)(e),a){var s=n.firstName;n.authorId<0&&(s=lang.mobile_stories_ask_question_group_owner);var l="";switch(r){case Qa:l=lang.mobile_stories_ask_question_public_tooltip;break;case Ya:l=lang.mobile_stories_ask_question_author_only_tooltip;break;case Xa:l=lang.mobile_stories_ask_question_anonymous_tooltip}$(".QuestionSupport__tooltip").innerText=l.replace("{name}",s),t?Object(i.removeClass)(a,"QuestionSupport--active"):Object(i.toggleClass)(a,"QuestionSupport--active")}},openMusicStickerActions:function(e,t){var n=ge("audio"+e),i=hasClass("ai_added",n),a=Object(za.default)({close:!0,items:[Object(za.ModalMenuBtn)({class:"ai_add",inner:i?lang.global_delete_audio:lang.global_add_to_audio,onclick:'Stories.addMusic(this, "'+e+'", '+i+");"}),Object(za.ModalMenuBtn)({class:"ai_add",inner:lang.mobile_stories_music_next,onclick:"Stories.nextMusic(this, "+t+");"})]}),o=s.default.elem(a);o.setAttribute("id","ai_menu_"+e),Pe.default.open(o,!0)},addMusic:function(e,t,n){audioplayer.add(t),za.default.close(e),Ga._hideTooltips(!0),Ga.showFlashPopup(n?lang.mobile_stories_music_deleted:lang.mobile_stories_music_added)},nextMusic:function(e,t){var n=window,i=n.audio,a=n.audioplayer,o=ut(t);if(i.getCurrentId()){var r=i.playlist().map(function(e){return e.id}).indexOf(i.getCurrentId())+1;i.addToPlaylist([o],r)}else a.playPause(!1,o.fullId,!0),i.pause();za.default.close(e),Ga._hideTooltips()},onRender:Object(r.default)()};page.onChange(function(){window.store.storiesLayers=[],window.store.stories={}}),window.Stories=Ga;var Ka="_si_container_loading",Ja="StoriesArchive--loaded",Za={};function eo(e){var t=$$(".StoryThumb[data-time]",e);if(t)return t.forEach(function(e){var t=1e3*e.getAttribute("data-time"),n=new Date(t);if(Za[n.toDateString()]&&Za[n.toDateString()]!==t){var i=geByClass1("StoryThumb-date",e);re(i)}else Za[n.toDateString()]=t}),e}window.initStoriesArchive=function(){var e=0,t=!1,n=$(".StoriesArchive"),a=n.classList.contains(Ja);eo(n),Object(i.initAutoScroll)(function(){var t=$$(".StoryThumb");return e=t.length,t[t.length-1]},function(){if(t||a)return!1;var i=$(".StoriesArchive-stories");i.classList.add(Ka),t=!0,ajax.post("/stories_archive",{offset:e,_ajax:!0},{onDone:function(e){var o=ce("div");o.innerHTML=e.html,o=eo(o),i.innerHTML+=o.innerHTML,i.classList.remove(Ka),e.more||(a=!0,n.classList.add(Ja)),t=!1}})})};var to={rollback:{onDone:function(e){var t=e.html,n=e.post;e.hash;cur.restored=0;var i=ge(n+"__message-archived");if(t){var a=n+"__message-rollback",o=ce("div",{className:["post_message_item",i.className].join(" "),innerHTML:t,id:a});hide(i),ge(o)||after(o,i)}else{var r=ge(n+"__message-rollback");show(i),remove(r)}}},set:{onStart:function(){var e=this.link;e.classList.contains("wia_item")&&addClass(e,"wia_item--loading")},onDone:function(e){var t=e.html,n=e.post,i=e.restored,a=e.rollback_hash,o=this.link;cur.restored||(cur.restored=0),i&&"profile"===cur.module&&cur.restored++,removeClass(o,"wia_item--loading");var r=ge(n),s=ge(n+"_replies");if(t){if(cur.restored>3){var l=r.id+"?act=rollback_archive&hash="+a;t+=Wd.html({class:"service_msg_row",inner:{tag:"a",href:l,onclick:"return ajax.click(this, Archive.rollback)",inner:getLang("mobile_archive_restore_bulk")}})}var c=r.id+"__message-archived",u=ce("div",{className:["post_message_item",r.className].join(" "),innerHTML:t,id:c});hide(r),hide(s),ge(c)||after(u,r)}else if(n){var d=ge(n+"__message-archived"),f=ge(n+"_replies");show(n),show(f),remove(d)}}}};window.Archive=to;var no=function(e,t){cancelEvent(e);var n=t.getAttribute("href"),i=getLang("mobile_wall_prometheus_edit_warn");Confirm(i,'Popup.close(this); nav.go("'+n+'");',"",{title:getLang("mobile_prometheus_edit_warn_popup_title")})};window.PrometheusEditConfirm=no,window.CopyrightPopup={open:function(e,t,n,i){var a=Object(je.default)({class:"CopyrightPopup",header:{title:getLang("mobile_wall_post_copyright_source")},content:{inner:[t,{class:"Popup__buttons",inner:[Btn({class:"Popup__button",inner:getLang("mobile_wall_post_copyright_go"),theme:"regular",use_native_onclick:!0,on_click:"CopyrightPopup.go(this, '"+n+"', "+(i?1:0)+")"})]}]}});je.default.open(Wd.elem(a),!0)},go:function(e,t,n){var i;if(je.default.close(e),t.startsWith("/story"))Stories.init(t.substr(1),{source:"view_source"});else if(i=/^\/?narrative(-?\d+)_(\d+)(\/?([a-z0-9_-]+))?$/i.exec(t))Stories.init(i[1]+"/narrative"+i[1]+"_"+i[2],{source:"view_source"});else{if(/^@-?[\d\w._]+-[\d\w.-]+/.test(t.substr(1))&&(t+="?from="+nav.cur),!n)return nav.go(t,null);window.open(t,"post_copyright")}}};var io=n("UvyM");function ao(){var e=window.lang,t=Object(v.$)(".pcont .service_msg_box");if(t){var n=Object(v.$)(".service_msg",t).innerHTML;Object(i.remove)(t);var a=Object(je.default)({class:"CopyrightPopup",content:[{inner:s.default.wrap(n)},{class:"Popup__buttons",inner:[Object(io.default)({class:"Popup__button",inner:e.mobile_zphoto_close,theme:"regular",on_click:"Popup.close(this)",use_native_onclick:!0})]}]});je.default.open(s.default.elem(a),!0)}}window.ZeroVKPopup={open:ao,init:function(){onDOMReady(function(){ao()})}};n("B9v3");window.initSharePage=function(e,t){var n=ge("SharePageInput__to"),i="";n&&(i=n.value);var a={};if("mail"===e&&""!==n.value&&(a=i.split(",").reduce(function(e,t){return e[t]=!0,e},{})),"club"===e){var o=Object(v.$)(".SharePage .qsearch_wrap"),r=Object(v.$)(".hp_block",o);show(o),show(r)}var s=Object(v.$)(".SharePage .SharePanel.MessagePanel"),l=Object(v.$)(".SharePage .SharePanel.ActionsPanel");extend(cur,{publishTo:e,refreshSelected:function(e,t,i){var a;void 0===i&&(i=!0),isUndefined(e)||(cur.publishSelected=e),t=cur.publishTo,e=cur.publishSelected,"group"===t?a=ge("club"+e):"mail"===t&&(a=ge("peer"+e));var o=!!cur.selectedMap[e];a&&(a.classList.toggle("inline_item_selected",i?!o:o),cur.like_search.toggleAttach(e,!o),i&&(cur.selectedMap[e]=!o),n.value=Object.keys(cur.selectedMap).filter(function(e){return cur.selectedMap[e]}).join(","));var r=Object.keys(cur.selectedMap).length>0&&Object.keys(cur.selectedMap).some(function(e){return!!cur.selectedMap[e]});return s.classList.toggle("SharePanel--active",r),l.classList.toggle("SharePanel--active",!r),!1},selectedMap:a,selectPeer:function(e,t){return cur.refreshSelected(t,"mail"),!1}}),Object.keys(a).forEach(function(t){cur.refreshSelected(t,e,!1)})};var oo=function(e,t,n,i,a,o,r){n?Confirm(t,"ReportConfirm.submit('"+a+"', false, "+i+", '"+o+"', "+JSON.stringify(r)+")","",{title:e,id:"confirm-"+i}):ro(a,!0,i,o,JSON.stringify(r))};function ro(e,t,n,i,a){"string"==typeof a&&(a=JSON.parse(a));var o=$("#mcont");setStyle(o,{"pointer-events":"none"}),ajax.post(e,Object(Ke.default)({_ajax:1,reason:n},a)),"story"===a.type&&Stories.sendAnalyticsEvent("claim"),Object(m.partConfigEnabled)("mvk_new_info_snackbar")||Snackbar.init({text:getLang("mobile_msg_reported")}),$$(".Confirm").forEach(function(e){return je.default.close(e)})}Object(i.extend)(oo,{submit:ro}),window.ReportConfirm=oo;var so=function(e){return{class:"ModalMenuUserList",inner:ei({inner:e.users})}};var lo=function(e){var t="animation-duration: "+e.duration+"s;";return{inner:[Object(ht.default)({sprite:"wall",name:"cancel_16"}),{inner:[{inner:[{class:"CancelTimer__line",style:t,tag:"span"}],class:"CancelTimer__hand",tag:"div"},{inner:[{class:"CancelTimer__line",style:t,tag:"span"}],class:"CancelTimer__hand",tag:"div"}],class:"CancelTimer__timer",tag:"div"}],class:"CancelTimer",tag:"div"}},co=2;window.Replies={init:function(e){!function(e){e&&function(){var e=Object(i.geByClass1)("wall_replies"),t=Object(i.domLC)(e);if(!t||!Object(i.hasClass)("RepliesThreadNext",t))return;var n=Object(i.geByClass1)("RepliesThreadNext__link",t);Object(i.autoScroll)(function(){if(Object(i.domPN)(t)&&!Object(i.hasClass)("RepliesThreadNext_loading",t))return n},RepliesNext,{no_cache:!0})}();(function(){var e=Object(i.ge)("reply_field");if(!e||Object(i.hasClass)("RepliesField_static",e))return;var t=window.onBodyScroll,n=!1;t(Object(i.throttle)(function(t){var a=t+Object(i.getCh)(),o=Object(i.getH)(e),r=a<Object(i.getY)(e)+o;r&&!n?(Object(i.setStyle)(e,{height:o}),Object(i.addClass)("RepliesField_fixed",e)):!r&&n&&(Object(i.removeClass)("RepliesField_fixed",e),Object(i.setStyle)(e,{height:null})),n=r},10)),Object(i.onBodyScrollForce)()})(),function(e){var t=Object(i.ge)("replies_to_last"),n=Object(i.geByClass1)("RepliesWrap");if(!t||!n)return;var a=Object(i.ge)("reply_field"),o=Object(i.hasClass)("RepliesField_static",a),r=Object(i.getY)(n),s=window.onBodyScroll,l=!1;Ao(),s(Object(i.throttle)(function(e){var s=e+Object(i.getCh)(),c=a&&!o?Object(i.getY)(a)-uo:r+Object(i.getH)(n)-uo,u=r<e&&s<c;u!==l&&(Object(i.toggleClass)("Replies_last_shown",t,u),l=u)},10))}()}(e);var t=Object(i.ge)("reply_field"),n=Object(i.ge)("reply_field_text");mediaUpload&&t&&(mediaUpload.onStart(vo),mediaUpload.onRemove(function(){vo(),n.focus()}));if(t){var a=window.cur;a.onStickersToggleCallbacks=a.onStickersToggleCallbacks||[],a.onStickersToggleCallbacks.push(function(e){if(Object(i.onBodyScrollForce)(),mo(),e){var t=Object(i.geByTag1)("a","stickers_panel");t&&t.focus()}else n.focus()}),ho()}},replyTo:function(e,t,n,a){if(Object(i.checkEvent)(e))return!0;if(window.cur.replyTo!==n&&ko)return Mo(),!0;n=n||0,Object(i.geByClass)("ReplyItem_active").forEach(function(e){Object(i.removeClass)("ReplyItem_active",e)});var o,r=Object(i.ge)("reply_field"),s=Object(i.ge)("reply_field_text"),l=Object(i.hasClass)("RepliesField_static",r),c=!!window.post&&window.post.replyNamesRE(),u=Object(i.val)(s),d="";if(n){if(o=Object(i.ge)("wall_reply"+t+"_"+n))if(l||Object(i.addClass)("ReplyItem_active",o),!Object(i.hasClass)("ReplyItem_deleted",o)&&a){var f=window.cur.replyNames[a]||{},_=f[0]||"";d=f[1]||"",u=u?c?u.replace(c,_):u:_,window.post&&window.post.onReplyClick(!0,_)}else u=c?u.replace(c,""):u}else u=c?u.replace(c,""):u;Object(i.val)(s,replaceEntities(u));var p=Object(i.ge)("reply_field_to"),h=Object(i.geByClass1)("RepliesField__infoName",p);Object(i.val)(h,Object(i.htsc)(d)),Object(i.toggleClass)("RepliesField__infoItem_shown",p,n&&d),Object(i.toggleClass)("RepliesField__infoItem_shown","reply_field_to_empty",n&&!d);var m=Object(i.ge)("reply_field_info"),A=Object(i.ge)("reply_field_from");if(Object(i.toggleClass)("RepliesField__info_shown",m,n||A),Object(i.toggleClass)("RepliesField__info_single",m,n&&!A||!n&&A),Object(i.val)("field_reply_to",n),Object(i.val)("field_reply_to_name",n&&d?"1":""),window.cur.replyTo=n,Object(i.val)("field_timestamp",To()),l)if(o)Unfold.changePosition(Unfold.getByName("attaches"),!0,!1),domInsertAfter(r,o);else{Unfold.changePosition(Unfold.getByName("attaches"),!0,!0);var v=Object(i.geByClass1)("wall_replies");domInsertBefore(r,v)}return mo(),ho(),elfocus(s),Object(i.cancelEvent)(e)},showMoreActions:function(e,t){var n=Object(i.ge)("reply_more_"+e);if(!n)return;var a=Object(i.geByClass)("ReplyItem__action",n),o=[];a.forEach(function(e){o.push(Object(za.ModalMenuBtn)({inner:Object(i.val)(e),onclick:"Replies.onClickMoreAction('"+e.id+"', event)"}))});var r=Object(za.default)({close:!0,items:o}),l=Object(i.ceFromString)(s.default.html(r));l=Pe.default.open(l,!0,{oncloseCallback:function(){var t=Object(i.ge)("reply_more"+e);t&&t.focus()}});var c=Object(i.geByClass1)("ModalMenu__btn",l);c&&c.focus();return Object(i.cancelEvent)(t)},onClickMoreAction:function(e,t){t&&Pe.default.close(t.target);var n=Object(i.ge)(e);if(!n)return;n.click()},onFieldInput:ho,toggleStickers:function(e,t){if(ko)return Object(i.cancelEvent)(t);return window.post.stickersToggle(e),Object(i.cancelEvent)(t)},replyAsShow:function(e,t){var n,a=!!window.cur.replyAs;jo(fo),a?n=yo(window.cur.replyAs):(n=s.default.wrap(Object(g.default)({large:!0})),function(e){if(window.cur.replyAsLoading)return;var t=window.ajax;window.cur.replyAsLoading=!0,t.post("/wall.php",{act:"get_reply_clubs_list",post_oid:e,modal:1},{onDone:function(e){window.cur.replyAs=e;var t=Object(i.ge)("reply_as_users_list");if(t){var n=yo(e);Object(i.val)(t,s.default.html(n));var a=Object(i.geByClass1)("ModalMenuUserList__item",t);a&&a.focus()}delete window.cur.replyAsLoading},onFail:function(){delete window.cur.replyAsLoading}})}(t));var o=Object(za.default)({title:Object(i.getLang)("mobile_wall_reply_as_title"),close:!0,items:[{id:"reply_as_users_list",inner:n}]}),r=Object(i.ceFromString)(s.default.html(o));if(Pe.default.open(r,!0),a){var l=Object(i.geByClass1)("ModalMenuUserList__item",Object(i.ge)("reply_as_users_list"));l&&l.focus()}return Object(i.cancelEvent)(e)},replyAsChange:function(e,t,n,a){var o=Object(i.ge)("reply_field_from"),r=Object(i.geByClass1)("RepliesField__infoName",o);return Object(i.val)(r,Object(i.htsc)(a)),Object(i.val)("field_from_oid",n),za.default.close(t),Object(i["ge"])("reply_field_text").focus(),Object(i.cancelEvent)(e)},checkSendButton:function(e){if(!bo())return Object(i.cancelEvent)(e)},onClickLastReplies:function(e,t){var n=Object(i.geByClass1)("wall_replies"),a=Object(i.domLC)(n),o=a&&Object(i.hasClass)("RepliesThreadNext",a);if(o){var r=Object(i.geByClass1)("Loading",a);r||(r=Object(i.ceFromString)(Object(g.default)({})),append(r,a)),Object(i.addClass)("RepliesThreadNext_loading",a)}if(Object(i.removeClass)("RepliesWrap_last_shown",e),window.scrollTo(0,document.body.scrollHeight),o)return a.focus(),ajax.click(e,window.RepliesLast);a&&(Object(i.hasClass)("RepliesThread",a)&&(a=Object(i.domPS)(a)),Object(i.hasClass)("ReplyItem",a)&&Object(i.geByClass1)("ReplyItem__name",a).focus());return Object(i.cancelEvent)(t)},onSubmitForm:function(e,t){if(To())Mo();else{if(e.preventDefault(),So)return;So=!0;var n=$('textarea[name="message"]',t),a=n?n.value:"",o=location.pathname.match(/^\/wall(-?[0-9]+)_([0-9]+)$/),r=o[1],l=o[2];ajax.post("/wall.php",{act:"check_comment",oid:r,post_oid:l,text:a},{onDone:function(e){So=!1;var t=e.timestamp;if(e.delay){var n=1e3*e.delay;Do(t);var a,o=$("#reply_field");Object(i.hasClass)("RepliesField_fixed",o)?a=Object(i.getH)(o)+5:Object(i.hasClass)("RepliesField_static",o)||(a=Object(i.getH)($("body"))-Object(i.getY)(o)+5),Co=Snackbar.init({type:b.SNACKBAR_TYPE_BULLYING,text:e.description,bottom:a,duration:n}),wo=setTimeout(function(){Io(),Mo()},n),function(e){var t=$("#nc_submit"),n=$(".RepliesField__field"),a=s.default.elem({class:"RepliesField__action RepliesField__action_cancel",inner:lo({duration:e/1e3}),onclick:["Replies.abortTimer",_o]});ko=!0;var o=$(".RepliesField__action_attach"),r=$(".RepliesField__action_smile");o&&o.classList.add(po),r&&r.classList.add(po),n.appendChild(a),Object(i.hide)(t)}(n)}else Do(t),Mo()},onFail:function(){So=!1,Mo()}})}},abortTimer:jo,setCurrentTimestamp:Do};var uo=50,fo="editing",_o="button",po="RepliesField__action_disabled";function ho(){var e=Object(i.ge)("reply_field_text"),t=Object(i.ge)("reply_field_text_fake"),n=e.value;t.innerText=n,"\n"===Object(i.last)(n)&&(t.innerHTML+="&nbsp;");var a=Object(i.getH)(t);Object(i.getH)(e)!==a&&(Object(i.setStyle)(e,{height:a}),mo()),go(),jo(fo)}function mo(){var e=Object(i.ge)("reply_field");Object(i.hasClass)("RepliesField_static",e)||Object(i.hasClass)("RepliesField_fixed",e)&&(Object(i.setStyle)(e,{height:Object(i.getH)(Object(i.geByClass1)("RepliesField_wrap",e))}),Ao(),Object(i.onBodyScrollForce)())}function Ao(){var e=Object(i.ge)("replies_to_last"),t=Object(i.ge)("reply_field");if(e&&t&&!Object(i.hasClass)("RepliesField_static",t)){var n=domData(e,"bottom");n||(n=parseInt(getStyle(e,"bottom"))||20,domData(e,"bottom",n)),Object(i.setStyle)(e,"bottom",Object(i.getH)(t)+parseInt(n))}}function vo(){go(),mo();var e=(mediaUpload?mediaUpload.getAttachesCount():0)<co;["photo_device","photo","video","audio","doc"].forEach(function(t){Unfold.toggleItemEnabled(Unfold.getByName("attaches"),t,e)})}function go(){var e=Object(i.ge)("nc_submit");e&&Object(i.toggleClass)("RepliesField__action_send_active",e,bo())}function bo(){var e=(Object(i.ge)("reply_field_text")||{}).value;return trim(e)||mediaUpload&&mediaUpload.getAttachesCount()}function yo(e){var t=[];return e.forEach(function(e){var n;t.push({class:"ModalMenuUserList__item",href:(n={href:e[2],image:e[1],name:e[3],onclick:"return Replies.replyAsChange(event, this, "+parseInt(e[0])+", '"+e[4]+"')"}).href,onclick:n.onclick?n.onclick:null,inner:[{tag:"img",class:"ModalMenuUserList__itemAvatar",src:n.image},{class:"ModalMenuUserList__itemName",inner:n.name}]})}),so({users:t})}var wo,Co,ko=!1,So=!1,Eo={};function Oo(){ko=!1,clearTimeout(wo),Snackbar.close(Co),Io()}function To(){return Eo[""+window.cur.replyTo]}function Do(e){Eo[""+window.cur.replyTo]=e,Object(i.val)("field_timestamp",e)}function jo(e){if(ko){var t=location.pathname.match(/^\/wall(-?[0-9]+)_([0-9]+)$/),n=t[1],i=t[2],a=To();ajax.post("/wall.php",{act:"cancel_check_comment",oid:n,post_oid:i,reason:e,timestamp:a})}Oo()}function Io(){var e=$("#nc_submit"),t=($(".RepliesField__field"),$(".RepliesField__action_cancel")),n=$(".RepliesField__action_attach"),a=$(".RepliesField__action_smile");n&&n.classList.remove(po),a&&a.classList.remove(po),Object(i.remove)(t),Object(i.show)(e)}function Mo(){var e=$("#nc_submit");nav.go(e,event),Do(0)}nav.onBeforeGo(function(e,t){var n=location.pathname.substr(1,4);isString(e)&&e.substr(1,4)!==n&&"wall"===n&&(Eo={})}),page.onChange(function(e,t){Oo()});var xo=n("fdw3");window.PostAttachVideoLink={},PostAttachVideoLink._onInit=No,PostAttachVideoLink._onPlayClick=Ho,PostAttachVideoLink._onReplayClick=Ho,PostAttachVideoLink._onSoundClick=Fo,PostAttachVideoLink._onVideoClick=Uo,PostAttachVideoLink._onVideoPlay=function(e){return Vo(e.target,"play")},PostAttachVideoLink._onVideoPause=function(e){return Vo(e.target,"pause")},PostAttachVideoLink._onVideoEnded=function(e){return Vo(e.target,"end")};var Bo={muted:"PostAttachVideoLink_muted",state:function(e){return"PostAttachVideoLink_state_"+e}},Po={attach:".PostAttachVideoLink",video:".PostAttachVideoLink__video"},Lo=window.MutationObserver,Ro=null;function No(){Lo&&!Ro&&(Ro=new Lo($o)).observe(document.body,{childList:!0,subtree:!0})}function Fo(e){var t=e.closest(Po.attach),n=Object(v.$)(Po.video,t);n.muted=!n.muted,t.classList.toggle(Bo.muted,n.muted)}function Ho(e){var t=e.closest(Po.attach);Object(v.$)(Po.video,t).play()}function Uo(e){e.paused||e.pause()}function Vo(e,t){var n=e.closest(Po.attach);n.classList.remove(Bo.state("play")),n.classList.remove(Bo.state("pause")),n.classList.remove(Bo.state("end")),n.classList.add(Bo.state(t))}function $o(e){e.forEach(function(e){e.removedNodes.forEach(function(e){e.nodeType===HTMLElement.ELEMENT_NODE&&Object(v.$$)(Po.video,e).forEach(function(e){e.src="",e.load()})})}),Object(v.$)(Po.video)||(Ro.disconnect(),Ro=null)}var qo,Wo,zo,Qo,Yo;n("bRFj"),n("eyw1");window.FeedAssistanceStats=((qo={register:Cs,forceRegister:function(e,t){e[sr]=Ss(e),e[cr]=t,os.push(e)},onScroll:throttle(Os,50),onStartViewElement:Object(r.default)("element"),onEndViewElement:Object(r.default)("element"),onStopTrackElement:Object(r.default)("element"),onViewedElement:Object(r.default)("element"),onBeforePageChange:Is,onPageChanged:Ms,getElementType:Ss,registerElements:ys,registerTrackingCls:function(e){vs.push(e)},unregisterTrackingCls:bs}).unregisterTrackingCls=bs,qo.setParenViewableX=function(e,t){e[br]=t},qo.forceProcessTrack=ks,qo.dispatchElementEvent=function(e,t){var n=function(e){return Kr[e]}(nl(t[sr]||Ss(t),e));Ps({type:e,data:n(t)})},qo.dispatchEvent=function(e){Ps(e)},qo.serializeEventData=Es,qo.clearElemsCache=function(){os.forEach(function(e){e[_r]=!1,e[pr]=!1})},qo._debug=function(){return{started:ss,tracking:os,events:As,blindTop:cs,blindBottom:us}},qo.getFromRef=dl,qo.getRoot=fl,qo.BLOCKS={},qo.EVENTS={},qo);var Xo=.5,Go=.25,Ko=500,Jo=3e5,Zo=2500,er=1e4,tr=6e3,nr=2e4,ir=3e4,ar=5e3,or=36e4,rr=100,sr="_feedAssistanceStatsType",lr="_feedAssistanceStatsIdled",cr="_feedAssistanceStatsModule",ur="_feedAssistanceStatsStarted",dr="_feedAssistanceStatsProcessed",fr="_feedAssistanceStatsEventTs",_r="_feedAssistanceStatsCachedY",pr="_feedAssistanceStatsCachedX",hr="_feedAssistanceStatsLeft",mr="_feedAssistanceStatsHeight",Ar="_feedAssistanceStatsWidth",vr="_feedAssistanceStatsTop",gr="_feedAssistanceStatsBottom",br="_feedAssistanceStatsParentViewableX",yr="BLOCK_TYPE_RECOMMENDED_SLIDER",wr="BLOCK_TYPE_DEFAULT",Cr="BLOCK_TYPE_EXPLORE_BAIT",kr="BLOCK_TYPE_PROFILE_PHOTO",Sr="BLOCK_TYPE_PROMO_BUTTON",Er="BLOCK_TYPE_IMPORT_CONTACTS",Or="BLOCK_TYPE_PUSH_SWITCH",Tr="explore_bait",Dr="feed_assistance",jr="hide",Ir="promo_button",Mr="SUB_EXPLORE_BAIT",xr="view",Br="like",Pr="comment",Lr="opened",Rr="subscribe",Nr="unsubscribe",Fr="open_user",Hr="open_group",Ur="hide",Vr="report",$r="seen",qr="filled",Wr="enable_push",zr="decline_push",Qr="SUB_PROMO_BUTTON",Yr="clicked",Xr=((Wo={})[yr]="view_block",Wo[Sr]="view_block",Wo[Cr]=Tr,Wo[kr]=Dr,Wo[Er]=Dr,Wo[Or]=Dr,Wo),Gr=((zo={})[yr]=500,zo[Cr]=Ko,zo[kr]=Ko,zo[Er]=Ko,zo[Or]=Ko,zo),Kr=((Qo={})[nl(yr,"view_block")]=function(e){var t=geByClass1("Slider__scroll",e),n=domData(t,"code");return Es("view_block","",e,domData(t,"ref"),n)},Qo[nl(Sr,"view_block")]=function(e){return Es("view_block",geByClass1("feedAssistancePromoButtonInstallApp__button",e)?"promo_install_app":"promo_button",e)},Qo[nl(Cr,Tr)]=function(){return Es(Mr,xr)},Qo[nl(kr,Dr)]=function(e){return Es(Dr,e,"m_ph",$r)},Qo[nl(Er,Dr)]=function(e){return Es(Dr,e,"m_mp",$r)},Qo[nl(Or,Dr)]=function(e){return Es(Dr,e,"m_push_switch",$r)},Qo),Jr=((Yo={}).view_block=function(e,t,n,i){return n=n||dl(t),[e,domChildIndex(t),_l(t),n,i].join("|")},Yo[Mr]=function(e){return e},Yo[Dr]=function(e,t,n){return[t,n,dl(e)].join("|")},Yo[jr]=function(e,t){return[e,_l(t),domChildIndex(t),dl(t)].join("|")},Yo[Qr]=function(e,t,n){return[domChildIndex(e),t,n||""].join("|")},Yo),Zr="feed_other",es="feedAssistance",ts="feedAssistanceStat.events",ns="feedAssistanceStat.idled",is="/feed",as="assistance_stats",os=[],ss=[],ls=Date.now(),cs=0,us=0,ds=!1,fs=null,_s=null,ps=null,hs=null,ms=null,As=[],vs=[],gs=!1;function bs(e){rl(vs,e)}function ys(){var e=[];each(vs,function(){e=e.concat(geByClass(this))}),each(e,function(){Cs(this,"feed")})}function ws(){ys();var e=Js();e.length&&(Ys(e),Zs()),ks(),Us()}function Cs(e,t){!e[sr]&&function(e){return!~os.indexOf(e)}(e)&&(e[sr]=Ss(e),e[cr]=t,os.push(e))}function ks(){xs(scrollGetY(),getCh())}function Ss(e){return e[sr]?e[sr]:hasClass("feedAssistance_recommendedFriends",e)?yr:hasClass("post_exploreBait",e)?Cr:hasClass("feedAssistance_profilePhoto",e)?kr:hasClass("feedAssistance_promoButton",e)?Sr:hasClass("feedAssistance_importContacts",e)?Er:hasClass("feedAssistance_pushNotificationsSwitch",e)?Or:wr}function Es(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Jr[e].apply(Jr,n)}function Os(e,t){var n,i=Os;xs(e||scrollGetY(),t||getCh()),ds||gs?(clearTimeout(i.timer),i.timer=setTimeout(Ts,150),gs=!1):(ds=!0,Hs(),n=ge("vk_head"),cs=n&&n.offsetHeight,us=0)}function Ts(){Hs(),Fs(),ds=!1}function Ds(){Hs(),ul(ss),Ys(As.concat(tl(ss))),ll(ss),As=[],ss=[],Vs()}function js(){ss.forEach(function(e){e[ur]=Date.now()}),Xs(null),Gs(null),Fs(),Vs(),Us()}function Is(){Hs(),ul(ss),As=As.concat(tl(ss)),ll(ss),ss=[],gs=!0,Fs()}function Ms(){ys(),ks()}function xs(e,t){var n=[];os.forEach(function(i){ol(i)?n.push(i):!function(e,t,n){return!e[ur]&&Rs(e,Xo,t,n)&&Ns(e,Xo)}(i,e,t)?!function(e,t,n){return e[ur]&&(!Rs(e,Go,t,n)||!Ns(e,Go))}(i,e,t)?Ls(i)&&(Bs(i),FeedAssistanceStats.onViewedElement(i)):(i[lr]?delete i[lr]:(Bs(i),FeedAssistanceStats.onEndViewElement(i)),delete i[ur]):(i[ur]=Date.now(),ss.push(i),FeedAssistanceStats.onStartViewElement(i))}),n.forEach(function(e){rl(os,e),FeedAssistanceStats.onStopTrackElement(e)})}function Bs(e){rl(ss,e),cl(e),Ps(al(e)),sl(e)}function Ps(e){e&&As.push(e)}function Ls(e){return!!e[ur]&&Math.min(Jo,Date.now()-e[ur])>function(e){var t=Ss(e);return Gr[t]||Ko}(e)}function Rs(e,t,n,i){if(!e)return!1;e[_r]||(e[_r]=!0,e[mr]=e.offsetHeight,e[vr]=n+e.getBoundingClientRect().top,e[gr]=e[vr]+e[mr]);var a=i-cs-us,o=n+cs,r=n+i-us,s=e[mr],l=e[vr],c=e[gr];return(c>o&&l<r?Math.min(r,c)-Math.max(o,l):0)>=Math.min(a*t,s*t)}function Ns(e,t){var n=e[br];n&&!n[pr]&&~os.indexOf(n)&&(n[pr]=!0,n[Ar]=n.clientWidth,n[hr]=n.getBoundingClientRect().left+n.clientLeft),e[pr]||(e[pr]=!0,e[Ar]=e.offsetWidth);var i=n?n[Ar]||n.clientWidth:getCw(),a=n?n[hr]||n.getBoundingClientRect().left+0:0,o=i+a,r=e[Ar],s=e.getBoundingClientRect().left,l=r+s,c=r*t,u=r*Math.max(0,1-t);return s+c>=a&&l-u<=o}function Fs(){fs=setTimeout($s,Zo),_s=setTimeout(qs,er),ps=setTimeout(Ws,tr),hs=setTimeout(zs,nr)}function Hs(){clearTimeout(fs),clearTimeout(_s),clearTimeout(ps),clearTimeout(hs)}function Us(){ms=setInterval(Qs,ir)}function Vs(){clearInterval(ms)}function $s(){As.length&&Xs(As)}function qs(){Ys(As),As=[],Xs(null)}function Ws(){ss.length&&(Gs(tl(ss)),ps=setTimeout(Ws,ar))}function zs(){clearTimeout(ps),ul(ss),Ys(tl(ss)),ll(ss),ss.forEach(function(e){e[lr]=!0}),ss=[],Gs(null)}function Qs(){As.length>=rr&&qs()}function Ys(e){if(e&&e.length){var t={act:as};t=extend(t,function(e){var t={};return each(e,function(){t[this.type]?t[this.type].push(this.data):t[this.type]=[this.data]}),t}(e)),ajax.post(is,t)}}function Xs(e){Ks(ts,e)}function Gs(e){Ks(ns,e)}function Ks(e,t){var n=lsGet(e)||{};t?n[ls]=t:delete n[ls],lsSet(e,n)}function Js(){var e=Js,t=[],n=lsGet(ts)||{},i=lsGet(ns)||{};return e.iterator||(e.iterator=function(e){return function(n){el(n)&&(t=t.concat(e[n]))}}),Object.keys(n).forEach(e.iterator(n)),Object.keys(i).forEach(e.iterator(i)),t}function Zs(){var e=Zs,t=lsGet(ts)||{},n=lsGet(ns)||{};e.iterator||(e.iterator=function(e){return function(t){el(t)&&delete e[t]}}),Object.keys(t).forEach(e.iterator(t)),Object.keys(n).forEach(e.iterator(n)),lsSet(ts,t),lsSet(ns,n)}function el(e){var t=Number(e);return t!==ls&&Date.now()-t>=or}function tl(e){var t=[];return e.forEach(function(e){var n=al(e);n&&t.push(n)}),t}function nl(e,t){return e+"_"+t}function il(e,t){return(0,Kr[nl(e[sr],t)])(e)}function al(e){if(ol(e))return null;if(!Ls(e))return null;var t=function(e){return Xr[e[sr]]}(e);return{type:t,data:il(e,t)}}function ol(e){return e[dr]||!document.body.contains(e)}function rl(e,t){var n=e.indexOf(t);n>=0&&e.splice(n,1)}function sl(e){ol(e)||Ls(e)&&(e[dr]=!0)}function ll(e){each(e,function(){sl(this)})}function cl(e){e[fr]=Date.now()}function ul(e){e.forEach(cl)}function dl(e){return(e=fl(e))&&domData(e,"from-ref")||Zr}function fl(e){return hasClass(e,es)||(e=domCA(e,"."+es)),e}function _l(e){var t=(new Date).getTime();return e&&(e[fr]||e[ur])||t}FeedAssistanceStats.BLOCKS={BLOCK_TYPE_RECOMMENDED_SLIDER:yr,BLOCK_TYPE_EXPLORE_BAIT:Cr,BLOCK_TYPE_PROFILE_PHOTO:kr,BLOCK_TYPE_PROMO_BUTTON:Sr,BLOCK_TYPE_IMPORT_CONTACTS:Er},FeedAssistanceStats.EVENTS={EVENT_EXPLORE_BAIT:Tr,EVENT_EXPLORE_BAIT_SUB:Mr,EVENT_FEED_ASSISTANCE:Dr,SUB_EVENT_EXPLORE_BAIT_VIEW:xr,SUB_EVENT_EXPLORE_BAIT_LIKE:Br,SUB_EVENT_EXPLORE_BAIT_COMMENT:Pr,SUB_EVENT_EXPLORE_BAIT_OPENED:Lr,SUB_EVENT_EXPLORE_BAIT_SUBSCRIBE:Rr,SUB_EVENT_EXPLORE_BAIT_UNSUBSCRIBE:Nr,SUB_EVENT_EXPLORE_BAIT_OPEN_USER:Fr,SUB_EVENT_EXPLORE_BAIT_OPEN_GROUP:Hr,SUB_EVENT_EXPLORE_BAIT_HIDE:Ur,SUB_EVENT_EXPLORE_BAIT_REPORT:Vr,SUB_EVENT_SEEN:$r,SUB_EVENT_FILLED:qr,EVENT_HIDE_BLOCK:jr,SUB_EVENT_ENABLE_PUSH:Wr,SUB_EVENT_DECLINE_PUSH:zr,EVENT_PROMO_BUTTON:Ir,EVENT_PROMO_BUTTON_SUB:Qr,SUB_EVENT_PROMO_BUTTON_CLICK:Yr},addEvent(window,"blur",Ds),addEvent(window,"focus",js),onDOMReady(function(){setTimeout(ws,500)}),addEvent(window,"scroll",function(){Os(scrollGetY(),getCh())}),nav.onBeforeGo(function(){return Is()}),page.onChange(function(){return Ms()});n("yuVR");var pl=48;function hl(e){return Object.keys(e).map(function(t){return t+":"+e[t]+";"}).join("")}function ml(e){return e+"-"+Date.now()+"-"+Math.round(999999*Math.random())}var Al=[];function vl(e){Al.push(e),gl()}var gl=debounce(function(){var e=Al.map(function(e){return $("#"+e)}).filter(function(e){return e}).map(function(e){var t=Math.round(e.getBoundingClientRect().left),n="skeleton-gradient-slide-"+t;return function(e,t){if(yl[e])return;var n=function(e,t){return["@"+bl()+"keyframes "+e+" {",t.map(function(e,n){return["\t"+n/(t.length-1)*100+"% {",Object.keys(e).map(function(t){return"\t\t"+t+": "+e[t]+";"}).join("\n"),"\t}"].join("\n")}).join("\n"),"}"].join("\n")}(e,t);yl[e]=n,wl.appendChild(document.createTextNode(n))}(n,[{"background-position-x":-600-t+"px"},{"background-position-x":window.innerWidth-t+"px"}]),{el:e,prop:n+" 1.2s infinite cubic-bezier(0.4, 0.0, 0.2, 1)"}});requestAnimationFrame(function(){e.forEach(function(e){var t=e.el,n=e.prop;t.style[bl()+"animation"]=n}),Al=[]})},100);function bl(){var e="";document&&(e=null!=(document.documentElement||document.createElement("div")).style.animation?"":"-webkit-");return e}var yl={},wl=document.createElement("style");function Cl(e){void 0===e&&(e={});var t=ml("skeleton-circle"),n=hl({width:e.size+"px",height:e.size+"px"})+(e.style||""),i=[o.default.class("SkeletonCircle",{header:e.header}),e.class].filter(function(e){return e}).join(" ");return vl(t),{id:t,class:i,style:n,tag:"div"}}document.head.appendChild(wl);function kl(e){void 0===e&&(e={});var t=ml("skeleton-line"),n=hl({})+(e.style||""),i=[o.default.class("SkeletonLine",{small:e.small,header:e.header}),e.class].filter(function(e){return e}).join(" ");return vl(t),{id:t,class:i,style:n,tag:"div"}}function Sl(e){void 0===e&&(e={});var t=[o.default.class("SkeletonRow",{"justify-content":e.justify,"align-items":e.align}),e.class].filter(function(e){return e});return{inner:[e.inner],class:t.join(" "),tag:"div"}}function El(e){void 0===e&&(e={});var t=[o.default.class("SkeletonCol",{auto:e.auto,grow:e.grow,"flex-column":e.flexColumn}),e.class].filter(function(e){return e}).join(" ");return{inner:[e.inner],class:t,tag:"div"}}function Ol(e){void 0===e&&(e={});var t=[o.default.class("SkeletonOffset",{small:e.small}),e.class].filter(function(e){return e});return{inner:[e.inner],class:t.join(" "),tag:"div"}}function Tl(e){void 0===e&&(e={});var t=hl({opacity:e.opacity});return{inner:[Sl({inner:[El({inner:[Cl({size:40,style:t})],auto:!0}),El({inner:[Sl({inner:[El({inner:[kl({style:t})],grow:3}),El({grow:4})]}),Sl({inner:[El({inner:[kl({small:!0,style:t})]}),El({grow:3})]})],flexColumn:!0})]}),Ol(),Sl({inner:[El({inner:[kl({style:t})],grow:4}),El({inner:[kl({style:t})],grow:3})]}),Ol(),Sl({inner:[El({inner:[kl({style:t})],grow:4}),El({grow:1})]}),Ol(),Sl({inner:[El({inner:[kl({style:t})],grow:4}),El({grow:3})]}),Ol(),Ol(),Sl({inner:[El({inner:[Cl({size:20,style:t})],auto:!0}),Ol(),El({inner:[Cl({size:20,style:t})],auto:!0}),Ol(),El({inner:[Cl({size:20,style:t})],auto:!0}),El({grow:1}),El({inner:[Cl({size:20,style:t})],auto:!0})]})],class:"SkeletonWallBlock",tag:"div"}}function Dl(e){void 0===e&&(e={});var t=ml("skeleton-search"),n=hl({})+(e.style||""),i=[o.default.class("SkeletonSearch",{small:e.small,header:e.header}),e.class].filter(function(e){return e}).join(" ");return vl(t),{id:t,class:i,style:n,tag:"div"}}function jl(e){return{inner:[Sl({inner:[El({inner:[Sl({inner:[El({inner:[Dl({header:!0})]}),Ol({small:!0}),El({inner:[Cl({header:!0,size:20})],auto:!0})]})],flexColumn:!0})]})],class:"SkeletonSearchHeader",tag:"div"}}function Il(e){for(var t=Math.ceil((window.innerHeight-pl)/210),n=[],i=0;i<t;i++)n.push(Tl());return{inner:[jl(),n],class:"SkeletonRecommended Skeleton",tag:"div"}}function Ml(e){void 0===e&&(e={});var t=hl({opacity:e.opacity});return{inner:[Sl({inner:[El({inner:[Cl({size:50,style:t})],auto:!0}),El({inner:[Sl({inner:[El({inner:[kl({style:t})],grow:3}),El({grow:4}),El({inner:[kl({style:t})]})],justify:"center"}),Sl({inner:[El({inner:[kl({style:t})]}),El({inner:[kl({style:t})],grow:5}),El({grow:3,style:t})]})],flexColumn:!0})]})],class:"SkeletonChatBlock",tag:"div"}}function xl(e){void 0===e&&(e={});var t={};e.hideIcon&&(t.visibility="hidden");var n=hl(t);return{inner:[Sl({inner:[El({inner:[Sl({inner:[El({inner:[kl({header:!0})],grow:4}),El({grow:5}),El({inner:[Cl({header:!0,size:20,style:n})],auto:!0})]})],flexColumn:!0})]})],class:"SkeletonHeader",tag:"div"}}function Bl(e){return{inner:[Dl()],class:"SkeletonSearchBlock",tag:"div"}}function Pl(e){for(var t=Math.ceil((window.innerHeight-pl)/70),n=[],i=0;i<t;i++)n.push(Ml());return{inner:[xl(),Bl(),n],class:"SkeletonMessages Skeleton",tag:"div"}}function Ll(e){void 0===e&&(e={});var t=hl({opacity:e.opacity});return{inner:[Cl({class:"SkeletonStory__avatar",size:56,style:t}),Ol({small:!0}),Sl({inner:[Ol({small:!0}),El({inner:[kl({small:!0,style:t})]}),Ol({small:!0})]})],class:"SkeletonStory",tag:"div"}}function Rl(e){void 0===e&&(e={});for(var t=Math.ceil(window.innerWidth/76),n=[],i=0;i<t;i++)n.push(El({inner:[Ll()],auto:!0})),n.push(Ol({small:!0}));return{inner:[Sl({inner:[n]})],class:"SkeletonStoriesBlock",tag:"div"}}function Nl(e){return{inner:[Sl({inner:[El({inner:[Cl({size:36})],auto:!0}),El({inner:[kl()]}),El(),El({inner:[Cl({size:20})],auto:!0})],justify:"center"})],class:"SkeletonNewPostBlock",tag:"div"}}function Fl(e){for(var t=Math.ceil((window.innerHeight-pl-180)/210),n=[],i=0;i<t;i++)n.push(Tl());return{inner:[xl(),Rl(),Nl(),n],class:"SkeletonFeed Skeleton",tag:"div"}}function Hl(e){void 0===e&&(e={});var t=ml("skeleton-line"),n=hl({width:e.size+"px",height:e.size+"px"})+(e.style||""),i=[o.default.class("SkeletonSquare",{}),e.class].filter(function(e){return e}).join(" ");return vl(t),{id:t,class:i,style:n,tag:"div"}}function Ul(e){return{inner:[Sl({inner:[El({inner:[Cl({size:48}),Cl({size:20,class:"SkeletonNotificationBlock__badge"})],auto:!0,class:"SkeletonNotificationBlock__avatar"}),El({inner:[Ol({small:!0}),Sl({inner:[El({inner:[kl()]})]}),Sl({inner:[El({inner:[kl()],grow:2}),El()]}),Sl({inner:[El({inner:[kl({small:!0})]}),El({grow:5})]})],grow:6}),El(),El({inner:[Hl({size:48})],auto:!0})],align:"flex-start"}),Ol(),Ol(),Sl({inner:[El({inner:[Cl({size:48})],auto:!0}),El({inner:[Ol({small:!0}),Sl({inner:[El({inner:[kl()]})]}),Sl({inner:[El({inner:[kl({small:!0})]}),El({grow:5})]}),Ol()],grow:4}),El({inner:[Ol()]})],align:"flex-start"})],class:"SkeletonNotificationBlock",tag:"div"}}function Vl(e){for(var t=Math.ceil((window.innerHeight-pl)/170),n=[],i=0;i<t;i++)n.push(Ul());return{inner:[xl({hideIcon:!0}),{inner:[Sl({inner:[El({inner:[kl()],grow:3}),El({grow:2}),El({inner:[kl()],grow:2})]})],class:"SkeletonNotifications__info",tag:"div"},n],class:"SkeletonNotifications Skeleton",tag:"div"}}var $l=function(){var e,t="_BottomMenu__icon_js",n="BottomMenu__icon_active",a="BottomMenu__counter",o="BottomMenu__updateButton",r="BottomMenu",s="vk_tabbar_hidden",l="data-tabbar",c="data-counter",u="feed",d="recommend",f="messages",_="notification",p="menu",h=Math.max(window.innerHeight,window.innerWidth),m=[u,d,f,_,p],A="",v={},g=((e={})[u]=0,e[d]=0,e[f]=0,e[_]=0,e[p]=0,e);function b(e){var t=geBySel1("["+l+'="'+e+'"]');return attr(t,"data-default")}function y(e){each(geBySel("["+l+"]"),function(n,i){var o=geByClass1(t,i),r=geByClass1(a,o),s=attr(i,c),u=attr(i,l);e({i:n,tabId:u,counter:s,$link:i,$icon:o,$counter:r})})}function w(){y(function(e){var t=e.$counter,n=e.$icon,i=(e.$link,e.tabId),o=g[i];if(o&&0!==o)if(t)val(t,o);else{var r=ce("div",{className:a,innerHTML:o});append(r,n)}else val(n,"")})}function C(e){setTimeout(function(){k()},0),val(geByClass1("mcont",e),'<div class="pcont bl_cont"><div id="al_loading" class="BottomMenu__preloader"></div></div>')}function k(){var e=$("."+o);remove(e)}return{setCurrentId:function(e){A=e},setHistory:function(e){v=extend({},e)},setCounter:function(e,t){g[e]=t?parseInt(t,10):0,w()},getCurrentId:function(){return A},getDefaultURL:b,getTabCounter:function(e){return g[e]?g[e]:0},drawUI:function(){y(function(e){var t=e.$icon,i=e.$link,a=e.tabId,o=v[a];if(o){var r=o.filter(function(e){return!0===e.current})||[];r.length&&a!==f&&attr(i,"href",r[0].a);var s=attr(i,"href");a!==A||!r.length||r[0].a!==s&&r[0].d!==s||attr(i,"href",b(a))}toggleClass(n,t,a===A)}),w()},drawUICounters:w,drawLoader:C,drawSkeletonLoader:function(e,t){if(hasClass(document.querySelector(".vk"),"vk_flex_yes"))switch(setTimeout(function(){k()},0),t){case u:$(".mcont",e).innerHTML=Wd.html(Fl());break;case f:$(".mcont",e).innerHTML=Wd.html(Pl());break;case _:$(".mcont",e).innerHTML=Wd.html(Vl());break;case d:$(".mcont",e).innerHTML=Wd.html(Il());break;case p:default:C(e)}else C(e)},showUpdateButton:function(e){var t=window.lang,n=Wd.html({class:o,inner:{class:"BottomMenu__updateButton_container",inner:{class:"BottomMenu__updateButton_wrap",onclick:["nav.updateCurrentPage"],inner:[{class:"BottomMenu__updateButton_icon",inner:{class:"Icon Icon_whiteArrowTop"}},{class:"BottomMenu__updateButton_text",inner:t.mobile_menu_refresh_button}]}}}),i=hasClass("vk_custom_scroll",geByTag1("body")),a=e.$(i?".basis":".upanel");a.$("."+o)||a.insertBefore(ceFromString(n),a.firstChild)},removeUpdateButton:k,onFocusIn:function(e){var t=geBySel1("."+r),n=e&&e.target;if(n&&t&&browser.android){var i=!1;"textarea"===n.tagName.toLowerCase()&&(i=!0),"input"!==n.tagName.toLowerCase()||["checkbox","radio"].includes(n.type)||(i=!0),"select"===n.tagName.toLowerCase()&&(i=!0),i&&t.classList.add(s)}},onFocusOut:function(){var e=geBySel1("."+r);e&&e.classList.remove(s)},onResize:function(){var e=window.bodyNode;$(".Skeleton")&&($(".mcont").innerHTML='<div class="pcont bl_cont"><div id="al_loading"></div></div>',Object(i.alLoadingFix)()),e&&e.classList.contains("vk_tabbar_bottom")&&0===Math.abs(window.orientation)&&h-180>window.innerHeight?e.classList.add(s):e&&e.classList.remove(s)},setDefaultCounters:function(){y(function(e){var t=e.tabId,n=e.counter;g[t]=n?parseInt(n,10):0}),w()},TAB_ID_FEED:u,TAB_ID_RECOMMEND:d,TAB_ID_MESSAGES:f,TAB_ID_NOTIFICATION:_,TAB_ID_MENU:p,TAB_IDS:m}}();window.Tabbar=$l;var ql=$l;window.isNewNavigation&&(page.onRestore($l.drawUI),page.onChange($l.drawUI),onDOMReady(function(){var e;$l.setDefaultCounters(),addEvent(window,"resize",function(){$l.onResize(),clearTimeout(e),e=setTimeout(function(){$l.onResize()},300)})})),page.onChange(Xl),photoview.onHide(Xl),photoview.onShow(Gl);var Wl,zl="#5181b8",Ql="#000",Yl=Object(v.$)('meta[name="theme-color"]');function Xl(){Kl(zl)}function Gl(){Kl(Ql)}function Kl(e){Wl||(Wl=Object(v.$)("#theme_color_shim")),Yl&&Yl.setAttribute("content",e),Wl&&(Wl.style.backgroundColor=e)}n("U34x");var Jl,Zl,ec,tc,nc,ic="groupCover-vk_animationYes",ac="groupCover-vk_animationStep",oc=function(){return{vk:geByClass1("vk"),basis:geByClass1("basis"),header:geByClass1("basis__header"),headerTitle:geByClass1("mh_header",geByClass1("basis__header")),cover:geByClass1("groupCover"),coverImage:geByClass1("groupCover__image"),coverDimmer:geByClass1("groupCover__dimmer")}},rc=!1;function sc(){rc||(Jl=oc()).cover&&(rc=!0,addClass(Jl.vk,ic),Zl=!d.default.chrome||Number(d.default.version.split(".")[0])>50,ec="fixed"===getStyle(Jl.header,"position"),tc=getH(Jl.header),nc=getH(Jl.cover),onBodyScroll(cc),onBodyResize(uc),cc(),window.cur.destroy=window.cur.destroy.filter(function(e){return e!==lc}),window.cur.destroy.push(lc))}function lc(){(!0||menu.opened())&&(removeClass(Jl.vk,ac),removeClass(Jl.vk,ic)),onBodyScroll("__clear",cc),onBodyResize("__clear",uc),rc=!1}function cc(){var e=scrollTop();if(ec)if(e<0)setStyle(Jl.header,"top",-e),addClass(Jl.vk,ac),setStyle(Jl.coverDimmer,"opacity",0),setStyle(Jl.coverImage,"top",0);else{var t=document.body,n=Math.min(1,e/(nc-tc)),i=t&&t.classList.contains("vk_tabbar_top")&&!Jl.header.classList.contains("basis__header_noBottomMenu")?48:0;setStyle(Jl.header,"top",i),setStyle(Jl.headerTitle,"display","block"),n<=.9?(addClass(Jl.vk,ac),Zl&&setStyle(Jl.coverImage,"top",.5*e),setStyle(Jl.coverDimmer,"opacity",n/.9),setStyle(Jl.headerTitle,"opacity",0)):(setStyle(Jl.headerTitle,"opacity",1),removeClass(Jl.vk,ac))}else Math.min(1,e/nc)<1?(addClass(Jl.vk,ac),setStyle(Jl.coverDimmer,"opacity",0),Zl&&setStyle(Jl.coverImage,"top",.5*e),setStyle(Jl.headerTitle,"display","none")):removeClass(Jl.vk,ac)}function uc(){lc(),sc()}onDOMReady(function(){(d.default.chrome||d.default.safari&&d.default.ios>=9)&&(sc(),page.onChange(sc),zlayer.onClose(function(){setTimeout(sc,0)}))});n("l51W"),n("BLcx"),n("nXjO");var dc="tabs_block",fc="mhb_back",_c="TopMenu_open",pc="TopMenu__switcher_on",hc=function(){return geByClass1(dc)},mc=function(){return geByClass1(fc)},Ac=function(){return geByClass1("TopMenu__switcher")},vc=function(){return geByClass1("tab_item_top")},gc=!0,bc=0;function yc(e){stopEvent(e),preventEvent(e),bc=300,gc&&(toggleClass(pc,Ac()),"touchstart"===e.type&&setTimeout(function(){nav.go(vc(),null)},130))}function wc(e){gpeByClass(dc,e.target)||gpeByClass(fc,e.target)||(stopEvent(e),preventEvent(e),removeClass(_c,hc()),Cc())}function Cc(){removeEvent(window,"touchstart mousedown",wc)}window.TopMenu={onHeaderClick:function(e){if(!gc)return;var t=hc();if(stopEvent(e),preventEvent(e),hasClass(_c,t))removeClass(_c,t);else{var n=mc(),i=vc();addClass(_c,t),geByClass1("_hfixed")&&setStyle(t,"max-height",window.innerHeight-70),append(t,n),addEvent(window,"touchstart mousedown",wc),addEvent(i,"touchstart mousedown",yc),addEvent(i,"click",function(e){stopEvent(e),preventEvent(e)}),cur.destroy.push(Cc),cur.destroy.push(function(){return removeEvent(i,"touchstart mousedown",yc)})}}},nav.onBeforeGo(function(){gc=!1,setTimeout(function(){removeClass(_c,hc()),bc=0,gc=!0},bc)});n("BQMu"),n("zHNa"),n("zouF");function kc(e,t,n){return{class:["Popup__button",o.default.class("Btn",{theme:t||"regular"})],tag:"button",inner:e,onclick:n}}page.onChange(function(){$$(".AlertBox").forEach(function(e){return je.default.close(e)})}),window.AlertBox=function(e,t,n,a){void 0===a&&(a={});var o=Object(i.ceFromString)(s.default.html(Object(je.default)({id:a.id,class:"AlertBox",scrollable:!0,header:{title:t||getLang("mobile_warning_header")},content:[e,{class:"Popup__buttons",inner:[kc(getLang("mobile_close"),"secondary",n||"Popup.close(this)")]}]})));domInsert(document.body,o),je.default.open(o,!0)};var Sc=function(){var e={UP:38,DOWN:40,RETURN:13,ESC:27},t="MentionContainer_opened",n="Mention_inited",i="Mention_noScroll",a="MentionItem_active",o={},s={},l=!1;function c(){o={ignoredTerm:null,curValue:"",curTerm:"",curPos:"",input:{}},s={container:null,scroll:null,index:{},cache:{},shown:[],lastQ:null,text:null,requestTimer:null,opts:{}}}c();var u=!0;function d(){u=!1}function f(){var e=val(o.input),t=Math.max(e.lastIndexOf("@"),e.lastIndexOf("*")),n=!1;if(t>-1){var i=function(e){if(void 0!==e.selectionStart)return e.selectionStart!==e.selectionEnd?e.selectionEnd:e.selectionStart;if(void 0!==window.getSelection){var t=window.getSelection();if(!t||!t.rangeCount)return 0;var n=t.getRangeAt(0),i=n.cloneRange(),a=ce("div");return i.selectNodeContents(e),i.setEnd(n.startContainer,n.startOffset),a.appendChild(i.cloneContents()),val(a).replace(/\n$/,"").length}return 0}(o.input),a=e.substr(0,i);t=Math.max(a.lastIndexOf("@"),a.lastIndexOf("*"));var r=a.match(/(^|[\s.,:\'\"\u00BB\u00AB;>\)\(]|\#[\w_\.\u0400-\u04FF]+)[@\*]([^,@\*\(\)\?\!\s\n\r \u00A0]*)$/);r&&"."!==r[2].substr(-1)&&(n=r[2])}!1===n&&delete o.ignoredTerm,void 0!==o.ignoredTerm&&n==o.ignoredTerm&&(n=!1),o.curValue=e,o.curTerm=n,o.curPos=t,s.text=n,!1===o.curTerm?h():(w(!1,o.curTerm),p(),function(){var e=ge("mhead").offsetHeight,t=s.container.getBoundingClientRect(),n=o.input.offsetHeight,i=parseInt(getStyle(s.scroll,"maxHeight"),10),a=!1;a=hasClass("Mention_openToBottom",s.container)?t.top-n-i<e:t.bottom-i<e,getXY(o.input)[1]>=e+i&&(a=!1),toggleClass("Mention_openToBottom",s.container,a),toggleClass("Mention_openToBottom",s.opts.appendTo,a)}())}function _(e){o.input=e}function p(){T(),document.addEventListener("click",m,!0),addClass(t,s.opts.appendTo),show(s.container),function(){if(!l){var e=browser.ipad?"touchend":"click";l=!0,addEvent(window,e,h),addEvent(window,"touchmove",d),nav.onBeforeGo(h)}}()}function h(e){!browser.ipad||u?e&&e.target&&gpeByClass(n,e.target)&&!gpeByClass("uMailWrite__button",e.target)&&!hasClass("uMailWrite__button",e.target)||hasClass(t,s.opts.appendTo)&&(removeClass(t,s.opts.appendTo),hide(s.container),function(){if(l){var e=browser.ipad?"touchend":"click";removeEvent(window,e,h),removeEvent(window,"touchmove",d),nav.onBeforeGo.off(h),l=!1}}()):u=!0}function m(e){var t=e.target;t&&!gpeByClass(n,t)&&(e.preventDefault(),e.stopImmediatePropagation(),h()),document.removeEventListener("click",m,!0)}function A(e){void 0===e&&(e={}),s.opts=extend(s.opts,e),v(),w(!0)}function v(){var e,t,n=s.opts.defaultItems,i=s.opts.items,a=[];for(e=0,t=n.length;e<t;++e)a.push(e);for(s.cache[""]=a,e=0,t=i.length;e<t;++e)g(e,i[e])}function g(e,t){var n,i,a,o="",r=s.opts.searchKeys,l={};for(n=0,a=r.length;n<a;++n)o+=" "+(t[r[n]]||"").replace(s.opts.delimeter," ").replace(/<[^>]*>/g,"");for(o+=(parseLat(o)||"")+(parseCyr(o)||""),o=trim(o.toLowerCase()).split(/\s+/),n=0;n<o.length;n++)for(i=1;i<=s.opts.wholeIndex;i++){var c=o[n].substr(0,i);l[c]||(s.index[c]||(s.index[c]=[]),s.index[c].push(e),l[c]=1)}}function b(){var e=trim(s.text);e&&ajax.post(s.opts.url,extend({str:e,mobile:1},s.opts.params||{}),{onDone:function(t){s.cache[e]=y(e).concat(t),C(s.cache[e],!0)}})}function y(e){if(!(e=trim(e.toLowerCase().replace(s.opts.delimeter," "))))return s.cache[""];var t=s.opts.wholeIndex;if(e.length<=t&&-1===e.indexOf(" "))return s.index[e]||[];var n,i,a=0,o="";for(n=0,i=(e=e.split(" ")).length;n<i;++n){var r=e[n].substr(0,t),l=s.index[r];if((!o||!l||l.length<a)&&(a=l?l.length:0,o=r),!a)return[]}var c=[],u=s.opts.searchKeys,d=u.length,f=e.length;for(n=0,i=s.index[o].length;n<i;++n){for(var _=s.index[o][n],p=s.opts.items[_],h=!1,m="",A=0;A<d;++A)m+=" "+(p[u[A]]||"").replace(s.opts.delimeter," ").replace(/<[^>]*>/g,"");m=(m+=(parseLat(m)||"")+(parseCyr(m)||"")).toLowerCase();for(var v=0;v<f;++v)if(-1===m.indexOf(" "+e[v])){h=!0;break}h||c.push(_)}return c}function w(e,t){if(s.cache[""])if(t=void 0!==t?t:trim(s.text),s.lastQ!==t||e){s.lastQ=t,clearTimeout(s.requestTimer);var n=s.cache[t];n?C(n,!0):(C(n=y(t),!s.opts.url),s.opts.url&&(s.requestTimer=setTimeout(b,s.opts.requestWait)))}else p()}function C(e,t){var n=[];s.shown=[];for(var a=e.slice(0,s.opts.maxItems),o=0,r=a.length;o<r;++o){var l=a[o];isArray(l)||(l=s.opts.items[l]),s.shown[l[0]]||(s.shown[l[0]]=l,n.push(k(l)))}s.container&&s.opts.appendTo.contains(s.container)||(s.container=ce("div"),addClass("Mention",s.container),s.scroll=ce("div"),addClass("ScrollView Mention__scroll",s.scroll),Object(J.setScrollView)(s.scroll,{topBanner:!1}),s.opts.appendTo.appendChild(s.container),s.container.appendChild(s.scroll),addEvent(s.scroll,"touchmove",function(e){hasClass(i,s.scroll)&&preventEvent(e)})),toggleClass("Mention_empty",s.container,!n.length),val(s.scroll,n.join("")),s.scroll.scrollTop=0,E(),setTimeout(function(){toggleClass(i,s.scroll,!function(){if(!browser.ios&&!browser.ipad)return!0;if(s.scroll.scrollHeight>s.scroll.offsetHeight)return!0;return!1}())},0)}function k(e){var t=e[0],n=e[1],i=e[2];return'<div class="MentionItem" onclick="Mention.onSelect(\''+t+'\');" onmouseover="Mention.onItemHover(this);">\n              <div class="MentionItem__cell">\n                <img src="'+e[3]+'" class="MentionItem__img"/>\n              </div>\n              <div class="MentionItem__cell MentionItem__cell_name">\n                <div class="MentionItem__name">'+n+'</div>\n                <div class="MentionItem__tag">'+i+"</div>\n              </div>\n            </div>"}function S(){var e=geByClass1(a,s.container),t=e.offsetTop;s.scroll.scrollTop=t-e.offsetHeight-parseInt(getStyle(s.scroll,"paddingTop"),10)}function E(e){void 0===e&&(e=null);var t=geByClass("MentionItem",s.container);if(t.length){var n=t.find(function(e){return hasClass(a,e)});e?(removeClass(a,n),addClass(a,e)):n||addClass(a,t[0])}}function O(e,t){setTimeout(function(){_(t),f()},0)}var T=Object(r.default)();return{onKeyUp:function(t,n){t.keyCode!==e.UP&&t.keyCode!==e.DOWN&&(w(!0),_(n),f())},onKeyDown:function(n,i){var o;hasClass(t,s.opts.appendTo)&&(n.keyCode===e.UP?(!function(){var e=geByClass1(a,s.container);if(e){var t=domPS(e);t&&(E(t),S())}else E(),S()}(),n.preventDefault()):n.keyCode===e.DOWN?(!function(){var e=geByClass1(a,s.container);if(e){var t=domNS(e);t&&(E(t),S())}else E(),S()}(),n.preventDefault()):n.keyCode===e.RETURN?(o=geByClass1(a,s.container))&&(o.click(),1)&&n.preventDefault():n.keyCode===e.ESC&&(h(),n.preventDefault()))},onFocus:O,onClick:O,onSelect:function(e){var t=s.shown[e];t&&function(e){if(!e)return!1;var t,n=e[2].replace("@",""),i=o.curValue.substr(0,o.curPos),a=o.curValue.substr(o.curPos),r=!!i.match(/\#[\w_\.\u0400-\u04FF]+$/i);s.opts.preferDomain&&e[9]&&(r=!0);r||(t=replaceEntities(e[8]||e[1]));var l=new RegExp("^(@|\\*)"+escapeRE(o.curTerm)+"(?:\\s+\\((?:(.*?)\\))?\\s*)?","");a=a.replace(l,function(e,i,a){var o=i+n+" ";return r||(o+="("+t.replace(/[\(\)\]\[]/g,"")+") "),o}),r||!i||i.match(/[\.\(\)\?\!\s\n\r\'\"\u00BB\u00AB \u00A0]$/)||(a=" "+a);h(),val(o.input,i+a),elfocus(o.input),s.opts.afterInsert&&s.opts.afterInsert(o.input)}(t),h()},onItemHover:function(e){E(e)},onOpen:T,init:function(e){void 0===e&&(e={}),c(),s.opts=extend({appendTo:document.body,url:"hints",params:{act:"a_json_friends",from:"composer"},delimeter:/[\s\(\)\.,\-]+/g,requestWait:300,wholeIndex:2,maxItems:51,searchKeys:[1,4],preferDomain:!1,defaultItems:[],items:[],afterInsert:function(){}},e),addClass("Mention_inited",s.opts.appendTo),s.scroll&&removeClass(i,s.scroll),v()},update:A,addItems:function(e){e=s.opts.defaultItems.concat(e);var t={};e.filter(function(e){return!t[e[0]]&&(t[e[0]]=!0,!0)}),A({defaultItems:e,items:e})}}}();window.Mention=Sc;n("OGWK"),n("ciqL");var Ec={cachedProgress:{}},Oc={init:function(e,t){return void 0===e&&(e=Object(i.srand)()),void 0===t&&(t=20),this.radius=t,{component:this._getLoader(e,Ec.cachedProgress[e]),id:e}},update:function(e,t){var n=$('[data-loader-id="'+e+'"] circle');if(n){var i=this.radius,a=Math.PI*(2*i);Ec.cachedProgress[e]=t;var o=(100-Math.max(5,t))/100*a;n.setAttribute("stroke-dashoffset",o)}},ready:function(e){var t=$('[data-loader-id="'+e+'"]');re(t)},_getLoader:function(e,t){void 0===t&&(t=0);var n=this.radius,i=Math.PI*(2*n);return{class:"Loader",inner:[{class:"Loader__progress","data-loader-id":e,inner:{tag:"svg",viewPort:"0 0 100 100",inner:{tag:"circle",r:n,cx:"30",cy:"30","stroke-dashoffset":(100-Math.max(5,t))/100*i,"stroke-dasharray":i}}}]}}},Tc=(n("tqja"),n("aiw/")),Dc=function(){function e(){window.isCustomScroll&&(document.body.classList.contains("vk__page_mail")||J.restoreDocumentScroll())}return{init:function(){if(window.isCustomScroll&&!document.body.classList.contains("vk__page_mail")){var t=ge("mcont");t&&t.classList.contains("ScrollView")?J.init():e(),Tc.onClose()}},restore:e}}();onDOMReady(function(){Dc.init(),page.onChange(function(){Dc.init()})}),window.ContentScrollView=Dc;var jc,Ic,Mc,xc,Bc,Pc,Lc,Rc=".basis__header",Nc="basis__header_noshadow",Fc="basis__header_noshadowAnim",Hc="basis__header_noTransition",Uc="basis__header_hidden",Vc="BottomMenu__updateButton_offset",$c=5,qc=20,Wc=200,zc=!1,Qc=Object(i.scrollTop)(),Yc=56,Xc=!1,Gc=!1,Kc=[];function Jc(e){void 0===e&&(e=nu()),e.classList.remove(Uc)}function Zc(){var e=Object(i.scrollTop)();if(jc){tu(jc,e);var t=Object(i.ge)("mcont");if(t){var n=$(".BottomMenu__updateButton"),a=Math.max(t.scrollHeight,parseInt(Object(i.getStyle)(t,"height"),10));if(Gc&&e)return;if(Math.abs(Qc-e)<=Yc)return;e>Qc+qc&&e>Yc?(!function(e){void 0===e&&(e=nu()),e.classList.add(Uc)}(jc),n&&n.classList.add(Vc),Gc=!0,setTimeout(function(){Gc=!1},Wc)):e+window.innerHeight<a&&(Jc(jc),n&&n.classList.remove(Vc))}Qc=e}}function eu(){if(zc&&(clearInterval(Bc),Object(i.onBodyScroll)("__clear",Ic),removeEvent(window,"touchend",Mc),Kc.forEach(function(e){removeEvent(e,"blur",Mc)}),zc=!1),!zc){jc=nu(),Yc=parseInt(Object(i.getStyle)(jc,"height"),10),Qc=Object(i.scrollTop)();var e=$(".BottomMenu__updateButton");jc&&(jc.classList.add(Hc),Jc(jc),e&&e.classList.remove(Vc)),tu(jc,Object(i.scrollTop)()),Ic=function(){Xc=!0},Mc=function(){clearInterval(xc),xc=setTimeout(function(){var t=Object(i.ge)("mcont");if(t){var n=Math.max(t.scrollHeight,parseInt(Object(i.getStyle)(t,"height"),10));window.innerHeight>n&&n&&(Jc(jc),e&&e.classList.remove(Vc))}},100)},setTimeout(function(){Xc=!1},0),setTimeout(function(){jc&&jc.classList.remove(Hc)},200),zc||(Bc=setInterval(function(){Xc&&(Zc(),Xc=!1)},250),Object(i.onBodyScroll)(Ic),addEvent(window,"touchend",Mc),(Kc=Array.from($$("input, textarea")||[])).forEach(function(e){addEvent(e,"blur",Mc)}),zc=!0)}}function tu(e,t){t<=$c&&e&&e.classList.contains(Nc)?e.classList.add(Fc):e&&e.classList.remove(Fc)}function nu(){return $(Rc)}function iu(){(jc=nu())&&(Jc(jc),tu(jc,Object(i.scrollTop)()))}onDOMReady(function(){eu(),window.page.onChange(eu),onBodyResize(iu),addEvent(window,"orientationchange",iu),addEvent(window,"blur",iu)}),Pc="",Lc=function(){Pc=nav.cur,function(){if(Object(m.partConfigEnabled)("geminus_counter")){var e="pzBAVLtpzyiyDVIwmwjmX5a2zSVdA6eUI7mpf0ufDFf.57";if(window.pp_gemius_identifier)window.pp_gemius_hit(e);else{window.pp_gemius_identifier=e;var t=function(e){window[e]=window[e]||function(){var t=window[e+"_pdata"]=window[e+"_pdata"]||[];t[t.length]=arguments}};t("gemius_hit"),t("gemius_event"),t("pp_gemius_hit"),t("pp_gemius_event"),function(e,t){try{var n=e.createElement(t),i=e.getElementsByTagName(t)[0],a="http"+("https:"==location.protocol?"s":"");n.setAttribute("async","async"),n.setAttribute("defer","defer"),n.src=a+"://galv.hit.gemius.pl/xgemius.js",i.parentNode.insertBefore(n,i)}catch(e){}}(document,"script")}}}()},onDOMReady(function(){Lc(),window.page.onChange(function(){Pc!==nav.cur&&Lc()})});var au={start:function(e,t){var n=this;if(t.stopPropagation(),t.preventDefault(),this.id=window.domData(e,"id"),this.id&&(Object(tt.statlogsValueEvent)("special_event","click",this.platform,this.id),!this.timeoutHandle)){var i=Number(window.domData(e,"v"))||0;this.duration||(this.duration=Number(window.domData(e,"duration"))||0),this.duration&&(!this.animationData||!this.animationData.v||"number"==typeof this.v&&this.v!==i?(this.v=i,Promise.all([this._getAnimation(),this._loadAnimator()]).then(function(e){var t=e[0],i=e[1];n.animationData=JSON.parse(t),n.animator=i,n._play()})):this._play())}},_getAnimation:function(){var e=this;return new Promise(function(t){var n=new XMLHttpRequest;n.open("GET","/images/stickers/special/"+e.id+"/animation.json?v="+e.v,!0),n.send(),n.onreadystatechange=function(){4===n.readyState&&t(n.responseText)}})},_play:function(){var e=this;if(this.animator){this.frame||(this.frame=document.createElement("div"),this.frame.className="special_event_frame",document.body.appendChild(this.frame)),this.frame.style.display="block";var t=this.animator.loadAnimation({container:this.frame,renderer:"svg",loop:!0,autoplay:!0,animationData:this.animationData});this.timeoutHandle=setTimeout(function(){t.stop(),t.destroy(),e.frame.style.display="none",e.timeoutHandle=null,Object(tt.statlogsValueEvent)("special_event","showed",e.platform,e.id)},this.duration)}},init:function(e){var t=e.platform,n=e.animatorLoader;this.platform=t,this._loadAnimator=n}};au.init({platform:"mvk",animatorLoader:function(){return n.e(0).then(n.bind(null,"P3dz")).then(function(e){return e.default})}}),window.SpecialEvent=au;var ou={onIframeReady:Object(r.default)("{ is_api, check_transfer_url, on_success_url }"),onPostMessage:Object(r.default)(),onAcceptCookieClick:Object(r.default)()};function ru(e){var t;if(e.origin.match(/^https?:\/\/([a-zA-Z0-9\-\.]+\.)?money\.mail\.ru$/)){try{t=JSON.parse(e.data)}catch(e){t={}}"billing"===t.type&&ou.onPostMessage(t.action,t.action_params)}}ou.onIframeReady(function(){addEvent(window,"message",ru),window.cur.destroy.push(function(){removeEvent(window,"message",ru)})}),window.BasisMoneyTransfer=ou;var su=ou;su.onPostMessage(function(e){"waiterStart"!==e&&"3dsPage"!==e||document.activeElement&&document.activeElement.blur()});su.onPostMessage(function(e,t){"resizeFrame"===e&&setStyle(geByClass1("pageMoneyTransfer__iframe"),"height",t.height+40)});var lu=["touchstart","touchend","touchmove","touchcancel"];su.onIframeReady(function(e){e.is_api&&registeredEvents.forEach(function(e){var t=e[0],n=e[1],i=e[2];lu.indexOf(n)>=0&&removeEvent(t,n,i)})}),su.onPostMessage(function(e){"putPixel"!==e&&"addCard"!==e&&window.scrollTop(0)});var cu,uu,du,fu="pageMoneyTransfer",_u="pageMoneyTransfer_error",pu="pageMoneyTransfer__errorText",hu="pageMoneyTransfer__iframe",mu=2e3;su.onIframeReady(function(e){vu(),uu={checkUrl:e.check_transfer_url,onSuccessUrl:e.on_success_url},bu(),window.cur.destroy.push(yu)}),su.onPostMessage(function(e,t){if("paySuccess"===e)addClass("pageMoneyTransfer_success",geByClass1(fu));else if("payError"===e)yu(),addClass(_u,geByClass1(fu)),val(geByClass1(pu),t.descr);else if("session_fail"===e){if(Au)return void gu();yu(),addClass(_u,geByClass1(fu)),addClass("pageMoneyTransfer_errorCookie",geByClass1(fu))}else if("putPixel"===e&&"page_load"===t.alias){var n=null;Object(i.isVkWebView)()&&(Object(i.isIosWebView)()?n="iphone":isAndroidWebView()&&(n="android")),n||(n=""),Object(i.statlogsValueEvent)("money_transfers",0,"iframe_loaded",n)}});var Au=0;function vu(){var e=geByClass1(hu);if(e){var t=e.contentWindow.document;t.open("text/html","replace"),t.write(attr(e,"data-html")),t.close()}else setTimeout(vu,2e3)}function gu(){var e=geByClass1(hu);if(e){var t=ce("div",{innerHTML:attr(e,"data-html")});hide(e),geByClass1(fu).appendChild(t),ge("payment_form").submit()}else setTimeout(gu,2e3)}function bu(){var e=uu,t=e.checkUrl,n=e.onSuccessUrl;cu=setInterval(function(){du=ajax.post(t,{},{onDone:function(e,t,i){if(1===e||3===e){if(yu(),i)return void nav.go(i,null,{replace:!0});"/"===n[0]?nav.go(n,null,{replace:!0}):location.href=n}else 2===e&&(yu(),addClass(_u,geByClass1(fu)),val(geByClass1(pu),t))}})},mu)}function yu(){cu&&(clearInterval(cu),cu=null),du&&(du.abort(),du=null)}su.onAcceptCookieClick(function(){var e=window.open("https://top-fwz1.mail.ru/counter2?id=1;","","width=300; height=300");setTimeout(function(){e.close();var t=geByClass1(hu),n=clone(t);removeClass(_u,geByClass1(fu)),replace(n,t);var i=n.contentWindow.document;i.open("text/html","replace"),i.write(attr(t,"data-html")),i.close(),bu()},500),Au++});var wu={_onMouseDown:Object(r.default)(),_onCancelClick:Object(r.default)()};window.MoneyTransferButton=wu;var Cu=wu,ku="-webkit-tap-highlight-color";Cu._onMouseDown(function(e){for(var t=e;!(!(t=gpeByClass("msg_item",t))||t&&attr(t,"data-id")););t&&(setStyle(t,ku,"transparent"),setTimeout(function(){return function(e){setStyle(e,ku,"initial")}(t)},400))});var Su,Eu,Ou=1500,Tu=!1,Du=null;function ju(){Du&&Btn.setLoading(Du,!1),Su&&(clearInterval(Su),Su=null),Eu&&(Eu.abort(),Eu=null)}Cu._onCancelClick(function(e,t){var n,i;t?(Tu=!1,preventEvent(e),cancelEvent(e),lockButton(t)):(Tu=!0,t=e.$btn,e=null,Du=t,Btn.setLoading(t,!0)),n={cancelUrl:attr(t,"href")},i=n.cancelUrl,Su=setInterval(function(){Eu=ajax.post(i,{_ajax:1},{onDone:function(e){if(1===e){if(Tu){var t=arguments[1];return Du.closest(".BtnStack").outerHTML='\n            <div class="notification__tempText">'+t+"</div>\n          ",void ju()}var n=window.scrollTop();nav.go(location.pathname+location.search,null,{replace:!0}),cur.destroy.push(function(){window.scrollTop(n)}),ju()}}})},Ou),window.cur.destroy.push(ju)});need("attr"),need("geByClass1");var Iu=need("preventEvent"),Mu=need("Popup");window.SendMoneyForm={},SendMoneyForm._onAmountChange=Fu,SendMoneyForm._onSubmit=qu,SendMoneyForm._onRecommAmountChange=Hu,SendMoneyForm._onAutoAcceptToggle=Wu,SendMoneyForm._onNoAmountToggle=zu,SendMoneyForm._onChooseCardClick=Nu,SendMoneyForm._onChooseCardCancelClick=Ru,SendMoneyForm._onChooseCardContinueClick=Pu,SendMoneyForm._onCardSelect=Lu;var xu={form:"sendMoneyForm",errorMin:"sendMoneyForm_error_min",errorMax:"sendMoneyForm_error_max",addCardVisible:"sendMoneyForm_addCardVisible",requestedVisible:"sendMoneyForm_requestedVisible",recommErrorMin:"sendMoneyForm_recommErrorMin",recommErrorMax:"sendMoneyForm_recommErrorMax",noAmount:"sendMoneyForm_noAmount",autoAccept:"sendMoneyForm_autoAccept"},Bu={form:".sendMoneyForm",cardsPopup:".sendMoneyForm__cardsPopup",amountInput:".sendMoneyForm__input_amount",recommInput:".sendMoneyForm__recommAmountInput input",requestAmount:".sendMoneyForm__amountNote_requestAmount"};function Pu(){var e=Object(v.$)('.Control__native[name="card"]:checked').value,t=Object(v.$)('.Control__native[name="card"]:checked ~ .Control__label').innerText;Object(v.$)('input[name="accept_card"]').value=e,Object(v.$)('input[name="accept_card"]').setAttribute("data-value",e),Object(v.$)(".sendMoneyForm__chooseCard").innerText=t,Mu.close()}function Lu(e){var t="-1"===e.value;Object(v.$)(Bu.form).classList.toggle(xu.addCardVisible,t)}function Ru(){Mu.close()}function Nu(){var e=Object(v.$)(Bu.cardsPopup);Mu.open(e)}function Fu(e){e||(e=Object(v.$)('input[name="amount"]')),Vu(e),$u(e,6);var t=e.closest(Bu.form),n="1"===t.getAttribute("data-is-chat-request"),i=Number(e.value),a=Number(t.getAttribute("data-max-amount"));if(t.classList.remove(xu.errorMin),t.classList.remove(xu.errorMax),n||i>a&&t.classList.add(xu.errorMax),n){var o=Uu(),r=Number(t.getAttribute("data-min-amount"))*(o?2:1),s=function(e,t){var n=Object(v.$)('input[name="amount"]').closest(Bu.form),i=Number(n.getAttribute("data-min-amount")),a=Number(n.getAttribute("data-max-amount")),o=Number(n.getAttribute("data-chat-members-count")),r=Math.ceil(e/(o-(t?0:1)));return Math.min(a,Math.max(i,r))}(i,o);if(Object(v.$)(Bu.recommInput).value=s,t.classList.remove(xu.recommErrorMax),t.classList.remove(xu.recommErrorMin),!r||i>=r){var l=o?i-s:i;Object(v.$)(Bu.requestAmount).innerText=l,t.classList.add(xu.requestedVisible)}else t.classList.remove(xu.requestedVisible)}}function Hu(e){Vu(e),$u(e,6);var t=e.closest(Bu.form),n=Number(e.value),i=t.getAttribute("data-max-amount");t.classList.remove(xu.recommErrorMax),t.classList.remove(xu.recommErrorMin),n>i&&t.classList.add(xu.recommErrorMax)}function Uu(){var e=Object(v.$)('input[name="participiate"]');return e&&e.checked}function Vu(e){e.value=parseInt(e.value,10)||""}function $u(e,t){e.value=e.value.slice(0,t)}function qu(e,t){var n=t.$(Bu.amountInput).value,i=Number(n),a=Number(t.getAttribute("data-min-amount")),o=Number(t.getAttribute("data-max-amount")),r="1"===t.getAttribute("data-is-chat-request"),s=!1;(t.classList.remove(xu.errorMin),t.classList.remove(xu.errorMax),r&&(t.classList.remove(xu.recommErrorMax),t.classList.remove(xu.recommErrorMin)),Object(v.$)(Bu.form).classList.contains(xu.noAmount))||(i<a*(!!r&&Uu()?2:1)||!n||n!==i.toString()?(t.classList.add(xu.errorMin),s=!0):i>o&&!r&&(t.classList.add(xu.errorMax),s=!0));if(r){var l=t.$(Bu.recommInput).value,c=Number(l);c<a||!l||l!==c.toString()?(t.classList.add(xu.recommErrorMin),s=!0):c>o&&(t.classList.add(xu.recommErrorMax),s=!0)}if(s)Iu(e),stopEvent(e);else{Iu(e),stopEvent(e),t.insertAdjacentHTML("beforeend",'<input id="submit" type="submit" style="display: none" />');var u=Object(v.$)("#submit");ajax.click(u)}}function Wu(e){Object(v.$)(Bu.form).classList.toggle(xu.autoAccept,e.checked),e.checked?Object(v.$)('input[name="accept_card"]').value=Object(v.$)('input[name="accept_card"]').getAttribute("data-value"):Object(v.$)('input[name="accept_card"]').value=""}function zu(e){Object(v.$)(Bu.form).classList.toggle(xu.noAmount,e.checked)}window.MoneyLink={copy:function(e){var t=e.$btn,n=t.nextElementSibling,i=geByClass1("TextInput__native",gpeByClass("Pad__content",t));copyToClipboard(i)&&(MoneyLink.lastCopyLabel&&hide(MoneyLink.lastCopyLabel),MoneyLink.lastCopyLabel=n,show(n))},genQRCode:function(e,t){if(!MoneyLink.qrcode){var n,i;t?(n=geByClass1("snippet__icon",geByClass1(t)),i=80):(n=ge("money_link_qr"),i=200);val(n,xt.a.createQR(e,i,"qr-code",{isShowLogo:!0,isShowBackground:!1}))}}};var Qu=n("qHA9"),Yu=need("Voting"),Xu=function(){var e,t,n=[],i=!1,a=!1,o={};function r(e){return function(){if(!i)return e.apply(this,arguments)}}function s(e){return"A"===e.tagName}function l(){a=n.length>0,toggleClass("vk_messages_actions_visible",document.body,a)}function c(){a&&(o={},each(n,function(e,t){removeClass("mi_selected",geByClass1("_msg"+t))}),i=!1,n=[],l())}function u(){return!!window.getSelection&&window.getSelection().toString().length>0}function d(e,t,a,o){void 0===o&&(o=!1),i=!0,lockButton(e),im.off(),ajax.click("/mail",{},{url_params:{act:o?"spam":"delete",peer:t,hash:a,ids:n.join(","),community:Gu()}})}function f(){return Boolean(e)}function _(){ge("dialogs")&&f()?addClass("vk_dialogs_forwarding",document.body):e="",c()}return page.onChange(_),mail.onShowDialogsPageFromCache(_),mail.onShowDialogFromCache(_),mail.onShowDialogsPageFromCache(Jc),mail.onShowDialogFromCache(Jc),mail.onMessagesRepainted(function(){each(n,function(e,t){addClass("mi_selected",geByClass1("_msg"+t))})}),{onMessageClick:r(function(e){var t=e.target,i=e.currentTarget,a=s(t)||s(t.parentNode);t.closest("."+Yu.cls)?e.stopPropagation():(a&&c(),browser.uc_mini||u()||a||setTimeout(function(){var e,t,a;u()||(e=i,t=attr(e,"data-id"),(a=n.indexOf(t))>=0?(n.splice(a,1),removeClass("mi_selected",e),delete o[t]):(n.push(t),addClass("mi_selected",e),o[t]=hasClass("msg_item_important",e)),l(),function(){var e=window.lang,t=Math.max(n.length,1);val(geByClass1("messagesActions__row_counter"),langNumeric(t,e.mobile_mail_messages_selected).replace("{count}",t))}())},40))}),remove:r(d),reply:r(function(e,t,a){i=!0,lockButton(e),ajax.click("/attachments",{},{url_params:{act:"add",target:"mail"+t,hash:a,object:"mail"+n.join(";"),community:Gu()}})}),forward:r(function(a,o){i=!0,lockButton(a),e="mail"+n.join(";"),t=o;var r=Gu(),s=r?"?community="+r:"";nav.go(location.pathname+s,null,{ignore_cur_process:!0})}),spam:r(function(e,t,n){d(e,t,n,!0)}),close:r(c),toggleImportant:r(function(e){var t,i=n.length,a=0;for(t=0;t<i;t++)if(!o[n[t]]){a=1;break}for(t=0;t<i;t++)toggleClass("msg_item_important",geByClass1("_msg"+n[t]),1===a);ajax.post("/mail",{_ajax:1,act:"mark_important",ids:n,val:a,hash:e}),c()}),hasFwdMessages:f,attachFwdMessages:function(n){ajax.click("/attachments",{},{url_params:{act:"add",target:"mail"+n,hash:t,object:e,community:Gu()}}),e=""}}}();function Gu(){return nav.getQuery("community")}window.MessagesActions=Xu;var Ku=n("TxR4"),Ju=n("S6+Z"),Zu=Object.entries(Ju.EMOJI_HINTS).map(function(e){var t=e[0],n=e[1],i=(n[0],n[1]);return[new RegExp("(\\s|^)("+Object(lt.escapeRE)(i)+(i.endsWith(")")||i.endsWith("(")?"+":"")+")([\\s\\.,]|$)","gi"),t]}),ed={q:"",w:"",e:"",r:"",t:"",y:"",u:"",i:"",o:"",p:"","[":"","]":"",a:"",s:"",d:"",f:"",g:"",h:"",j:"",k:"",l:"",";":"","'":"",z:"",x:"",c:"",v:"",b:"",n:"",m:"",",":"",".":"","/":"."};browser.mac?ed["\\"]="":ed["`"]="";var td=new RegExp("["+Object(lt.escapeRE)(Object.keys(ed).join(""))+"]","gi"),nd=function(e){return e.replace(td,function(e){return ed[e]})},id=Object.entries(ed).reduce(function(e,t){var n=t[0];return e[t[1]]=n,e}),ad=new RegExp("["+Object(lt.escapeRE)(Object.keys(id).join(""))+"]","gi"),od=function(e){return e.replace(ad,function(e){return id[e]})},rd=function(){function e(e){this.config={mvk:!1,peerId:null,maxInputLength:256},this.setConfig(e)}var t=e.prototype;return t.setConfig=function(e){Object.assign(this.config,e)},t.getQueries=function(e){if(!e||e.length>this.config.maxInputLength)return[""];var t=window.Wall&&window.Wall.replyNamesRE||window.post&&window.post.replyNamesRE;if(t){var n=t();n&&(e=e.replace(n,""))}e=e.toLowerCase(),e=(e=Zu.reduce(function(e,t){var n=t[0],i=t[1];return e.replace(n,function(e,t,n,a){return(t||"")+Object(Ku.emojiByteHexToSymbol)(i)+(a||"")})},e)).replace(/^[\s\uFEFF\xA0]+|\n+$/g,"");for(var i=[e=Object(Ku.emojiRemoveSkinToneModifiers)(e)],a=0,o=[].concat(i);a<o.length;a++){var r=o[a];i.push(nd(r)),i.push(od(r))}for(var s=0,l=[].concat(i);s<l.length;s++){var c=l[s];i.push(c.replace(//g,"")),i.push(c.replace(//g,""))}for(var u=0,d=[].concat(i);u<d.length;u++){var f=d[u];i.push(f.replace(/[.!?]+$/,""))}return Object.keys(i.reduce(function(e,t){return e[t]=1,e},{}))},t.isBotLinkEnabled=function(){return Object(m.partConfigEnabled)("stickers_bot_link")&&-184940019!==this.config.peerId},t.getBotLinkUrl=function(){return this.config.mvk?"/mail?act=show&peer=-184940019":"/im?sel=-184940019"},t.getBotLinkImageUrl=function(e){return"/images/stickers_suggestions_bot_light_"+e+".png"},t.getBotLinkClickStatName=function(){return"stickers_suggestions_bot_link"},t.getBotLinkClickStatKeys=function(){return[]},t.isMoneyTransferEnabled=function(){return!1},t.isMoneySendEnabled=function(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.send)},t.isMoneyRequestEnabled=function(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.request)},e}();window.StickersHints=function(){var e,t,n,a,o,r,s=864e5,l=300,c=64,u=8,d=4,f=!0,_=0,p=new rd({mvk:!0});Ju.EMOJI_HINTS;function h(e){var i=window.cur;if(n=geByTag1("textarea",gpeByTag("form",geByClass1("cp_sticker_btn"))),p.setConfig(e),n&&!n.initialized){var r=function(e){var t=n.value.length;t-_>1,_=t,m(),f&&(!function(){w()&&vkNow()-C()>s*(2+Math.random())&&A();e=function(e){e*=1e3,w()&&e>C()&&A()},ajax.post("/attachments",{_ajax:1,act:"stickers_hints_change_date"},{onDone:e});var e}(),f=!1)};n.initialized=!0,o=geByClass1("stickersHints"),a=geByClass1("stickersHints__content"),addEvent(n,"focus",m),addEvent(n,"input",r),addEvent(document,"click",v),onBodyResize(g),onBodyResize(S),i.destroy.push(function(){o=null,a=null,n=null,removeEvent(n,"focus",m),removeEvent(n,"input",r),removeEvent(document,"click",v),onBodyResize("__clear",g),onBodyResize("__clear",S),t&&t.destroy(),_=0}),document.activeElement===n&&m()}}function m(){var i;n&&(e&&clearTimeout(e),i=function(i){var r=p.getQueries(n.value).find(function(e){return i.hasOwnProperty(e)}),s=r&&i[r];s?e=setTimeout(function(){var e,n=s.userStickers||[],i=s.promotedStickers||[];if(n.length>0||i.length>0){var l=[];each(n,function(e,t){l.push(b({stickerId:t,query:r,isPromoted:!1}))}),each(i,function(e,t){l.push(b({stickerId:t,query:r,isPromoted:!0}))}),p.isBotLinkEnabled()&&l.push((e=Object(Qu.getStickerSize)(),Wd.html({inner:[{inner:[{class:"th_img",src:p.getBotLinkImageUrl(e),tag:"img"}],class:"sticker_thumb",href:p.getBotLinkUrl(),onclick:"StickersHints.onSuggestionsBotLinkClick();",target:"_blank",tag:"a"}],class:"sticker_item",tag:"div"}))),a.innerHTML=l.join(""),show(o),g(),S(),(t=new Scroller(o)).init()}},l):(t&&t.destroy(),hide(o))},r?i(r):w()?(r=lsGet("stickers_keywords").keywords,i(r)):y(function(e){r=e,k(e),i(e)}))}function A(){y(function(e){r=e,k(e),m()})}function v(t){var i=t.target;i===n||gpeByClass(i,"stickersHints")||(hide(o),e&&clearTimeout(e))}function g(){attr(a,"style","")}function b(e){var t=e.isPromoted,n=t?"":"onclick=\"return StickersHints.onStickerThumbClick(event, this, {{stickerId}}, '{{stickerReferrer}}');\"",i=t?'href="/attachments?'+["act=stickers_store","target="+attr(o,"data-target"),"sticker_id={{stickerId}}","from=inline","sticker_referrer={{stickerReferrer}}"].join("&")+'"':"",a=Stickers.getStickerUrl(e.stickerId,Object(Qu.getStickerSize)());return('<div class="sticker_item sticker{{stickerId}} {{promotedClass}}">        <a class="sticker_thumb thumb_item" '+i+" "+n+'>          <img class="th_img" src="{{stickerUrl}}" />        </a>      </div>').replace(/{{stickerId}}/g,e.stickerId).replace(/{{stickerUrl}}/g,a).replace("{{promotedClass}}",t?"sticker_item_promoted":"").replace("{{stickerReferrer}}","suggestion_"+e.query)}function y(e){ajax.post("/attachments",{_ajax:1,act:"stickers_hints_keywords"},{onDone:function(t){e(function(e){var t={};return each(e,function(e,n){var i=n.user_stickers,a=n.promoted_stickers;each(n.words,function(e,n){t[n]={userStickers:i,promotedStickers:a}})}),t}(t))}})}function w(){return Boolean(lsGet("stickers_keywords"))}function C(){return lsGet("stickers_keywords").time}function k(e){!e||isEmpty(e)?lsSet("stickers_keywords"):lsSet("stickers_keywords",{keywords:e,time:vkNow()})}function S(){var e=geByClass1("stickersHints__callout");if(e){var t=e.offsetWidth-d,n=t/c,i=n%1;i<.3?n=Math.floor(n)-.5:i>.7&&(n=Math.ceil(n)-.5);var a=Math.round(t/n-u);each(geByClass("sticker_item",e),function(e,t){var n=geByClass1("sticker_thumb",t),i=geByClass1("th_img",t);setStyle(t,"width",a),setStyle(t,"height",a),setStyle(n,"width",a),setStyle(n,"height",a),setStyle(i,"height",a)})}}return onDOMReady(function(){lsCheck()&&!geByClass1("vk_stickers_hints_support_no")&&(post.onStickersInit(function(){h()}),geByClass1("stickersHints")&&h())}),ajax.onRedirect(function(e){qs2obj(e.split("?")[1]).invalidate_stickers_hints&&A()}),post.onReplyClick(function(e){var t=window.cur;e,setTimeout(m,10),t.destroy.push(function(){;""})}),{actualizeVisibility:m,init:h,onStickerThumbClick:function(t,i,a,r){window.isNewMail&&preventEvent(t);var s=gpeByClass("sticker_item",i),l=geByClass1("th_img",s);return attr(s,"style",""),attr(i,"style",""),attr(l,"style",""),hide(o),n.value="",e&&clearTimeout(e),post.sendSticker(i,a,!0,r)},onCheckboxLabelClick:function(e,t){setTimeout(function(){!function(e,t,n){var i={_ajax:1,act:"stickers_hints_enabled",value:e,hash:t};ajax.post("/attachments",i,{onDone:n})}(val(geByTag1("input",e.parentElement))?1:0,t,A)},0)},onCheckboxAutoAnimationLabelClick:function(e,t){setTimeout(function(){!function(e,t,n){var i={_ajax:1,act:"stickers_auto_animation_enabled",value:e,hash:t};ajax.post("/attachments",i,{onDone:n})}(val(geByTag1("input",e.parentElement))?1:0,t,A)},0)},onSuggestionsBotLinkClick:function(){i.statlogsValueEvent.apply(void 0,[p.getBotLinkClickStatName(),0].concat(p.getBotLinkClickStatKeys()))}}}();var sd=need("nav");window.PinnedMsg={onHideClick:befall(),getByMsgId:function(e){return Object(v.$)(ld.pinnedMsg(e))}};var ld={pinnedMsg:function(e){return'.pinnedMsg[data-msg-id="'+e+'"]'}};function cd(e,t){sd.go(t,e)}PinnedMsg._onClick=cd,PinnedMsg._onHideClick=PinnedMsg.onHideClick;n("98L6"),n("gunf");window.SettingsRow_select={},SettingsRow_select._onChange=dd;var ud={row:".settingsRow",description:".settingsRow__description"};function dd(e,t){!function(e){var t=e.$select,n=e.label;t.closest(ud.row).$(ud.description).textContent=n}(t),s.default.handle(e,t)}n("MzAf"),n("Dh0N"),n("fYoA");var fd=n("PovR");function _d(e){pushNotifier.canBeEnabled().then(function(t){var n=!!e.$control&&geByTag1("input",e.$control);n&&(t?pushNotifier.setupSubscription().then(function(){!function(e){var t=ce("input",{type:"submit"},{display:"none"});e.$control.form.appendChild(t),ajax.click(t),e.$control.form.removeChild(t)}(e)}).catch(function(e){PushNotifier.PUSH_NOTIFIER_BLOCKED_BY_BROWSER_SETTINGS===e?(n.checked=!1,addClass("Popup_open",geByClass1("pageAllowPushPopup"))):n.checked=!1}):n.checked=!1)})}window.SettingsNotifyPush={},SettingsNotifyPush._onSwitch=_d;var pd=function(){function e(e,t){isObject(t)||(t={items:t}),this.opts=extend({slideClassName:"",onStartChange:!1,onChange:!1,pointsWrap:!1,slideContFn:!1,shownSlidesNum:1},t),this.wrap=ge(e),this.parseItems(t.items),this.init()}var t=e.prototype;return t.parseItems=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];"string"==typeof i&&(i={className:i}),i=extend({html:"",className:"",pos:t.length},i),t.push(i)}this.items=t},t.init=function(){if(addClass("landings_slider_wrap",this.wrap),addEvent(this.wrap,"touchstart mousedown",this.touchStart.bind(this)),this.opts.pointsWrap){var e="";for(var t in this.items)e+='<div class="landings_slider_point"></div>';addClass("landings_slider_points",this.opts.pointsWrap),val(this.opts.pointsWrap,e)}this.changeSlide(0)},t.getTouchX=function(e){return e.targetTouches&&e.targetTouches.length>0?e.targetTouches[0].pageX:e.pageX},t.getTouchY=function(e){return e.targetTouches&&e.targetTouches.length>0?e.touches[0].pageY:e.pageY},t.touchStart=function(e){var t=this.getTouchX(e),n=this.getTouchY(e),i=this,a=!1,o=!1,r=vkNow(),s=0,l=this.getTouchX(e),c=getW(this.wrap);function u(e){if(!o)if(!a&&Math.abs(i.getTouchY(e)-n)>20)o=!0;else{i.lock&&(a=!0,t=i.getTouchX(e),r=vkNow(),i.changeSlide(i.newPos),cancelEvent(e),i.lock=0,clearTimeout(i.changeTimeout));var u=i.getTouchX(e),d=t-u;(Math.abs(d)>20||a)&&(cancelEvent(e),a||(t=i.getTouchX(e),d=0,a=!0),s=d,l=u,d=-(100+d/c*100),d-=100*i.opts.shownSlidesNum-100,setStyle(i.helper,"transform","translateX("+d+"%)"))}}function d(e){if(removeEvent(bodyNode,"mousemove touchmove",u),removeEvent(bodyNode,"mouseup touchend touchcancel",d),!i.lock)if(i.lock=1,Math.abs(s)>50){var n=s<0?"prev":"next",a=Math.abs(l-t)/(r/vkNow());a+=.2*a;var o=100*i.opts.shownSlidesNum;o="next"==n?100+o:o-100,setStyle(i.helper,{transition:"transform "+a+"ms",transform:"translateX(-"+o+"%)"});var c=i.items.length-1,f="prev"==n?i.pos-1:i.pos+1;f<0?f=c:f>c&&(f=0),i.opts.onStartChange&&i.opts.onStartChange(f,n),i.newPos=f,i.changeTimeout=setTimeout(function(){i.lock=0,i.changeSlide(f)},a)}else setStyle(i.helper,{transition:"transform 200ms",transform:"translateX(-"+100*i.opts.shownSlidesNum+"%)"}),setTimeout(function(){i.lock=0},200)}removeEvent(bodyNode,"mousemove touchmove",u),removeEvent(bodyNode,"mouseup touchend touchcancel",d),addEvent(bodyNode,"mousemove touchmove",u),addEvent(bodyNode,"mouseup touchend touchcancel",d)},t.makeItem=function(e){var t=this.pos==e.pos?"_active_slide ":"",n=this.opts.slideContFn?this.opts.slideContFn(e):e.html;return'<div class="landings_slider_item '+t+e.className+" "+this.opts.slideClassName+'">'+n+"</div>"},t.getSlidesHtml=function(e){for(var t=this.opts.shownSlidesNum,n=this.items.length-1,i="",a=e,o=0;o<t;o++)--a<0&&(a=n),i=this.makeItem(this.items[a])+i;i+=this.makeItem(this.items[e]),a=e;for(var r=0;r<t;r++)++a>n&&(a=0),i+=this.makeItem(this.items[a]);return i},t.changeSlide=function(e){if(this.pos=Math.max(0,Math.min(e,this.items.length-1)),this.replaceHtml(this.getSlidesHtml(this.pos)),this.opts.onChange&&this.opts.onChange(this.pos),this.opts.pointsWrap){var t=ge(this.opts.pointsWrap);removeClass("selected",geByClass1("selected",t)),addClass("selected",t.children[this.pos])}},t.replaceHtml=function(e){val(this.wrap,'<div class="landings_slider_helper">'+e+"</div>"),this.helper=geByClass1("landings_slider_helper",this.wrap),setStyle(this.helper,"transform","translateX(-"+100*this.opts.shownSlidesNum+"%)")},t.toSlide=function(e,t){this.lock=1;var n=this.makeItem(this.items[this.pos]),i=this.makeItem(this.items[e]);e>this.pos?n+=i:n=i+n,this.replaceHtml(n),t||(t=e>this.pos?"next":"prev");var a="next"==t?0:-100;setStyle(this.helper,"transform","translateX("+a+"%)"),this.opts.onStartChange&&this.opts.onStartChange(e,t);var o=this;clearTimeout(this.toSlideTimer),this.toSlideTimer=setTimeout(function(){a="next"==t?-100:0,setStyle(o.helper,{transition:"transform 200ms",transform:"translateX("+a+"%)"}),o.toSlideTimer=setTimeout(function(){o.lock=0,o.changeSlide(e)},200)},10)},e}();window.landingsSlider=pd;n("03kU"),n("4qiT"),n("Tjn9"),n("tlL+"),n("w1QQ"),n("DVnk"),n("cLcH"),n("uo4j"),n("Fhlr");var hd=n("myok");window.groupInvitationClick=function(e,t){var n=t.$btn,i=n.getAttribute("href");(n.nextElementSibling||n.previousElementSibling).remove(),ajax.post(i,{_ajax:1},{onDone:function(){}}),n.closest(".BtnStack").outerHTML='\n    <div class="notification__tempText">'+e+"</div>\n  "},window.apiCallAction=function(e,t,n,i,a,o,r){var s=r.$btn,l=s.getAttribute("href"),c=s.nextElementSibling||s.previousElementSibling,u=t?'<span class="notification__tempIcon '+t+'Icon"></span>':"";i&&!confirm(i)||(hd.default.setLoading(s,!0),ajax.post(l,{_ajax:1},{onDone:function(){hd.default.setLoading(s,!1),c&&c.remove(),s.closest(".BtnStack").outerHTML='<div class="notification__tempText">'+u+e+"</div>"}}))},window.NotifierPage={notifyMarkAsViewed:function(e){ajax.post("feed.php",{_ajax:1,section:"notifications",hash:e,action:"mark_as_viewed"})}},window.NotifyItem={_onPhotoTagAcceptClick:function(e,t,n){var i=n.$btn,a=i.getAttribute("href");i.nextElementSibling||i.previousElementSibling;ajax.post(a,{_ajax:1},{onDone:function(){}}),i.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+t+"</div>\n    "},_onPhotoTagDeclineClick:function(e,t,n){var i=n.$btn,a=i.getAttribute("href");i.nextElementSibling||i.previousElementSibling;ajax.post(a,{_ajax:1},{onDone:function(){}}),i.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+t+"</div>\n    "},_onHideClick:function(e,t,n){e.preventDefault();var i=e.target,a=i.getAttribute("href"),o=a+"&action=hide",r=a+"&action=restore";(!n||confirm(n))&&ajax.post(o,{_ajax:1},{onDone:function(){var e=i.closest(".notificationList__items")||i.closest(".notificationList"),n=i.closest(".notification"),a=n.getAttribute("id"),o=e.closest(".notificationList");if(hide(n),NotifyItem._onBodyScroll(),o.classList.contains("notificationList_type_unread")){var s=o.$(".Pad__title"),l=parseInt(s.innerText,10)-1;s.innerText=langNumeric(l,lang.mobile_notifications_new)}var c=!0;each(geByClass("notification",e),function(e,t){isVisible(t)&&(c=!1)}),c&&o.classList.add("Pad_empty");var u=window.Snackbar;u&&u.init&&u.init({text:t,action:{url:r,text:lang.mobile_notifications_restore,callback:["NotifyItem._onRestoreClick","event",a]}})}})},_onRestoreClick:function(e,t,n){var i=n.id,a=n.url;e.preventDefault();var o=ge(t);ajax.post(a,{_ajax:1},{onDone:function(){ge(t).style.display="",Snackbar.close(i);var e=o.closest(".notificationList__items")||o.closest(".notificationList"),n=e.closest(".notificationList");if(n.classList.contains("notificationList_type_unread")){var a=n.$(".Pad__title"),r=parseInt(a.innerText,10)+1;a.innerText=langNumeric(r,lang.mobile_notifications_new)}var s=!0;each(geByClass("notification",e),function(e,t){isVisible(t)&&(s=!1)}),s||n.classList.remove("Pad_empty")}})},_onBodyScroll:function(){$$(".notification_actionsOpen").forEach(function(e){e.classList.remove("notification_actionsOpen")}),window.removeEventListener("scroll",NotifyItem._onBodyScroll)},_onActionTriggerClick:function(e){window.addEventListener("scroll",NotifyItem._onBodyScroll);var t=e.closest(".notification");t.classList.remove("notification_reverse"),t.classList.toggle("notification_actionsOpen"),$$(".notification_actionsOpen").forEach(function(e){e!==t&&e.classList.remove("notification_actionsOpen")}),t.$(".notification__actionsBubble").getBoundingClientRect().y<50&&t.classList.add("notification_reverse")}},window.FriendRequest={_onAcceptClick:function(e,t){var n=t.$btn,i=n.getAttribute("href"),a=n.nextElementSibling||n.previousElementSibling;a&&a.remove(),ajax.post(i,{_ajax:1},{onDone:function(){}}),n.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+e+"</div>\n    "},_onDeclineClick:function(e,t){var n=t.$btn,i=n.getAttribute("href"),a=n.nextElementSibling||n.previousElementSibling;a&&a.remove(),ajax.post(i,{_ajax:1},{onDone:function(){}}),n.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+e+"</div>\n    "}},window.GroupNotify={deleteSource:function(e,t){return ajax.post("feed.php",{gid:e,hash:t,act:"group_notify_delete_source"},{onDone:function(){}}),!1},addSource:function(e,t,n){this.processQuery("group_notify_add_source",e,t,n)},editSource:function(e,t){this.processQuery("group_notify_edit_source",e,t)},processQuery:function(e,t,n,i){var a=$(".group_notify_general .Control_type_switcher input.Control__native").checked?1:0,o={};$$(".group_notify_params .Control_type_switcher input.Control__native").forEach(function(e){o["setting_"+e.name]=e.checked?1:0}),ajax.post("feed.php",Object(Ke.default)({gid:t,hash:n,unmuted:a,from:i},o,{act:e}),{onDone:function(){}})},gn_grProcess:function(e,t,n,i){ajax.post("club"+e,{act:"user_action",mid:t,hash:n,from:"top_notifier",action:i},{onDone:function(){}})}};var md=n("H5mD");function Ad(e,t,n){if(md.isWKWebView){attr(t,"onclick",""),attr(t,"href","vk://vk.com/write"+(2e9+e));var i=new Event("click");return t.dispatchEvent(i),void setTimeout(function(){attr(t,"href","/mail?act=show&chat="+e),t.textContent=n})}d.default.android?location.href="https://vk.com/write"+(2e9+e):md.isIOS?(attr(t,"onclick",""),attr(t,"href","/mail?act=show&chat="+e),t.textContent=n,location.href="vk://vk.com/write"+(2e9+e)):location.href="/mail?act=show&chat="+e}window.ChatPreview={join:function(e,t,n){return ajax.post(e,{},{onDone:function(e){Ad(e,t,n)}}),!1},open:function(e,t,n){return setTimeout(function(){Ad(e,t,n)}),!1}};n("aXSb");var vd="touchstart mousedown",gd="touchcancel touchend touchmove mouseout mouseup mousemove scroll";function bd(e,t,n){var a;void 0===t&&(t=350);var o=function(o){var s=o.target;Object(i.addEvent)(e,gd,r,{passive:!0}),(0===o.button||isUndefined(o.button))&&(a=setTimeout(function(t){var o,s;t.touches?(o=t.touches[0].pageX,s=t.touches[0].pageY):(o=t.pageX,s=t.pageY);n({pageX:o,pageY:s}),Object(i.removeEvent)(e,gd,r,{passive:!0}),clearTimeout(a)}.bind(s,o),t))},r=function t(){clearTimeout(a),Object(i.removeEvent)(e,gd,t,{passive:!0})};return Object(i.addEvent)(e,vd,o,{passive:!0}),function(){clearTimeout(a),Object(i.removeEvent)(e,vd,o,{passive:!0})}}!window.isMVK&&(window.vkExpand=window.vkExpand||"VK"+ +new Date,window.vkUUID=window.vkUUID||0,window.vkCache=window.vkCache||{});var yd="doc",wd="photo",Cd="video",kd="album",Sd="market_album",Ed=1,Od=1.777,Td=1.5,Dd=window.isMVK?200:120,jd=5,Id=6,Md=3,xd=window.isMVK?604:537,Bd=window.isMVK?360:343;function Pd(e,t,n,i){var a=function(e){var t=0;return each(e,function(e,n){t+=n}),t},o=function(e,t,n){return(t-(e.length-1)*n)/a(e)},r=(i=Vd(i)?i:{}).wide,s=[],l=0,c=[],u=[];each(n,function(e,t){Hd(t.type)&&(c[c.length]=t[t.type]),t.type===Cd&&s.push(l),l++});var d="",f=[],_=c.length;each(c,function(n,i){var a=Fd(i,e,t);d+=a>1.2?"w":a<.8?"v":"q",f[f.length]=a});var p,h,m=f.length>0?a(f)/f.length:1,A=jd;window.isMVK&&(A=window.innerWidth>=480?Id:Md);var v=A;i.force?(p=e,h=t):(r?(p=xd,h=Bd):e>=381?(p=381,h=1==_?361:237):(p=337,h=1==_?320:214),e<p&&(p=e,h=t),window.isMVK&&(p=Math.min(xd,window.innerWidth),h=Math.min(Bd,p)));var g=p/h,b=0,y=0;if(1==_){var w={lastColumn:1,lastRow:1,single:1};c[0].thumb?(b=279,y=185):f[0]>=1*g?(b=p,y=Math.min(b/f[0],h)):(y=h,b=Math.min(y*f[0],p));var C=Ld(c[0],b,y,w);!C.unsized&&(C.image.width<b&&C.image.height<=h||C.image.height<y&&C.image.width<=p)&&(b=C.image.width,y=C.image.height,C=Ld(c[0],b,y,w)),u[0]=C}else if(2==_){var k,S;switch(d){case"ww":if(m>1.4*g&&f[1]-f[0]<.2){S=p,k=Math.min(S/f[0],S/f[1],(h-v)/2),u[0]=Ld(c[0],S,k,{lastColumn:1}),u[1]=Ld(c[1],S,k,{lastColumn:1,lastRow:1}),b=p,y=2*k+v;break}case"vv":case"qv":case"vq":case"qq":S=(p-A)/2,k=Math.min(S/f[0],S/f[1],h),u[0]=Ld(c[0],S,k,{lastRow:1}),u[1]=Ld(c[1],S,k,{lastRow:1,lastColumn:1}),b=p,y=k;break;default:var E=intval((p-A)/f[1]/(1/f[0]+1/f[1])),O=p-E-A;k=Math.min(h,E/f[0],O/f[1]),u[0]=Ld(c[0],E,k,{lastRow:1}),u[1]=Ld(c[1],O,k,{lastColumn:1,lastRow:1}),b=p,y=k}}else if(3==_)if((f[0]>1.2*g||m>1.5*g)&&"www"==d){var T,D=p,j=Math.min(D/f[0],.66*(h-v));if(u[0]=Ld(c[0],D,j,{lastColumn:1}),"www"==d){var I=intval(p-A)/2;T=Math.min(h-j-v,I/f[1],I/f[2]),u[1]=Ld(c[1],I,T,{lastRow:1}),u[2]=Ld(c[2],p-I-A,T,{lastColumn:1,lastRow:1})}else{var M=intval((p-A)/f[2]/(1/f[1]+1/f[2])),x=p-M-A;T=Math.min(h-j-v,M/f[2],x/f[1]),u[1]=Ld(c[1],M,T,{lastRow:1}),u[2]=Ld(c[2],M,T,{lastRow:1,lastColumn:1})}b=p,y=j+T+v}else{var B=h,P=intval(Math.min(B*f[0],.75*(p-A)));u[0]=Ld(c[0],P,B,{lastRow:1});var L=f[1]*(h-v)/(f[2]+f[1]),R=h-L-v,N=Math.min(p-P-A,intval(L*f[2]),intval(R*f[1]));u[1]=Ld(c[1],N,R,{lastColumn:1}),u[2]=Ld(c[2],N,L,{lastColumn:1,lastRow:1}),b=P+N+A,y=h}else if(4==_)if((f[0]>1.2*g||m>1.5*g)&&"wwww"==d){var F=p,H=Math.min(F/f[0],.66*(h-v));u[0]=Ld(c[0],F,H,{lastColumn:1});var U=(p-2*A)/(f[1]+f[2]+f[3]),V=intval(U*f[1]),$=intval(U*f[2]),q=F-V-$-2*A;U=Math.min(h-H-v,U),u[1]=Ld(c[1],V,U,{lastRow:1}),u[2]=Ld(c[2],$,U,{lastRow:1}),u[3]=Ld(c[3],q,U,{lastColumn:1,lastRow:1}),b=p,y=H+U+v}else{var W=h,z=Math.min(W*f[0],.66*(p-A)),Q=(h-2*v)/(1/f[1]+1/f[2]+1/f[3]),Y=intval(Q/f[1]),X=intval(Q/f[2]),G=W-Y-X-2*v;z+(Q=Math.min(p-z-A,Q))+A<p&&W*f[0]>z&&(z=Math.min(W*f[0],p-A-Q)),u[0]=Ld(c[0],z,W,{lastRow:1}),u[1]=Ld(c[1],Q,Y,{lastColumn:1}),u[2]=Ld(c[2],Q,X,{lastColumn:1}),u[3]=Ld(c[3],Q,G,{lastColumn:1,lastRow:1}),b=z+Q+A,y=h}else{var K=[],J=0;m>(s.length?1.3:1.1)?each(f,function(e,t){K[K.length]=Math.max(1,t)}):each(f,function(e,t){~s.indexOf(J)?K[K.length]=t:K[K.length]=Math.min(1,t),J++});var Z,ee,te={};for(te[_+""]=[o(K,p,A)],Z=1;Z<=_-1;Z++)te[Z+","+(ee=_-Z)]=[o(K.slice(0,Z),p,A),o(K.slice(Z),p,A)];for(Z=1;Z<=_-2;Z++)for(ee=1;ee<=_-Z-1;ee++)te[Z+","+ee+","+(_-Z-ee)]=[o(K.slice(0,Z),p,A),o(K.slice(Z,Z+ee),p,A),o(K.slice(Z+ee),p,A)];var ne,ie=null,ae=0;for(var oe in te)if(te.hasOwnProperty(oe)){var re=te[oe],se=a(re)+v*(re.length-1),le=Math.abs(se-h);if(~oe.indexOf(",")){for(var ce=oe.split(","),ue=0;ue<ce.length;ue++)ce[ue]=intval(ce[ue]);(ce[0]>ce[1]||ce[2]&&ce[1]>ce[2])&&(le+=50,le*=1.5)}(null===ie||le<ae)&&(ie=oe,ae=le,ne=se)}for(var de=Ud(c),fe=Ud(K),_e=ie.split(","),pe=te[ie],he=_e.length-1,me=0;me<_e.length;me++){var Ae=parseInt(_e[me]),ve=de.splice(0,Ae),ge=pe.shift(),be=ve.length-1,ye={};he==me&&(ye.lastRow=!0);for(var we=p,Ce=0;Ce<ve.length;Ce++){var ke=ve[Ce],Se=fe.shift(),Ee=ye,Oe=void 0;be==Ce?(Oe=Math.ceil(we),Ee.lastColumn=!0):we-=(Oe=intval(Se*ge))+A,u[u.length]=Ld(ke,Oe,ge,Ee)}}b=p,y=ne}return{width:intval(b),height:intval(y),thumbs:u}}function Ld(e,t,n,i){var a={id:e.id,width:intval(t),height:intval(n),lastColumn:i.lastColumn,lastRow:i.lastRow,single:i.single,image:Rd(e,t,n,i.single),unsized:e.unsized,type:e.type,orig:e};return e.title&&void 0!==e.size?extend(a,{title:e.title,size:e.size}):e.title&&void 0!==e.msize?extend(a,{title:e.title,msize:e.msize}):e.type===Cd&&e.name&&void 0!==e.name&&extend(a,{name:e.namem}),"number"==typeof e.duration&&(e.duration=formatTime(e.duration)),a.unsized?a.ratio=Ed:a.ratio=a.image.width/a.image.height,a}function Rd(e,t,n,i){if(!e)return{};t=intval(t),n=intval(n);var a,o=window.devicePixelRatio||1;if(e.type===Cd||e.type===yd){(e.vid?["x","y","l","s","m"]:["o","z","y","x","m","s","temp"]).forEach(function(i){e.sizes[i]&&(!a||t*o<=e.sizes[i][1]&&n*o<=e.sizes[i][2])&&(a=e.sizes[i])})}else{var r=e.thumb?e.thumb.sizes:e.sizes,s=r.x||r[r.length-1],l=s?(s[1]||1)/(s[2]||1):Ed,c=0;l>t/n?(c=n,l>1&&(c*=l)):(c=t,l<1&&(c/=l)),n*=o,t*=o;var u=!i&&r.o,d="";d=r.temp?"temp":c<75?"s":c<130?"m":u&&r.o&&r.o[1]>=t&&r.o[2]>=n?"o":u&&r.p&&r.p[1]>=t&&r.p[2]>=n?"p":u&&r.q&&r.q[1]>=t&&r.q[2]>=n?"q":u&&r.r&&r.r[1]>=t&&r.r[2]>=n?"r":"x",a=r[d]}return a[1]=intval(a[1]),a[2]=intval(a[2]),a[1]&&a[2]||(e.unsized=!0),{src:a[0],width:a[1],height:a[2]}}function Nd(e,t,n){var i=t,a=n,o=0,r=0;if(!e.vid&&e.image.width&&e.image.height){var s=e.image.width/e.image.height;s<t/n?(e.single&&e.image.width<t&&(t=e.image.width,n=Math.min(n,e.image.height)),(a=(i=t)/s)>n&&(r=-intval((a-n)/2))):(e.single&&e.image.height<n&&(n=e.image.height,t=Math.min(t,e.image.width)),(i=(a=n)*s)>t&&(o=-intval((i-t)/2)))}return{width:i,height:a,marginLeft:o,marginTop:e.orig&&(e.type===Sd||e.type===kd)&&e.single?0:r}}function Fd(e,t,n){var i;switch(e.type){case yd:i=e.ratio;break;case Cd:i=e.ratio||Od;break;case kd:case Sd:i=Td;break;default:if(e.sizes&&e.sizes.x){var a=e.sizes.x,o=a[1],r=a[2];o&&r&&(i=o/r)}if(e.sizes&&e.sizes.temp){var s=e.sizes.temp,l=s[1],c=s[2];l&&c&&(i=l/c)}}return i||Ed}function Hd(e){return!!~[yd,wd,Cd,kd,Sd].indexOf(e.toString())}function Ud(e,t){var n=Vd(e)||void 0===e.length?{}:[];for(var i in e)(!/webkit/i.test(_ua)||"layerX"!=i&&"layerY"!=i&&"webkitMovementX"!=i&&"webkitMovementY"!=i)&&(t&&"object"==typeof e[i]&&"prototype"!==i&&null!==e[i]?n[i]=Ud(e[i]):n[i]=e[i]);return n}var Vd=function(e){return"[object Object]"===Object.prototype.toString.call(e)};var $d={drag:{curEl:null},cachedPhoto:{}};window.ThumbsEdit={initialized:!1,_init:function(){onDOMReady(function(){window.ThumbsEdit.init(!1),page.onChange(function(){window.ThumbsEdit.init(!1,"/wall")})})},init:function(e,t){var n=this;if(void 0===t&&(t=nav.path),e||(e=$("#feed_add_form .cp_attached_wrap")),!e||0!==t.indexOf("/wall"))return this.initialized=!1,removeClass(document.body,"te_i"),void($d.destroyLongpress&&$d.destroyLongpress());if(addClass(document.body,"te_i"),!geByClass1("ThumbsEdit",e)){var a=Object(i.ceFromString)(s.default.html({class:"ThumbsEdit",style:"width: 100%; height: 100%",id:"ThumbsEdit"})),o=Object(i.ceFromString)(s.default.html({class:["ThumbsEdit-wrap"," _preventMenuOpen"],inner:a}));o.appendChild(a),e.insertBefore(o,e.firstChild),$d=Object(Ke.default)({},$d,{previews:[],loaders:{},attachEl:a});var r=this.parsePreviews(Object(i.getPreloadData)());this.initialized=!0,r.length&&($d.previews=r,this.draw(),Object(i.onBodyResize)(function(){return n.draw()}))}},parsePreviews:function(e){return e.map(function(e){return function(e,t,n,i){var a=t.split("_"),o=a[0],r=a[1],s=Object(Ke.default)({owner_id:o,ownerId:o,itemId:r,type:e,remove:n.remove,click:n.click,temp:"temp"in n.sizes},i);switch(e){case yd:s.data={sizes:n.sizes,ratio:n.ratio,label:n.label,href:n.href},s.doc=s.data;break;case wd:s.data={pid:r,sizes:n.sizes},s.photo=s.data;break;case Cd:s.data={vid:r,duration:n.duration,platform:n.platform,play_icon:n.play_icon,active_live:n.active_live,ratio:n.ratio,sizes:n.sizes,name:n.name},s.video=s.data;break;case kd:s.data={aid:r,title:n.title,size:n.size,thumb:{sizes:n.sizes}},s.album=s.data;break;case Sd:s.data={type:Sd,aid:r,title:n.title,msize:n.msize,thumb:{sizes:n.sizes}},s.market_album=s.data}return s.data.type=e,s.data.id=s.temp?e+"temp_"+o:""+e+s.ownerId+"_"+s.itemId,s}.apply(void 0,e)}).filter(function(e){return Hd(e.type)})},draw:function(){var e=this,t=$d,n=t.previews,i=t.attachEl,a=n[0]?Fd(n[0]):1.5,o={width:i.parentNode.offsetWidth,height:Math.min(Math.round(i.parentNode.offsetWidth/a),360),wide:!0},r=Pd(o.width,o.height,n,o),s=r.thumbs,l=r.height,c=r.width;$d=Object(Ke.default)({},$d,{thumbs:s,height:l,options:o});var u=document.createDocumentFragment();s.forEach(function(t,n){u.appendChild(e.createThumbEl(t,n))}),this.updateIds();var d=ce("div");d.id="ThumbsEdit-splitter",val(i,""),i.style.width=c+"px",i.parentNode.style.height=l+"px",i.appendChild(u),ge("ThumbsEdit-splitter")||i.parentNode.appendChild(d),mediaUpload.refreshUploadState(),this.updatePhotos()},update:function(e,t){var n=this;if(e=ge(e)){var a=e.id,o=ge(a),r=$d.thumbs,l=$d.height,c=$d,u=c.options,d=c.drag,f=t[0]?Fd(t[0]):1.5,_=u.width,p=u.height;_&&p||(_=e.parentNode.offsetWidth,p=Math.min(Math.round(_/f),360)),u.width=_,u.height=p,u.wide=!0;var h=Pd(_,p,t,u),m=h.thumbs,A=h.height,v=h.width,g=Object(i.ceFromString)(s.default.html({class:"ThumbsEdit",style:"width: "+v+"px; height: "+A+"px; position: fixed; left: "+d.wpos[0]+"px; top: "+d.wpos[1]+"px; visibility: hidden"}));m.forEach(function(e,t){g.appendChild(n.createThumbEl(e,t,!0))}),document.body.appendChild(g);var b=this.getCoords(g,d.wpos);re(g),b.forEach(function(e,t){var n=$d.drag.coords.find(function(t){return t.id===e.id});if(n){var a=geByClass1("Thumb",n.node),o=$("img",a),s=r[n.index],l=m.find(function(e){return e.id===s.id});$d.drag.toIndex!==t&&i.setStyle.transform(a,1,[0,0]),n.height===e.height&&e.x===n.x&&e.y===n.y&&n.index!==$d.drag.i||setTimeout(function(){i.setStyle.animate(a,"margin-left, margin-top, height, width, opacity, transform",{duration:Dd+"ms"}),Object(i.setStyle)(a,{"margin-left":0,"margin-top":0,height:e.height,width:e.width,opacity:1}),i.setStyle.transform(a,1,[e.x-n.x,e.y-n.y]),i.setStyle.animate(a.parentNode,"background",{duration:Dd+"ms"}),Object(i.setStyle)(a.parentNode,{func:"ease-in",background:"transparent"});var t=Nd(l,e.width,e.height);o&&(i.setStyle.animate(o,Object.keys(t).join(),Dd+"ms"),Object(i.setStyle)(o,t))})}}),l!==A&&setTimeout(function(){[o,o.parentNode].forEach(function(e){i.setStyle.animate(e,"height",{duration:Dd+"ms"}),Object(i.setStyle)(e,{height:A})})}),v>=_&&(i.setStyle.animate(o,"width",{duration:Dd+"ms"}),Object(i.setStyle)(o,{width:v})),setTimeout(function(){Object(i.setStyle)(o,{width:v}),$d.thumbs=m,$d.previews=t,$d.height=A;var e=document.createDocumentFragment();m.forEach(function(t,i){e.appendChild(n.createThumbEl(t,i))}),o.innerHTML="",o.appendChild(e),$d.drag.updating=!1,n.updatePhotos()},Dd)}else console.error("empty el to update")},createThumbEl:function(e,t){var n=e.image,a=e.width,o=e.height,r=e.type,l=Nd(e,a,o),c=["Thumb-wrap","Thumb-wrap--"+r],u=0===e.id.indexOf("phototemp_"),d=u||a<=30||o<=60;u&&c.push("Thumb-wrap--temp"),e.lastColumn&&c.push("last_column"),e.lastRow&&c.push("last_row");var f=$d.previews[t],_=null;f.label&&(_=s.default.wrap(f.label));if(u&&f.orientation>1){var p=(a-o)/2;"\n        position: absolute;\n        right: "+p+"px;\n        bottom: "+-p+"px;\n        height: "+a+"px;\n        width: "+o+"px;\n       "}var h=this.getCached(e.id,n.src);this.cachePhoto(e.id,n.src);var m=[{tag:"img",src:h?h.src:n.src,width:""+Math.round(l.width),height:""+Math.round(l.height),style:"margin-left: "+l.marginLeft+"px; margin-top: "+l.marginTop+"px;"},{class:"Thumb__overlay",inner:[!d&&{class:"Thumb__overlay-closeBtn",onclick:"ThumbsEdit.remove(null, "+t+")"},_]},{tag:"input",type:"hidden",name:"attach"+(t+1)+"_type",value:r},{tag:"input",type:"hidden",name:"attach"+(t+1),value:e.id.slice(r.length,e.id.length)}];if(u){var A,v=Math.min(Math.min((l.width-24)/2,30),Math.min((l.height-24)/2,30));$d.loaders[e.id]&&(A=$d.loaders[e.id]);var g=Oc.init(A,v),b=g.component,y=g.id;$d.loaders[e.id]=y,m.push(b)}var w=Object(i.ceFromString)(s.default.html({class:"Thumb",style:"width: "+Math.round(a)+"px; height: "+Math.round(o)+"px",inner:m})),C=Object(i.ceFromString)(s.default.html({class:c.join(" "),style:"width: "+Math.round(a)+"px; height: "+Math.round(o)+"px","data-media":e.id,"data-index":t,"data-upload":f.upload}));return $d.destroyLongpress=bd(w,350,this.startDrag.bind(this,w)),addEvent(C,"click",this.showPopup.bind(this)),C.appendChild(w),C},addTempPreview:function(e){var t;if($d.attachEl){var n=this.parsePreviews([e]);(t=$d.previews).push.apply(t,n),this.draw()}},replaceTemp:function(e,t,n,i){void 0===i&&(i={});var a=$d.previews.findIndex(function(t){return t.ownerId===e}),o=$d.previews[a],r=t.split("_").ownerId,s=t.split("_").itemId;o.ownerId=r,o.owner_id=r,o.itemId=s,o.temp=!1,o.upload=e,o.list=n,o.photo.sizes=i,o.photo.id="photo"+t,o.photo.pid=s,o.data=o.photo,Oc.ready($d.loaders["phototemp_"+e]),this.draw()},onUploadProgress:function(e,t){Oc.update($d.loaders["phototemp_"+e],t)},preventScroll:function(e){preventEvent(e)},startDrag:function(e,t){if(addEvent(window,"touchmove",this.preventScroll),e.classList.contains("Thumb")&&!e.classList.contains("Thumb--moving")){window.navigator.vibrate&&navigator.vibrate(50),Object(i.setStyle)(document.body,"overflow","hidden"),Object(i.setStyle)(document.body,"max-height","100%"),Object(i.setStyle)(document.body,"user-select","none");var n=this.onDrag.bind(this),a=this.onDrop.bind(this);addEvent(window,"mousemove touchmove",n),addEvent(window,"mouseup touchend touchcancel",a),statlogsValueEvent("mvk_thumb_edit_interaction",""),$d.drag=Object(Ke.default)({},$d.drag,{curEl:e,curIndex:e.parentNode.dataset.index,dragListener:n,dropListener:a});var o=e.offsetWidth>=40&&e.offsetHeight>=80,r=e.parentNode.parentNode,s=$("img",e),l=intval(e.parentNode.getAttribute("data-index")),c=$d.thumbs[l],u=getXY(r),d=getXY(e.parentNode),f=this.getCoords(r,u);$d.drag.id=r.id,$d.drag.i=l,$d.drag.toIndex=l,$d.drag.x=(t.pageX||t.detail.pageX)-d[0],$d.drag.y=(t.pageY||t.detail.pageY)-d[1],$d.drag.t=c,$d.drag.w=c.width,$d.drag.h=c.height,$d.drag.pos=d,$d.drag.wpos=u,$d.drag.crop=Nd(c,c.width,c.height),$d.drag.coords=f,$d.drag.needScale=o;var _=o?function(e,t,n,i){n=intval(n),i=intval(i)||n;var a=e,o=t;return e>=t&&e>n?(a=intval(n),o=intval(t/(e/n))):e<t&&t>i&&(o=intval(i),a=intval(e/(t/i))),[a,o]}(c.width,c.height,.9*e.offsetWidth,.9*e.offsetHeight):[c.width,c.height],p=_[0],h=_[1],m=intval((c.width-p)*(browser.android?.5:$d.drag.x/c.width)),A=intval((c.height-h)*(browser.android?.5:$d.drag.y/c.height));addClass(e,"Thumb--moving"),Object(i.setStyle)(e,{zIndex:100}),Object(i.setStyle)(e.parentNode,{zIndex:100});var v=Nd(c,p,h);Object(i.setStyle)(e,{opacity:.75,width:p,height:h,marginLeft:m,marginTop:A}),s&&Object(i.setStyle)(s,v),$d.drag.state=!0}},onDrag:function(e){var t=$d.drag.curEl;if(e.touches&&e.touches.length>1)return this.drop();var n=this._getClickCoord(e),a=n.x,o=n.y,r=$d.drag,s=a-(r.pos[0]+r.x),l=o-(r.pos[1]+r.y);i.setStyle.transform(t,1,[s,l]);var c=r.wpos;s=r.pos[0]+intval(t.style.marginLeft)+s-c[0],l=r.pos[1]+intval(t.style.marginTop)+l-c[1];var u=s,d=l,f=(t.offsetWidth,t.offsetHeight,r.i),_=!1,p=r.i,h=-1,m=window.innerWidth>=480?Id:Md,A={};if(r.coords.forEach(function(e,t){if(t!==r.i&&t!==h){e.offsetX=e.node.offsetWidth+m,e.offsetY=e.node.offsetHeight+m;var n=r.coords[t-1],a=r.coords[t+1],o=u+r.x,s=d+r.y,l=e.x+e.offsetX/2,c=e.y+e.offsetY/2,v=e.x+e.offsetX,g=e.y+e.offsetY,b=(n&&n.x===e.x&&n.y!=e.y&&0!=e.y||a&&a.x===e.x&&a.y!=e.y)&&0!=e.x,y=o>=l&&(a&&(o<=a.x+a.offsetX/2&&(a.offsetY===e.offsetY||o<v)||a.y!=e.y)||!a&&u<=v)&&s>e.y&&s<g,w=o<l&&o>=e.x&&(!n||n.y!=e.y&&!(n.x===e.x&&!a))&&s>e.y&&s<g,C=b&&s>=c&&s<g&&o>e.x&&o<v,k=b&&s<c&&s>=e.y&&o>e.x&&o<v;y=y&&!b,w=w&&!b&&!y,(y||w||C||k)&&(_=!0,p=e.index<r.i&&(y||C)?e.index+1:f<e.index&&(k||w)?e.index-1:e.index),p!==r.i?(i.setStyle.transform(e.node,1,[y?-5:w?5:0,C?-5:k?5:0]),y?(A.side="right",A.toIndex=e.index):w&&(A.side="left"),C?(A.side="down",A.toIndex=e.index):k&&(A.side="up")):i.setStyle.transform(e.node,1,[0,0]),y&&a&&a.y===e.y&&a.x>e.x&&f>e.index&&(i.setStyle.transform(e.node,1,[0,0]),i.setStyle.transform(e.node,1,[0,0]),i.setStyle.transform(a.node,1,[5,0]),h=t+1,A.side="left",A.toIndex=p),C&&a&&a.x===e.x&&a.y>e.y&&s<=c&&(i.setStyle.transform(a.node,1,[0,0]),h=t+1),k&&n&&n.x===e.x&&n.y<e.y&&s<=c&&(i.setStyle.transform(n.node,1,[0,-5]),i.setStyle.transform(e.node,1,[0,0]),A.side="down",A.toIndex=n.index),p===t&&"number"!=typeof A.toIndex&&(A.toIndex=e.index)}}),A&&(!r.split||r.split.toIndex!==A.toIndex||r.split.side!==A.side)){var v=ge("ThumbsEdit-splitter");if(Object(i.setStyle)(v,{opacity:0}),r.split=A,"number"==typeof A.toIndex){var g=r.coords[A.toIndex].node,b=m===Md;"left"===r.split.side&&Object(i.setStyle)(v,{left:Math.max(0,g.offsetLeft-(b?0:1)),top:g.offsetTop+8,height:g.offsetHeight-16,width:"2px",opacity:1}),"right"===r.split.side&&Object(i.setStyle)(v,{left:Math.min(g.offsetLeft+g.offsetWidth-(b?2:1),$d.options.width-2),top:g.offsetTop+8,height:g.offsetHeight-16,width:"2px",opacity:1}),"up"===r.split.side&&Object(i.setStyle)(v,{left:g.offsetLeft+8,top:g.offsetTop,height:"2px",width:g.offsetWidth-16,opacity:1}),"down"===r.split.side&&Object(i.setStyle)(v,{left:g.offsetLeft+8,top:g.offsetTop+g.offsetHeight-1,height:"2px",width:g.offsetWidth-16,opacity:1})}}return r.toIndex=_?p:r.i,cancelEvent(e)},onDrop:function(e){var t=$d.drag;t.state=!1,t.updating=!0;var n=t.curEl,a=$("img",n),o="touchcancel".split(" ").includes(e.type);if(removeEvent(window,"mousemove touchmove",t.dragListener),removeEvent(window,"mouseup touchend touchcancel",t.dropListener),removeEvent(window,"touchmove",this.preventScroll),document.body.contains(t.curEl)){if(Object(i.setStyle)(document.body,"overflow",null),Object(i.setStyle)(document.body,"max-height",null),Object(i.setStyle)(document.body,"user-select",null),i.setStyle.transform(n.parentNode,1,[0,0]),t.split)delete t.split,ge("ThumbsEdit-splitter").removeAttribute("style");if(!hasClass(n,"Thumb--moving"))return t.updating=!1,cancelEvent(e);if(o){var r=t.coords[t.toIndex].node;i.setStyle.transform(r,1,[0,0])}if(t.toIndex===t.i||o){var s=t.crop;i.setStyle.animate(n,"transform, margin-top, margin-left, width, height, opacity",{duration:"100ms"},function(){removeClass(n,"Thumb--moving")}),i.setStyle.animate(a,"transform, margin-top, margin-left, width, height, opacity",{duration:"100ms"});var l=$d.thumbs[t.i];i.setStyle.transform(n,1,[0,0]),Object(i.setStyle)(n,{"margin-top":0,"margin-left":0,width:l.width,height:l.height,opacity:1,zIndex:null}),Object(i.setStyle)(n.parentNode,{zIndex:null}),a&&Object(i.setStyle)(a,s)}else{var c=$d.previews;c=function(e,t,n){if(n>=e.length)for(var i=n-e.length;1+i--;)e.push(void 0);return e.splice(n,0,e.splice(t,1)[0]),e}(c,t.i,t.toIndex),this.update(t.id,c)}return cancelEvent(e)}},getCoords:function(e,t){var n=[];t=t||getXY(e);var i=Array.from(e.childNodes||[]);return[].concat(i).forEach(function(e,i){var a=getXY(e);n[i]={id:e.getAttribute("data-media"),x:intval(a[0]-t[0]),y:intval(a[1]-t[1]),width:intval(e.offsetWidth),height:intval(e.offsetHeight),index:intval(e.getAttribute("data-index")),node:e}}),n},remove:function(e,t){var n=$d.previews[t];e&&Pe.default.close(e.target),mediaUpload.reset(null,null,n.remove,function(){$d.previews=$d.previews.filter(function(e,n){return n!==t}),ThumbsEdit.draw()})},showPopup:function(e){var t=e.target;if(!$d.drag.state&&!t.classList.contains("Thumb--moving")&&!t.classList.contains("Thumb__overlay-closeBtn")){e.cancelable&&cancelEvent(e);var n=t.closest(".Thumb-wrap").getAttribute("data-index"),a=Object(i.ceFromString)(s.default.html(this.getPopup(n)));za.default.open(a,!0)}},getPopup:function(e){var t=$d.previews[e],n=null;switch(t.type){case"doc":n='\n          Gif.openPopup(null, null, {\n            raw: "'+t.doc.id.slice(3,t.doc.id.length)+'",\n            hasVideo: '+Gif.isMp4Support()+"\n          });\n          Popup.close(this);\n        ";break;case"photo":n='\n          photo.zopen(null, null, "'+t.data.id.slice(5,t.data.id.length)+'", "'+t.list+'", {\n            hideOverlay: true,\n            single: true,\n          });\n          Popup.close(this);\n        '}var i=Object(za.ModalMenuBtn)({inner:getLang("mobile_delete"),onclick:"ThumbsEdit.remove(event, "+e+")"}),a=null;return n&&!t.temp&&(a=Object(za.ModalMenuBtn)({inner:getLang("mobile_open"),onclick:""+n})),Object(za.default)({class:"ThumbsEdit__modal",close:!0,items:[a,i]})},_getClickCoord:function(e){return{x:e.touches?e.touches[0].pageX:e.pageX,y:e.touches?e.touches[0].pageY:e.pageY}},cachePhoto:function(e,t,n){var i=ce("img");if(i.src=t,$d.cachedPhoto[e]){var a=$d.cachedPhoto[e].find(function(e){return e.src===t});a?n&&n(a.src):i.onload=function(){$d.cachedPhoto[e].push({width:i.width,height:i.height,src:t}),$d.cachedPhoto[e].sort(function(e,t){return e.width>t.width?-1:e.width<t.width?1:0}),n&&n(t)}}else $d.cachedPhoto[e]=[]},updatePhotos:function(){var e=this;$d.thumbs.forEach(function(t){var n=$("[data-media="+t.id+"] img");n.src!==t.image.src&&e.cachePhoto(t.id,t.image.src,function(e){n.src=e})})},getCached:function(e,t){var n=ce("img");return n.src=t,n.complete?t:$d.cachedPhoto[e]&&0!==$d.cachedPhoto[e].length?$d.cachedPhoto[e].find(function(e){var t=e.src,n=ce("img");return n.src=t,n.complete}):null},getThumbsCount:function(){return($d.thumbs||[]).length},updateIds:function(){var e=$$(".mr_x_wrap"),t=this.getThumbsCount()+1;e.forEach(function(e,n){var i=$$("input",e),a=t+n;i[0].name="attach"+a+"_type",i[1].name="attach"+a})}};var qd=need("Btn"),zd=need("Control"),Qd=window.Join||(window.Join={});Qd._onCountryChange=Gd,Qd._onPhoneChange=Kd,Qd._onTermsAcceptChange=Kd;var Yd={eu:"Join_eu"},Xd={join:".Join",phone:".Join__phone",accept:".Join__accept",submit:".Join__submit"};function Gd(e){var t=e.$option,n=Object(v.$)(Xd.join),i="1"===t.getAttribute("data-eu");n.classList.toggle(Yd.eu,i);var a=Object(v.$)(Xd.phone),o=t.value;Qt.default.setPrefix(a,o),cur.calledPhoneExcludeCountries&&val(Object(v.$)(".join_desc"),getLang(-1==indexOf(cur.calledPhoneExcludeCountries,t.getAttribute("data-id"))?"mobile_join_about_phone_with_call":"mobile_join_about_phone")),Object(v.$$)(Xd.accept).forEach(function(e){return zd.setChecked(e,!1)}),Kd()}function Kd(){var e=Array.prototype.slice.call(Object(v.$$)(Xd.accept)),t=Object(v.$)(Xd.phone),n=Object(v.$)(Xd.submit);if(n){var i=e.some(zd.isChecked)&&Qt.default.getValue(t).trim().length>0;qd.setDisabled(n,!i)}else(n=Object(v.$)('.button[type="submit"]')).disabled=!zd.isChecked(e[0])}n("XLP4");onDOMReady(tf),page.onChange(tf);var Jd="feedAssistance_pushNotificationsSwitch",Zd="enable_browser_notifications",ef="m_push_switch";function tf(){window.pushNotifier&&pushNotifier.canBeEnabled().then(function(e){return e&&PushNotifier.getPermission()===fd.PUSH_NOTIFIER_PERMISSION_DEFAULT}).then(function(e){if(e){FeedNotifications.addWebActionAcceptHandler(Zd,nf),FeedNotifications.addWebActionDeclineHandler(Zd,af);var t=geByClass1(Jd);if(!t)return;FeedAssistanceStats.registerTrackingCls(Jd),FeedAssistanceStats.register(t,"feed")}})}function nf(e){return PushNotifier.requestPermission().then(function(t){var n,i=!0;return unlockButton(e),t===fd.PUSH_NOTIFIER_PERMISSION_DEFAULT?i=!1:(n=t===fd.PUSH_NOTIFIER_PERMISSION_GRANTED?FeedAssistanceStats.EVENTS.SUB_EVENT_ENABLE_PUSH:FeedAssistanceStats.EVENTS.SUB_EVENT_DECLINE_PUSH,rf(e,n),of(),i)},function(){return af(e)})}function af(e){return unlockButton(e),rf(e,FeedAssistanceStats.EVENTS.SUB_EVENT_DECLINE_PUSH),of(),!0}function of(){var e=geByClass1(Jd);remove(e)}function rf(e,t){FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,e,ef,t)})}n("NBPr"),n("bYEY");function sf(e,t){return void 0===e&&(e=""),void 0===t&&(t=[]),!!t.find(function(t){return"*"===t[t.length-1]?e.startsWith(t.slice(0,t.length-1)):e===t})}var lf,cf=["/restore","/login","/authorize*","/join*","/","/settings","/album*","/terms","/privacy","/payments*","/attachments*","/page*","/blog*","/about","/privacy","/jobs","/dev","/legal","/data_protection","/safety","/activation*","/licence","/agelimits"];function uf(){lf&&lf.classList.remove(jn.class.open)}function df(){lf&&lf.classList.add(jn.class.open)}onDOMReady(function(){!function e(t,n){void 0===n&&(n=!0),Object(i.isIosWebView)()||Object(i.isAndroidWebView)()||Object(i.isVkWebView)()||(n||(lf=geByClass1(jn.class.btn),page.onChange(e.bind(this))),t=t?t.split("?")[0]:nav.path,!/^\/photo/.test(t)&&uf(),sf(t,cf)||nav.getQuery("z")?(uf(),setTimeout(uf)):df())}(null,!1)});var ff={_onCloseClick:function(e){jn._onCloseClick(e),Object(Ne.setCookie)("remixregbtn",0,0)},show:df,hide:uf};window.uRegisterFloatBtn=ff;var _f,pf=["/restore","/login","/join*","/","/settings","/album*","/terms","/privacy","/payments*","/attachments*","/pages*","/blog*","/about","/privacy","/jobs","/dev","/legal","/data_protection","/safety","/activation*","/licence","/agelimits"];function hf(){_f&&_f.classList.remove(jn.class.open)}function mf(){_f&&_f.classList.add(jn.class.open)}onDOMReady(function(){!function e(t,n){void 0===n&&(n=!0),n||(_f=geByClass1(jn.class.btn),page.onChange(e.bind(this))),t=t?t.split("?")[0]:A.default.path,!/^\/photo/.test(t)&&hf(),sf(t,pf)||A.default.getQuery("z")?hf():mf()}(null,!1)});var Af={_onCloseClick:function(e){jn._onCloseClick(e)},show:mf,hide:hf,processOpenInNativeApp:function(e,t,n,a,o){void 0===o&&(o={}),o=o||{},A.default.onMenuItemClick(n),A.default.openInNativeApp(a,t,e),Object(i.statlogsValueEvent)("utm_open_in_native_app_button","clicked",o.utm_source,o.utm_param,o.utm_medium,o.utm_time)}};window.uOpenInNativeAppFloatBtn=Af;var vf=need("nav"),gf=need("page"),bf=need("ajax"),yf=need("audioplayer"),wf=need("TabRow"),Cf=need("AudioSerp");window.uAudioSerp={},uAudioSerp._onQueryChange=jf,uAudioSerp._init=Df;var kf=300,Sf={},Ef=!1,Of=null,Tf=null;function Df(){var e,t=need("cur");(e=Mf(vf.getQuery("q")))&&(Sf[e]=Cf.getFoundHtml()),t.processNav=If,yf.onAdd(xf),yf.onDel(xf)}function jf(e){var t=e.query,n=Mf(t);function i(){var e=!0;n||(e=!1),!n&&Ef&&(cur.processNav=null,Cf.toggleTabs(!1),Cf.setView("spinner"),Ef=!1),vf.go(xa.default.make(vf.path,{q:n?t:"",tab:e})),cur.processNav=If}Tf&&Tf.abort(),Of&&clearTimeout(Of),Cf.toggleTabs(!0),n in Sf||!n?i():(Cf.setView("spinner"),Of=setTimeout(i,kf))}function If(e){var t=vf.path,n=e.nav.path,i=qs2obj(vf.params),a=qs2obj(e.nav.params);if(t!==n||a.act)return gf.save(vf.cur,{title:document.title,bc:Object(v.$)("body").className,html:Object(v.$)(".basis").outerHTML,js:vf.getPageJs()}),Sf={},Ef=!0,yf.onAdd.off(xf),yf.onDel.off(xf),Tf&&Tf.abort(),!1;if(!Object(m.partConfigEnabled)("audio_recommendations_new_catalog")&&i.tab!==a.tab){var o=a.tab||"owned";Cf.setTab(o),wf.setSelectedTab("uAudioSerp",o)}var r=a.q||"",s=Mf(r);if(t.q!==a.q&&Tf&&Tf.abort(),!Object(m.partConfigEnabled)("audio_recommendations_new_catalog")){var l=xa.default.make(t,{q:r,tab:null}),c=xa.default.make(t,{q:r,tab:"global"});wf.setTabUrl("uAudioSerp","owned",l),wf.setTabUrl("uAudioSerp","global",c)}return SearchPanel.setQuery("uAudioSerp",r),r?s in Sf?(Cf.setFoundHtml(Sf[s]),Cf.setView("found")):(Cf.setView("spinner"),Tf=bf.post(t,{q:r,_ajax:1},{onDone:function(e){Cf.setFoundHtml(e),Cf.setView("found"),Sf[s]=e}})):Cf.setView("owned"),!0}function Mf(e){return(e||"").trim().toLowerCase()}function xf(){Sf={},Ef=!0}n("LTt1"),n("mXGF"),n("is+u");var Bf=function(e){var t=e.tag,n=t.id===e.current_id?"control_radio_checked":"control_radio";return{href:t.href,class:"Bookmarks__tagsSelectItem",inner:[{class:"Bookmarks__tagsSelectItemTitle",inner:s.default.wrap(t.name)},s.default.wrap(Object(Tn.default)({icon:n}))]}};var Pf=Bf;window.BookmarksFilterListItem=Bf;var Lf=function(e){var t=!(!e.tags||!e.tags.length)&&e.tags;return{class:"Owner__tags",inner:t?[{class:"Owner__tags_icon Icon Icon_tagLabel"},t.map(function(e){return{class:"Owner__tag",inner:s.default.wrap(e.name)}})]:null}};var Rf=Lf;window.BookmarksPageItem=Lf;var Nf=window.Popup,Ff=window.ActionMenu,Hf=window.attr,Uf=window.val,Vf=window.ajax,$f=window.replace,qf=window.scrollTop,Wf=window.ceFromString,zf=window.Btn;window.Bookmarks={hideTagsList:t_,showTagsList:function(e,t){void 0===t&&(t=!1);e&&e.stopPropagation();var n=Jf(Qf.tagsListPopup),a=s_();if(n.classList.remove("BookmarksPopup__hideCorner"),t){var o=t.closest(Qf.bookmarkItem),r=l_(Hf(o,"id"));a=a.filter(function(e){return r.includes(e.id)}),n.classList.add("BookmarksPopup__hideCorner")}var l=Object(i.qs2obj)(nav.params),c=Object.keys(a).reduce(function(e,t){var n=a[t];return e.push(Pf({tag:n,current_id:parseInt(l.tag)})),e},[]),u=s.default.html(c);Uf(n.$(".Popup__scrollContent"),u);var d=Object(v.$$)(Qf.tagsListLinks,n);d&&d.forEach(function(e){addEvent(e,"click",t_)});return!1},hideDeletePopup:n_,showDeletePopup:function(e){var t=Jf(Qf.tagsDeletePopup),n=Hf(e,"data-id"),a=Hf(e,"data-hash"),o=Hf(e,"data-name");return u_(t,{id:n,hash:a}),Uf(t.$("["+Yf.deleteName+"]"),Object(i.htsc)(o)),!1},submitDeleteTag:function(){var e=d_(Array.from(Object(v.$$)(Qf.tagsDeletePopup)).pop()),t=e.id,n=e.hash;Vf.post("/bookmarks",{_ajax:1,act:"tag_delete",id:t,hash:n},{onDone:function(e){Kf(e),n_()}})},hideCreatePopup:i_,showCreatePopup:function(e){var t=Jf(Qf.tagsCreatePopup),n=Hf(e,"data-hash");u_(t,{hash:n});var i=Object(v.$)("[name="+Yf.createName+"]",t),a=Object(v.$)(Qf.tagsSubmitButton,t),o=Uf(i).trim();return zf.setDisabled(a,!o),!1},submitCreateTag:function(){var e=Array.from(Object(v.$$)(Qf.tagsCreatePopup)).pop(),t=Array.from(Object(v.$$)(Qf.tagsSettings)).pop(),n=d_(e).hash,i=Uf(e.$("[name="+Yf.createName+"]")),a=+!!Object(v.$)(Qf.tagsSettings);Vf.post("/bookmarks",{_ajax:1,act:"tag_edit",tag:i,hash:n,id:0,from_settings:a},{onDone:function(e,n){if(a){var i=[];Array.from(t.$$('[name="tag"][type="checkbox"]:checked')||[]).forEach(function(e){i.push(e.value)}),Uf(t,e),i.forEach(function(e){var n=t.$('[name="tag"][type="checkbox"][value="'+e+'"]');n&&(n.checked=!0)})}else Kf(e);!function(e){var t=r_(),n=e[0],i=e[1];t&&t.tags&&(t.tags[n]={id:n,name:i,order:0})}(n),i_()}})},hideEditPopup:a_,showEditPopup:function(e){var t=Jf(Qf.tagsEditPopup),n=Hf(e,"data-id"),i=Hf(e,"data-hash"),a=Hf(e,"data-name")||"",o=t.$("[name="+Yf.editName+"]");Uf(o,a),u_(t,{id:n,hash:i,name:a});var r=Array.from(Object(v.$$)(Qf.tagsSubmitButton,t)).pop(),s=Uf(o).trim();return zf.setDisabled(r,!s),!1},submitEditTag:function(){var e=Array.from(Object(v.$$)(Qf.tagsEditPopup)).pop(),t=d_(e),n=t.id,i=t.hash,a=Uf(e.$("[name="+Yf.editName+"]"));Vf.post("/bookmarks",{_ajax:1,act:"tag_edit",tag:a,hash:i,id:n},{onDone:function(e){Kf(e),a_()}})},hideSettingsPopup:o_,showSettingsPopup:function(e,t){void 0===t&&(t={});var n,i,a,o=Hf(e,"data-item_id"),r=Hf(e,"data-item_oid"),l=Hf(e,"data-item_type"),c=Hf(e,"data-hash"),u=Hf(e,"data-raw");t.wrap||(n=Jf(Qf.tagsSettingsPopup),i=n.$(Qf.tagsSettings),a=l_(u),Uf(i,s.default.html({class:"Bookmarks__tagsSettingsLoading"})),u_(n,{id:o,oid:r,type:l,hash:c,itemRaw:u}));return Vf.post("/bookmarks",{_ajax:1,act:"tag_settings",hash:c,item_id:o,item_oid:r,item_type:l,wrap:t.wrap?1:0},{onDone:function(e){if(t.wrap){var s=Wf(e);u_(s=Jf(s),{id:o,oid:r,type:l,hash:c,itemRaw:u,needRemove:!0,is_from_snackbar:t.is_from_snackbar})}else Uf(i,e),a.forEach(function(e){var t=n.$('[name="tag"][type="checkbox"][value="'+e+'"]');t&&(t.checked=!0)})}}),!1},submitSettingsTags:function(){var e=Array.from(Object(v.$$)(Qf.tagsSettingsPopup)).pop(),t=d_(e),n=t.id,i=t.oid,a=t.type,o=t.hash,r=t.itemRaw,l=t.is_from_snackbar,c=[];Array.from(e.$$('[name="tag"][type="checkbox"]:checked')||[]).forEach(function(e){c.push(e.value)});var u=c.join(",");Vf.post("/bookmarks",{_ajax:1,act:"tag_set",hash:o,item_id:n,item_oid:i,item_type:a,tag_ids:u,is_from_snackbar:l},{onDone:function(e){o_();var t=Object(v.$)("#"+r);if(t){var n=Object(v.$)(".BookmarkListItem__tags, .BookmarksItem__tag",t);if(n)Uf(n,e);else if(n=Object(v.$)(".Owner__tags",t)){var i=s_(),a=c.map(function(e){return parseInt(e,10)}),o=i.filter(function(e){return a.includes(e.id)}),l=s.default.html(Rf({tags:o}));Uf(n.parentNode,l)}p_(r,c,""),cur&&cur.search_bookmarks&&cur.search_bookmarks.redraw()}}})},closeAll:function(){t_(),n_(),i_(),a_(),o_()},initStore:c_,pushItemsToStore:function(e){var t=r_();t&&(t.items=Object(Ke.default)({},t.items,e))},pushItemToStore:p_,removeFromBookmarkLink:function(e){var t=Hf(e,"data-item_id"),n=Hf(e,"data-item_oid"),i=Hf(e,"data-item_type"),a=Hf(e,"data-hash"),o=Hf(e,"data-raw"),r=Hf(e,"data-link_url"),s=Hf(e,"data-link_title"),l=Hf(e,"data-link_img"),c=Object(v.$)("#"+o);return Ff.closeMenu(),addClass(c,Xf.removed),Vf.post("/bookmarks",{_ajax:1,act:"bookmark_remove",hash:a,item_id:t,item_oid:n,item_type:i,link_url:r,link_title:s,link_img:l},{onDone:function(e){__(o,[Xf.removed]),Share.setBookmarkState(o,!1),cur&&cur.search_bookmarks&&cur.search_bookmarks.redraw()}}),!1},addToBookmarkLink:function(e){var t=Hf(e,"data-item_id"),n=Hf(e,"data-item_oid"),i=Hf(e,"data-item_type"),a=Hf(e,"data-hash"),o=Hf(e,"data-raw"),r=Hf(e,"data-link_url"),s=Hf(e,"data-link_title"),l=Hf(e,"data-link_img"),c=Object(v.$)("#"+o);return Ff.closeMenu(),removeClass(c,Xf.removed),Vf.post("/bookmarks",{_ajax:1,act:"bookmark_add",hash:a,item_id:t,item_oid:n,item_type:i,link_url:r,link_title:s,link_img:l},{onDone:function(){var e=f_(o),t=e.indexOf(Xf.removed);-1!==t&&e.splice(t,1),__(o,e),Share.setBookmarkState(o,!0),cur&&cur.search_bookmarks&&cur.search_bookmarks.redraw()}}),!1},showSuccessSnack:function(e){var t,n=window.lang,a=Object(i.geByClass1)("RepliesField_fixed");a&&(t=Object(i.getH)(a)+5);Snackbar.init({type:b.SNACKBAR_TYPE_BOOKMARK,text:n.mobile_bookmarks_snackbar_added,bottom:t,action:{url:"/bookmarks",text:n.mobile_bookmarks_snackbar_edit_tags,onclick:"return Bookmarks.showSettingsPopup(this, { wrap: true, is_from_snackbar: 1 });",attrs:Object.keys(e).reduce(function(t,n){return t["data-"+n]=e[n],t},{})}})},keyupCreateInput:function(e,t){var n=gpeByClass("BookmarksPopup",t),i=Object(v.$)(Qf.tagsSubmitButton,n),a=Uf(t).trim();zf.setDisabled(i,!a)},openSavedTab:function(e,t){var n=Object(v.$)(".mm_counter",t),i=Object(Ne.getCookie)(Gf.lastTab);i&&!n&&(e&&e.preventDefault(),nav.go("/bookmarks?type="+i))},openLikesFeed:function(e){var t=Object(v.$)(".mm_new",e);Object(i.remove)(t)},getStoreItemDataById:h_,getTagsByItemId:m_,renderSearchItem:function(e,t,n,i,a){var o="";if(!i||isEmpty(i))o=n;else{var r=m_(e),l=f_(e);i=JSON.parse(i),r&&(t=r.reduce(function(e,t){return[].concat(e,[t.id])},[]),i.subtitle=Rf({tags:r})),l&&(i.mix=[].concat(l)),i.title=s.default.wrap(a.highlight(i.title)),o=s.default.html(ki(i))}return p_(e,t,n),o}};var Qf={tagsListPopup:".BookmarksPopup__filter",tagsDeletePopup:".BookmarksPopup__delete",tagsCreatePopup:".BookmarksPopup__create",tagsEditPopup:".BookmarksPopup__edit",tagsSettingsPopup:".BookmarksPopup__settings",tagsSettings:".Bookmarks__tagsSettings",tagsListContainer:".BookmarkListItem__tags",tagsListLinks:".Bookmarks__tagsSelectItem",tagsListWrap:".BookmarksTags",tagsListItem:".BookmarksTags__item",tagsListItemMore:".BookmarksTags__item_more",tagsContainer:".basisDefault",tagsSubmitButton:".BookmarksPopup__buttonSubmit",bookmarkItem:".BookmarksItem"},Yf={deleteName:"data-deletetagname",createName:"createtagname",editName:"edittagname"},Xf={removed:"BookmarksItem_removed"},Gf={lastTab:"remixblt"};function Kf(e){var t=qf(),n=Object(v.$)(Qf.tagsContainer),i=Wf(e);$f(i,n),qf(t)}function Jf(e){var t;Ff.closeMenu(),t="string"==typeof e?Object(v.$)(e):e,t=Nf.open(t,!0);var n="popup"+Date.now();return Hf(t,"data-popupid",n),t}function Zf(e){return Hf(e,"data-popupid")}function e_(e){var t;if(t=!("string"==typeof e)?e:Array.from(Object(v.$$)(e)).pop()){Nf.close(t);var n=d_(t),a=n&&n.needRemove;!function(e){var t=Zf(e);delete r_().popup[t]}(t),a&&Object(i.remove)(t)}return!1}function t_(){var e=Array.from(Object(v.$$)(Qf.tagsListPopup)).pop(),t=Object(v.$$)(Qf.tagsListLinks,e);return t&&t.forEach(function(e){removeEvent(e,"click",t_)}),e_(e)}function n_(){return e_(Qf.tagsDeletePopup)}function i_(){var e=Array.from(Object(v.$$)(Qf.tagsCreatePopup)).pop();if(e){var t=e.$("[name="+Yf.createName+"]");Uf(t,"")}return e_(Qf.tagsCreatePopup)}function a_(){var e=Array.from(Object(v.$$)(Qf.tagsEditPopup)).pop();if(e){var t=e.$("[name="+Yf.editName+"]");Uf(t,"")}return e_(Qf.tagsEditPopup)}function o_(){return e_(Qf.tagsSettingsPopup)}function r_(){return window.store.bookmarks||c_(),window.store.bookmarks}function s_(){var e=r_();return e.tags?e.tags:{}}function l_(e){var t=r_();return t.items[e]?t.items[e][3]:[]}function c_(e){void 0===e&&(e={}),window.store.bookmarks=Object(Ke.default)({},e,{popup:{}})}function u_(e,t){var n=Zf(e);r_().popup[n]=t}function d_(e){var t=Zf(e);return r_().popup[t]}function f_(e){var t=r_();return t&&t.items&&t.items[e]&&t.items[e][5]}function __(e,t){var n=r_();n&&n.items&&n.items[e]&&(n.items[e][5]?n.items[e][5]=[].concat(n.items[e][5],t):n.items[e][5]=[].concat(t))}function p_(e,t,n,i){var a=r_();a&&a.items&&(t=t.map(function(e){return parseInt(e,10)}),a.items[e]?(a.items[e][3]=t,a.items[e][4]=i):a.items[e]=["",n,e,t,i])}function h_(e){var t=r_();return t&&t.items&&t.items[e]}function m_(e){var t=h_(e),n=s_();if(t&&n){var i=t[3]||[];return n.filter(function(e){return i.includes(e.id)})}return!1}window.uCloseProfileSwitcher={},uCloseProfileSwitcher._onConfirmClick=v_;var A_=null;function v_(e,t){var n=t.checked;A.default.clear();var a={is_closed:n?"1":"0",_ajax:1};f.default.post(e,a,{onDone:function(){A.default.reload();var e=window.cur;A_=Object(i.scrollTop)(),e.destroy.push(g_)}})}function g_(){Object(i.scrollTop)(A_),requestAnimationFrame(function(){Object(i.scrollTop)(A_),requestAnimationFrame(function(){Object(i.scrollTop)(A_)})})}window.GroupsMenu={},window.GroupsMenu._onClick=function(e,t,n,a,o){return Object(i.statlogsValueEvent)("groups_menu_item_click",e,t,n,a,o),!0};var b_=function(e){void 0===e&&(e={});var t=window.lang;return Object(yt.default)({on_overlay_click:"return false;",class:"Popup_open",body:{class:"WarningModal",inner:[{class:"WarningModal__icon",inner:Object(ht.default)("groups/common","hide_outline_56")},{class:"WarningModal__title",inner:e.title},{class:"WarningModal__text",inner:e.text}]},items:[Object(yt.ModalMenuBtn)({url:"/groups",class:"WarningModal__button",theme:"regular",size:"large",inner:t.mobile_back,onclick:["WarningModal.leave","this","event"],attrs:{"data-id":e.id,"data-hash":e.hash,"data-gid":e.gid,"data-uid":e.user_id}}),Object(yt.ModalMenuBtn)({url:e.proceed_url,class:"WarningModal__button",theme:"secondary",size:"large",inner:t.mobile_groups_warning_notification_proceed,onclick:["WarningModal.close","this","event"],attrs:{"data-id":e.id,"data-hash":e.hash,"data-gid":e.gid,"data-uid":e.user_id}})]})};window.WarningModal=b_,extend(b_,{close:function(e,t){t&&t.preventDefault(),za.default.close(e),f.default.post("/groups",{_ajax:1,act:"hide_warning_notification",notification_id:Object(i.domData)(e,"id"),group_id:Object(i.domData)(e,"gid"),hash:Object(i.domData)(e,"hash")})},leave:function(e,t){t&&t.preventDefault(),za.default.close(e),Object(v.$)("#m .header__back").click()}});var y_=!1,w_={start:function(e,t,n){if("%page_id%"!==e&&!y_){var a,o;switch(y_=!0,n&&"%page_path%"!==n?n:A.default.cur){case"/feed":a=ql.TAB_ID_FEED;break;case"/feed?section=recommended":a=ql.TAB_ID_RECOMMEND;break;case"/mail":a=ql.TAB_ID_MESSAGES;break;case"/feed?section=notifications":a=ql.TAB_ID_NOTIFICATION}a&&innerWidth<882?ql.drawSkeletonLoader(Object(v.$)(".layout__basis"),a):o=setTimeout(function(){o=null,ql.drawLoader(Object(v.$)(".layout__basis")),Object(i.alLoadingFix)()},1e3),setTimeout(function(){var i={headers:{"X-AppShell-Start-Id":e,"X-AppShell-Start":t},zProcess:function(){},onNavDone:function(){o&&clearTimeout(o)}};n&&"%page_path%"!==n?A.default.go(n,{push_only:!0,replace:!0},i):A.default.go(A.default.cur,null,i)})}}};window.AppShell=w_;var C_={reload:function(e){xn.default.setDisabled(e,!0),!1===navigator.onLine?setTimeout(function(){xn.default.setDisabled(e,!1)},500):A.default.reload()}};window.OfflinePage=C_;var k_=n("2mXy");var S_=function(e){var t=e.info||{};return{inner:[{inner:[{inner:[Object.keys(t).map(function(e){var n=t[e];return"boolean"==typeof n&&(n=n?"yes":"no"),function(e,t){return{inner:[{inner:[e],tag:"b"},"\n      :\n      ",{inner:[t],tag:"i"}],tag:"div"}}(e,n)})],class:"fi_row",tag:"div"},{inner:[{inner:[{inner:[{inner:[{inner:"Audio tag not support",tag:"b"}],src:"//vk.com/mp3/bb1.mp3",tag:"source"}],preload:"none",controls:"controls",style:"width: 100%;",tag:"audio"}],style:"color: #777;",tag:"div"}],class:"fi_row",tag:"div"},{inner:[{inner:[{type:"hidden",id:"device_info_text",name:"device_info",value:e.fallbackText,tag:"input"},{inner:[e.needSendButton&&Object(xn.default)({inner:[Object(xo.getLang)("mobile_send_device_info")],submit:!0,stretch:!0,onClick:e.onSendClick})],class:"cp_buttons_block",tag:"div"}],action:"/?device",method:"post",tag:"form"}],class:"fi_row",tag:"div"}],class:"form_item",tag:"div"}],class:"PageBlock DeviceInfo fit_box",style:"color: #777; line-height: 1.7",tag:"div"}},E_=function(e){function t(t){var n;return(n=e.call(this,t)||this).onSendClick=function(e){e.preventDefault();var t=n.state.info,i=Object.keys(t).map(function(e){return e+": "+t[e]}).join("\n");f.default.post("/?device",{_ajax:!0,device_info:i},{onDone:function(e){1===e?(self.setState({needSendButton:!1}),Snackbar.init({text:getLang("mobile_device_info_sent")})):Snackbar.init({text:getLang("mobile_unknown_error")})}})},n.state=Object(Ke.default)({},t),n}Object(rt.default)(t,e);var n=t.prototype;return n._testAudio=function(){return!!window.Audio&&(new Audio).canPlayType("audio/mpeg")},n._testPhotoView=function(e){var t=document.createElement("div").style,n=[];return void 0!==t.webkitTransform&&n.push("webkitTransform"),void 0!==t.MozTransform&&n.push("MozTransform"),void 0!==t.msTransform&&n.push("msTransform"),void 0!==t.OTransform&&n.push("OTransform"),e+" ("+n.join(", ").replace(/^(, )+|(, )+$|(, )(, )+/g,"$3")+")"},n._testFileAPI=function(e){return e+" ("+[window.XMLHttpRequest?"XMLHttpRequest":"",window.XDomainRequest?"XDomainRequest":"",window.FormData?"FormData":"",window.FileReader?"FileReader":"",window.XMLHttpRequest&&XMLHttpRequest.sendAsBinary?"sendAsBinary":"",window.ArrayBuffer?"ArrayBuffer":"",window.Uint8Array?"Uint8Array":"",window.MozBlobBuilder?"MozBlobBuilder":"",window.WebKitBlobBuilder?"WebKitBlobBuilder":"",window.BlobBuilder?"BlobBuilder":""].join(", ").replace(/^(, )+|(, )+$|(, )(, )+/g,"$3")+")"},n.componentDidMount=function(){var e=this.state.info;e.Audio=this._testAudio(),e["Fullscreen Photoview"]=this._testPhotoView(e["Fullscreen Photoview"]),e.FileAPI=this._testFileAPI(e.FileAPI),this.setState({info:e})},n.render=function(){return s.default.preact(S_,Object(Ke.default)({},this.state,{onSendClick:this.onSendClick}))},t}(k_.Component);function O_(){var e=$("#DeviceInfo");s.default.hydrate(E_,Object(xo.getState)("DeviceInfo"),e)}l.default.getRouter().addRoute("/?device",O_),window.initDeviceInfo=O_,Object(c.initStaticManager)(),Object(i.addEvent)(window,"scroll touchmove",function(){Object(i.onBodyScroll)(!0)},{passive:!0});var T_=window,D_=T_.thover,j_=T_.ajax;function I_(){if(Object(i.lsGet)("custom_opts"))return Object(i.addClass)("_copts","vk_wrap");var e=Object(i.ce)("div",{innerHTML:'<input id="copts_test_radio" type="radio" checked="checked"><div id="copts_test_label"></div>'});Object(i.append)(e,"vk_utils");var t=Object(i.ge)("copts_test_label");t&&Math.abs(t.offsetWidth-5)<1&&(Object(i.addClass)("_copts","vk_wrap"),Object(i.lsSet)("custom_opts",1)),Object(i.remove)(e)}Object(i.addEvent)(document,"touchmove touchcancel",D_.cancel),Object(i.addEvent)(document,"touchend",D_.end),j_._init(),j_.enabled=!!j_._req,j_.enabled&&(onDOMReady(function(){Object(i.remove)("app_go_frame"),j_.prepare_click(),menu&&menu.init(),audioplayer&&audioplayer.initAudio(),Object(i.addClass)("_js","vk_wrap")}),page.clear()),page.onChange(function(){return l.default.getRouter().checkRoutes()}),onDOMReady(function(){l.default.getRouter().checkRoutes()}),onDOMReady(u.resizePosters),Object(i.addEvent)(window,"resize",u.resizePosters),Object(i.addEvent)(document,"touchstart",function(e){var t=Object(i.checkTouchHover)(e.target);D_.clear(),t&&D_.start.call(t,e)}),Object(i.addEvent)(document,"click",function(e){var t=window.al;if(window.al&&t.ver){var n=Object(i.gpeByClass)("al_after",e.target);if(n){var a=Object(i.attr)(n,"data-target"),o=!!a&&Object(i.geByClass1)(a,n);if(o&&!nav.go_after(o,e)||!nav.go_after(n,e))return}var r=Object(i.checkNav)(e.target,{allow_post_away:!0});if(r&&(nav.go(r,e)||Object(i.cancelEvent)(e)),"bookmarks"===cur.module){var s=e&&e.target&&(e.target.closest(".BookmarksItem_link")||e.target.closest(".BookmarkSlider__item")||e.target.closest(".OwnerRow"));if(!s)return;var l=s.getAttribute("id").match(/^(link|page)(-?\d+)_(-?\d+)?$/)||[],c=l[0],u=l[1],d=l[2],f=l[3];if(!(c&&u&&d&&f))return;var _=!1;switch(u){case"link":_=e.target.closest('a[target="_blank"]');break;case"page":_=e.target.closest(".OwnerRow__content")||e.target.closest(".OwnerColumn")}if(!_)return;statlogsValueEvent("bookmarks_product_analytics",{item_type:u,item_owner_id:intval(d),item_id:intval(f),time:vk.ts+Math.floor(((new Date).getTime()-vk.started)/1e3)})}}}),Object(i.addEvent)(document,"submit",function(e){var t=e.target;Object(i.hasClass)("vk_js_yes",geByTag1("html"))&&!Object(i.hasClass)("opera_mini_yes",geByTag1("body"))&&Object(i.hasClass)("qsearch",t)&&Object(i.gpeByClass)("audioPage",t)&&(geBySel1('[type="submit"]',t).click(),Object(i.cancelEvent)(e))}),Object(i.addEvent)(document,d.isTouch?"touchstart":"mousedown",function(e){tooltip.closeByTap(e)}),onDOMReady(I_),onDOMReady(m.calculateTimeOffsets),Object(i.sgFix)(),onDOMReady(function(){var e=window.vk;e&&!e.id&&Object(i.lsCheck)()&&localStorage.clear()}),window.optionsTest=I_,zlayer.isReady=!0,window.isNewMail&&(n("sc7o"),n("s0aB"),n("/Id8"),n("DkIl"),n("CkGd"),n("iS9e"),n("fWqt"),n("QBkA"),n("rKp0"),n("u33z"),n("5qQ6"),n("/Rzu"),n("B5sG"),n("M2vk"),n("HPEO"),n("irqS"))},"7jQU":function(e,t,n){"use strict";n.r(t);n("rKUZ");function i(e){var t=store.mail.cur.typings[e];return t?t.mixed||t.audio||t.text:null}function a(e){if(!e)return[];for(var t=store.mail.members,n=e.users,i=n.length,a=[],o=0;o<i;o++){var r=t[n[o]];if(r){var s=1===i?r.name:r.shortName;a.push(s)}}return a}n.d(t,"uTyping_getPeerTyping",function(){return i}),n.d(t,"uTyping_getNames",function(){return a})},"98L6":function(e,t){window.FeedBlocks={hideReason:function e(t,n){if(e.progress)return!1;e.progress=!0;var i="block_"+t,a=ge(i);cur.feedBlocksHTML&&delete cur.feedBlocksHTML[i],ajax.post("feed.php",{act:"block_hide_reason",block_id:t,reason:0|n,hash:attr(a,"data-hash"),pos:attr(a,"data-pos"),ref:attr(a,"data-ref")},{onDone:function(t){e.progress=!1,t?val(a,t):hide(a),e.progress=!1},onFail:function(){e.progress=!1}})},restore:function(e){var t="block_"+e,n=ge(t);cur.feedBlocksHTML&&cur.feedBlocksHTML[t]&&val(t,cur.feedBlocksHTML[t]),ajax.post("feed.php",{act:"block_restore",block_id:e,hash:attr(n,"data-hash"),pos:attr(n,"data-pos"),ref:attr(n,"data-ref")})},hide:function e(t,n){if(e.progress)return!1;e.progress=!0,post.wallActionsHide();var i="block_"+t,a=ge(i);return ajax.post("feed.php",{act:"block_hide",block_id:t,hash:attr(a,"data-hash"),pos:attr(a,"data-pos"),ref:attr(a,"data-ref")},{onDone:function(t){post.wallActionsHide(),cur.feedBlocksHTML||(cur.feedBlocksHTML={}),cur.feedBlocksHTML[i]=val(a),val(a,t),e.progress=!1},onFail:function(){e.progress=!1}}),!1}}},"9M99":function(e,t,n){"use strict";n.r(t);var i=n("S6+Z"),a=n("TxR4"),o=[["&amp;","&"],["&lt;","<"],["&gt;",">"],["&quot;",'"']];function r(e){return function(e){return o.reduce(function(e,t){var n=t[0],i=t[1];return e.replace(new RegExp(i,"ig"),n)},e)}(e).replace(/[\u00A0-\u9999<>\&]/gim,function(e){return"&#"+e.charCodeAt(0)+";"})}function s(e,t,n,i){return!n&&t?t:i?'<i class="emoji @'+e+'" emoji="'+e+'"'+(t?' title="'+t+'"':"")+"></i>":'<img class="emoji" src="/emoji/e/'+e+(window.devicePixelRatio>=2?"_2x":"")+'.png"'+(t?' alt="'+t+'"':"")+(browser.msie&&Number(browser.version)>8?' contenteditable="false"':"")+">"}function l(e){return s(Object(a.emojiSymbolToByteHex)(e),r(e),!0)}n.d(t,"emojiToHTML",function(){return c});var c=function(e){return function(e,t){if(browser.ipad||browser.iphone)return e;e=(e+"").replace(/&nbsp;/g," ").replace(/<br>/g,"\n");for(var n=0;n<2;n++)Object.keys(i.EMOJI_PREFIXED_REPLACES).forEach(function(t){e.replace(i.EMOJI_PREFIXED_REPLACES[t],function(e,n,i,a){return(n||"")+s(t)+(a||"")})});return Object.keys(i.EMOJI_REPLACES).forEach(function(t){e=e.replace(i.EMOJI_REPLACES[t],function(e,n,i){return s(t)+(i||"")})}),e=e.replace(/\n/g,"<br>"),t&&(e=e.replace(/\uFE0F/g,"").replace(Object(i.emojiRegex)(),l)),e}(e,!0)}},"9y81":function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("Mc5h"),o=function(e){var t,n=e.icon,o=e.class||e.mix;return Object(a.default)({mix:i.default.class(o,"Icon",(t={},t[n]=!0,t.active=e.active,t.blue=e.blue,t.bluer=e.bluer,t.dark=e.dark,t.selected=e.selected,t.small=e.small,t.white=e.white,t)),url:e.url,attrs:e.attrs})};function r(e){var t,n=e.icon;return{class:[e.class,Bem.class("Icon",(t={},t[n]=!0,t.active=e.active,t.blue=e.blue,t.bluer=e.bluer,t.dark=e.dark,t.selected=e.selected,t.small=e.small,t.white=e.white,t))],href:e.url,attrs:e.attrs}}Object.assign(o,{toggleActive:function(e){e.classList.toggle(s.active)}});var s={active:"Icon_active"};n.d(t,"IconWd",function(){return r});t.default=o;window.Icon=o},AXyT:function(e,t,n){"use strict";n.r(t);var i=function(e){return Wd.html({class:[Bem.class("Oval",{type:e.gray?"minor":e.type,hidden:a(e.value)}),e.mix],inner:e.value})};function a(e){return!e||e<=0}Object.assign(i,{setValue:function(e,t){if(!e)return;var n=a(t);e.innerText=t,e.classList.toggle(o.hidden,n)}});var o={hidden:"Oval_hidden"};t.default=i;Object.assign(window,{Oval:i,Oval_isHidden:a})},AeId:function(e,t){var n={_seen:{},_saved:{},_saveTimer:null,_sendTimer:null,_cleanTimer:null,LS_ADS_EVENTS:"ads.events",postsGetRaws:function(e){var t,n=(e=ge(e)).id||"",i=attr(e,"data-copy")||"",a={};if("block_"===n.substr(0,6)){a[n]=1,a.block=n.substr(6);var o=attr(e,"data-contain");o&&(o=o.split(",")).forEach(function(e){e=e.split(":"),a[e[0]]=intval(e[1])||1})}else(t=n.match(/^wall(adsite.*)$/))?a[t[1]]=1:(t=n.match(/^wall(-?\d+_\d+)$/))&&(a[t[1]]=1,(t=i.match(/^(-?\d+_\d+)$/))&&(a[t[1]]=-1));var r=attr(e,"data-ad-view");return r&&(a["ad_"+r]=1),a.height=e.offsetHeight,a.index=indexOf(domPN(e).children,e)-1,a},seen:function(e){var t,i,a,o,r,s,l;window.vk.id&&e.length&&(window._postsExtras||(window._postsExtras={}),e.forEach(function(e,c){r=e.index,l=e.block,s=e.height,Object.keys(e).forEach(function(c){"index"!==c&&"block"!==c&&"height"!==c&&"viewportHeight"!==c&&(i=e[c],a=n._seen[c],-1===(o=n._saved[c])||-1===a||1===i&&(o||a)||(t=n._seen[c]=i,_postsExtras[c]={index:r,block:l,height:s,viewportHeight:getCh()}))})}),t&&(clearTimeout(n._saveTimer),n._saveTimer=setTimeout(n.save,2500),clearTimeout(n._sendTimer),n._sendTimer=setTimeout(n.send,5e3)))},save:function(){if(!lsCheck()||isEmpty(n._seen))return n._seen;var e,t,i,a,o,r=window.vk,s=Math.floor((r.ts+Math.floor((vkNow()-r.started)/1e3))/3600),l=lsGet("posts_sent")||{},c=lsGet("posts_seen")||{},u=lsGet("posts_extras")||{};for(t in window._postsExtras||(window._postsExtras={}),n._seen)o=n._seen[t],_postsExtras[t]&&(u[t]={index:_postsExtras[t].index,block:_postsExtras[t].block,height:_postsExtras[t].height,viewportHeight:_postsExtras[t].viewportHeight},delete window._postsExtras[t]),"ad"!==(i=t.split("_"))[0]&&"adsite"!==i[0]&&"block"!==i[0]&&(i[0]=intval(i[0]),i[1]=intval(i[1])),a=(l[i[0]]||{})[i[1]],i[0]!=r.id&&(!a||-1==o&&a>0)&&(c[i[0]]||(c[i[0]]={}),(!c[i[0]][i[1]]||-1==o&&c[i[0]][i[1]]>0)&&(e=c[i[0]][i[1]]=s*o)),n._saved[t]=o;n._seen={},e&&(lsSet("posts_seen",c),lsSet("posts_extras",u))},getSeenData:function(){var e,t,i,a={},o={},r=[];if(lsCheck())a=lsGet("posts_seen"),o=lsGet("posts_extras")||{};else for(e in i=n.save()){var s=i[e],l=e.split("_");l[0]=intval(l[0]),l[0]&&(l[1]=intval(l[1])),a[l[0]]||(a[l[0]]={}),(!a[l[0]][l[1]]||-1==s&&a[l[0]][l[1]]>0)&&(a[l[0]][l[1]]=s)}for(e in a){for(t in i=[],a[e]){var c=a[e][t]>0?t:-t,u=o[e+"_"+t],d="";u?(d+=":"+(u.index||""),d+=":"+(u.block||""),d+=":"+(u.height||""),d=(d+=":"+(u.viewportHeight||"")).replace(/:+$/,"")):d="","block"!==e||cur._pstatbref||(cur._pstatbref=attr(ge(e+"_"+t),"data-ref")),i.push(c+d)}i.length&&r.push(e+"_"+i.join(","))}return r.length?{seen:a,data:r.join(";")}:""},onSend:function(e){if(!lsCheck())return extend(n._saved,n._seen);var t,i,a=lsGet("posts_seen")||{},o=lsGet("posts_sent")||{};for(t in e){for(i in e[t])o[t]||(o[t]={}),-1!=o[t][i]&&(o[t][i]=e[t][i]),(a[t]||{})[i]&&delete a[t][i];a[t]&&isEmpty(a[t])&&delete a[t]}lsSet("posts_seen",a),lsSet("posts_sent",o),clearTimeout(n._cleanTimer),n._cleanTimer=setTimeout(n.clean,1e4)},send:function(){var e=window.cur,t=window.vk,i=n.getSeenData();if(i.data){if(!t.id)return n.clear();var a="";!nav||"/feed?section=podcasts"!==nav.cur&&"/feed/podcasts"!==nav.cur?e&&e.module?a=e.module:nav&&"/feed"==nav.cur&&(a="feed"):a="feed_podcasts";var o={_ajax:1,act:"ping",_pstat:i.data,_pstatref:a};e._pstatbref&&(o._pstatbref=e._pstatbref),ajax.post("/",o,{onDone:function(){n.onSend(i.seen)}}),delete e._pstatbref}},clean:function(){var e,t,i,a=window.vk,o=Math.floor((a.ts+Math.floor((vkNow()-a.started)/1e3))/3600),r=lsGet("posts_sent")||{};for(e in r){for(t in r[e])o-((i=r[e][t])>0?i:-i)>24&&delete r[e][t];isEmpty(r[e])&&delete r[e]}lsSet("posts_sent",r),n.cleanAdsEvents()},clear:function(){lsSet("posts_seen",{}),lsSet("posts_sent",n._saved=n._seen={}),lsSet(n.LS_ADS_EVENTS,n._lsAdsEvents={})},getStatsObj:function(e){return e=ge(e),hasClass("_stats_cont",e)?e:gpeByClass("_stats_cont",e)},getAdsEvents:function(){var e=n._lsAdsEvents;return e||(e=n._lsAdsEvents=lsGet(n.LS_ADS_EVENTS)||{}),e},cleanAdsEvents:function(){var e=n.getAdsEvents(),t=(new Date).getTime()/1e3|0,i=!1;each(e,function(n,a){t-a>=3600&&(delete e[n],i=!0)}),i&&lsSet(n.LS_ADS_EVENTS,e)},checkPixelEvent:function(e,t){var i=e.getAttribute("data-ad-block-uid"),a=-1!==indexOf(["load","impression"],t);if(!i||!a)return!0;try{var o=hashCode(""+t+i),r=n.getAdsEvents();if(r[o])return!1;var s=(new Date).getTime()/1e3|0;r[o]=s,lsSet(n.LS_ADS_EVENTS,r)}catch(e){try{console.log(e.message)}catch(e){}}return!0},getPixelElements:function(e,t){var n=[];return each(geByClass(t,e),function(){attr(this,"data-src")&&n.push(this)}),n},sendPixels:function(e){each(e,function(){attr(this,"src",attr(this,"data-src")),attr(this,"data-src",!1),addClass("_cntr",this)})},viewed:function(e){if(e=n.getStatsObj(e)){var t=n.getPixelElements(e,"_cntr_view");t.length&&n.checkPixelEvent(e,"impression")&&n.sendPixels(t)}},clicked:function(e){if(e=n.getStatsObj(e)){attr(e,"data-clicked","1");var t=n.getPixelElements(e,"_cntr_click");t.length&&n.sendPixels(t),checkPostsSeen()}}};n._sendTimer||(n._sendTimer=setTimeout(n.send,1e4)),window.pStats=n},AgBx:function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("Mc5h"),o=function(e){return Object(a.default)({mix:i.default.class(e.mix,"ScrollView"),attrs:e.attrs,inner:e.inner})};n("QMH7"),t.default=o;window.ScrollView=o},"B+U2":function(e,t,n){"use strict";n.r(t);n("bZ/P");var i=n("29dZ"),a=n("Y6JH"),o=n("TYsd"),r=n("z9sQ"),s=n("fdw3"),l=function(e){var t=e.keyboard,n=e.msgId;return{class:"BotsKeyboard__main",inner:t.buttons.map(function(e){return function(e,t,n){return{class:"BotsKeyboard__row",inner:e.map(function(e){return function(e,t,n){var l,u=window.lang,d=e.action.type,f=r.default.class("BotsKeyboard__button",{primary:"primary"===e.color||"vkpay"===d,positive:"positive"===e.color,negative:"negative"===e.color},"--"),_=["uMailWrite._onKeyboardButtonClick","this","event",{action:c(c(Object(s.stringifyJSON)(e.action))),authorId:t.author_id,inline:t.inline,msgId:n}];l="vkpay"===d?[{class:"BotsKeyboard__buttonInner",inner:[o.default.wrap(u.mobile_mail_keyboard_label_vkpay),o.default.wrap("&nbsp;"),o.default.wrap("&nbsp;"),Object(a.default)("mail/bot_buttons","vkpay")]}]:"location"===d?[{class:"BotsKeyboard__buttonInner",inner:[{tag:"span",class:"BotsKeyboard__leadingIcon",inner:Object(a.default)("mail/bot_buttons","place_24")},o.default.wrap("&nbsp;"),{class:"BotsKeyboard__buttonLabelWrapped",inner:[o.default.wrap(u.mobile_mail_keyboard_label_location)]}]}]:"open_app"===d?[{class:"BotsKeyboard__buttonInner",inner:[{tag:"span",class:"BotsKeyboard__leadingIcon",inner:Object(a.default)("mail/bot_buttons","service_24")},o.default.wrap("&nbsp;"),{class:"BotsKeyboard__buttonLabelWrapped",inner:[o.default.wrap(e.action.label)]}]}]:"open_link"===d?[{class:"BotsKeyboard__buttonInner",inner:[{class:"BotsKeyboard__buttonLabelWrapped",inner:[o.default.wrap(e.action.label)]},o.default.wrap("&nbsp;"),Object(a.default)("mail/bot_buttons","open_link_16")]}]:[o.default.wrap(e.action.label)];return Object(i.default)({class:f,on_click:_,use_native_onclick:!0,inner:l,theme:"none",size:"normal",type:"button"})}(e,t,n)})}}(e,t,n)})}};function c(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/\'/g,"&#39;")}t.default=l},B5sG:function(e,t,n){"use strict";n.r(t);var i=n("bYEY"),a=n("DkIl");function o(e){var t=store.mail,n=t.peers[e].actionUrls,i=t.peers[e].isChannel;return e>-2e9&&e<0?[r("showMedias",n.showMedia),r("deleteHistory",n.flushHistory),r("blockCommunity",n.blockCommunity),r("unblockCommunity",n.unblockCommunity),r("blockNotify",n.blockNotify)]:e>2e9?[r("chatInfo",n.chatInfo,"",i),r("chatAdd",n.addToChat),r("inviteLink",n.inviteLink,"",i),r("showMedias",n.showMedia),n.unpinMsg?r("chatUnpinMsg",n.unpinMsg):"",n.unpinMsg?r("chatShowPinnedMsg",null,'onmousedown="uMessenger.onShowPinnedMsgClick()"'):"",n.unpinMsg?r("chatHidePinnedMsg",null,'onmousedown="uMessenger.onHidePinnedMsgClick()"'):"",r("chatDeleteHistory",n.flushHistory),r("chatReturn",n.returnToChat,"",i),r("chatLeave",n.leaveChat,"",i)]:t.cur.groupId?[r("showMedias",n.showMedia),r("markAsAnswered",n.communityMarkAsAnswered),n.isDialogImportant?r("removeImportantMark",n.communityToggleImportant):r("markAsImportant",n.communityToggleImportant),n.isBlacklisted?r("unbanUser",n.userBan):r("banUser",n.userBan),r("deleteHistory",n.flushHistory)]:[r("showMedias",n.showMedia),r("deleteHistory",n.flushHistory)]}function r(e,t,n,i){void 0===n&&(n=""),void 0===i&&(i=!1);var a=window.lang;if(!t&&!n)return null;var o={showMedias:[a.mobile_mail_show_medias,"attach"],deleteHistory:[a.mobile_mail_delete_history,"delete"],blockCommunity:[a.mobile_mail_block_community,"block"],blockNotify:[a.mobile_mail_block_community_notify,"block"],unblockCommunity:[a.mobile_mail_unblock_community,"allow"],chatAdd:[a.mobile_mail_add_to_chat,"plus"],chatUnpinMsg:[a.mobile_mail_unpin_msg,"unpin","unpin"],chatShowPinnedMsg:[a.mobile_mail_pin_show,"show","showPinned"],chatHidePinnedMsg:[a.mobile_mail_pin_hide,"hide","hidePinned"],chatInfo:[a.mobile_mail_chat_info,"info"],chatDeleteHistory:[a.mobile_mail_delete_chat_history,"delete"],chatReturn:[i?a.mobile_mail_return_to_channel:a.mobile_mail_chat_return,"revert","returnToChat"],chatLeave:[i?a.mobile_mail_channel_leave:a.mobile_mail_chat_leave,"close16","leaveChat"],markAsAnswered:[a.mobile_mail_mark_as_answered,"answered"],removeImportantMark:[a.mobile_mail_remove_important_mark,"important"],markAsImportant:[a.mobile_mail_mark_as_important,"important"],unbanUser:[a.mobile_settings_blacklist_unban_user,"allow"],banUser:[a.mobile_settings_blacklist_ban_user,"block"],inviteLink:[i?a.mobile_mail_channel_invite_link:a.mobile_mail_invite_link,"invite"]},r={text:o[e][0],icon:o[e][1],attrs:n,url:t};return o[e][2]&&(r.name=o[e][2]),r}t.default=function(){var e=store.mail.cur.peerId,t=store.mail.cur.page;if(e)return function(e){var t=store.mail,n=t.peers[e],i=e>2e9,r={title:n.title,photos:n.avatarImages,actions:o(e),editing:t.cur.editing};if(i){var s=i?e-2e9:null;if(r.url="/mail?act=info&chat="+s,r.membersCount=n.countMembers,r.hasPinnedMsg=n.hasPinnedMsg,r.isChannel=n.isChannel,r.isChannel){var l=-n.ownerId;r.url="/club"+l}}else r.url=n.profileUrl,r.isOnline=n.isOnline,r.onlinePlatform=n.onlinePlatform,r.offlineText=n.offlineText;return Object(a.MailHat_convo)(r)}(e);if(t)return function(e){return Object(a.MailHat_page)(e)}(t);return function(){var e=store.mail.cur,t=Math.abs(e.groupId),n=t?"&community="+t:"",o=t?"?community="+t:"";return Object(a.MailHat_main)({folder:e.folder,urls:{all:"/mail"+o,unrespond:"/mail?act=unrespond"+n,unread:"/mail?act=unread"+n,important:"/mail?act=important"+n,createChatUrl:"/mail?act=new_chat"},unreadCount:e.countUnread,importantCount:e.countImportant,withUnrespond:!!t,forwarding:!!e.forwardFromId,notifier:Object(i.default)()})}()}},B9v3:function(e,t,n){"use strict";n.r(t);var i=n("Y6JH"),a=n("fdw3");var o=function(e){return Object(a.extend)({tag:"textarea",class:["Textarea",e.mix],name:e.name,placeholder:e.placeholder,rows:e.rows?e.rows:3,inner:e.text},e.attrs)},r=n("p5n7"),s=n("29dZ");function l(e){return void 0===e&&(e={}),{class:"SharePanel SharePanel-header SharePanel--active ShareHeaderConversationsPanel","aria-hidden":"false","data-name":"ShareHeaderConversationsPanel",inner:[{"aria-label":Object(a.getLang)("mobile_close"),onclick:"cur.share.destroy()",role:"button",class:"SharePanel-header__close",inner:Object(i.default)("common","cancel_24")},{class:"SharePanel-headerText",inner:[{class:"SharePanel-headerText__label",inner:Object(a.getLang)("mobile_like_publish_head_title")},{class:"SharePanel-headerText__receivers"}]},{class:"SharePanel-headerRight",inner:[{"aria-label":Object(a.getLang)("mobile_search"),class:"SharePanel-headerRight__search",role:"button",inner:Object(i.default)("wall","search_24"),onclick:"cur.share.toggleConversationsSearch(true)"},e.supportsExternalShare?{"aria-label":Object(a.getLang)("mobile_share_external"),class:"SharePanel-headerRight__externalShare",role:"button",inner:"iOS"===e.platform?Object(i.default)("wall","share_external_ios_24"):Object(i.default)("wall","share_external_android_24"),onclick:"cur.share.externalShare()"}:null]}]}}function c(e){var t=e.buttons,n=e.options,i="boolean"!=typeof e.active||e.active;return{class:"ActionsPanel SharePanel "+(i?"SharePanel--active":""),"data-name":"ActionsPanel","aria-hidden":!i,style:!(n.can_to_own||n.can_to_club||n.can_bookmark)?"display: none;":"",inner:t.map(function(e){if(e)return function(e){var t=e.href?"a":"div",n=e.onclick,i={tag:t,role:"button",tabindex:-1,href:e.href,onclick:n,class:"ActionsPanel-button ActionsPanel-button--"+e.target,inner:[{class:"ActionsPanel-button__icon",inner:e.icon},{class:"ActionsPanel-button__label",inner:e.label}]};"boolean"==typeof e["aria-pressed"]&&(i["aria-pressed"]=e["aria-pressed"]+"");return i}(e)})}}var u=function(e){var t=e.can_bookmark,n=e.is_bookmarked,u=e.object,d=e.list,f=e.from,_=e.post_from,p=e.supportsExternalShare,h=e.isVKApp,m=e.targetOwnOnClick,A=Object(a.makeUrl)("/wall",{act:"add",share_box:1,is_vk_app:h,object:u,list:d,from:f,post_from:_});return{inner:[{inner:[l({platform:e.platform,supportsExternalShare:p}),{class:"SharePanel ShareHeaderSearch ShareHeaderConversationsSearchPanel","aria-hidden":"true","data-name":"ShareHeaderConversationsSearchPanel",role:"search",inner:Object(r.default)({autocomplete:!1,onblur:'cur.share.clearSearch(event, "peers", true)',prefix:{text:{role:"button",inner:Object(i.default)("wall","search_outline_16")}},postfix:{text:{class:"ShareHeaderSearch__clear",role:"button",onclick:'cur.share.clearSearch(event, "peers")',inner:Object(i.default)("common","cancel_outline_24")}},class:"ShareHeaderConversationsSearchPanel__input",id:"ShareHeaderConversationsSearchPanel__input",placeholder:Object(a.getLang)("mobile_search"),spellcheck:!1})},{class:"SharePanel SharePanel-header ShareHeaderGroupsPanel","aria-hidden":"true","data-name":"ShareHeaderGroupsPanel",inner:[{"aria-label":Object(a.getLang)("mobile_back"),onclick:"cur.share.toggleGroupsPanel(false)",role:"button",class:"SharePanel-header__close",inner:Object(i.default)("common","back_24")},{class:"SharePanel-headerText",inner:[{class:"SharePanel-headerText__label",inner:Object(a.getLang)("mobile_like_publish_head_title")}]},{class:"SharePanel-headerRight",inner:[{class:"SharePanel-headerRight__search",role:"button",inner:Object(i.default)("wall","search_24"),onclick:'cur.share.setActivePanel(this, "ShareHeaderGroupsSearchPanel", true)'}]}]},{class:"SharePanel ShareHeaderSearch ShareHeaderGroupsSearchPanel","aria-hidden":"true","data-name":"ShareHeaderGroupsSearchPanel",role:"search",inner:Object(r.default)({autocomplete:!1,onblur:'cur.share.clearSearch(event, "group", true)',prefix:{text:{"aria-label":Object(a.getLang)("mobile_search"),role:"button",inner:Object(i.default)("wall","search_outline_16")}},postfix:{text:{class:"ShareHeaderSearch__clear",onclick:'cur.share.clearSearch(event, "group")',inner:Object(i.default)("common","cancel_outline_24")}},class:"ShareHeaderGroupsSearchPanel__input",id:"ShareHeaderGroupsSearchPanel__input",placeholder:Object(a.getLang)("mobile_search"),spellcheck:!1})}],class:"SharePanelRoot ShareHeader",tag:"header"},{id:"Share__input",style:"display: none;",tag:"input"},{inner:[{class:"ShareConversations SharePanel SharePanel--active filter_peer_wrap","data-name":"ShareConversations","aria-hidden":"false",role:"group",id:"ShareConversations"},{class:"ShareGroups SharePanel","data-name":"ShareGroups","aria-hidden":"true",role:"group",id:"ShareGroups"}],class:"SharePanelRoot ShareLists",tag:"section"},{inner:[c({active:!0,options:e,buttons:[e.can_to_own?{target:"own",label:Object(a.getLang)("mobile_share_target_own"),onclick:m||"cur.share.go('"+A+"')",icon:Object(i.default)("wall","repost_outline_28")}:null,e.can_to_club?{target:"group",label:Object(a.getLang)("mobile_share_target_group"),icon:Object(i.default)("wall","users_outline_28")}:null,t?{target:"bookmark","aria-pressed":n,label:n?Object(a.getLang)("mobile_share_target_bookmark_active"):Object(a.getLang)("mobile_share_target_bookmark"),icon:Object(i.default)("wall",e.is_bookmarked?"favorite_28":"favorite_outline_28")}:null]}),{class:"SharePanel MessagePanel","aria-hidden":"true","data-name":"MessagePanel",inner:[Object(r.default)({tabindex:-1,autocomplete:!1,class:"MessagePanel__input",on_click:["cur.share.expandMessage"],placeholder:Object(a.getLang)("mobile_share_message_placeholder"),spellcheck:!1,readonly:!0,disabled:!0}),Object(s.default)({stretch:!0,size:"large",inner:Object(a.getLang)("mobile_share_message_single"),on_click:"cur.share.sendMessage(event)",use_native_onclick:!0})]},{class:"SharePanel ExpandedMessagePanel","aria-hidden":"true","data-name":"ExpandedMessagePanel",inner:[{class:"ExpandedMessagePanel__textareaWrap",inner:[o({placeholder:Object(a.getLang)("mobile_share_message_placeholder"),rows:1}),{class:"ExpandedMessagePanelSend",inner:Object(i.default)("common","send_active_24")}]}]},{class:"SharePanel ProcessingPanel","aria-hidden":"true","data-name":"ProcessingPanel",inner:[{class:"ProcessingPanel__icon ProcessingPanel__icon--loading",inner:Object(i.default)("wall","loading_40")},{class:"ProcessingPanel__label",inner:Object(a.getLang)("mobile_share_state_progress")}]}],class:"SharePanelRoot ShareBottom",tag:"footer"}],class:"Share","aria-role":"dialog","aria-label":Object(a.getLang)("mobile_like_publish_head_title"),hidden:"false",tabindex:"-1",tag:"div"}},d=n("wTbK"),f=n("Qz23"),_=n("OcsD"),p=n("UxAg"),h=n("j80l"),m="/hints?act=a_json_friends&mobile=1&from=imwrite&case=Nom&qs=1",A="ShareConversations",v="ShareGroups",g=m+A,b=!1,y=0,w=!1,C={bookmarks:{}};function k(e){E(e)}function S(e){nav.go(e),cur.share.destroy({isNavigation:!0})}function E(e){var t=cur.share._els.header,n=e.scrollTop;t.classList.toggle("ShareHeader--scrolled",n>=10)}function O(e,t,n){cur.share._els.content;if(cur.share.blocked)return!1;if(D(!0),cancelEvent(n),hasClass("inline_item_selected",t))return cur.shareSearch.toggleAttach(e,!1),function(e,t){cur.share._els.content;for(var n=0;n<cur.share.selected.length;n++)if(cur.share.selected[n]===e){cur.share.selected.splice(n,1);break}return x(!1),!1}(e);cur.shareSearch.toggleAttach(e,!0);for(var i=!1,a=0;a<cur.share.selected.length;a++)if(cur.share.selected[a]===e){i=!0;break}return i||cur.share.selected.push(e),D(!1),x(!1),P(),!1}function T(e,t,n){if(!cur.share.blocked){e=e.closest(".SharePanelRoot");var i,a=Object(p.$$)(".SharePanel",e);t&&(i=Object(p.$)("."+t,e)),a.forEach(function(e){var t=e===i;e.setAttribute("aria-hidden",!t),e.classList.toggle("SharePanel--active",t),t?e.removeAttribute("tabindex"):e.setAttribute("tabindex",-1),Object(p.$$)("input, ul",e).forEach(function(e){e.setAttribute("aria-hidden",!t),t?(e.removeAttribute("disabled"),e.setAttribute("tabindex",0)):(e.setAttribute("disabled",!0),e.setAttribute("tabindex",-1))})});var o=Object(p.$)("input",i);o&&n&&o.focus(),setStyle(e,{height:i?i.clientHeight:0})}}function D(e){var t=Object(p.$)(".ShareModal");t&&t.classList.toggle("ShareModal--disableAnimations",!e)}function j(e){var t=cur.share._els,n=t.header,i=t.content,a=t.bottom;i.classList.add("ShareLists--transition"),D(!0),T(n,e?"ShareHeaderGroupsPanel":"ShareHeaderConversationsPanel"),T(i,e?"ShareGroups":"ShareConversations"),T(a,e?"":"ActionsPanel"),setTimeout(function(){i.classList.remove("ShareLists--transition")},300),Object(p.$)(".SharePanel--active ul",i).focus(),P(),E(e?Object(p.$)("#ShareGroups .ShareList__container"):Object(p.$)("#ShareConversations .ShareList__container"))}function I(e){var t=cur.share._els,n=t.header,i=(t.content,t.bottom),a=B();b=!0,w=e,P(e),D(!1),T(i,e?"":a),e&&T(n,"ShareHeaderConversationsSearchPanel",!0),P(e),setTimeout(function(){browser.ios&&Object(_.scrollTop)(document.activeElement),b=!1},500)}function M(){var e=cur.share._els,t=e.content,n=e.bottom,i=e.messageTextarea;b=!0,T(n,"ExpandedMessagePanel"),t.classList.add("ShareLists--transition"),P(!1),i.focus({preventScroll:!0})}function x(e){void 0===e&&(e=!0);var t=cur.share,n=t.selected,i=t._els;ge(A)&&(!function(){if(!cur.share)return;var e=cur.share.cache._cache,t=Object(p.$)(".ShareHeaderConversationsPanel"),n=Object(p.$)(".ShareHeaderConversationsPanel .SharePanel-headerText__receivers",t),i=cur.share.selected,a=i.length;t.classList.toggle("ShareHeaderConversationsPanel--hasReceivers",a>0);var o="";if(1===a){o=getLang("mobile_share_box_to_single");var r=e[i[0]][0];o=o.replace("{name}",r)}else if(2===a){o=getLang("mobile_share_box_to_couple");var s=e[i[0]][6]||e[i[0]][0],l=e[i[1]][6]||e[i[1]][0];o=o.replace("{name1}",s).replace("{name2}",l)}else if(a>2){o=getLang("mobile_share_box_to_many");var c=e[i[0]][6]||e[i[0]][0];o=o.replace("{name}",c).replace("{count}",a-1)}n.innerHTML=o}(),L());var a,o,r=B();T(i.bottom,r,e),a=n.length>1,o=cur.share._els.messagePanel,Object(p.$)(".Btn",o).innerHTML=a?getLang("mobile_share_message_many"):getLang("mobile_share_message_single")}function B(){var e=cur.share,t=e.selected,n=e.content;return"ShareHeaderGroupsSearchPanel"===Object(p.$)(".SharePanel--active",n).getAttribute("data-name")?"":t.length>0?"MessagePanel":"ActionsPanel"}function P(e){if(cur.share&&cur.share._els){var t=cur.share._els,n=t.header,i=t.bottom,a=t.content,o=t.groupsList;if(n&&i&&a){var r=Object(p.$)(".ShareModal"),s=400;(e=w||e)&&(s+=cur.share.lastBottomHeight-Object(_.getH)(i)),i.clientHeight&&(cur.share.lastBottomHeight=i.clientHeight);var l=[n,i].reduce(function(e,t){var n=Object(p.$)(".SharePanel--active",t);return n&&(e+=n.clientHeight,setStyle(t,{height:n.clientHeight})),e},0),c=Math.min(s,innerHeight-l);(b||cur.share.blocked)&&(browser.ios||browser.ipad||browser.safari)&&(c=Math.min(s,document.body.clientHeight-l));var u=l+c!==y;u||(D(!1),a.classList.remove("ShareLists--transition")),setStyle(o,{bottom:-i.clientHeight}),r.classList.contains("ModalMenu--focused")||setStyle(a,{height:c}),u||D(!0),y=l+c}}}function L(){cur.share&&each(geByClass("inline_item",Object(p.$)("ShareConversations__container")),function(e,t){if(cur.share){var n=intval((t.id||"").substr(4)),i=-1!==cur.share.selected.indexOf(n);toggleClass("inline_item_selected",t,i),t.setAttribute("aria-selected",i);var a=Object(p.$)('input[type="checkbox"]',t);a&&(a.checked=i)}})}function R(e){var t=cur.share._els.bookmarkButton;if(t){var n=Object(p.$)(".ActionsPanel-button__icon",t),a=Object(p.$)(".ActionsPanel-button__label",t);t.setAttribute("aria-pressed",e),e?(n.innerHTML=Wd.html(Object(i.default)("wall","favorite_28")),a.innerHTML=getLang("mobile_share_target_bookmark_active")):(n.innerHTML=Wd.html(Object(i.default)("wall","favorite_outline_28")),a.innerHTML=getLang("mobile_share_target_bookmark")),window.thover.clear()}}function N(e){var t=cur.share._els,n=t.bottom,a=t.processingPanel,o=this.mail_hash,r=this.object,s=this.list,l=this.appId,c=Object(p.$)(".ExpandedMessagePanel__textareaWrap textarea");D(!0),e&&cancelEvent(e),T(n,"ProcessingPanel"),cur.share.blocked=!0,(r.startsWith("story")||r.startsWith("narrative"))&&Stories.sendAnalyticsEvent("share_to_message"),setTimeout(function(){P()}),setTimeout(function(){P()},350),ajax.post("/mail?act=send",{_ajax:1,from:"share_box",hash:o,media:r,list:s,message:c.value,to:cur.share.selected.join(","),app_id:l},{onDone:function(e){D(!0);var t=Object(p.$)(".ProcessingPanel__icon",a),n=Object(p.$)(".ProcessingPanel__label",a);t.classList.remove("ProcessingPanel__icon--loading");var o=e.error;t.innerHTML=Wd.html(o?Object(i.default)("wall","error_circle_40"):Object(i.default)("wall","done_circle_40")),n.innerText=o?getLang("mobile_share_state_error"):getLang("mobile_share_state_success"),setTimeout(function(){cur.app&&(o&&cur.app.hasOwnProperty("vkMiniAppShareFail")?cur.app.vkMiniAppShareFail():!o&&window.isFunction(cur.app.vkMiniAppShareSuccess)&&cur.app.vkMiniAppShareSuccess(0)),cur.share&&cur.share.destroy({isFail:o})},1e3)}})}function F(e,t,n){void 0===n&&(n=!1),Object(_.preventEvent)(e);var i,a,o,r=cur.share._els.header;if("group"===t?(i=ge("ShareHeaderGroupsSearchPanel__input"),a="ShareHeaderGroupsPanel",o=cur.shareGroupSearch):"peers"===t&&(i=ge("ShareHeaderConversationsSearchPanel__input"),a="ShareHeaderConversationsPanel",o=cur.shareSearch),D(!1),i.value){if(n)return void D(!0);o.clear()}else"peers"===t?(T(r,a),I(!1)):(T(r,a),D(!0))}function H(){var e=/^([a-z_]+)(-?\d+)_(\d+)$/.exec(cur.share.options.object),t=e[1],n=e[2],i=e[3],a=cur.share.options.object;"app"===t&&"0"===i&&(a="app"+n),cur.share.options.list&&(a+="?list="+cur.share.options.list),a=a.replace("wall_reply","wall"),a=cur.share.options.external_url||a;var o=navigator.share({url:a});if(!o)return Object(_.statlogsValueEvent)("mvk_share_external",t);o.then(function(){cur.share&&Object(_.statlogsValueEvent)("mvk_share_external",t)})}function U(e,t){C.bookmarks[e]=t}var V=function(e,t,n){var i=t.can_to_own,a=void 0===i||i,o=t.can_to_club,r=void 0===o||o,s=t.can_bookmark,l=t.is_bookmarked,c=t.from,y=t.post_from,w=t.list,E=(t.message,t.targetOwnOnClick),B=t.appId;cur.share&&cur.share.destroy();var U=B?m+"&app_id="+B+A:g;t.withoutScrollView||Object(f.preventDocumentScroll)(),l=void 0!==C.bookmarks[e]?C.bookmarks[e]:l,t.is_bookmarked=l,cancelEvent(n);var V=!!navigator.share,$=browser.ios?"iOS":"Android",q=Object(d.default)({on_overlay_click:"cur.share.destroy()",class:"ShareModal",attached:!0,body:u({targetOwnOnClick:!!E&&"cur.share.toOwnWall()",can_to_own:a,can_to_club:r,supportsExternalShare:V,platform:$,can_bookmark:s,is_bookmarked:l,list:w,from:c,post_from:y,object:t.object,isVKApp:t.isVKApp})}),W=t.withoutHash?null:"share";d.default.open(Wd.elem(q),!0,W,{swipeDown:!0,onClose:function(){cur.share&&cur.share.destroy({closeModal:!1})}});var z=Object(p.$)(".ShareModal"),Q=Object(p.$)(".ShareHeader"),Y=Object(p.$)(".ShareLists"),X=Object(p.$)(".ShareBottom"),G=Object(p.$)(".ActionsPanel-button--bookmark"),K=Object(p.$)(".ActionsPanel-button--group");!function(e){void 0===e&&(e={});cur.shareSearch=new QuickSearch;var t=e.appId?m+"&app_id="+e.appId:m;cur.shareSearch.init({action:t,field:"ShareHeaderConversationsSearchPanel__input",container:A,top_len:20,tpl:function(e,t){return'<ul aria-multiselectable="true" aria-hidden="false" class="ScrollView ShareConversations__container ShareList__container" onscroll="cur.share.onScroll(this)">'+e+"</ul>"},item_tpl:function(e,t){if(cur.share){var n=cur.share.cache._cache[this.id][0],i=-1!==cur.share.selected.indexOf(+this.id)?"inline_item_selected":"";return'\n        <label aria-label="'+n+'" tabindex="0" role="checkbox" id="peer'+this.id+'" onclick="cur.share.select('+this.id+', this)" class="inline_item active '+i+'">\n          <input type="checkbox" style="display: none;">\n            <img aria-hidden="true" class="ii_img" src="'+t+'" />\n            <div class="ii_body">\n              <div class="ii_owner">\n                 '+this.highlight(n)+"\n              </div>\n            </div>\n          </input>\n        </label>\n      "}},null_tpl:function(e){var t=getLang("mobile_friends_search_not_found").replace("%s",htsc(e));return e||(t=getLang("mobile_share_list_no_friends")),'<div class="service_msg_box"><div class="service_msg service_msg_null">'+t+"</div></div>"}}),L()}({appId:B}),addEvent(G,"click",function(e,t,n){var i=e.split("_"),a=31,o=5,r=[a,o].includes(Object(_.toInt)(t.bookmark_type));ajax.post("/bookmarks.php",{_ajax:1,wide:2===t.bookmark_type?1:0,from:"share_box",star:r?1:0,act:t.is_bookmarked?"bookmark_remove":"bookmark_add",item_type:t.bookmark_type,item_oid:i[0],item_id:i[1],hash:t.bookmark_hash},{onDone:function(e,t){var n=Object(p.$)("."+e),i=Object(_.ceFromString)(t);n&&Object(_.replace)(i,n.parentNode)}}),t.bookmark_type===o&&Article.toggleButton(e,!t.is_bookmarked);if(t.bookmark_type===a){var s=Object(p.$)(".StoryMenu__button");Stories.toggleBookmark(s,!0)}t.is_bookmarked=!t.is_bookmarked,C.bookmarks[e]=t.is_bookmarked,n()}.bind(this,e,t,function(){R(t.is_bookmarked)}),{passive:!0}),addEvent(K,"click",function(){j(!0)},{passive:!0});var J=Object(p.$)(".ExpandedMessagePanel textarea"),Z=Object(p.$)(".MessagePanel__input input");J.value=t.message||"",Z.value=t.message||"",function(e,t){void 0===t&&(t=3);var n=ce("span");setStyle(n,{width:e.clientWidth+"px"}),n.innerText="_",append(n,e.parentNode);var i=n.clientHeight;addEvent(e,"input",function(){n.innerText=e.value,e.rows=Math.max(1,Math.min(t,Math.ceil(n.clientHeight/i)))})}(J),addEvent(J,"input blur focus",function(){Z.value=J.value.replace(/\n/gi," "),D(!1)}),addEvent(Object(p.$)(".ExpandedMessagePanelSend"),"click",function(){cur.share.sendMessage()},{capture:!0}),addEvent(J,"input",function(){D(!1),P(!browser.ios),setTimeout(function(){D(!0)},150)}),addEvent(J,"touchmove",function(e){stopEvent(e)},{capture:!0}),addEvent(J,"focus",function(e){var t=cur.share._els.content;cancelEvent(e),!0,t.classList.remove("ShareLists--transition"),z.classList.add("ModalMenu--blocked"),D(!1),P(!1),setTimeout(function(){P(!1),0===Object(_.scrollTop)()||browser.ios||(z.classList.add("ModalMenu--focused"),Object(_.scrollTop)(document.body.clientHeight))},300)}),addEvent(J,"blur",function(){z.classList.remove("ModalMenu--blocked"),D(!1),!1,setTimeout(function(){z.classList.remove("ModalMenu--focused"),document.activeElement&&document.activeElement.blur(),x(),P(!1),b=!1},100),setTimeout(function(){document.activeElement&&document.activeElement.blur(),P(!1)},250)}),addEvent(J,"keydown",function(e){13===e.keyCode&&(e.ctrlKey||e.metaKey&&browser.mac)&&cur.share.sendMessage(e)});var ee={act:"publish_box",object:"null"};B&&(ee.app_id=B),t.object&&(ee.object=t.object,t.list&&(ee.list=t.list));var te=Object(h.makeUrl)("/like",ee);cur.share={open:!0,onClose:befall(),go:S,options:t,externalShare:H,actionBox:te,blocked:!1,_els:{actionsPanel:Object(p.$)(".ActionsPanel"),messagePanel:Object(p.$)(".MessagePanel"),processingPanel:Object(p.$)(".ProcessingPanel"),groupsList:ge("ShareGroups"),conversationsList:ge("ShareConversations"),bookmarkButton:G,messageTextarea:J,header:Q,content:Y,bottom:X},selected:[],cache:QuickSearchCache[U],expandMessage:M,toggleGroupsPanel:j,toggleConversationsSearch:I,select:O,clearSearch:F,setActivePanel:T,onScroll:k,sendMessage:N.bind(t),lastBottomHeight:X.clientHeight,destroy:function(e){void 0===e&&(e={}),e=extend({closeModal:!0,isFail:!0,isNavigation:!1},e);var t=Object(p.$)(".ShareModal");e.isFail&&cur.app&&cur.app.vkMiniAppShareFail&&cur.app.vkMiniAppShareFail(),t&&e.closeModal&&d.default.close(t),cur.share&&(cur.share.onClose(e.isNavigation),cur.share.open=!1),cur.share.options.withoutScrollView||Object(f.restoreDocumentScroll)(),delete cur.share,delete cur.shareSearch,delete cur.shareGroupSearch}},E&&(cur.share.toOwnWall=E),function(){cur.shareGroupSearch=new QuickSearch;var e=Icon({icon:"chevron_right"});cur.shareGroupSearch.init({load_once:!0,field:"ShareHeaderGroupsSearchPanel__input",container:v,action:cur.share.actionBox,tpl:function(e,t){return'<ul aria-hidden="true"  class="ScrollView ShareGroups__container ShareList__container" onscroll="cur.share.onScroll(this)">'+e+"</ul>"},item_tpl:function(t,n){var i=function(){if(!cur.share)return{};var e=cur.share.actionBox+v;return QuickSearchCache[e]}()._cache[this.id][0],a=cur.share.options,o=a.object,r=a.list,s=a.from,l=a.post_from,c={act:"add",share_box:"1"};o&&(c=extend(c,{object:o,list:r,from:s,post_from:l})),cur.share.options.isVKApp&&(c.is_vk_app=+cur.share.options.isVKApp);var u=Object(h.makeUrl)("/wall"+this.id,c);return'\n        <li aria-label="'+i+'" tabindex="0" role="link" id="group'+this.id+'" onclick="cur.share.go(\''+u+"', "+cur.share.options.isVKApp+')" class="inline_item " xmlns="http://www.w3.org/1999/html">\n          <img aria-hidden="true" class="ii_img" src="'+n+'" />\n          <div class="ii_body">\n            <div class="ii_owner">\n               '+this.highlight(i)+'\n            </div>\n            <div class="ii_go">\n               '+e+"\n            </div>\n          </div>\n        </li>\n      "},null_tpl:function(e){var t=getLang("mobile_groups_no_groups_found");return e||(t=getLang("mobile_share_list_no_groups")),'<div class="service_msg_box"><div class="service_msg service_msg_null">'+t+"</div></div>"}})}(),R(l),P(),Q.closest(".Share").focus(),onBodyResize(function(){z.classList.contains("ModalMenu--focused")||(P(),setTimeout(function(){D(!0)},150))})};n.d(t,"setBookmarkState",function(){return U}),n.d(t,"ActionsPanel",function(){return c}),n.d(t,"init",function(){return V}),window.Share=V,extend(window.Share,{setBookmarkState:U});t.default=u},BLcx:function(e,t){var n,i=(n=document.getElementsByClassName("gift_create_post_counter"),{counter:function(e){var t=n[0];if(t){var i=e.value.length,a=e.maxLength;if(i>a)e.value=e.value.substr(0,a);else if(i>a/2){var o=Math.max(a-i,0);t.innerText=langNumeric(o,lang.text_N_symbols_remain),show(t)}else hide(t)}}});window.GiftsSendFormCounter=i},BQMu:function(e,t){var n=function(){var e,t,n="ai_menu_opened",i=!1;function a(e){for(var t=!1;e;){var n=getStyle(e,"overflow-y");if(("scroll"===n||"auto"===n)&&e.offsetHeight<e.scrollHeight){e===document.documentElement||e===document.body?e=null:t=!0;break}e=e.parentElement}return{cursor:e,isOverflowYContainer:t}}function o(e){for(var t=!1;e;){var n=getStyle(e,"overflow-x"),i=hasClass(e,"Slider__scroll");if("scroll"===n||"auto"===n||i){t=!0;break}e=e.parentElement}return{cursor:e,isOverflowXContainer:t}}function r(){if(e&&t){var n=geByClass1("i_pointer",e);if(document.body.contains(n))a(n).isOverflowYContainer?setStyle(t,"top",n.getBoundingClientRect().top):setStyle(t,"top",getY(n)),o(n).isOverflowXContainer?setStyle(t,"left",function(e){return e.getBoundingClientRect().left}(n)-getW(t)):setStyle(t,"left",getX(n)-getW(t))}}function s(e){e&&"A"===e.target.tagName&&requestAnimationFrame(function(){r()})}function l(l){!function(n){e=gpeByClass("ai_menu_wrap",n),t=geByClass1("ai_menu",e)}(l),addClass(n,e),append(t,document.body),i=c,tooltip.addHandler(i),tooltip.show(e,t),addEvent(window,"resize",r),addEvent(t,"click",s);var u=geByClass1("i_pointer",e),d=a(u);d.isOverflowYContainer&&addEvent(d.cursor,"scroll",r);var f=o(u);f.isOverflowXContainer&&addEvent(f.cursor,"scroll",r),r()}function c(){removeClass(n,e),append(t,e),tooltip.removeHandler(i),tooltip.hide(),removeEvent(window,"resize",r),removeEvent(t,"click",r);var s=geByClass1("i_pointer",e),l=a(s);l.isOverflowYContainer&&removeEvent(l.cursor,"scroll",r);var c=o(s);c.isOverflowXContainer&&removeEvent(c.cursor,"scroll",r)}return{closeMenu:c,toggleMenu:function(t,i){cancelEvent(t),hasClass(n,e)?c():l(i)},update:function(){!function(){if(t){var e=geByClass("wia_item",t);e&&each(e,function(e,t){var n=clone(t);before(n,t),remove(t),addClass("unhover",n),setTimeout(function(){removeClass("unhover",n)},100)})}}(),r()}}}();window.ActionMenu=n},BZzM:function(e,t,n){"use strict";n.r(t),n.d(t,"resizePosters",function(){return o});var i=.75,a=1/18;function o(e,t,n){var o=ge(t)||document,r="[data-poster-resized='false']";(e||n)&&(r="");var s=domQuery(".poster__text"+r,o),l=[],c=cur.posterConfig&&cur.posterConfig.constants;if(!c){if(!s.length)return;c=JSON.parse(domData(s[0].parentElement,"poster-constants"))}for(var u=0;u<s.length;u++){var d=s[u],f=domPN(d);l.push(domPN(f).clientWidth)}for(var _=0;_<s.length;_++){var p=s[_],h=domPN(p),m=l[_],A=c.font_size_ratio_range_1*m+"px",v=Math.round(c.line_height_ratio_range_1*m)+"px",g="0 "+Math.round(m*a)+"px";p.textContent.length>c.range_threshold&&(A=Math.round(c.font_size_ratio_range_2*m)+"px",v=Math.round(c.line_height_ratio_range_2*m)+"px"),setStyle(h,{height:m*i+"px",width:m}),setStyle(p,{fontSize:A,lineHeight:v,padding:g}),domData(p,"poster-resized",!0)}}},BoyB:function(e,t,n){"use strict";n.r(t);var i=n("TYsd"),a=n("z9sQ"),o=function(e){var t=e.class||e.mix;return i.default.html({class:[t,a.default.class("Loading",{white:e.white,large:e.large})],inner:{class:"Loading__items",inner:[{class:"Loading__item Loading__item_0"},{class:"Loading__item Loading__item_1"},{class:"Loading__item Loading__item_2"}]}})};t.default=o;window.Loading=o},CQvH:function(e,t){addEvent(window,"keydown",function(e){9===e.keyCode&&document.body.classList.add("tabbing")},{passive:!0}),addEvent(window,"click touchstart",function(){document.body.classList.remove("tabbing")},{capture:!0,passive:!0})},Cbap:function(e,t,n){"use strict";n.r(t);var i=function(){function e(){this.routes=[]}e.getRouter=function(){return window.router||(window.router=new e),window.router};var t=e.prototype;return t.addRoute=function(e,t,n){this.routes.push({isActive:!1,test:e,activateCallback:t,deactivateCallback:n})},t.test=function(e){var t=e.test;return"function"==typeof t?t(window.nav.cur):t instanceof RegExp?t.test(window.nav.cur):!(!window.nav.cur||"string"!=typeof t)&&window.nav.cur.startsWith(t)},t.deactivateAllRoutes=function(){this.routes=this.routes.map(function(e){return e.isActive=!1,e.deactivateCallback&&e.deactivateCallback(),e})},t.checkRoutes=function(){var e=this;this.routes=this.routes.map(function(t){var n=e.test(t);return n&&!t.isActive&&t.activateCallback&&t.activateCallback(),!n&&t.isActive&&t.deactivateCallback&&t.deactivateCallback(),t.isActive=n,t})},e}();t.default=i,window.Router=i},CkGd:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("9y81");function r(){var e=Object(i.default)(['\n    <div class="','" ',">","</div>\n  "]);return r=function(){return e},e}function s(){var e=Object(i.default)(['\n    <button class="','" aria-label="','" ',"></button>\n  "]);return s=function(){return e},e}function l(){var e=Object(i.default)(['\n    <button class="','" ',">\n      ","\n    </button>\n  "]);return l=function(){return e},e}function c(){var e=Object(i.default)(['\n    <div class="','">\n\n      ','\n\n      <div class="mailActs__counter"></div>\n\n      <div class="mailActs__buttons">\n        <div class="mailActs__buttonsIn">\n          ',"\n          ",'\n        </div>\n        <div class="mailActs__chevron">\n          <div class="mailActs__chevronIn">\n            ',"\n            ","\n            ","\n            ","\n            ",'\n          </div>\n          <div class="mailActs__chevronMore">\n            <div class="mailActs__chevronMoreIcon" ','></div>\n            <div class="mailActs__chevronList">\n              ',"\n              ","\n              ","\n              ","\n              ","\n            </div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n  "]);return c=function(){return e},e}var u=function(e){e||(e={});window.lang;var t=a.default.onClick("MailActs._onMoreClick"),n=Object(o.default)({mix:"mailActs__close",icon:"close12",attrs:a.default.onClick("MailActs._onCloseClick")}),i=d("reply"),r=d("forward"),s=f("edit",e),l=f("pin",e),u=f("important",e),p=f("remove",e),h=f("spam",e),m=_("edit",e),A=_("pin",e),v=_("important",e),g=_("remove",e),b=_("spam",e),y=a.default.class("mailActs",{canPin:e.canPin,pinned:e.isPinned,important:e.isImportant,isChannel:e.isChannel});return a.default.html(c(),y,n,i,r,s,l,u,p,h,t,m,A,v,g,b)};function d(e){var t=window.lang,n=a.default.class("mailActs__button",{type:e}),i=a.default.onClick("MailActs._onButtonClick",e),o="reply"===e?t.mobile_mail_messages_actions_reply:t.mobile_mail_messages_actions_forward;return a.default.html(l(),n,i,o)}function f(e,t){var n,i=window.lang,o=a.default.class("mailActs__icon",{type:e}),r=a.default.onClick("MailActs._onButtonClick",e),l=t.isPinned?i.mobile_mail_messages_actions_unpin:i.mobile_mail_messages_actions_pin,c=t.isImportant?i.mobile_mail_messages_actions_important_off:i.mobile_mail_messages_actions_important;switch(e){case"edit":n=i.mobile_mail_messages_actions_edit;break;case"pin":n=l;break;case"important":n=c;break;case"remove":n=i.mobile_mail_messages_actions_delete;break;case"spam":n=i.mobile_mail_messages_actions_spam}return a.default.html(s(),o,n,r)}function _(e,t){var n,i=window.lang,o=a.default.class("mailActs__chevronListItem",{type:e}),s=a.default.onClick("MailActs._onButtonClick",e),l=t.isPinned?i.mobile_mail_messages_actions_unpin:i.mobile_mail_messages_actions_pin,c=t.isImportant?i.mobile_mail_messages_actions_important_off:i.mobile_mail_messages_actions_important;switch(e){case"edit":n=i.mobile_mail_messages_actions_edit;break;case"pin":n=l;break;case"important":n=c;break;case"remove":n=i.mobile_mail_messages_actions_delete;break;case"spam":n=i.mobile_mail_messages_actions_spam}return a.default.html(r(),o,s,n)}var p=n("UxAg"),h=n("+cqQ");function m(){store.mail.cur&&y()}function A(e){store.mail.cur&&function(e){var t=e.target,n=$(".mailActs");n&&n.classList.contains("mailActs_menuOpened")&&!t.closest(".mailActs__chevronList")&&!t.closest(".mailActs__chevronMoreIcon")&&n.classList.remove("mailActs_menuOpened")}(e)}function v(e){g({canEdit:e})}function g(e){Object(p.$$)(".mailActs").forEach(function(t){var n=a.default.parseClass("mailActs",t.getAttribute("class"));t.setAttribute("class",a.default.class("mailActs",Object.assign({},n,e)))})}function b(e){switch(e){case"edit":u.onEditClick();break;case"remove":u.onRemoveClick();break;case"important":u.onImportantClick();break;case"reply":u.onReplyClick();break;case"forward":u.onForwardClick();break;case"spam":u.onSpamClick();break;case"pin":u.onPinClick()}}function y(){var e=document.querySelector(".mailActs__chevron"),t=e.offsetWidth-1,n=e.querySelectorAll(".mailActs__chevronListItem"),i=e.querySelectorAll(".mailActs__icon");Array.prototype.forEach.call(i,function(e,a){t<36*i.length?t-34>=36*(a+1)?(e.classList.remove("mailActs__icon_hidden"),n[a].classList.add("mailActs__chevronListItem_hidden")):(e.classList.add("mailActs__icon_hidden"),n[a].classList.remove("mailActs__chevronListItem_hidden")):(e.classList.remove("mailActs__icon_hidden"),n[a].classList.add("mailActs__chevronListItem_hidden"))}),g({cutted:t<36*i.length})}function w(){Object(p.$$)(".mailActs").forEach(function(e){return e.classList.toggle("mailActs_menuOpened")})}Object.assign(u,{onCloseClick:Object(h.default)(),onRemoveClick:Object(h.default)(),onImportantClick:Object(h.default)(),onReplyClick:Object(h.default)(),onForwardClick:Object(h.default)(),onSpamClick:Object(h.default)(),onPinClick:Object(h.default)(),onMoreClick:Object(h.default)(),onEditClick:Object(h.default)(),setCount:function(e){var t=langNumeric(e,lang.mobile_mail_messages_selected).replace("{count}",e);Object(p.$$)(".mailActs__counter").forEach(function(e){return e.innerText=t}),1!=e&&v(!1);y()},setEditAvailable:v,setImportantAvailable:function(e){g({canImportant:e})},toggleQuickButtons:function(e){$(".mailActs__buttonsIn").hidden=!e},setReplyAvailable:function(e){$(".mailActs__button_type_reply").disabled=!e},togglePin:function(e){Object(p.$$)(".mailActs").forEach(function(t){return t.classList.toggle("mailActs_canPin",e)})},setModifiers:g,setLabels:function(e){var t=window.lang,n=e.pinned?t.mobile_mail_messages_actions_unpin:t.mobile_mail_messages_actions_pin,i=e.important?t.mobile_mail_messages_actions_important_off:t.mobile_mail_messages_actions_important;$(".mailActs__icon_type_pin").setAttribute("aria-label",n),$(".mailActs__icon_type_important").setAttribute("aria-label",i),$(".mailActs__chevronListItem_type_pin").innerHTML=n,$(".mailActs__chevronListItem_type_important").innerHTML=i},update:y}),u._onButtonClick=b,u._onCloseClick=u.onCloseClick,u._onMoreClick=w,onBodyResize(m),document.addEventListener("click",A);t.default=u;window.MailActs=u},DG1x:function(e,t){window.LoadMore={setUrl:r,destroy:s},LoadMore._strategy={replace:{onFail:m,onSuccess:function(e){var t=e.response;a.outerHTML=t,s()}},padsExtend:{onFail:m,onSuccess:function(e){var t=e.response,n=t.pads,i=t.nextPageUrl;Object.keys(n).forEach(function(e){var t=n[e];Pad.addContent(e,t)}),i?r(i):s()}}},LoadMore._onButtonClick=l,onDOMReady(c),page.onChange(c);var n={loadMore:".LoadMore",button:".LoadMore__button"},i="_loadMore_loading",a=null,o=null;function r(e){o.setAttribute("href",e)}function s(e){a.remove(),a=null,o=null,d()}function l(){h()||f()}function c(){if(a=$(n.loadMore)){var e=window.cur;o=a.$(n.button),u(0),onBodyScroll(u),e.destroy.push(d)}}function u(e){if(a&&!h()){var t=getY(a),n=getCh();t-(e+n)<2*n&&f()}}function d(){onBodyScroll("__clear",u)}function f(){p(!0);var e=o.getAttribute("href");ajax.post(e,{_ajax:1},{onDone:function(e){return _(e,!0)},onFail:function(e){return _(e,!1)}})}function _(e,t){if(p(!1),a){var n=t?"data-success-handler":"data-fail-handler";n=a.getAttribute(n),Wd.handle(n,{$loadMore:a,response:e}),a=null,o=null,d(),c()}}function p(e){o&&a&&(Btn.setLoading(o,e),a[i]=e)}function h(){return a&&a[i]}function m(e){console.error("LoadMore: failed to load more",e)}},DVnk:function(e,t){FeedAssistanceStats.registerTrackingCls("feedAssistance_recommendedFriends"),FeedAssistanceStats.onStartViewElement(function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_RECOMMENDED_SLIDER){if(e._friendsSliderHandlersAdded)return;e._friendsSliderHandlersAdded=!0}})},Dh0N:function(e,t){function n(e,t){var n=t.$select,o=t.value;n.closest(i.email).classList.toggle(a.groupsVisible,e.includes(o)||e.includes(Number(o)))}window.SettingsEmail={},SettingsEmail._onFrequencyChange=n;var i={email:".settingsEmail"},a={groupsVisible:"settingsEmail_groupsVisible"}},DkIl:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("9y81"),r=n("gy8s"),s=n("KMpi"),l=n("fdw3");function c(){var e=Object(i.default)(['\n    <div class="mailHat__convoDetails">\n      <div class="mailHat__convoDetailsText">',"</div>\n      ","\n    </div>\n  "]);return c=function(){return e},e}function u(){var e=Object(i.default)(['\n    <a class="','" href="','">\n      ','\n      <div class="mailHat__convoBody">\n        <div class="mailHat__convoTitle">',"</div>\n        ","\n      </div>\n    </a>\n  "]);return u=function(){return e},e}function d(){var e=Object(i.default)(['\n    <div class="mailHat__title">\n      ',"\n    </div>\n  "]);return d=function(){return e},e}function f(){var e=Object(i.default)(['\n    <div class="mailHat__editingTitle">\n      ',"\n    </div>\n  "]);return f=function(){return e},e}function _(){var e=Object(i.default)(['\n    <div class="mailHat__forwardTitle">\n      ',"\n    </div>\n  "]);return _=function(){return e},e}function p(){var e=Object(i.default)(['\n    <div class="mailHat__unreadCount mailHat__unreadCount_length_','">\n      ',"\n    </div>\n  "]);return p=function(){return e},e}function h(){var e=Object(i.default)(['\n    <div class="','" ',">\n      ","\n      ","\n    </div>\n  "]);return h=function(){return e},e}function m(){var e=Object(i.default)(['\n    <div class="mailHat '," "," "," ",'">\n      <div class="mailHat__left">','</div>\n      <div class="mailHat__center">','</div>\n      <div class="mailHat__right">',"</div>\n    </div>\n  "]);return m=function(){return e},e}function A(e){var t,n,i,s,c,u=Object(o.default)({mix:"mailHat__burger",icon:"burger",attrs:a.default.onClick("MailHat_main.onBurgerClick")}),d=function(e,t,n,i){var a=window.lang;return Object(r.default)({mix:"mailHat__folder",items:[{name:"all",text:a.mobile_mail_tab_all,active:"all"===e,url:t.all},n?{name:"unrespond",text:a.mobile_mail_tab_unrespond,active:"unrespond"===e,url:t.unrespond}:"",{name:"unread",text:a.mobile_mail_tab_unread,active:"unread"===e,url:t.unread},{name:"important",text:a.mobile_mail_tab_important,active:"important"===e,count:i,url:t.important}]})}(e.folder,e.urls,e.withUnrespond,e.importantCount),f=(t=e.unreadCount,n=a.default.class("mailHat__unread",{hasUnread:t>0}),i=Object(o.default)({mix:"mailHat__unreadIcon",icon:"msg"}),s=y(t),c=a.default.onClick("MailHat_main.onUnreadClick"),a.default.html(h(),n,c,i,s)),p=Object(o.default)({mix:"mailHat__cancelForward",icon:"back",attrs:a.default.onMouseDown("MailHat_main.onCancelForwardTap")}),m=function(){var e=window.lang;return a.default.html(_(),e.mobile_mail_choose_recipient)}(),A=Object(o.default)({mix:"mailFilter__create",icon:"pencil",url:e.urls.createChatUrl}),v=Object(l.isNewNavigation)();return b({type:"main",left:v?""+p:""+u+p,center:""+d+m,right:v?""+A:""+e.notifier+f,forwarding:e.forwarding})}function v(e){var t;return b({type:"convo",left:""+C()+Object(o.default)({mix:"mailHat__cancelEditing",icon:"close",attrs:a.default.onMouseDown("MailHat_convo.onCancelEditingTap")}),center:""+function(e){var t=a.default.class("mailHat__convo",{mobile:e.mobile}),n=Object(s.default)({mix:"mailHat__convoAvatar",photos:e.photos,size:36}),i=function(e){var t=window.lang,n=e.membersCount,i="",r="";if(n>0)r=e.isChannel?langNumeric(n,t.mobile_mail_channel_N_members):langNumeric(n,t.mobile_mail_N_members);else{var s=e.onlinePlatform;r=S(e.isOnline,e.offlineText),"mobile"===s&&(i=Object(o.default)({mix:a.default.class("mailHat__onlineIcon",{platform:"mobile"}),icon:"phoneMini"}))}return a.default.html(c(),r,i)}(e);return a.default.html(u(),t,e.url,n,e.title,i)}(e)+function(){var e=window.lang;return a.default.html(f(),e.mobile_mail_message_editing)}(),right:(t=e.actions,Object(r.default)({mix:"mailHat__actions",icon:"dots",position:"topRight",items:t})),hasPinnedMsg:e.hasPinnedMsg,editing:e.editing})}function g(e){return b({type:"page",left:""+C(),center:"",right:"",hasPinnedMsg:!1,editing:!1})}function b(e){var t=e.forwarding?"mailHat_forwarding":"",n=e.hasPinnedMsg?"mailHat_hasPinnedMsg":"",i="mailHat_type_"+e.type,o=e.editing?"mailHat_editing":"";return a.default.html(m(),i,t,n,o,e.left,e.center,e.right)}function y(e){var t;return e>999?(e="999+",t=4):t=e>99?3:e>9?2:1,a.default.html(p(),t,e)}function w(e){return a.default.html(d(),e.title)}function C(){return k({mix:"mailHat__back",icon:"back",attrs:a.default.onMouseDown("MailHat_convo.onBackTap")})}function k(e){return Object(o.default)({mix:a.default.class("mailHat__icon",e.mix),icon:e.icon,attrs:e.attrs,url:e.url})}function S(e,t){var n=window.lang;return e?n.mobile_mail_online:t}var E=n("UxAg"),O=n("+cqQ");function T(e){Object(E.$$)(".mailHat").forEach(function(t){var n=a.default.parseClass("mailHat",t.getAttribute("class"));t.setAttribute("class",a.default.class("mailHat",Object.assign({},n,e)))})}Object.assign(A,{onUnreadClick:Object(O.default)(),onBurgerClick:Object(O.default)(),onCancelForwardTap:Object(O.default)(),setFolder:function(e){Object(E.$$)(".mailHat__folder").forEach(function(t){r.default.setActive(t,e)})},setUnreadCount:function(e){Object(E.$$)(".mailHat_type_main").forEach(function(t){var n=t.$(".mailHat__unread"),i=t.$(".mailHat__unreadCount");n.classList.toggle("mailHat__unread_hasUnread",e>0),i.outerHTML=y(e)})},setImportantCount:function(e){Object(E.$$)(".mailHat__folder").forEach(function(t){r.default.setCount(t,"important",e)})},setForwarding:function(e){Object(E.$$)(".mailHat_type_main").forEach(function(t){return t.classList.toggle("mailHat_forwarding",e)})},setModifiers:T}),Object.assign(v,{onBackTap:Object(O.default)(),onCancelEditingTap:Object(O.default)(),setOnline:function(e,t){var n=S(e,t);Object(E.$$)(".mailHat__convoDetailsText").forEach(function(e){return e.innerText=n})},setMobile:function(e){Object(E.$$)(".mailHat__convo").forEach(function(t){return t.classList.toggle("mailHat__convo_mobile",e)})},setHasPinnedMsg:function(e){Object(E.$$)(".mailHat_type_convo").forEach(function(t){return t.classList.toggle("mailHat_hasPinnedMsg",e)})},setModifiers:T}),n.d(t,"MailHat",function(){return b}),n.d(t,"MailHat__Title",function(){return w}),n.d(t,"MailHat__icon",function(){return k}),n.d(t,"MailHat_main",function(){return A}),n.d(t,"MailHat_convo",function(){return v}),n.d(t,"MailHat_page",function(){return g}),window.MailHat_main=A,window.MailHat_convo=v},Fhlr:function(e,t){FeedAssistanceStats.registerTrackingCls("feedAssistance_promoButton"),FeedAssistanceStats.onStartViewElement(function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_PROMO_BUTTON){if(e._promoButtonClickHandlerAdded)return;var t=geByClass1("feedAssistancePromoButtonInstallApp__button",e),n=t?"install_app":"";addEvent(t||e,"click",function(){!function(e,t,n){FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_PROMO_BUTTON,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_PROMO_BUTTON_SUB,e,t,n)})}(e,FeedAssistanceStats.EVENTS.SUB_EVENT_PROMO_BUTTON_CLICK,n)}),e._promoButtonClickHandlerAdded=!0}})},G0UO:function(e,t){var n=Array.isArray,i={mail:{}},a={injectStore:function(e){i.mail={};var t=e.mail,a=t.cur,o=t.rolls,r=t.reached;t.msgs,t.queue;n(e.mail.msgs)&&(e.mail.msgs={}),n(e.mail.replies)&&(e.mail.replies={}),o&&n(o.peer)&&(o.peer={}),o&&n(o.search.peers)&&(o.search.peers={}),o&&n(o.search.msgs)&&(o.search.msgs={}),r&&n(r.search.peers)&&(r.search.peers={}),r&&n(r.search.msgs)&&(r.search.msgs={}),r&&n(r.peer.before)&&(r.peer.before={}),r&&n(r.peer.after)&&(r.peer.after={}),i.mail=e.mail,i.mail.pendingReplies={},i.mail.presend={},a&&(a.msgSelected={},a.msgRemoved={},a.msgAttached={},a.msgReply={},a.keyboards={},a.typings={},a.peerMembers={}),"notificationsCount"in i||(i.notificationsCount=e.notificationsCount)},injectMail:function(e){var t=i.mail,n=e;isObject(n.msgs)&&Object.assign(t.msgs,n.msgs),isObject(n.peers)&&Object.assign(t.peers,n.peers),isObject(n.members)&&Object.assign(t.members,n.members),isObject(n.replies)&&Object.assign(t.replies,n.replies),isObject(n.forwards)&&Object.assign(t.forwards,n.forwards),t.page=n.page,n.mrs&&(t.cur.countMR=n.mrs.count,t.rolls.mrs=n.mrs.rolls,t.reached.mrs=n.mrs.reached,t.scraps.mrs=n.mrs.rolls,Object.keys(n.msgs).forEach(function(e){var i=n.msgs[e],a=i.peerId;t.rolls.peer[a]=[i.id],t.reached.peer.after[a]=!0}),t.mrs=n.mrs)},injectMsg:function(e){var t;a.injectMail({msgs:(t={},t[e.id]=e,t)})},resetMail:function(){i.mail={}}};window.storeMethods=a,window.store=i},"GR/G":function(e,t,n){var i=n("/8IX"),a=n("HN+/"),o=3;function r(e,t){return t?e?e.isSameNode&&e.isSameNode(t)?t:e.tagName!==t.tagName||s(e)!==s(t)?e:(a(e,t),l(e,t),t):null:e}function s(e){return e.dataset?e.dataset.nanomorphComponentId:void 0}function l(e,t){for(var n,i,a,o,s=0,l=0;n=t.childNodes[l],i=e.childNodes[l-s],n||i;l++)if(i)if(n)if(c(i,n))(a=r(i,n))!==n&&(t.replaceChild(a,n),s++);else{o=null;for(var u=l;u<t.childNodes.length;u++)if(c(t.childNodes[u],i)){o=t.childNodes[u];break}o?((a=r(i,o))!==o&&s++,t.insertBefore(a,n)):i.id||n.id?(t.insertBefore(i,n),s++):(a=r(i,n))!==n&&(t.replaceChild(a,n),s++)}else t.appendChild(i),s++;else t.removeChild(n),l--}function c(e,t){return e.id?e.id===t.id:e.isSameNode?e.isSameNode(t):e.tagName===t.tagName&&(e.type===o&&e.nodeValue===t.nodeValue)}e.exports=function(e,t,n){if(i.equal(typeof e,"object","nanomorph: oldTree should be an object"),i.equal(typeof t,"object","nanomorph: newTree should be an object"),n&&n.childrenOnly)return l(t,e),e;return i.notEqual(t.nodeType,11,"nanomorph: newTree should have one root node (which is not a DocumentFragment)"),r(t,e)}},Gzds:function(e,t,n){"use strict";n.r(t);var i,a,o=n("+cqQ"),r={curGif:null,onStickersTabSelected:Object(o.default)(),onStickerClick:Object(o.default)(),onStickersInit:se(),onReplyClick:se(),add_attach:function(e,t){var n=window.al;remove("feed_extra_field");var i=gpeByTag("form",e),a=ce("input",{id:"feed_extra_field",type:"hidden",name:"add_attach",value:2});if(i){var o=!1;if(each(i,function(e,t){if("submit"===t.type)return o=t,!1}),o)return append(a,i),window.al&&n.ver?nav.go(o,t):i.submit()}return!0},saveDraft:function(e,t,n){e&&e.preventDefault();var i=ge("feed_add_form"),a={act:"post",save_draft:1,redirect:n,hash:t};each(i.elements,function(e,t){"submit"!==t.type&&(a[t.name]="checkbox"===t.type?(+t.checked).toString():t.value)}),ajax.post(window.nav.path,a)},toggleActions:function(e,t){var n=gpeByClass("post_item",e);return toggleClass("pi_actions_opened",n),cancelEvent(t),!1},wallActions:function(e,t){var n=window.tooltip,i=gpeByClass("_audioPlaylist",e)||gpeByClass("wall_item",e)||gpeByClass("post",e);if(!i)return!0;if(hasClass("wi_actions_opened",i))removeClass("wi_actions_opened",i),n.hide();else{var a=geByClass1("wi_actions_wrap",i),o=geByClass1("wi_actions",a),s=geByClass1("wi_actions_btn",i);r.wallActionsHide(),addClass("wi_actions_opened",i);var l=getY(i)+45+getH(o)+7,c=scrollTop()+getCh();toggleClass("wi_actions_top",a,l>c),n.addHandler(r.wallActionsHide),n.show(a,s)}return cancelEvent(t),!1},wallActionsHide:function(){var e=window.tooltip;removeClass("wi_actions_opened",geByClass1("wi_actions_opened")),e.hide()},wallPostOpen:function(e,t){var n=gpeByClass("wall_item",e),i=geByClass1("wi_date",n);return!i||nav.go_after(i,t)},toggleGif:function(e,t,n,a){return void 0===a&&(a=!1),!e||(!!checkEvent(t)||(clearInterval(i),hasClass("current_gif",e)?r.hideGif(e,t,a):(a||Gif.autoplayTest(),r.showGif(e,t,n,a))))},hidePlayingGifs:function(e,t){geByClass("current_gif","mcont").forEach(function(n,i){n!==e&&r.hideGif(n,!1,t)})},showGif:function(e,t,n,o){var s=window.cur;if(!e)return!0;if(checkEvent(t))return!0;if(n){if(s.loadedGifs||(s.loadedGifs={}),!s.loadedGifs[e.href]&&!confirm(n))return!1;s.loadedGifs[e.href]=!0}if(clearInterval(i),!o){var l=getY(e),c=scrollTop();scrollTop(c-(l-getY(e)))}geByClass("current_gif","mcont").forEach(function(e,t){r.hideGif(e,!1,o)});var u=!hasClass("not_mp4",e)&&Gif.isMp4Supports();if(u){var d=geByClass1("ph_img",e).src;a&&"VIDEO"===a.tagName&&(a.pause(),a.src="",a.load()),(a=ce("video",{src:e.href,className:"gif_original",loop:!0,muted:!0,autoplay:!0,poster:d},{position:"relative"})).setAttribute("playsinline",!0),a.setAttribute("webkit-playsinline",!0),a.setAttribute("controls",!0),a.controls=!1,a.load()}else a=ce("img",{src:e.href,className:"gif_original"});addClass("current_gif gif_loading",e);var f=function(t,n){hasClass("current_gif",e)&&(replaceClass("gif_loading","gif_opened",e),append(a,e),r.curGif=e,n&&n())};return u?a.oncanplay=function(){e!==r.curGif&&(statlogsValueEvent("gif_play",0,"mp4",null,o?1:0),f())}:i=setInterval(function(){a.complete&&(statlogsValueEvent("gif_play",0,"gif",null,o?1:0),f(),clearInterval(i))},100),t&&!t.defaultPrevented?cancelEvent(t):void 0},hideGif:function(e,t,n){if(void 0===n&&(n=!1),!e)return!0;if(checkEvent(t))return!0;if(removeClass("current_gif",e),removeClass("gif_opened",e),removeClass("gif_loading",e),geByClass("gif_original").forEach(function(e){remove(e)}),!n){var i=Gif.getState(),a=i.currentAutoplayElement,o=i.ignore;a===e&&(o.push(e),Gif.setState("ignore",o))}return r.curGif=null,t&&!t.defaultPrevented?cancelEvent(t):void 0},replyNamesRE:function(){var e=window.cur;if(!e.replyNames)return!1;var t=[];return each(e.replyNames,function(){t.push(escapeRE(this[0]))}),new RegExp("^("+t.join("|")+")")},replyTo:function(e,t,n,i,a){var o=window.cur;if(checkEvent(e))return!0;n=n||0,removeClass("nc_current_reply",geByClass1("nc_current_reply"));var s=ge("nc_form"),l=ge("nc_message"),c=geByClass1("nc_reply_name",s),u=gpeByClass("near_btn",c),d=ge("nc_reply_as"),f=val(l),_=r.replyNamesRE();if(n){var p=ge(t+"_"+n),h=getY(p)+getH(p),m=scrollTop();after(s,p),addClass("nc_current_reply",geByClass1("pi_reply_wrap",p)),scrollTop(m+getY(p)+getH(p)-h);var A=o.replyNames[i]||{},v=A[0]||"",g=A[1]||"";f=f?_?f.replace(_,v):f:v,r.onReplyClick(!0,v)}else{append(s,geByClass1("wall_replies")),scrollToEl(s);g="";f=_?f.replace(_,""):f}return val(l,replaceEntities(f)),val(c,g),toggle(u,n),d&&(val(d,+a),toggleClass("cp_post_as_group",s,+a)),val("nc_reply_to",n),o.replyTo=n,elfocus(l),!1},stickersInit:function(){if(!window.isNewMail||!geByClass1("messenger")){var e=window.cur,t=window.Scroller,n=ge("stickers_panel");if(n){var i=geByClass1("sp_body",n),a=geByClass1("sp_stickers_tabs",n);e.scroller&&e.scroller.destroy(),e.scroller=new t(i,{byPage:!0}),e.scroller.init(),e.destroy.push(function(){e.scroller.destroy()}),e.tabScroller&&e.tabScroller.destroy(),e.tabScroller=new t(a),e.tabScroller.init(),e.destroy.push(function(){e.tabScroller.destroy()}),r.onStickersInit(!0)}}},stickersToggle:function(e,t){var n=window.cur;if(!n.stickers)return!0;isUndefined(t)&&(t=!isVisible("stickers_panel"));var i=ge("write_form")||ge("nc_form"),a=ge("stickers_panel"),o=geByClass1("cp_sticker_btn",i);return!a||(toggle(a,t),toggleClass("cp_sticker_btn_sel",o,t),t&&n.tabScroller&&n.tabScroller.onShow(),n.onStickersToggleCallbacks&&n.onStickersToggleCallbacks.forEach(function(e){return e(t)}),!1)},stickersClick:function(e,t){var n=window.cur;return n.stickers&&n.stickers[t]?(window.isNewMail&&"/mail"===location.pathname&&(window.uMailWrite.drawStickers(),window.uMailWrite.openStickersPanel()),r.stickersToggle(null,!0),r.stickersSelectTab(null,t)):nav.go(e)},stickersStoreOpen:function(e){var t=window.cur;return ajax.click(e,!1,{url_params:{reply_to:t.replyTo||0}})},fromStickerToObject:function(e){return{id:e[0],size:e[1],url:e[2],animationUrl:e[3],recent:e[4],ref:e[5]}},fromObjectToSticker:function(e){return[e.id,e.size,e.url,e.animationUrl,e.recent,e.ref]},getStickersTabHTML:function(e){var t=cur.stickers[e],n=window.isNewMail?16:8,i=[];if(t&&t.length)for(var a=0;a<t.length/n;a++)i.push(t.slice(a*n,a*n+n));var o=i.map(function(e){return'\n        <div class="sp_page scroller_page">\n          <div class="stickers_list">\n            '+e.map(function(e){var t=r.fromStickerToObject(e),n=t.id,i=t.size,a=t.url,o=t.animationUrl,s=t.recent,l=t.ref,c="",u="";return o&&(c=" sticker_animation",u='\n          data-animation-path="'+o+'"\n          data-uniq-id="'+Date.now()+Math.round(1e8*Math.random())+'"\n          data-sticker-id="'+n+'"\n          data-loop-count="3"\n          ontouchstart="StickersAnimation.touchStartSticker(this);"\n          ontouchend="StickersAnimation.touchEndSticker(this);"\n        '),'\n          <div class="sticker_item'+(" sticker"+n)+'">\n            <a class="sticker_thumb thumb_item'+c+'" '+(' onclick="return post.sendSticker(this, '+n+", "+Boolean(s)+", '"+l+"');\"")+" "+u+'>\n              <img src="'+a+'" class="th_img sticker_img" height="'+i+'"/>\n            </a>\n          </div>\n        '}).join("\n")+"\n          </div>\n        </div>\n      "}).join("\n"),s='\n        <div class="sp_page scroller_page">\n          <div class="stickers_list">\n            <div class="stickers_null">'+getLang("mobile_common_stickers_no_recent")+"</div>\n          </div>\n        </div>\n    ",l=i.map(function(e,t){return'\n        <span class="sp_ppt '+(0===t?"sp_ppt_sel":"")+'" data-i="'+t+'">\n            <span class="sp_pptw"></span>\n        </span>\n      '}).join("\n");return'\n        <div class="sp_cont scroller_wrap">\n          <div class="scroller_cont">\n            '+(t&&t.length?o:s)+'\n          </div>\n        </div>\n        <div class="sp_pages_pts">\n            '+(i.length>1?l:"")+"\n        </div>\n      "},stickersSelectTab:function(e,t){var n=window.cur;if(!window.isNewMail&&n.tabScroller&&!n.tabScroller.canClick())return!1;var i=ge("stickers_panel"),a=geByClass1("sp_body",i),o=geByClass1("sp_tab_selected",i);n.scroller&&n.scroller.destroy(),val(a,r.getStickersTabHTML(t)),n.scroller&&n.scroller.init(),e||(e=geByClass1("sp_tab"+t,i)),removeClass("sp_tab_selected",o),addClass("sp_tab_selected",e);var s=getY(i),l=s+getW(i),c=scrollTop(),u=c+getCh();return(s<c||l>u)&&scrollToEl(i),n.tabScroller&&n.tabScroller.showElem(e),StickersAnimation&&StickersAnimation.loadAutoplayAnimationStickers(),window.isNewMail&&r.onStickersTabSelected(),!1},addRecentSticker:function(e,t,n){var i=window.cur,a=gpeByClass("sticker_item",e);if(i.stickers&&a){var o=Object.keys(i.stickers).reduce(function(e,n){return e||i.stickers[n].find(function(e){return r.fromStickerToObject(e).id===t})},null);if(!o)throw new Error("Sticker "+t+" not found");var s=r.fromStickerToObject(o),l=s.id,c=s.size,u=s.url,d=s.animationUrl;i.stickers[-1]=i.stickers[-1]||[],i.stickers[-1]=i.stickers[-1].filter(function(e){return r.fromStickerToObject(e).id!==l}),i.stickers[-1].unshift(r.fromObjectToSticker({id:l,size:c,url:u,animationUrl:d,recent:1,ref:"recent"})),i.stickers[-1]=i.stickers[-1].filter(function(e,t){return t<(window.isNewMail?16:8)}),n&&r.stickersSelectTab(!1,-1)}},sendSticker:function(e,t,n,i){if(window.isNewMail&&r.onStickerClick(t,i))return r.addRecentSticker(e,t,!1),!1;var a=window.cur;if(a.scroller&&!a.scroller.canClick())return!1;r.stickersToggle(e,!1);var o=ge("write_submit"),s={lock:!0,url_params:{media:"sticker"+t,_af:srand()}};if(n&&!i&&(s.url_params.media_from="recent"),a.ref&&(s.url_params.ref=a.ref,a.ref=void 0),a.refSource&&(s.url_params.ref_source=a.refSource,a.refSource=void 0),!i){var l=attr(e,"href");l&&(i=l.split("sticker_referrer=")[1].split("&")[0])}return i&&(s.url_params.sticker_referrer=i),r.addRecentSticker(e,t,n),o?ajax.click(o,extend({save:!0},Dialog),s):(o=ge("nc_submit"))?(setTimeout(function(){Replies.setCurrentTimestamp(0)},0),ajax.click(o,{},s)):void 0},toggleMarkAsAds:function(e,t){cancelEvent(t);var n=$("input[name='from_group']");if(!n||n.checked){var i=$("input",e);i.checked=!i.checked;var a=$("input[name='mute_notifications']");a&&(a.checked=i.checked,a.disabled=i.checked),r.checkCopyright()}},toggleSender:function(e,t){t.stopPropagation(),t.preventDefault();var n=e.querySelector("input");n.checked=!n.checked;var i={group:[],user:["marked_as_ads","signed","close_comments","mute_notifications"]},a=$("input[name='marked_as_ads']");$$(".Control.Control_type_checkbox.Row").forEach(function(e){if(!hasClass("Control__blocked",e)){var t=e.querySelector("input[name]");if("from_group"!==t.name)n.checked&&!i.group.includes(t.name)?t.disabled=!n.checked:!n.checked&&i.user.includes(t.name)&&(t.disabled=!n.checked),"mute_notifications"===t.name&&a&&a.checked&&(t.disabled=!0);else{var o=$(".header__user"),r=$(".header__group"),s=$("#select-timer"),l=$("input[name=postpone]"),c=$("input#add_post_btn");if(n.checked?(o.classList.add("header_hidden"),r.classList.remove("header_hidden"),s.style.display="inline-block",l.disabled=!1):(o.classList.remove("header_hidden"),r.classList.add("header_hidden"),s.style.display="none",l.disabled=!0),c){var u=c.value;c.value=c.dataset.value,c.dataset.value=u}}}}),r.checkCopyright()},checkCopyright:function(){var e=$("input[name='marked_as_ads']"),t=$("input[name='from_group']"),n=ge("select-copyright"),i=$('input[name="copyright"]'),a=$(".create_post__source-option");if(n){var o=$(".Icon",a),r=$(".Btn",a),s=$(".Btn__text",r);e&&e.checked&&(!t||t.checked)?(hide(n),attr(r,"disabled",!0),a.classList.add("create_post__source-option--disabled"),s.innerHTML=getLang("mobile_wall_post_copyright_add_button"),o.classList.remove("Icon_edit"),o.classList.add("Icon_audio_plus")):(attr(r,"disabled",!1),a.classList.remove("create_post__source-option--disabled"),i.value?(setStyle(n,"display","inline-block"),s.innerHTML=getLang("mobile_wall_post_copyright_edit_button"),o.classList.remove("Icon_audio_plus"),o.classList.add("Icon_edit")):(s.innerHTML=getLang("mobile_wall_post_copyright_add_button"),o.classList.remove("Icon_edit"),o.classList.add("Icon_audio_plus")))}}};t.default=r,window.post=r},H5mD:function(e,t,n){"use strict";n.r(t),n.d(t,"IPHONE_SAFARI_BOTTOM_BAR",function(){return o}),n.d(t,"IPHONE_X_SAFARI_BOTTOM_BAR",function(){return r}),n.d(t,"IPHONE_KEYBOARD_REJECT_OFFSET",function(){return s}),n.d(t,"IOS_NO_KEYBOARD_ALLOWED_OFFSET",function(){return l}),n.d(t,"isIPad",function(){return d}),n.d(t,"isIPhone",function(){return f}),n.d(t,"isIOS",function(){return _}),n.d(t,"isIPadOS",function(){return u}),n.d(t,"iosMajor",function(){return i}),n.d(t,"iosMinor",function(){return a}),n.d(t,"isWKWebView",function(){return m}),n.d(t,"isScrollBasedViewport",function(){return h}),n.d(t,"isIPhoneX",function(){return A}),n.d(t,"isIOSChrome",function(){return v}),n.d(t,"isLandscapePhone",function(){return g}),n.d(t,"checkIPadOS",function(){return b});var i,a,o=45,r=85,s=180,l=70,c=navigator.userAgent.toLowerCase(),u=b(c),d=u||-1!==c.indexOf("ipad"),f=!d&&-1!==c.search(/iphone|ipod/),_=f||d,p=_&&navigator.userAgent.match(/OS ([\d_]+) like Mac OS X/i);u&&(i=13,a=0),p&&(p=p[1].split("_"),i=+p[0],a=+p[1]),p=null;var h=i<13&&!(11===i&&a<3),m=_&&function(e){if(window.webkit&&window.webkit.messageHandlers)return!0;var t=/constructor/i.test(window.HTMLElement),n=!!window.indexedDB;if(-1===e.indexOf("safari")||-1===e.indexOf("version")||navigator.standalone){if(!n&&t||!window.statusbar||!window.statusbar.visible);else if(!t||n)return!0}else;return!1}(c),A=_&&375===screen.width&&812===screen.height&&3===window.devicePixelRatio,v=-1!==c.search(/crios/i);function g(){return 90===Math.abs(window.orientation)&&!d}function b(e){var t=!/ipad|iphone|ipod/.test(e);return!(!/mac os/.test(e)||!t||"boolean"!=typeof navigator.standalone)}},HGMY:function(e,t,n){"use strict";n.r(t);n("TYsd");var i=n("/Id8"),a=function(){store.mail.pendingMsgs;return{class:"MailPreSendList__box"}};function o(e){var t=store.mail,n=t.members[e.authorId],a=e.peerId,o=t.peers[a],r=Object(i.Msg__authorName)(n,a,t.cur.userId);return Object(i.default)({id:e.id,text:e.text,important:e.isImportant,unread:e.isUnread,authorPhoto:n.avatar,authorName:r,authorUrl:n.url,date:e.date,removed:t.cur.msgRemoved[e.id],admin:e.adminName?{name:e.adminName,url:e.adminUrl}:null,edited:e.edited,channel:o.isChannel&&o.ownerId!==t.cur.viewerId,attaches:e.attaches,attachesHTML:e.attachesHTML,attachesLoading:e.attachesLoading,forwards:e.forwards,reply:e.reply,pending:e.pending,failed:e.failed,sendId:e.sendId,sticker:e.sticker,maxDepth:store.mail.cur.maxMsgDepth})}var r=n("UxAg");function s(){return Object(r.$)(".MailPreSendList__box")}function l(e){s().innerHTML=e.map(function(e){return o(e)}).join("")}function c(e){s().insertAdjacentHTML("beforeend",o(e)),MailScrap.peerGoToBottom()}function u(e){var t=i.default.getElem(e.sendId);t&&t.remove()}function d(e){return i.default.getElem(e.sendId)}n.d(t,"MailPreSendList__Msg",function(){return o}),n.d(t,"getElem",function(){return s}),n.d(t,"setMsgs",function(){return l}),n.d(t,"addMsg",function(){return c}),n.d(t,"removeMsg",function(){return u}),n.d(t,"getMsg",function(){return d});t.default=a},"HN+/":function(e,t,n){var i=n("vOyG"),a=i.length,o=1,r=3,s=8;function l(e,t,n){e[n]!==t[n]&&(t[n]=e[n],e[n]?t.setAttribute(n,""):t.removeAttribute(n))}e.exports=function(e,t){var n=e.nodeType,c=e.nodeName;n===o&&function(e,t){for(var n=t.attributes,i=e.attributes,a=null,o=null,r=null,s=null,l=i.length-1;l>=0;--l)s=i[l],r=s.name,a=s.namespaceURI,o=s.value,a?(r=s.localName||r,t.getAttributeNS(a,r)!==o&&t.setAttributeNS(a,r,o)):t.hasAttribute(r)?t.getAttribute(r)!==o&&("null"===o||"undefined"===o?t.removeAttribute(r):t.setAttribute(r,o)):t.setAttribute(r,o);for(var c=n.length-1;c>=0;--c)!1!==(s=n[c]).specified&&(r=s.name,(a=s.namespaceURI)?(r=s.localName||r,e.hasAttributeNS(a,r)||t.removeAttributeNS(a,r)):e.hasAttributeNS(null,r)||t.removeAttribute(r))}(e,t);n!==r&&n!==s||t.nodeValue!==e.nodeValue&&(t.nodeValue=e.nodeValue);"INPUT"===c?function(e,t){var n=e.value,i=t.value;l(e,t,"checked"),l(e,t,"disabled"),n!==i&&(t.setAttribute("value",n),t.value=n);"null"===n&&(t.value="",t.removeAttribute("value"));e.hasAttributeNS(null,"value")?"range"===t.type&&(t.value=n):t.removeAttribute("value")}(e,t):"OPTION"===c?function(e,t){l(e,t,"selected")}(e,t):"TEXTAREA"===c&&function(e,t){var n=e.value;n!==t.value&&(t.value=n);if(t.firstChild&&t.firstChild.nodeValue!==n){if(""===n&&t.firstChild.nodeValue===t.placeholder)return;t.firstChild.nodeValue=n}}(e,t);!function(e,t){for(var n=0;n<a;n++){var o=i[n];e[o]?t[o]=e[o]:t[o]&&(t[o]=void 0)}}(e,t)}},HPEO:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("TYsd"),r=n("Mc5h"),s=n("9y81"),l=n("AXyT"),c=n("gy8s"),u=n("29dZ"),d=n("Y6JH"),f=n("/Id8");n("BoyB");function _(){var e=Object(i.default)(['\n    <input type="hidden" name="attached_messages" value="','" />\n  ']);return _=function(){return e},e}function p(){var e=Object(i.default)(['\n    <div class="uMailWrite__attachedMsgs">\n      ',"\n      ","\n      ",'\n      <div class="uMailWrite__attachedMsgsText">',"</div>\n    </div>\n  "]);return p=function(){return e},e}function h(){var e=Object(i.default)(['\n    <div class="',' _preventMenuOpen">\n      ',"\n      ","\n    </div>\n  "]);return h=function(){return e},e}function m(){var e=Object(i.default)(['\n    <div class="','">\n      ',"\n      ","\n      ","\n    </div>\n  "]);return m=function(){return e},e}function A(){var e=Object(i.default)(['\n    <div class="uMailWrite__templates">\n      <div class="uMailWrite__templatesHeader">\n        ','\n        <a class="uMailWrite__templatesAdd" href="','" ',">\n          ",'\n        </a>\n      </div>\n      <div class="uMailWrite__templatesBody ScrollView"></div>\n    </div>\n  ']);return A=function(){return e},e}function v(){var e=Object(i.default)(['\n    <div class="uMailWrite__buttonKeyboardIcon"></div>\n  ']);return v=function(){return e},e}function g(){var e=Object(i.default)(['\n    <div class="uMailWrite__keyboard ScrollView">\n\n    </div>\n  ']);return g=function(){return e},e}function b(){var e=Object(i.default)(['\n    <div class="uMailWrite__SVGIcon uMailWrite__SVGIcon_','"></div>\n  ']);return b=function(){return e},e}function y(){var e=Object(i.default)(['\n    <div class="uMailWrite__main">\n      <div class="uMailWrite__button uMailWrite__buttonAttach">','</div>\n      <div class="uMailWrite__button uMailWrite__buttonKeyboard" ',">",'</div>\n      <div class="uMailWrite__button uMailWrite__buttonStickers" ',">","",'</div>\n      <button class="','" type="submit" ',">\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ",'\n      </button>\n      <div class="uMailWrite__textareaContainer">\n        <textarea\n          class="uMailWrite__textarea"\n          name="message"\n          placeholder="','"\n          maxlength="4096"\n          ',"\n          ","\n          ","\n          ","\n          ","\n          ","\n          ",'\n        ></textarea>\n        <div class="uMailWrite__textareaGhost"></div>\n      </div>\n    </div>\n  ']);return y=function(){return e},e}function w(){var e=Object(i.default)(["\n    ","\n    ","\n  "]);return w=function(){return e},e}function C(){var e=Object(i.default)(['\n    <form\n      class="','"\n      method="POST"\n      action="/mail?act=send&to=',"&hash=","&from=dialog",'"\n      ','\n    >\n      <div class="uMailWrite__toBottom" ',">","</div>\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n    </form>\n  "]);return C=function(){return e},e}function k(){var e=Object(i.default)(['\n      <div class="uMailWrite uMailWrite_unableToWrite">\n        ','\n        <div class="uMailWrite__unableToWriteText">\n          ',"\n        </div>\n      </div>\n    "]);return k=function(){return e},e}var S=function(){var e=window.lang,t=store.mail,n=t.cur.peerId;if(!n)return'<form class="uMailWrite"></form>';var i=t.peers[n];if(i.unableToWrite){if(i.isChannel)return"";var o=i.kickedMessage||e.mobile_msg_mail_privacy_error,l=Object(s.default)({mix:"uMailWrite__unableToWriteIcon",icon:"warning"});return a.default.html(k(),l,o)}var u=a.default.onSubmit("uMailWrite._onSubmit","event","this"),f=a.default.onClick("uMailWrite.onToBottomClick"),_=Object(r.default)({mix:"uMailWrite__popupStickers _preventMenuOpen",inner:""}),p=T(null),h=D(n),m=function(e){var t=window.lang,n=store.mail,i=n.cur,o=n.queue,r=a.default.onMouseDown("uMailWrite._onStickersClick","event"),l=a.default.onMouseDown("uMailWrite._onKeyboardClick","event"),u=n.peers[e],f=i.groupId,_=Math.abs(f),p=f?"&community="+_:"",h=Object(c.default)({icon:"attach",name:"uMailWrite_attachments",position:"bottomLeft",items:[{text:i.inlineUploadHTML.replace(/mail\d+/g,"mail"+e),icon:Object(d.default)("mail-attachments","camera_24")},{text:t.mobile_attachments_add_photo_vk,url:"/attachments?act=choose_photo&target=mail"+e+p,icon:Object(d.default)("mail-attachments","gallery_24")},{text:t.mobile_attachments_add_video,url:"/attachments?act=choose_video&target=mail"+e+p,icon:Object(d.default)("mail-attachments","video_24")},{text:t.mobile_attachments_add_audio,url:"/attachments?act=choose_audio&target=mail"+e+p,icon:Object(d.default)("mail-attachments","music_24")},{text:t.mobile_attachments_add_doc,url:"/attachments?act=choose_doc&target=mail"+e+p,icon:Object(d.default)("mail-attachments","document_24")},u.canSendGift?{text:t.mobile_attachments_add_gift,url:"/gifts"+e+"?act=send&from=mail&ref=media_selector",icon:Object(d.default)("mail-attachments","gift_24")}:null,u.canAttachMoney?{text:t.mobile_attachments_add_money,url:"/attachments?act=attach_money&target=mail"+e+p,icon:Object(d.default)("mail-attachments","money_transfer_24")}:null,u.canAttachPoll?{text:t.mobile_attachments_add_poll,url:"/attachments?act=attach_poll&target=mail"+e+p,icon:Object(d.default)("mail-attachments","poll_24"),mix:"uMailWrite__pollUnfoldItem"}:null]}),m=a.default.onKeyUp("uMailWrite._onKeyUp"),A=a.default.onInput("uMailWrite._onInput","event","this"),g=a.default.onKeyDown("uMailWrite._onKeyDown","event","this"),b=a.default.onFocus("uMailWrite._onFocus","event","this"),w=a.default.onBlur("uMailWrite._onBlur","event","this"),C=a.default.onClick("uMailWrite._onClick","event","this"),k=a.default.onTouchEnd("uMailWrite._onSendTouchEnd","event","this"),S=Object(s.default)({mix:"uMailWrite__buttonSendIcon",icon:"send"}),E=Object(s.default)({mix:"uMailWrite__buttonSendIcon",icon:"send",active:!0}),T=O("accept"),D=O("remove"),j=O("templates"),I=O("templatesActive"),M=Object(s.default)({mix:"uMailWrite__buttonSendIcon",icon:"spinner"}),x=Object(s.default)({mix:"uMailWrite__buttonStickersIcon",icon:"sticker"}),B=Object(s.default)({mix:"uMailWrite__buttonStickersIcon",icon:"sticker",active:!0}),P=a.default.html(v()),L=u.attachmentsHTML.length,R=i.msgAttached[i.peerId],N=R&&R.length,F=!!(o[i.peerId]||[]).length,H=a.default.class("uMailWrite__button","uMailWrite__buttonSend",{send:!0,sendActive:!!(L>150||N),loading:F});return a.default.html(y(),h,l,P,r,x,B,H,k,S,E,M,T,D,j,I,t.mobile_mail_message_placeholder,b,m,A,g,b,w,C)}(n),b=a.default.html(g()),w=function(){var e=window.lang,t=Object(s.default)({icon:"plus"}),n=store.mail.cur.peerId,i=store.mail.cur.communityParam,o="/mail?act=template&from="+n+i,r=a.default.onClick("uMailWrite.loadTemplatePage","event","this",o);return a.default.html(A(),e.mobile_mail_templates_panel_title,o,r,t)}(),S=E(),j=a.default.class("uMailWrite",{canAttachMoney:!!i.canAttachMoney,canAttachPoll:!0});return a.default.html(C(),j,n,i.hashSend,t.cur.communityParam,u,f,S,p,h,m,_,b,w)};function E(){var e=store.mail,t=e.cur,n=e.peers,i=n[t.peerId]?n[t.peerId].countUnread:null,o=i?Object(l.default)({mix:"uMailWrite__toBottomValue",value:i}):"",r=Object(s.default)({mix:"uMailWrite__toBottomIcon",icon:"arrowDown"});return a.default.html(w(),o,r)}function O(e){return a.default.html(b(),e)}function T(e){var t=store.mail.cur,n=store.mail.members,i=t.peerId,o=t.msgReply[i],r=null;o&&(r=store.mail.forwards[o]||store.mail.msgs[o]);var s="",l="";if(r){var c=Object(f.Msg__authorName)(n[r.authorId],i,t.userId);s=Object(f.Msg__reply)(r,c,e),l='\n      <input type="hidden" name="attached_messages" value="'+o+'" />\n      <input type="hidden" name="has_reply" value="true" />\n    ',t.editing&&(l+='\n        <input type="hidden" name="mail_edit_attach_fwd" value="1" />\n      ')}var u=a.default.class("uMailWrite__reply",{visible:!!s}),d=MailButton({class:"uMailWrite__replyClose",onClick:a.default.onClick("uMailWrite.onReplyClose")});return a.default.html(m(),u,s,d,l)}function D(e){var t,n=store.mail,i=n.cur,o=n.peers[e].attachmentsHTML,r=a.default.class("uMailWrite__attachments",((t={})[e]=!0,t)),l=i.msgAttached[e]||[],c=l.length,u="";c>0&&(u=function(e,t){var n=window.lang,i=a.default.onClick("uMailWrite.onAttachedMsgsRemove"),o=Object(s.default)({mix:"uMailWrite__attachedMsgsIcon",icon:"msgMini"}),r=Object(s.default)({mix:"uMailWrite__attachedMsgsRemove",icon:"close9",attrs:i}),l=langNumeric(e,n.mobile_mail_messages),c=function(e){return a.default.html(_(),e)}(t);return a.default.html(p(),c,r,o,l)}(c,l.join(";")));return a.default.html(h(),r,u,o)}var j=n("UxAg"),I=n("+cqQ"),M=n("jk6M"),x=n("rKp0"),B=(n("u33z"),n("V4qE")),P=n("HGMY"),L=n("t7Ww"),R=n("r/ag"),N=2147483647;function F(){try{if(window.crypto){var e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce(function(e,t){return e+t}))}}catch(e){}return intval(rand(0,N).toFixed(0))}var H=n("9M99"),U=n("H5mD"),V=n("aiw/"),$=n("Qz23"),q=n("jE6c"),W=n("hw56"),z=n("j80l"),Q=n("wcVR"),Y=n("B+U2");function X(e){var t=e.length,n=!t;return o.default.html([G(n),{class:"uMailWrite__templatesRows",attrs:{hidden:n},inner:e.map(function(e,n){return function(e,t,n){var i=t>0&&t===n-1,r=store.mail.cur.communityParam,s=store.mail.cur.peerId,l=e.name,u=e.text;l=Object(H.emojiToHTML)(l),u=K(u,!0);var d="_touched uMailWrite__templatesRow";d+=" uMailWrite__templatesRow"+e.id,e.deleting&&(d+=" uMailWrite__templatesRow_hidden");return{class:d,inner:[{class:"uMailWrite__templatesRowContent",attrs:{onclick:["uMailWrite.onTemplateClick","event","this",e.id]},inner:[{class:"uMailWrite__templatesRowName",inner:o.default.html(l)},{class:"uMailWrite__templatesRowText",inner:o.default.html(u)}]},{class:"uMailWrite__templatesRowMore",inner:[o.default.wrap(Object(c.default)({mix:"",icon:"more",position:i?"bottomRight":"topRight",items:[{text:lang.mobile_mail_templates_action_edit,name:"edit",url:"/mail?act=template&id="+e.id+r+"&from="+s},{text:lang.mobile_mail_templates_action_delete,name:"delete",attrs:a.default.onMouseDown("uMailWrite._onDeleteTemplate",e.id)}]}))]}]}}(e,n,t)})}])}function G(e){var t="/mail?act=template&from="+store.mail.cur.peerId+store.mail.cur.communityParam,n=a.default.onClick("uMailWrite.loadTemplatePage","event","this",t);return{class:"uMailWrite__templatesEmpty",attrs:{hidden:!e},inner:[{class:"uMailWrite__templatesEmptyInfo",inner:lang.mobile_mail_templates_empty_info},Object(u.default)({type:"button",theme:"small",attrs:n,inner:lang.mobile_mail_templates_empty_button})]}}function K(e,t){void 0===t&&(t=!1);var n,i=store.mail.members,a=store.mail.cur,o=i[a.peerId],r=i[a.userId],s=i[a.groupId],l=o.name.replace(o.firstName,"").trim(),c=r.name.replace(r.firstName,"").trim();if((e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<br>/g,"\n")).replace(/&lt;br&gt;/g,"\n")).replace(/\t/g,"\n")).replace(/{user name}/g,o.firstName)).replace(/{user surname}/g,l)).replace(/{admin name}/g,r.firstName)).replace(/{admin surname}/g,c)).replace(/{community}/g,s.name)).match(/{greeting}/g)){var u,d=(n=Date.now()+1e3*store.mail.cur.timeShift,new Date(n).getHours());u=d>=3&&d<12?lang.mobile_mail_templates_greeting_morning:d>=12&&d<17?lang.mobile_mail_templates_greeting_afternoon:d>=17&&d<=23?lang.mobile_mail_templates_greeting_evening:lang.mobile_mail_templates_greeting_night,e=e.replace(/{greeting}/g,u)}return t&&(e=Object(H.emojiToHTML)(e)),e}var J=n("HdGT");n("qHA9");Object.assign(S,{onToBottomClick:Object(I.default)(),onAttachedMsgsRemove:Object(I.default)(),onReplyClose:Object(I.default)(),onMessage:Object(I.default)(),showToBottom:function(){if(le)return;ce&&(clearTimeout(ce),ce=null);addClass("uMailWrite__toBottom_visible",Object(j.$)(".uMailWrite__toBottom"))},hideToBottom:function(){clearTimeout(ue),ce=setTimeout(function(){removeClass("uMailWrite__toBottom_visible",Object(j.$)(".uMailWrite__toBottom"))},100)},preventShowToBottom:function(){le=!0,setTimeout(function(){le=!1},300)},openStickersPanel:Ee,redrawReply:Ne,uiRedrawAttachments:Fe,redrawToBottom:function(){Object(j.$$)(".uMailWrite__toBottom").forEach(function(e){return e.innerHTML=E()})},drawStickers:Ce,setModifiers:function(e){Object(j.$$)(".uMailWrite").forEach(function(t){var n=a.default.parseClass("uMailWrite",t.getAttribute("class"));t.setAttribute("class",a.default.class("uMailWrite",Object.assign({},n,e)))})},hideStickersPanel:Se,setText:nt,renderKeyboardIfNeeded:at,openKeyboard:rt,init:function(){var e=store.mail,t=e.cur,n=(e.msgs,e.pendingReplies),i=t&&Object(W.getPeerDraft)(t.viewerId,t.peerId);i&&!t.editing&&i.text&&function(e){var t=document.createElement("textarea");t.innerHTML=e;var n=t.value;Object(j.$$)(".uMailWrite__textarea").forEach(function(e){return e.value=n});var i=Object(j.$)(".uMailWrite__textareaGhost");i.innerText=n,"\n"===last(n)&&(i.innerHTML+="&nbsp;");he()}(i.text);"templates"===Object(W.getKeyboardType)()?xe():at();ft(),Ae(),i&&!t.editing&&Array.isArray(i.msgs)&&(t.msgAttached[t.peerId]=i.msgs);if(i&&!t.editing&&isFinite(i.reply)){var a=f.default.getReplyDataFromHTML(i.reply);a&&(t.msgReply[t.peerId]=i.reply,n[i.reply]=a)}Ne(),Fe(t.peerId),Object(j.$$)(".uMailWrite__textarea").forEach(function(e){Object($.setScrollView)(e,{topBanner:!1,overscrollY:!1})}),Object(j.$$)(".uMailWrite__attachments").forEach(function(e){Object($.setScrollView)(e,{topBanner:!1,allowY:!1})})},reset:function(){Object(W.setKeyboardType)("")},loadTemplatePage:function(e,t,n){e.preventDefault(),uMessenger.loadMailPage(n)}}),uVK.onReady(me),S._onBlur=Xe,S._onKeyUp=Ve,S._onKeyDown=ze,S._onFocus=Ye,S._onInput=$e,S._onSubmit=He,S._onClick=Qe,S._onAttachClick=Pe,S._onStickersClick=ke,S._onKeyboardClick=Oe,S._onKeyboardButtonClick=Te,S._onDeleteTemplate=lt,S._onConfirmDeleteTemplate=ct,S._onSendTouchEnd=Ue,S._onRetryFailedMsg=pt,S._onDeleteFailedMsg=ht,S._onCancelPendingMsg=mt,S._onConfirmSendGeo=De,mediaUpload.onRemove(ve),mediaUpload.onComplete(we),mediaUpload.onStart(be),mediaUpload.onError(ye),post.onStickersTabSelected(Le),post.onStickerClick(Re),J.onSent(dt),J.onErrorMessage(At),f.default.onPendingClick(_t),c.default.onOpen("uMailWrite_attachments")(pe),S.onToBottomClick(function(){var e=Object(j.$)(".uMailWrite__toBottom_visible");e&&e.classList.remove("uMailWrite__toBottom_visible"),x.default.removeDivider()}),S.onReplyClose(function(){var e=store.mail.cur;e.msgReply[e.peerId]=null,Object(W.setPeerDraft)(e.viewerId,e.peerId,{reply:void 0},e.editing),e.editing||ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),Ne()}),S.onTemplateClick=function(e,t,n){var i;n&&(store.mail.cur.templates.some(function(e){if(e.id===n)return i=e,!0}),i&&nt(K(i.text)))},Mention.onOpen(function(){if(store.mail.cur){var e=store.mail.cur,t=e.peerMembers,n=e.peerId;t[n]||(t[n]=!0,ajaxRequest("/mail",{act:"get_members",peer_id:n},function(e){Object.assign(store.mail.members,e);var t=qe(n);Mention.update({items:t,defaultItems:t})},function(){t[n]=!1}))}});var Z,ee,te="uMailWrite__popupAttach_open",ne="uMailWrite__popupStickers_open",ie="uMailWrite__keyboard_open",ae="uMailWrite__templates_open",oe=!1,re={canAttachPoll:"uMailWrite_canAttachPoll"},se={mailWrite:".uMailWrite",pollAttachment:".attachment_type_poll"},le=!1,ce=null,ue=null,de=[],fe=debounce(Ke,100),_e=debounce(Ge,1e3);function pe(){function e(e,t){return e=e.replace(/&edit_msg_id=\d+/,"").replace(/=mailedit(-?\d+)/,"=mail$1"),store.mail.cur.editing&&(e=e.replace(/=mail(-?\d+)/,"=mailedit$1"),e+=t?"&edit_msg_id="+store.mail.cur.editing:""),e}Object(j.$$)("a.Unfold__item").forEach(function(t){var n=e(t.getAttribute("href"),!0);t.setAttribute("href",n)}),Object(j.$$)("input.inline_upload").forEach(function(t){t.setAttribute("data-upload-url",e(t.getAttribute("data-upload-url")))})}function he(){var e=Object(j.$)(".uMailWrite__textareaGhost").offsetHeight;Object(j.$$)(".uMailWrite__textarea").forEach(function(t){return setStyle(t,"height",e)}),Object(j.$$)(".uMailWrite__main").forEach(function(t){return setStyle(t,"height",e)}),Ke()}function me(){if("/mail"===location.pathname||0===location.pathname.indexOf("/write")){var e=store.mail.cur;if(e&&e.peerId){var t=geBySel(".uMailWrite__attachments .medias_thumb").length,n=geBySel(".uMailWrite__attachments .medias_row").length,i=(e.msgAttached[e.peerId]||[]).length?1:0;e.hasAttachments=t+n+i>0,Object(j.$$)(".uMailWrite__attachments").forEach(function(t){toggleClass("uMailWrite__attachments_hasAttachments",t,e.hasAttachments)}),function(){var e=Object(j.$)(".uMailWrite__buttonAttach");if(!e)return;var t=(n=Object(j.$)(".uMailWrite__attachments"),(n?n.$$(".thumb_item").length+n.$$(".medias_row").length-n.$$(".fwd_item").length:0)>=10);var n;e.classList.add("uMailWrite__button_disabled",t),t?e.addEventListener("mousedown",tt,!0):e.removeEventListener("mousedown",tt,!0)}()}}}function Ae(){var e=store.mail.cur;e&&e.peerId&&(de=qe(e.peerId),Mention.init({defaultItems:de,items:de,appendTo:geByClass1("uMailWrite__main"),url:null,params:{},preferDomain:!0,afterInsert:function(t){var n=Object(j.$)(".uMailWrite__textareaGhost"),i=t.value;n.innerText=i,he(),Ge(i,e.viewerId,e.peerId)}}))}function ve(e){if(store.mail.cur){var t=store.mail,n=t.cur,i=t.peers,a=n.peerId;if(a&&(i[a].attachmentsHTML=geBySel1(".uMailWrite__attachments_"+a+" .cp_attached_wrap").outerHTML,Fe(a)),e.closest(se.pollAttachment))Object(j.$)(se.mailWrite).classList.add(re.canAttachPoll)}}function be(){store.mail.cur&&(me(),Ke())}function ye(){if(store.mail.cur){var e=store.mail,t=e.cur,n=(e.peers,t.peerId);n&&(Fe(n),Messenger.scrollConvoToBottom())}}function we(){var e=store.mail,t=e.cur,n=e.peers;if(t){var i=t.peerId;i&&(n[i].attachmentsHTML=geBySel1(".uMailWrite__attachments_"+i+" .cp_attached_wrap").outerHTML,Ke())}}function Ce(){var e=store.mail.cur,t=Object(j.$)(".uMailWrite__popupStickers");e&&t&&!t.childElementCount&&(t.innerHTML=e.stickersPanelHTML.replace(/mail0/g,"mail"+e.peerId),Object(j.$$)(".sp_body",t).forEach(function(e){Object($.setScrollView)(e,{topBanner:!1})}),Object(j.$$)(".scroller_wrap",t).forEach(function(e){Object($.setScrollView)(e,{topBanner:!1,allowY:!1})}),post.stickersSelectTab(null,-1))}function ke(e){var t=Object(j.$)(".uMailWrite__popupStickers"),n=hasClass(ne,t);e.preventDefault(),Ce(),st("stickers"),n?Se():Ee()}function Se(){"stickers"===Object(W.getKeyboardType)()&&Object(W.setKeyboardType)("");var e=Object(j.$)(".uMailWrite__popupStickers");removeClass(ne,e),Je(!1);var t=ge("stickers_panel");t&&"block"===t.style.display&&(t.style.display="none")}function Ee(){Object(W.setKeyboardType)("stickers");var e=Object(j.$)(".uMailWrite__popupStickers");addClass(ne,e),post.stickersInit(),Je(!0)}function Oe(e){var t=Object(j.$)(".uMailWrite__keyboard"),n=hasClass(ie,t);e.preventDefault(),st("buttons"),n?je({store:!0}):Ie({store:!0})}function Te(e,t,n){var i,o=n.authorId,r=n.inline,s=n.msgId,l=JSON.parse(Object(q.replaceEntities)(n.action)),c=l.type,d=l.payload,f=l.rawLabel,_=store.mail,p=_.cur,h=_.members,m=_.peers,A=_.msgs,v=h[o],g=F();if(s){var b=A[s];i=b.peerId}else i=p.peerId;var y,w=m[i],C=f||"";if(i>=2e9)if(v.domain)y="@"+v.domain+" "+C;else{var k=v.url.replace(/^\//,"");y="@"+k+" ("+v.firstName+") "+C}else y=C;var S=c,E=r?"inline":"normal";if("open_app"===S&&(S="app"),statlogsValueEvent("message_send_from_keyboard",0,p.viewerId,i,o,S,E),"vkpay"!==c)if("open_app"!==c)if("open_link"!==c){if("location"!==c)et({act:"send",to:i,from:"dialog",hash:w.hashSend,message:y,media:"",_af:p._af,random_id:g,payload:d}),r&&!p.peerId&&nav.go(Object(z.makeUrl)("/mail",{act:"show",peer:i,community:nav.getQuery("community")}));else Q.default.init()?(u.default.setLoading(e,!0,"blue"),Q.default.getCurrentPosition(function(t){var n=t.coords,o=n.latitude,r=n.longitude;u.default.setLoading(e,!1),MailDialog.open({body:lang.mobile_mail_geo_send_question,confirmText:lang.mobile_mail_geo_send_confirm,cancelText:lang.mobile_cancel,onConfirm:a.default.onClick("uMailWrite._onConfirmSendGeo",o,r,d,y,i)})},function(){u.default.setLoading(e,!1),B.init({text:lang.mobile_mail_geo_not_available})},{maximumAge:100,enableHighAccuracy:!0,timeout:1e4})):B.init({text:lang.mobile_mail_geo_not_available})}else{var O=function(e,t){var n=decodeURIComponent(e);return/^\/[^/]/.test(n)||/^(https?:\/\/)?([a-z0-9_\-.]+\.)?vk.com(\/.*)?/.test(n)?e:"/away.php?to="+encodeURIComponent(n)+(t?"&utf=1":"")}(l.link,!0);nav.hard_go(O)}else{var T=l.app_id,D=l.hash,j=Object(z.makeUrl)("/app"+T,{from:nav.cur.slice(1)});nav.go(j+"#"+D)}else{var I=l.hash,M=Object(z.makeUrl)("/app6217559",{from:nav.cur.slice(1)});nav.go(M+"#"+I)}}function De(e,t,n,i,a){var o=store.mail,r=o.cur,s=o.peers[a],l=F();et({act:"send",to:a,from:"dialog",hash:s.hashSend,message:i,media:"",_af:r._af,random_id:l,payload:n,attach1_type:"map",attach1:e+"_"+t}),MailDialog.close(),nav.go(Object(z.makeUrl)("/mail",{act:"show",peer:a,community:nav.getQuery("community")}))}function je(e){"buttons"===Object(W.getKeyboardType)()&&Object(W.setKeyboardType)("");var t=Object(j.$)(".uMailWrite__keyboard");if(removeClass(ie,t),Ze(!1),e&&e.store){var n=store.mail.cur.peerId,i=store.mail.peers[n];i&&i.keyboard&&(Z[n]=i.keyboard.chat_local_id,lsSet("mail_keyboard_hidden",Z))}}function Ie(e){Object(W.setKeyboardType)("buttons");var t=Object(j.$)(".uMailWrite__keyboard"),n=e&&e.forceRender;addClass(ie,t),Ze(!0);var i=Object(W.getKeyboardState)(store.mail.cur.peerId);!n&&!!i.rendered||function(){var e=store.mail,t=e.cur,n=e.peers,i=t.peerId&&n[t.peerId];if(!i||!i.keyboard||!i.keyboard.buttons)return;var a=o.default.render(Object(Y.default)({keyboard:i.keyboard})),r=Object(j.$)(".uMailWrite__keyboard");r.innerHTML=a,Object($.setScrollView)(r,{topBanner:!1}),Object(W.getKeyboardState)(t.peerId).rendered=!0}(),e&&e.store&&Me()}function Me(){var e=store.mail.cur.peerId;Z&&(delete Z[e],lsSet("mail_keyboard_hidden",Z))}function xe(){Object(W.setKeyboardType)("templates");var e=Object(j.$)(".uMailWrite__templates");addClass(ae,e),Ke(),ot()}function Be(){"templates"===Object(W.getKeyboardType)()&&Object(W.setKeyboardType)("");var e=Object(j.$)(".uMailWrite__templates");removeClass(ae,e),Ke()}function Pe(e){var t=Object(j.$)(".uMailWrite__popupAttach"),n=Object(j.$)(".uMailWrite__popupStickers");e.preventDefault(),e.stopPropagation(),hasClass(ne,n)&&removeClass(ne,n),hasClass(te,t)?removeClass(te,t):(addClass(te,t),addEvent(window,"click",function e(n){removeClass(te,t);removeEvent(window,"click",e)}))}function Le(){store.mail.cur&&(geByClass1("sp_body")&&(cur.scroller&&cur.scroller.destroy(),geByClass1("sp_body").scrollTop=0,removeClass("scroller_wrap",geByClass1("sp_cont")),geByClass("sp_page").forEach(function(e){return removeClass("scroller_page",e)})))}function Re(e,t){if(store.mail.cur){var n=store.mail,i=n.cur,a=n.peers,o=(geByClass1("uMailWrite"),Object(j.$)(".uMailWrite__popupStickers")),r=F(),s=0===t.indexOf("suggestion"),l={act:"send",to:i.peerId,from:"dialog",hash:a[i.peerId].hashSend,message:"",media:"sticker"+e,_af:i._af,random_id:r,sticker_referrer:t},c=i.msgReply[i.peerId];if(c&&(l.attached_messages=c,l.has_reply=!0,Object(W.setPeerDraft)(i.viewerId,i.peerId,{reply:void 0}),ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),i.msgReply[i.peerId]=null),s){var u=Object(j.$)(".uMailWrite__textarea");u.value="",Ge("",i.viewerId,i.peerId),$e({},u)}return et(l),Ke(),Ne(),oe&&(removeClass(ne,o),Je(!1)),!0}}function Ne(){var e=store.mail,t=e.cur,n=e.replies,i=t.msgReply[t.peerId],a="";if(t.editing){var o=n[i];o&&(a=o.preview_url)}else{var r=i&&f.default.getElem(i);if(r){var s=Object(j.$)(".thumbs_map .thumb_map_img_as_div",r);(a=s&&s.style.backgroundImage)&&(a=a.replace(/^url\((['"])?/,"").replace(/(['"])?\)$/,""))}}Object(j.$$)(".uMailWrite__reply").forEach(function(e){e.outerHTML=T(a)})}function Fe(e){Object(j.$$)(".uMailWrite__attachments_"+e).forEach(function(t){t.outerHTML=D(e)}),me(),Object(j.$)(".uMailWrite__textarea")&&Ke();var t=Object(j.$)(se.mailWrite);if(t){var n=!!t.$(se.pollAttachment);t.classList.toggle(re.canAttachPoll,!n)}}function He(e){if(e&&e.preventDefault(),!mediaUpload.checkUploading())return!1;var t,n=Object(j.$)(".uMailWrite__textarea"),i=store.mail,a=i.cur,o=i.peers,r=F(),s=store.mail.cur.editing,l=s&&store.mail.msgs[s],c=l?{act:"edit_message",id:s,peerId:l.peerId,hash:o[a.peerId].hashSend}:{act:"send",to:a.peerId,from:"dialog",hash:o[a.peerId].hashSend,_af:a._af,random_id:r,entrypoint:store.mail.cur.mvk_entrypoint||""};if(!it())return l?MsgDeleteDialog.open({isEditing:!0}):a.groupId&&(t=Object(j.$)(".uMailWrite__templates"),st("templates"),hasClass(ae,t)?Be():xe()),!1;each(geByClass1("uMailWrite"),function(e,t){return!(t.name&&!t.disabled)||("radio"===t.type&&!t.checked||("checkbox"===t.type&&!t.checked||("button"===t.type||("submit"===t.type||("image"===t.type||void(c[t.name]=t.value))))))}),s?(uMailHat.onCancelEditing(!0),et(c)):(et(c),store.mail.cur.mvk_entrypoint="",Object(W.popPeerAttachments)(a.peerId),n.value="",Ge("",a.viewerId,a.peerId),Object(W.setPeerDraft)(a.viewerId,a.peerId,{msgs:void 0,reply:void 0},a.editing),a.msgReply[a.peerId]&&!a.editing&&ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),a.msgAttached[a.peerId]=[],a.msgReply[a.peerId]=null,$e({},n)),x.default.onSystemMessageClick(),Fe(a.peerId),Ne(),StickersHints.actualizeVisibility(),U.isIOS?(n.focus(),setTimeout(function(){return n.focus()})):M.default.msie_edge||(n.focus(),requestAnimationFrame(function(){return n.focus()}))}function Ue(e){M.default.msie_edge&&(e.preventDefault(),He(e))}function Ve(){var e=Ve,t=e.typingData||(e.typingData={});if(0!==Object(j.$)(".uMailWrite__textarea").value.length&&!store.mail.cur.editing){var n=Date.now(),i=store.mail,a=i.cur,o=i.peers,r=a.peerId;r<=-2e9||t[r]&&n-t[r]<5e3||(t[r]=n,ajaxRequest("/mail",{_ajax:1,act:"typing",peer:r,hash:o[r].hashTyping,community:nav.getQuery("community")}))}}function $e(e,t){var n=Object(j.$)(".uMailWrite__textareaGhost"),i=t.value;n.innerText=i,"\n"===last(i)&&(n.innerHTML+="&nbsp;");var a=store.mail.cur,o=n.offsetHeight;Object(j.$$)(".uMailWrite__textarea").forEach(function(e){return setStyle(e,"height",o)}),Object(j.$$)(".uMailWrite__main").forEach(function(e){return setStyle(e,"height",o)}),fe(),a&&_e(i,a.viewerId,a.peerId),We(e,t,function(){Mention.onKeyUp(e,t)})}function qe(e){var t=store.mail,n=t.peers,i=t.members,a=t.cur,o=n[e].memberIds||[],r=[],s=[];return o.forEach(function(e,t){if(e!==a.viewerId){var n=i[e];if(n){var o=[n.id,n.name,n.url.replace("/","@"),n.avatar,n.url.replace("/",""),null,null,null,n.firstName,n.domain];r.push(o)}else{var l=["fake"+t,"...","@...",i[0].avatar,"",null,null,null,"...",null];s.push(l)}}}),r.concat(s)}function We(e,t,n){de.length&&(!hasClass("Mention_inited",geByClass1("uMailWrite__main"))&&Ae(),n(e,t))}function ze(e,t){We(e,t,function(){Mention.onKeyDown(e,t)}),(10==e.keyCode||13==e.keyCode&&(e.ctrlKey||e.metaKey))&&He()}function Qe(e,t){We(e,t,function(){Mention.onClick(e,t)})}function Ye(e,t){Object(W.setKeyboardType)("text");var n=function(){Ce(),st("text"),StickersHints.init({peerId:store.mail.cur.peerId}),We(e,t,function(){Mention.onFocus(e,t)})};U.isIOS?n():requestAnimationFrame(function(){requestAnimationFrame(function(){n()})}),V.onOpen("bottom")}function Xe(e,t){if("text"===Object(W.getKeyboardType)()&&Object(W.setKeyboardType)(""),V.onClose(),_e._timer&&clearTimeout(_e._timer),store.mail&&store.mail.cur){var n=store.mail.cur,i=n.viewerId,a=n.peerId;Ge(t.value,i,a)}}function Ge(e,t,n){var i=store.mail.cur.editing;Object(W.setPeerDraft)(t,n,{text:e},i)}function Ke(){var e=store.mail,t=e.cur,n=(e.queue,e.flags);if(t.peerId){var i=!it(),o=!mediaUpload.checkUploading(),r=!!t.editing,s={sendActive:!i&&!r&&!o,loading:o,editAccept:r&&!i,editRemove:r&&i},l=n.templates&&!(r||!t.groupId||!i||s.loading||s.uploading);s.templates=l&&"templates"!==Object(W.getKeyboardType)(),s.templatesActive=l&&"templates"===Object(W.getKeyboardType)();var c=!(s.sendActive||s.loading||s.editAccept||s.editRemove||s.templates||s.templatesActive);s.disabled=c;var u=a.default.class("uMailWrite__button","uMailWrite__buttonSend",s);Object(j.$$)(".uMailWrite__buttonSend").forEach(function(e){return e.className=u})}}function Je(e){var t=a.default.class("uMailWrite__button","uMailWrite__buttonStickers",{active:e});Object(j.$$)(".uMailWrite__buttonStickers").forEach(function(e){return e.className=t})}function Ze(e){var t=a.default.class("uMailWrite__button","uMailWrite__buttonKeyboard",{active:e});Object(j.$$)(".uMailWrite__buttonKeyboard").forEach(function(e){return e.className=t})}function et(e){if(store.mail.cur){var t=store.mail.cur,n=t.ref,i=t.refSource,a=e.to;if(i&&(e.ref_source=i,e.ref=n,store.mail.refSource=void 0,store.mail.ref=void 0),J.send(e),a){var o=store.mail.peers[a];if(o&&o.keyboard&&o.keyboard.one_time)o.keyboard=null,Object(W.getKeyboardState)(a).updateTime=Date.now(),at()}Ke()}}function tt(e){e.stopPropagation(),alert(lang.mobile_mail_attachments_limit)}function nt(e){var t=document.createElement("textarea");t.innerHTML=e;var n=t.value,i=Object(j.$$)(".uMailWrite__textarea");i.forEach(function(e){return e.value=n}),$e({},i[0])}function it(){return function(){var e=store.mail,t=e.cur;e.peers;return!!t&&t.hasAttachments}()||!!Object(j.$)(".uMailWrite__textarea").value.trim()}function at(e){if(Object(j.$)(".uMailWrite__keyboard")){var t,n=store.mail,i=n.cur,o=n.peers,r=i.peerId&&o[i.peerId];t=!(i.groupId||!r||r.closed||r.kicked)&&!(!r.keyboard||!r.keyboard.buttons.length);var s=Object(j.$)(".uMailWrite"),l=a.default.parseClass("uMailWrite",s.className);if(l.keyboard!==t&&(s.className=a.default.class("uMailWrite",Object.assign({},l,{keyboard:t}))),Object(W.getKeyboardState)(i.peerId).rendered=!1,t){Z||(Z=lsGet("mail_keyboard_hidden")||{});var c=r.keyboard,u=Z[i.peerId],d=(e&&e.update,!Object(W.getKeyboardType)()||"buttons"===Object(W.getKeyboardType)()||"text"===Object(W.getKeyboardType)()),f=!1;u&&(u==c.chat_local_id?d=!1:f=!0),d?rt("buttons",{store:f}):f&&Me()}else je()}}function ot(){var e=store.mail,t=e.cur,n=e.peers,i=t.peerId&&n[t.peerId];if(t.groupId&&i&&!i.closed&&!i.kicked){var a=Object(j.$)(".uMailWrite__templatesBody"),o=t.templates;if(a)return o?void function(e,t){e.innerHTML=X(t)}(a,o):(function(e){e.innerHTML=Loading({mix:"uMailWrite__templatesLoading"})}(a),ee||(ee=new Promise(function(e){ajaxRequest("/mail",{act:"get_templates"},function(t){e(t)},function(t){e()})})),void ee.then(function(e){ee=null,store.mail&&store.mail.cur&&(store.mail.cur.templates=e),ot()}))}}function rt(e,t){switch(st(e),e){case"stickers":Ee();break;case"buttons":Ie(t);break;case"text":(n=Object(j.$)(".uMailWrite__textarea"))&&n.focus();break;case"templates":xe()}var n}function st(e){var t;"stickers"!==e&&Se(),"buttons"!==e&&je(),"text"!==e&&(t=Object(j.$)(".uMailWrite__textarea"))&&document.activeElement===t&&t.blur(),"templates"!==e&&Be()}function lt(e){var t=store.mail.cur.templates.find(function(t){return t.id===e});if(t){var n=lang.mobile_mail_templates_delete_popup_text;n=n.replace("{name}",Object(H.emojiToHTML)(t.name)),MailDialog.open({body:n,confirmText:lang.mobile_mail_delete_popup_delete,cancelText:lang.mobile_mail_delete_popup_cancel,onConfirm:a.default.onClick("uMailWrite._onConfirmDeleteTemplate",e)})}}function ct(e){var t=store.mail.cur.templates,n=t.findIndex(function(t){return t.id===e});if(-1!==n){var i=t[n],a=Object(j.$)(".uMailWrite__templatesRow"+i.id);i.deleting=!0,a.classList.add("uMailWrite__templatesRow_hidden"),ajaxRequest("/mail",{act:"delete_template",hash:store.mail.hash.templateDelete,id:e},function(n){if(n.error)ut(e);else{var i=t.findIndex(function(t){return t.id===e});t.splice(i,1),ot()}},function(){ut(e)})}MailDialog.close()}function ut(e){var t=store.mail.cur.templates,n=Object(j.$)(".uMailWrite__templatesRow"+e),i=t.findIndex(function(t){return t.id===e}),a=t[i];a.deleting=!1,n.classList.remove("uMailWrite__templatesRow_hidden");var o=lang.mobile_mail_templates_delete_error;o=o.replace("{name}",a.name),B.init({text:o,action:{text:lang.mobile_mail_templates_toast_action_ok,callback:function(e,t){var n=t.id;B.close(n)}}})}function dt(){x.default.clearSystemMessage2(),remove(geByClass1("message__newMsgsDivider")),remove(geByClass1("Unfold__item_returnToChat"))}function ft(){var e=store.mail,t=e.cur,n=e.presend,i=e.pendingReplies,a=[],o=n.failed[t.peerId]||[],r=n.pending[t.peerId]||[];(o.length||r.length)&&(o.concat(r).map(function(e){var t=n.msgs[e];if(t)if(0===t.sendId.indexOf("edit"))S.onMessage(t);else{if(t.reply){var o=f.default.getReplyDataFromHTML(t.reply);o&&(i[t.reply]=o)}a.push(t)}}),P.setMsgs(a))}function _t(e,t,n){var i;n?i=[Object(L.ModalMenuBtn)({inner:lang.mobile_mail_presend_menu_retry,onclick:["uMailWrite._onRetryFailedMsg","this",t]}),Object(L.ModalMenuBtn)({inner:lang.mobile_mail_presend_menu_delete,onclick:["uMailWrite._onDeleteFailedMsg","this",t]})]:i=[Object(L.ModalMenuBtn)({inner:lang.mobile_mail_presend_menu_cancel,onclick:["uMailWrite._onCancelPendingMsg","this",t]})];var a=Object(L.default)({class:"",close:!0,closeText:lang.mobile_mail_presend_menu_close,items:i});R.default.open(o.default.elem(a),!0)}function pt(e,t){L.default.close(e);var n=store.mail.presend.msgs[t];Object(W.removeFailedMsg)(n),J.retry(t,function(e){var t=store.mail.cur.peerId,n=store.mail.peers[t];return e.data.hash=n.hashSend,e})}function ht(e,t){L.default.close(e),J.remove(t)}function mt(e,t){L.default.close(e),J.remove(t)}function At(e){B.init({duration:0,text:e,action:{text:lang.mobile_mail_templates_toast_action_ok,callback:function(e,t){var n=t.id;B.close(n)}}})}t.default=S;window.uMailWrite=S},HdGT:function(e,t,n){"use strict";n.r(t);var i=n("W38l"),a=n("OcsD"),o={},r={},s="idle",l="sending";function c(e,t){var n=o[e];delete n.items[t];var i=n.pending.indexOf(t),a=n.failed.indexOf(t);-1!==i&&n.pending.splice(i,1),-1!==a&&n.failed.splice(a,1),_(e)}function u(e){var t=o[e];t.failed=t.failed.concat(t.pending),t.pending=[],r[e]=s,t.sendingItemId=null,t.onStopped(),_(e)}function d(e){var t=o[e];return t.loaded?Promise.resolve():t.retrieving?t.retrieving:(t.retrieving=function(e){return new Promise(function(t){var n=Object(a.lsGet)("q_"+e)||{items:{},pending:[],failed:[]};n.failed=n.failed.concat(n.pending).filter(function(e){return!!n.items[e]}),n.pending=[],t(n)})}(e).then(function(t){var n=t.pending,i=t.failed,a=t.items,r=o[e];r.retrieving=null,r.loaded=!0,r.pending=n,r.failed=i,r.items=a}),t.retrieving)}function f(e,t){if(!1!==navigator.onLine){var n=o[e];if(r[e]!==l&&n.pending.length&&!n.backoffTimer){var i=n.pending[0],a=n.items[i];if(!a.fails||t)r[e]=l,n.sendingItemId=i,n.onSend(a.id,a.data);else{var s=Math.pow(2,Math.max(a.fails-2,0));n.backoffTimer=setTimeout(function(){n.backoffTimer=null,f(e,!0)},1e3*s)}}}}function _(e){var t=o[e],n=t.pending,i=t.failed,r=t.items;Object(a.lsSet)("q_"+e,{pending:n,failed:i,items:r})}window.addEventListener("online",function(){Object.keys(o).forEach(function(e){f(e)})});var p=n("qHA9"),h=n("+cqQ"),m=n("j80l");n.d(t,"onStopped",function(){return g}),n.d(t,"onSent",function(){return b}),n.d(t,"onFailed",function(){return y}),n.d(t,"onCaptcha",function(){return w}),n.d(t,"onErrorMessage",function(){return C}),n.d(t,"onMessage",function(){return k}),n.d(t,"onMessageRemove",function(){return S}),n.d(t,"QUEUE_MAX_FAILS",function(){return E}),n.d(t,"QUEUE_NAME",function(){return O}),n.d(t,"ready",function(){return T}),n.d(t,"getItems",function(){return D}),n.d(t,"send",function(){return j}),n.d(t,"retry",function(){return I}),n.d(t,"remove",function(){return M});var A,v,g=Object(h.default)(),b=Object(h.default)(),y=Object(h.default)(),w=Object(h.default)(),C=Object(h.default)(),k=Object(h.default)(),S=Object(h.default)(),E=5,O="mail_send";function T(){return d(O)}function D(){return{pending:(e=o[O]).pending,failed:e.failed,items:e.items};var e}function j(e){T().then(function(){var t;i.logQueueSize((t=o[O])?t.pending.length:0);var n=Object(p.sendDataToMessage)(e);!function(e,t,n){var i={id:t,data:n,fails:0},a=o[e];c(e,t),a.items[t]=i,a.pending.push(t),f(e),_(e)}(O,n.sendId,{data:e}),k(n)})}function I(e,t){var n,i=(n=e,o[O].items[n]||null);t&&(i.data=t(i.data)),c(O,e),j(i.data.data)}function M(e,t){c(O,e),"silent"!==t&&S(e)}v={onSend:function(e,t){!function(e,t){e=Object.assign({},e);var n="/mail",a="edit_message"===e.act;a?Object.keys(e).forEach(function(t){"attached_messages"!==t&&"has_reply"!==t||delete e[t]}):(n=Object(m.makeUrl)("/mail",{act:"send",to:e.to,from:e.from,hash:e.hash,_af:e._af,ref:e.ref||"",ref_source:e.ref_source||""}),Object.keys(e).forEach(function(t){"act"!==t&&"to"!==t&&"from"!==t&&"hash"!==t&&"_af"!==t||delete e[t]})),i.log(t,a?"edit":"send");var l=function(e){var n,l,c;i.mark(t,"server"),a&&!e.was_modified&&S(t),b(),l=o[n=O],(c=l.sendingItemId)&&(l.pending[0]===c&&l.pending.shift(),delete l.items[c]),r[n]=s,l.sendingItemId=null,f(n),_(n)};Object(p.mailRequest)(n,e).then(l,function e(n){var a=n.type,c=n.code,d=n.message,_=n.data;if(i.error(t,"server_send",a),"captcha"!==a&&i.clean(t),"server"===a&&c&&c!==p.UNKNOWN_ERROR)return d&&C(d),void u(O);"captcha"!==a?(function(e){var t=o[e],n=t.sendingItemId;if(n&&t.pending[0]===n){var i=t.items[n];if(i&&(i.fails+=1,i.fails>=t.maxFails))return void u(e)}r[e]=s,t.sendingItemId=null,f(e)}(O),y()):w(_,function(n){if(!n)return i.clean(t),void u(O);n.then(l,e)})})}(t.data,e)},onStopped:g,maxFails:E},o[A=O]={pending:[],failed:[],items:{},onSend:v.onSend,onStopped:v.onStopped,maxFails:0|v.maxFails,loaded:!1,sendingItemId:null,backoffTimer:null},r[A]=s},I2ZF:function(e,t){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);e.exports=function(e,t){var i=t||0,a=n;return[a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],"-",a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]],a[e[i++]]].join("")}},JuPy:function(e,t,n){"use strict";function i(){return!!window.isMVK}n.r(t),n.d(t,"isMvk",function(){return i})},KMpi:function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("Mc5h"),o=function(e){var t,n,o=e.photos||[e.photo],l=(o=Array.isArray(o)?o:[o]).length,c="";if(l>1)for(var u=0;u<l;u++)c+=r(o[u],u);n=40===e.size?"m":36===e.size?"s":e.size?e.size:"xl";return Object(a.default)({mix:i.default.class(e.mix,"Avatar",(t={},t[l]=!0,t.size=n,t)),url:e.url,attrs:1===l?s(o[0]):"",inner:c})};function r(e,t){var n;return Object(a.default)({mix:i.default.class("Avatar__image",(n={},n[t]=!0,n)),attrs:s(e)})}function s(e){return i.default.attr("style","background-image: url('"+e+"')")}t.default=o;window.Avatar=o},L9Nh:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"QueueManager",function(){return QueueManager});var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("wx14"),_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("OcsD"),QUEUE_CREATION_TIME_INDEX=0,QUEUE_TIMESTAMP_INDEX=1,QUEUE_KEY_INDEX=2,QUEUE_CALLBACK_INDEX=3,INCORRECT_KEY_OR_TIMESTAMP_ERROR_CODE=2,KEY_IS_BLOCKED_BY_ANOTHER_REQUEST_ERROR_CODE=4,TRANSPORT_FRAME_ID="queue_transport_frame",QueueManager=function(){function QueueManager(){}return QueueManager.addQueue=function(e,t){QueueManager.queues[e.key]=[vkNow(),e.ts,e.key,t]},QueueManager.start=function(){QueueManager.started||(QueueManager.createFrame(QueueManager.check),QueueManager.started=!0)},QueueManager.check=function check(){var _this=this,params={act:"a_check",ts:curNotifier.timestamp,key:curNotifier.key,id:curNotifier.uid,wait:25},addQueues=[],now=vkNow();Object.keys(QueueManager.queues).forEach(function(e){var t=QueueManager.queues[e],n=t[QUEUE_CREATION_TIME_INDEX],i=t[QUEUE_TIMESTAMP_INDEX];now-n>3e4&&!e.match(/nccts/)?delete QueueManager.queues[t]:(params.ts+="_"+i,params.key+=e,addQueues.push(e))}),curNotifier.lpMakeRequest(curNotifier.frame_url,params,function(text){try{var response=eval("("+text+")"),main_response=response,addResponse,addQueue,busy=0;if(isArray(response))for(main_response=response.shift(),curNotifier.timestamp=main_response.ts;(addResponse=response.shift())&&(addQueue=addQueues.shift(),addQueue);)addResponse.failed!==INCORRECT_KEY_OR_TIMESTAMP_ERROR_CODE||addResponse.err!==KEY_IS_BLOCKED_BY_ANOTHER_REQUEST_ERROR_CODE?addResponse.failed?delete QueueManager.queues[addQueue]:QueueManager.callQueue(addQueue,addResponse):busy|=1;else if(response.failed)for(;addQueue=addQueues.shift();)delete QueueManager.queues[addQueue];busy||(clearTimeout(curNotifier.lpCheckTO),curNotifier.lpCheckTO=setTimeout(QueueManager.check.bind(_this),curNotifier.request_timeout||1e3),curNotifier.error_timeout=Math.max(1,(curNotifier.error_timeout||1)/1.5))}catch(e){curNotifier.error_timeout=curNotifier.error_timeout||1,clearTimeout(curNotifier.lp_error_to),curNotifier.lp_error_to=setTimeout(QueueManager.check.bind(_this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2)}},function(){return!0})},QueueManager.init=function(e){window.curNotifier=Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.default)({},e),QueueManager.initialized=!0,delete curNotifier.makeRequest},QueueManager.createFrame=function(e){re(TRANSPORT_FRAME_ID),Object(_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_1__.createIframe)({id:TRANSPORT_FRAME_ID,name:TRANSPORT_FRAME_ID,src:window.curNotifier.frame_path});var t=setInterval(function(){curNotifier.lpMakeRequest&&(clearInterval(t),e())},500);setTimeout(function(){return clearInterval(t)},1e4)},QueueManager.callQueue=function(e,t){var n=QueueManager.queues[e];if(Array.isArray(n)&&n.length){n[QUEUE_TIMESTAMP_INDEX]=t.ts;var i=n[QUEUE_CALLBACK_INDEX];isFunction(i)&&i(n[QUEUE_KEY_INDEX],t)}},QueueManager}();QueueManager.queues={},QueueManager.started=!1,QueueManager.initialized=!1,window.QueueManager=QueueManager},LTt1:function(e,t){var n=need("page"),i=need("audio"),a=need("onDOMReady"),o=need("audioplayer"),r=need("AudioSpecialForYou");function s(){c(),i.subscribe([i.events.INIT,i.events.SELECT,i.events.PAUSE],c),n.onChange(c)}function l(e){var t=e.$btn;u()?o.playPause():o.playFirst(null,t),c()}function c(){r.setPlaying(i.playing()&&u())}function u(){var e=i.getCurrentPlaylistId(),t=document.querySelector(window.AudioSpecialForYou.selector);return!!t&&e===t.querySelector(".AudioPlaylistRoot").dataset.playlistId}window.uAudioBlock={},a(s),uAudioBlock._onSpecialPlayAllClick=l},M2vk:function(e,t,n){"use strict";n.r(t);var i=n("rKUZ"),a=n("7jQU"),o=function(){return Object(i.default)(r())};function r(){var e,t,n=store.mail.cur.peerId,i=Object(a.uTyping_getPeerTyping)(n);return i&&("mixed"===i.type?(e="dots",t="mixed"):"audio"===i.type?(e="audio",t="audio"):"text"===i.type&&(e="dots",t="")),{id:"curConvo",typing:Object(a.uTyping_getNames)(i),typingCount:i?i.count:0,dimmed:!0,animation:e,text:t}}Object.assign(o,{redraw:function(){if(!store.mail.cur.peerId)return;var e=i.default.getElem("curConvo"),t=r();q.parseClass("typing",e.className).animation===t.animation?i.default.setTyping(e,t):e.outerHTML=Object(i.default)(t)}});t.default=o;window.uCurConvoTyping=o},Mc5h:function(e,t,n){"use strict";n.r(t);var i=n("2IoG");t.default=i.default,window.Brick=i.default},MzAf:function(e,t){function n(e){return function(t){t.$control.closest(a.sms).classList.toggle(o[e])}}function i(e,t){var n=t.$select,i=t.value;n.closest(a.sms).classList.toggle(o.pmUsersVisible,e.includes(i)||e.includes(Number(i)))}window.SettingsSms={},SettingsSms._onEnabledChange=n("enabled"),SettingsSms._onTimeLimitedChange=n("timeLimited"),SettingsSms._onFrequencyChange=i;var a={sms:".settingsSms"},o={enabled:"settingsSms_enabled",timeLimited:"settingsSms_timeLimited",pmUsersVisible:"settingsSms_pmUsersVisible"}},NBPr:function(e,t){window.closePostSuggest=function(e,t){return re(geByClass1("post_suggest")),ajax.post("wall.php",{_ajax:1,act:"close_suggest_post",suggest_id:e.getAttribute("data-suggest-id")}),cancelEvent(t)}},O5lf:function(e,t,n){"use strict";n.r(t);var i=n("9y81"),a=function(e){var t=e?e.mix:"";return Object(i.default)({mix:t+" Spinner",icon:"spinner"})};t.default=a;window.Spinner=a},OGWK:function(e,t){window.SubscribeBtn={onClick:function(e,t,u,d,f,_){try{var p=_+n,h=_+o,m=_+i,A=_+a,v=hasClass(e,p),g=v?d:u,b=v?getLang(s):getLang(r),y=!v,w=geByClass1(h,e),C=function(e){var t=intval(domData(e,"block-id"));if(!t){var n=domCA(e,c);t=intval(domData(n,"block-id"))||null}return t}(e),k=domData(e,"from")||null;w&&(toggleClass(m,w,y),toggleClass(A,w,!y)),attr(e,"aria-label",escapeAttr(b)),toggleClass(p,e,y),f===l?function(e,t,n,i){(n?Groups.leave:Groups.enter).call(Groups,e,t,i)}(t,g,v):function(e,t,n,i,a){(n?Friends.decline:Friends.accept).call(Friends,e,t,i,a)}(t,g,v,k,C)}catch(e){console.trace(e)}return!1}};var n="_unsubscribe",i="Icon_unsubscribe",a="Icon_subscribe",o="Icon",r="mobile_groups_you_are_in_public",s="mobile_groups_public_subscribe",l="group",c=".feedAssistance"},"Po+v":function(e,t,n){"use strict";n.r(t),t.default=function(e){void 0===e&&(e={});var t=[];if(e.on_overlay_click_native)t=e.on_overlay_click_native;else{var n=!0;"boolean"==typeof e.hide_on_overlay_click&&(n=e.hide_on_overlay_click),t=["Popup._onOverlayClick","this",e.on_overlay_click||null,n]}return{id:e.id,class:[e.mix?e.mix:e.class,Bem.class("Popup",{open:e.open,scrollable:e.scrollable})],ontouchmove:["Popup._onTouchMove","event"],inner:[e.rel?e.rel:null,{class:"Popup__overlay",onclick:t},{class:"Popup__wrap",inner:{tag:"div",class:"Popup__content","aria-modal":"true",inner:[e.header?{class:"Popup__header",inner:[e.header.title?{class:"Popup__headerTitle",inner:e.header.title}:null,e.header.corner?{class:["Popup__headerCorner",e.header.corner.class],inner:e.header.corner.text,href:e.header.corner.url,onclick:e.header.corner.onclick,attrs:e.header.corner.attrs}:null]}:null,e.scrollable?{class:"Popup__scroll ScrollView",inner:{class:"Popup__scrollContent",inner:e.content}}:e.content,e.footer?{class:"Popup__footer",inner:e.footer}:null]}}]}}},PovR:function(e,t,n){"use strict";n.r(t),n.d(t,"SECOND",function(){return i}),n.d(t,"MINUTE",function(){return a}),n.d(t,"HOUR",function(){return o}),n.d(t,"DAY",function(){return r}),n.d(t,"PUSH_NOTIFIER_PERMISSION_GRANTED",function(){return s}),n.d(t,"PUSH_NOTIFIER_PERMISSION_DEFAULT",function(){return l}),n.d(t,"PUSH_NOTIFIER_PERMISSION_DENIED",function(){return c});var i=1e3,a=60*i,o=60*a,r=24*o,s="granted",l="default",c="denied"},QBkA:function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("9y81"),o=n("fdw3"),r=function(e){var t=window.lang,n=Object(o.isNewNavigation)(),r=e.query;return Wd.html({class:[Bem.class("mailFilter",{hasQuery:!!r}),e.mix],inner:[Wd.wrap(Object(a.default)({icon:"search"})),{class:"mailFilter__input",tag:"input",placeholder:t.mobile_search,value:r,oninput:["MailFilter._onInput","this"],attrs:i.default.onFocus("MailFilter._onFocus")},{class:"mailFilter__right",inner:[n?null:Wd.wrap(Object(a.default)({mix:"mailFilter__create",icon:"plus",url:e.createUrl})),Wd.wrap(Object(a.default)({mix:"mailFilter__clear",icon:"close12",attrs:i.default.onMouseDown("MailFilter._onClearMouseDown","this")}))]}]})};var s=n("UxAg"),l=n("+cqQ"),c=n("jk6M"),u=n("aiw/");function d(e){requestAnimationFrame(function(){var t=e.value;p(e.value),r.onChange(t)})}function f(){u.onOpen("top")}function _(e){var t=e.closest(".mailFilter").$(".mailFilter__input"),n=document.activeElement===t;(c.default.ios?setTimeout:requestAnimationFrame)(function(){p(""),t.value="",n&&t.focus(),r.onClear(),r.onChange("")})}function p(e){Object(s.$$)(".mailFilter").forEach(function(t){return t.classList.toggle("mailFilter_hasQuery",!!e)})}Object.assign(r,{onChange:Object(l.default)("query"),onClear:Object(l.default)(),setQuery:function(e){var t=Object(s.$)(".mailFilter__input");t&&t.value!==e&&(t.value=e,r.onChange(e),p(e))},setQuerySilently:function(e){var t=Object(s.$)(".mailFilter__input");t&&t.value!==e&&(t.value=e,p(e))}}),r._onInput=d,r._onClearMouseDown=_,r._onFocus=f;t.default=r;window.MailFilter=r},QMH7:function(e,t,n){"use strict";n.r(t),n.d(t,"healScroll",function(){return c}),n.d(t,"unhealScroll",function(){return u});var i=n("UxAg"),a=n("Qz23");n("H5mD").isIOS&&window.MutationObserver&&document.addEventListener("DOMContentLoaded",s);var o={scrollView:".ScrollView"},r="_scrollViewHealed";function s(){(l(),document.body)&&new MutationObserver(l).observe(document.body,{childList:!0,subtree:!0})}function l(){Object(i.$$)(o.scrollView).forEach(c)}function c(e){if(!e[r]){e[r]={};var t=getComputedStyle(e),n=parseInt(t.paddingTop,10),i=parseInt(t.paddingBottom,10);e.style.paddingTop=n+1+"px",e.style.paddingBottom=i+1+"px",d(e),Object(a.setScrollView)(e,{override:!1}),hasClass("messenger__body",e)||addEvent(e,"scroll",_),addEvent(e,"scroll",f)}}function u(e){e[r]&&(e[r]=null,e.style.paddingTop="",e.style.paddingBottom="",Object(a.cleanScrollView)(e),removeEvent(e,"scroll",_),removeEvent(e,"scroll",f))}function d(e){var t=e.scrollTop;t<0||(0===t?e.scrollTop+=1:t+e.offsetHeight===e.scrollHeight&&(e.scrollTop-=1))}function f(e){var t=e.target,n=t[r];n&&(n.timer&&clearTimeout(n.timer),n.timer=setTimeout(function(){t[r]&&d(t)},50))}function _(){onBodyScroll(!0)}},QQoL:function(e,t,n){"use strict";n.r(t);var i=n("TYsd"),a=n("z9sQ"),o=n("9y81"),r=function(e){var t=window.lang,n=e.count;return i.default.html({class:[a.default.class("Bell",{empty:!n}),"al_menu"],href:e.url,onclick:e.onclick,"aria-label":t.mobile_notifications_title,"data-header":t.mobile_notifications_title,"data-skiponclick":1,inner:[i.default.html(Object(o.default)({mix:"Bell__icon",icon:"bell"})),{class:"Bell__counter",inner:n,tag:"em"}]})};var s=n("UxAg");Object.assign(r,{setCount:function(e){Object(s.$$)(c.bell).forEach(function(t){var n=t.$(c.counter);t.classList.toggle(l.empty,!e),n.innerText=e})}});var l={empty:"Bell_empty"},c={bell:".Bell",counter:".Bell__counter"};t.default=r;window.Bell=r},Qg0H:function(e,t,n){"use strict";n.r(t);var i=n("UxAg"),a=n("TYsd"),o=n("+cqQ");window.Voting={cls:"Voting",setLoading:f,setHtml:function(e,t){c(e).forEach(function(e){e.outerHTML=t}),c(e).forEach(function(e){e.classList.add(s.beforeAnimation)}),setTimeout(function(){c(e).forEach(function(e){e.classList.remove(s.beforeAnimation),Voting.onHtmlUpdate(e)})},30)},getVotingsById:c,onHtmlUpdate:Object(o.default)("$voting")},Voting._onSubmit=_,Voting._onSingleAnswerClick=d,Voting._onCheckboxClick=u,Voting._onRevoteClick=p;var r="_Voting_singleAnswerAction",s={loading:"Voting_loading",beforeAnimation:"Voting_beforeAnimation",hasCheckedOptions:"Voting_hasCheckedOptions"},l={voting:".Voting",votingById:function(e){return'.Voting[data-id="'+e+'"]'},optionControl:".Voting__optionControl",submit:".Voting__submit"};function c(e){return Object(i.$$)(l.votingById(e))}function u(e){var t=e.closest(l.voting),n=Array.from(Object(i.$$)(l.optionControl)).some(function(e){return e.checked});t.classList.toggle(s.hasCheckedOptions,n)}function d(e){var t=e.name,n=e.value,i=e.closest("form"),a=i.getAttribute("action");i[r]=a+"&"+t+"="+encodeURIComponent(n)}function f(e){e.classList.add(s.loading)}function _(e,t,n){var i;if(e.preventDefault(),t[r])i=t[r],f(t);else{var o=Array.from(t.$$("input:checked"));if(0===o.length)return;var s=o[0].name,l=o.map(function(e){return e.value}).join(","),c=t.getAttribute("action"),u=c.includes("?")?"&":"?";f(t),i=""+c+u+s+"="+l+"&is_board="+t.$('input[name="is_board"]').value}a.default.handle(n,{$voting:t,url:i})}function p(e,t){var n=e.closest(l.voting);a.default.handle(t,{$voting:n})}},Qz23:function(e,t,n){"use strict";n.r(t),n.d(t,"init",function(){return g}),n.d(t,"preventDocumentScroll",function(){return b}),n.d(t,"restoreDocumentScroll",function(){return y}),n.d(t,"cleanDocumentViews",function(){return w}),n.d(t,"allowScrolling",function(){return C}),n.d(t,"setScrollView",function(){return E}),n.d(t,"cleanScrollView",function(){return O}),n.d(t,"hideTopBanner",function(){return H}),n.d(t,"showTopBanner",function(){return U});var i,a,o,r,s,l,c,u=n("UxAg"),d=n("aiw/"),f=n("H5mD"),_=".layout",p=!0,h=!1,m="closed",A=!1,v=[];function g(e){A&&w(),b(e)}function b(e){void 0===e&&(e={}),f.isIOS&&(!0!==e.stack&&A||(c={initialized:!1,scrollViews:[]},v.push(c),e.layoutElement&&e.layoutElement.nodeType?c.layoutElement=e.layoutElement:c.layoutElement=Object(u.$)(e.layoutElement||_)),!1===e.topBanner?c.topBanner=!1:c.topBanner=!0,A||(A=!0,addEvent(window,"focusin",L),addEvent(window,"focusout",R),addEvent(document,"touchmove",x,{capture:!0}),addEvent(document,"touchmove",B,{capture:!1}),addEvent(window,"resize",D),d.onCloseCallback(N),f.isWKWebView||(addEvent(window,"orientationchange",j),requestAnimationFrame(function(){Object(f.isLandscapePhone)()?j(null,!0):(D(),c&&!c.topBanner?requestAnimationFrame(H):o||requestAnimationFrame(U))}))))}function y(){A&&(A=!1,w(),1===v.length&&(c.layoutOffset=null,V(),document.body.style.height=""),c.layoutElement=null,v.pop(),(c=v.length?v[v.length-1]:null)&&V(),removeEvent(window,"focusin",L),removeEvent(window,"focusout",R),removeEvent(document,"touchmove",x,{capture:!0}),removeEvent(document,"touchmove",B,{capture:!1}),removeEvent(window,"resize",D),removeEvent(window,"orientationchange",j),removeEvent(window,"resize",I),removeEvent(window,"scroll",M),d.offCloseCallback(N))}function w(){c.scrollViews.forEach(function(e){return O(e)}),c.scrollViews=[]}function C(e){var t=e.currentTarget.__ScrollView;if("prevented"!==t.state){if(!("start"!==t.state||t.allowX&&t.allowY)){var n=Math.abs(t.startX-e.changedTouches[0].clientX),i=Math.abs(t.startY-e.changedTouches[0].clientY);if(!t.allowX&&n>i)return void(t.state="prevented");if(!t.allowY&&i>n)return void(t.state="prevented")}if("allowed"!==t.state&&(t.state="allowed"),p=!1,!t.overscrollX){var a=e.currentTarget.scrollLeft,o=t.startX-e.changedTouches[0].clientX;(a<=0&&o<=0||a>=t.maxX&&o>=0)&&(p=!0,t.standalone&&e.preventDefault())}if(!t.overscrollY){var r=e.currentTarget.scrollTop,s=t.startY-e.changedTouches[0].clientY;(r<=0&&s<=0||r>=t.maxY&&s>=0)&&(p=!0,t.standalone&&e.preventDefault())}}}function k(e){var t=e.currentTarget,n=t.__ScrollView;n.state="start",n.startX=e.changedTouches[0].clientX,n.startY=e.changedTouches[0].clientY,n.maxX=n.overscrollX?null:t.scrollWidth-t.clientWidth,n.maxY=n.overscrollY?null:t.scrollHeight-t.clientHeight}function S(e){e.currentTarget.__ScrollView.state=""}function E(e,t){if(void 0===t&&(t={}),f.isIOS&&(!1!==t.override||!e.__ScrollView)){if(!0!==t.standalone){if(!A)return;e.__ScrollView||c.scrollViews.push(e)}e.__ScrollView={allowX:!1!==t.allowX,allowY:!1!==t.allowY,overscrollX:!1!==t.overscrollX,overscrollY:!1!==t.overscrollY,standalone:!0===t.standalone},c&&(f.isWKWebView||(!1!==t.topBanner&&(e.__ScrollView.topBanner=t.topBanner||{hide:30,show:60}),addEvent(e,"scroll",T))),addEvent(e,"touchstart",k),addEvent(e,"touchmove",C),addEvent(e,"touchend",S)}}function O(e){e.__ScrollView=null,removeEvent(e,"touchstart",k),removeEvent(e,"touchmove",C),removeEvent(e,"touchend",S),removeEvent(e,"scroll",T)}function T(e){if("closed"!==m||Object(f.isLandscapePhone)())return h=!1,void(r&&clearTimeout(r));h=!0;var t=e.target.__ScrollView.topBanner;c&&c.topBanner&&t?F(e.target,t.show,t.hide):F(e.target,1/0,0),r&&clearTimeout(r),r=setTimeout(function(){h=!1,D()},100)}function D(){if(!h)if(l)l=!1;else if(!Object(f.isLandscapePhone)()){window.pageYOffset;"closed"===m&&(f.isWKWebView||(i=document.documentElement.offsetHeight,a=innerHeight,o=i===a,"show"===s?(s=null,requestAnimationFrame(U)):"hide"===s&&(s=null,requestAnimationFrame(H))))}}function j(e,t){f.isIPad?c.topBanner||setTimeout(function(){H()},400):90===Math.abs(window.orientation)?(addEvent(window,"resize",I),document.body.style.height="",c.layoutHeight=null,t?setTimeout(function(){window.scrollTo(0,-300),I()}):setTimeout(function(){window.scrollTo(0,-300)},400)):(removeEvent(window,"resize",I),c.layoutOffset=null,V(),c.topBanner||setTimeout(function(){H()},400))}function I(){if("closed"===m){var e=document.body.offsetHeight,t=e-innerHeight;c.layoutOffset=t,V(),window.scrollTo(0,e)}}function M(){pageYOffset&&(m="opened",removeEvent(window,"scroll",M))}function x(e){p=!0}function B(e){p&&e.preventDefault()}function P(e){var t=e&&e.target,n=0===e.eventPhase&&t.getAttribute("autofocus"),i=!1;return"textarea"!==t.tagName.toLowerCase()||n||(i=!0),"input"!==t.tagName.toLowerCase()||["checkbox","radio","image","submit"].includes(t.type)||n||(i=!0),"select"===t.tagName.toLowerCase()&&(i=!0),i}function L(e){if(P(e)){var t,n=e&&e.target;m="opening",addEvent(window,"scroll",M),window.isCustomScroll&&(t=n.dataset.scrollviewposition),d.onOpen(t,{exitIfStarted:!0})}}function R(e){P(e)&&d.onClose({exitIfStarted:!0})}function N(){removeEvent(window,"scroll",M),m="closed",setTimeout(function(){Object(f.isLandscapePhone)()?I():D()},100)}function F(e,t,n){var i=e.scrollTop;i<=-t&&(o||s)?(s="show",window.scrollTo(0,-10)):i>=n&&(!o||s)&&(s="hide",window.scrollTo(0,10))}function H(){window.scrollTo(0,300)}function U(){window.scrollTo(0,-300)}function V(){var e=c.layoutOffset;c.layoutElement.style.top=e?e+"px":""}},"S6+Z":function(e,t,n){"use strict";n.r(t),n.d(t,"emojiRegex",function(){return i}),n.d(t,"skinToneModifierRegex",function(){return a}),n.d(t,"EMOJI_PREFIXED_REPLACES",function(){return o}),n.d(t,"EMOJI_REPLACES",function(){return r}),n.d(t,"EMOJI_HINTS",function(){return s});var i=function(){return/(?:\uD83C\uDFF4)(?:(?:\uDB40\uDC67)(?:\uDB40\uDC62)(?:(?:\uDB40\uDC65)(?:\uDB40\uDC6E)(?:\uDB40\uDC67)|(?:\uDB40\uDC77)(?:\uDB40\uDC6C)(?:\uDB40\uDC73)|(?:\uDB40\uDC73)(?:\uDB40\uDC63)(?:\uDB40\uDC74))(?:\uDB40\uDC7F)|\u200D\u2620\uFE0F?)|(?:\uD83D\uDC69)\u200D(?:\uD83D\uDC69)\u200D(?:(?:\uD83D\uDC66)\u200D(?:\uD83D\uDC66)|(?:\uD83D\uDC67)\u200D(?:\uD83D[\uDC66\uDC67]))|(?:\uD83D\uDC68)(?:\u200D(?:\u2764\uFE0F?\u200D(?:(?:\uD83D\uDC8B)\u200D)?(?:\uD83D\uDC68)|(?:\uD83D[\uDC68\uDC69])\u200D(?:(?:\uD83D\uDC66)\u200D(?:\uD83D\uDC66)|(?:\uD83D\uDC67)\u200D(?:\uD83D[\uDC66\uDC67]))|(?:\uD83D\uDC66)\u200D(?:\uD83D\uDC66)|(?:\uD83D\uDC67)\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3]))|(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3]))|(?:\uD83D\uDC69)\u200D(?:\u2764\uFE0F?\u200D(?:(?:\uD83D\uDC8B)\u200D(?:\uD83D[\uDC68\uDC69])|(?:\uD83D[\uDC68\uDC69]))|(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3]))|(?:\uD83D\uDC69)\u200D(?:\uD83D\uDC66)\u200D(?:\uD83D\uDC66)|(?:(?:\uD83D\uDC41)\uFE0F?\u200D(?:\uD83D\uDDE8)|(?:\uD83D\uDC69)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|(?:\uD83D\uDC68)(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|(?:(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)\uFE0F?|(?:\uD83D\uDC6F|\uD83E[\uDD3C\uDDDE\uDDDF]))\u200D[\u2640\u2642]|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDD6-\uDDDD])(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|\u200D[\u2640\u2642])|(?:\uD83D\uDC69)\u200D[\u2695\u2696\u2708])\uFE0F?|(?:\uD83D\uDC69)\u200D(?:\uD83D\uDC67)\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D\uDC69)\u200D(?:\uD83D\uDC69)\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D\uDC68)(?:\u200D(?:(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D[\uDC66\uDC67]))|(?:\uD83C[\uDFFB-\uDFFF]))|(?:\uD83C\uDFF3)\uFE0F?\u200D(?:\uD83C\uDF08)|(?:\uD83D\uDC69)\u200D(?:\uD83D\uDC67)|(?:\uD83D\uDC69)(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDB0-\uDDB3])|(?:\uD83D\uDC69)\u200D(?:\uD83D\uDC66)|(?:\uD83C\uDDF6)(?:\uD83C\uDDE6)|(?:\uD83C\uDDFD)(?:\uD83C\uDDF0)|(?:\uD83C\uDDF4)(?:\uD83C\uDDF2)|(?:\uD83D\uDC69)(?:\uD83C[\uDFFB-\uDFFF])|(?:\uD83C\uDDED)(?:\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA])|(?:\uD83C\uDDEC)(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE])|(?:\uD83C\uDDEA)(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA])|(?:\uD83C\uDDE8)(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF])|(?:\uD83C\uDDF2)(?:\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF])|(?:\uD83C\uDDF3)(?:\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF])|(?:\uD83C\uDDFC)(?:\uD83C[\uDDEB\uDDF8])|(?:\uD83C\uDDFA)(?:\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF])|(?:\uD83C\uDDF0)(?:\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF])|(?:\uD83C\uDDEF)(?:\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5])|(?:\uD83C\uDDF8)(?:\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF])|(?:\uD83C\uDDEE)(?:\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9])|(?:\uD83C\uDDFF)(?:\uD83C[\uDDE6\uDDF2\uDDFC])|(?:\uD83C\uDDEB)(?:\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7])|(?:\uD83C\uDDF5)(?:\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE])|(?:\uD83C\uDDE9)(?:\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF])|(?:\uD83C\uDDF9)(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF])|(?:\uD83C\uDDE7)(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF])|[#\*0-9]\uFE0F?\u20E3|(?:\uD83C\uDDF1)(?:\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE])|(?:\uD83C\uDDE6)(?:\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF])|(?:\uD83C\uDDF7)(?:\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC])|(?:\uD83C\uDDFB)(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA])|(?:\uD83C\uDDFE)(?:\uD83C[\uDDEA\uDDF9])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u270A-\u270D]|\uD83C[\uDF85\uDFC2\uDFC7]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC70\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDCAA\uDD74\uDD7A\uDD90\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1F\uDD30-\uDD36\uDDB5\uDDB6\uDDD1-\uDDD5])(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDEEB\uDEEC\uDEF4-\uDEF9]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD70\uDD73-\uDD76\uDD7A\uDD7C-\uDDA2\uDDB0-\uDDB9\uDDC0-\uDDC2\uDDD0-\uDDFF])|(?:[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEF9]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD70\uDD73-\uDD76\uDD7A\uDD7C-\uDDA2\uDDB0-\uDDB9\uDDC0-\uDDC2\uDDD0-\uDDFF])\uFE0F?|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC69\uDC6E\uDC70-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD26\uDD30-\uDD39\uDD3D\uDD3E\uDDB5\uDDB6\uDDB8\uDDB9\uDDD1-\uDDDD])/g},a=/\uFE0F?\uD83C[\uDFFB-\uDFFF]/,o={e29da4:/(\s|^)([0O]:\))([\s\.,]|$)/g,f09f9887:/(\s|^)(;-\)+)([\s\.,]|$)/g,f09f9889:/(\s|^)([Xx]-?D)([\s\.,]|$)/g,f09f9886:/(\s|^)(B-\))([\s\.,]|$)/g,f09f988e:/(\s|^)(3-\))([\s\.,]|$)/g,f09f988c:/(\s|^)(&gt;\()([\s\.,]|$)/g,f09f98a0:/(\s|^)(;[oO])([\s\.,]|$)/g,f09f98b0:/(\s|^)(8\|)([\s\.,]|$)/g,f09f98b3:/(\s|^)(8-?[oO])([\s\.,]|$)/g,f09f98b2:/(\s|^)(8-\))([\s\.,]|$)/g,f09f988d:/(\s|^)(:[X])([\s\.,]|$)/g,f09f98b7:/(\s|^)(:[oO])([\s\.,]|$)/g,f09f98a8:/(\s|^)(&lt;3)([\s\.,]|$)/g},r={f09f988a:/(:-\))([\s\.,]|$)/g,f09f9883:/(:-D)([\s\.,]|$)/g,f09f989c:/(;-[P])([\s\.,]|$)/g,f09f988b:/(:-[p])([\s\.,]|$)/g,f09f9892:/(:-\()([\s\.,]|$)/g,e298ba:/(:-?\])([\s\.,]|$)/g,f09f988f:/(;-\])([\s\.,]|$)/g,f09f9894:/(3-?\()([\s\.,]|$)/g,f09f98a2:/(:&#039;\()([\s\.,]|$)/g,f09f98ad:/(:_\()([\s\.,]|$)/g,f09f98a9:/(:\(\()([\s\.,]|$)/g,f09f9890:/(:\|)([\s\.,]|$)/g,f09f98a1:/(&gt;\(\()([\s\.,]|$)/g,f09f989a:/(:-\*)([\s\.,]|$)/g,f09f9888:/(\}:\))([\s\.,]|$)/g,f09f918d:/(:like:)([\s\.,]|$)/g,f09f918e:/(:dislike:)([\s\.,]|$)/g,e2989d:/(:up:)([\s\.,]|$)/g,e29c8c:/(:v:)([\s\.,]|$)/g,f09f918c:/(:ok:|::)([\s\.,]|$)/g},s={e29da4:[0,"<3"],f09f988a:[1,":-)"],f09f9883:[2,":-D"],f09f9889:[3,";-)"],f09f9886:[4,"xD"],f09f989c:[5,";-P"],f09f988b:[6,":-p"],f09f988d:[7,"8-)"],f09f988e:[8,"B-)"],f09f9892:[9,":-("],f09f988f:[10,";-]"],f09f9894:[11,"3("],f09f98a2:[12,":'("],f09f98ad:[13,":_("],f09f98a9:[14,":(("],f09f98a8:[15,":o"],f09f9890:[16,":|"],f09f988c:[17,"3-)"],f09f98a0:[18,">("],f09f98a1:[19,">(("],f09f9887:[20,"O:)"],f09f98b0:[21,";o"],f09f98b3:[22,"8|"],f09f98b2:[23,"8o"],f09f98b7:[24,":X"],f09f989a:[25,":-*"],f09f9888:[26,"}:)"],f09f918d:[27,":like:"],f09f918e:[28,":dislike:"],e2989d:[29,":up:"],e29c8c:[30,":v:"],f09f918c:[31,":ok:"]}},TYsd:function(e,t,n){"use strict";n.r(t);var i=n("1By4");t.default=i.default,window.Wd=i.default},Tjn9:function(e,t){function n(e){(e=ge(e))&&(addClass(e,"profileEdit_selected"),setTimeout(function(){addClass(e,"profileEdit_animated"),setTimeout(function(){removeClass(e,"profileEdit_selected"),removeClass(e,"profileEdit_animated")},1e3)},1500))}function i(e){(e=ge(e))&&setTimeout(function(){var t=getXY(e)[1],i=getSize("mhead")[1],a=scrollGetY(),o=getCh();t<i+a||t>a+o?setTimeout(function(){scrollTo(0,t-i),n(e)},0):n(e)},0)}window.ProfileEditor={init:function(){var e=(qs2obj(nav.params)||{}).hl;e&&i(geByClass1("_"+e))},highlightRow:n,scrollHighlightRow:i}},TxR4:function(e,t,n){"use strict";n.r(t),n.d(t,"emojiSymbolToByteHex",function(){return a}),n.d(t,"emojiByteHexToSymbol",function(){return o}),n.d(t,"emojiRemoveSkinToneModifiers",function(){return r});var i=n("S6+Z");function a(e){var t=e.split("").map(function(e){return e.charCodeAt(0).toString(16)}).filter(function(e){return"fe0f"!==e.toLowerCase()}).map(function(e){return String.fromCodePoint(parseInt(e,16))}).join("");return encodeURIComponent(t).replace(/%/gi,"").toLowerCase()}function o(e){var t,n=e.length%2==1,i=n?e.slice(0,1):"",a=n?e.slice(1):e,o="";try{o=decodeURIComponent("%"+(t=a,t.split("").reduce(function(e,t,n){return e+t+((n+1)%2==0?" ":"")},"").trim().split(/\s+/)).join("%"))}catch(e){}return i+o}function r(e){return e.replace(Object(i.emojiRegex)(),s)}function s(e){return e.replace(i.skinToneModifierRegex,"")}},U34x:function(e,t){var n="dropdown_open",i={_onTogglerClick:function(e,t){preventEvent(e),stopEvent(e);var i=gpeByClass("dropdown",t);if(toggleClass(i,n),!1!==i.isFirstClick){i.isFirstClick=!1;var a=function(){removeClass(i,n)};addEvent(window,"click",a),window.cur.destroy.push(function(){removeEvent(window,"click",a),i.isFirstClick=!0})}}};window.Dropdown=i},UlUB:function(e,t,n){"use strict";function i(e,t){var n,i,a=!1;return function o(){if(a)return n=arguments,void(i=this);e.apply(this,arguments),a=!0,setTimeout(function(){a=!1,n&&(o.apply(i,n),n=i=null)},t)}}n.r(t),n.d(t,"default",function(){return i})},UvyM:function(e,t,n){"use strict";n.r(t);var i=n("z9sQ"),a=n("fdw3");t.default=function(e){void 0===e&&(e={});var t=e.url,n=e.is_icon,o=e.on_click||e.onClick,r=e.use_native_onclick,s=e.inner||e.children;isArray(s)&&1===s.length&&"string"==typeof s[0]&&(s=s[0]);var l=!1;"function"==typeof o&&(r=!0,l=!0);o&&!r&&(o=["Btn._onClick","event","this",o]);var c={class:[e.class,i.default.class("Btn",{theme:e.theme||"regular",size:e.size||"",stretch:e.stretch})],onclick:o,attrs:e.attrs};l&&(c.onClick=o,delete c.onclick);var u=e.hide?"; display: none;":"",d=e.style?e.style+u:u;if(t)return Object(a.mergeObjects)(c,{tag:"a",href:t,role:"button",style:d,inner:n?s:{class:"Btn__text",inner:s},target:e.open_in_new_tab?"_blank":null});var f=e.is_submit?"submit":null,_=e.type||f;return Object(a.mergeObjects)(c,{"aria-label":e["aria-label"],tag:"button",style:d,disabled:e.disabled,type:_,inner:n?s:{class:"Btn__text",inner:s}})}},V4qE:function(e,t,n){"use strict";n.r(t);var i=n("z9sQ"),a=n("29dZ"),o=n("Y6JH"),r=n("fdw3"),s=function(e){void 0===e&&(e={});var t=!(!e.type||e.image),n={class:i.default.class("SnackbarItem__cell",{left:!0,image:!!e.image,icon:t})},s={class:i.default.class("SnackbarItem__cell",{right:!0,avatar:!!e.avatar})},l=!1,c=!1;if(e.type){l=!0;var u=null;switch(e.type){case 1:u=Object(o.default)("common","snackbar_done_24");break;case 2:u=Object(o.default)("common","snackbar_error_24");break;case 3:u=Object(o.default)("common","favorites_24");break;case 4:u=Object(o.default)("wall","error_fill_24")}n.inner={class:"SnackbarItem__icon",inner:u}}e.image&&(l=!0,n.inner={class:"SnackbarItem__image",inner:{tag:"img",src:e.image}});e.action&&(c=!0,s.inner=Object(a.default)({theme:"none",class:"SnackbarItem__action",url:e.action.url,on_click:e.action.onclick,use_native_onclick:!0,inner:Wd.wrap(e.action.text),attrs:e.action.attrs}));e.avatar&&(c=!0,s.inner={tag:"img",class:"SnackbarItem__avatar",src:e.avatar});return{style:e.style?e.style:"",class:Object(r.concatValues)("SnackbarItem_"+e.id+" ",i.default.class("SnackbarItem",{static:!!e.static,vertical:!!e.vertical,hasIcon:t},"--")),attrs:{"data-snackbar-id":e.id},inner:[{class:"SnackbarItem__table",inner:[l?n:null,e.text?{class:i.default.class("SnackbarItem__cell",{text:!0}),inner:{class:"SnackbarItem__text",inner:Wd.wrap(e.text)}}:null,c?s:null]}]}};var l=n("OcsD"),c=n("UxAg"),u=882;window.Snackbar={init:b,close:w,_onActionClick:function(e,t){var n=m[t];if(!n)return void hide(t);var i=n.callback,a=n.url;i?"function"==typeof i?i.call(null,e,{id:t,url:a}):Wd.handle2(i,e,{id:t,url:a}):hide(t)},_onRestoreClick:function(e,t){var n=e.closest(".SnackbarItem");w(domData(n,"snackbar-id")),ajax.post(t,{_ajax:1,_snackbar:1})}};var d="SnackbarItem_",f="SnackbarItem_added",_="SnackbarItem_removed",p="SnackbarItem--closing",h=0,m={},A="touchstart",v="touchmove",g="touchcancel touchend";function b(e){var t=isFinite(e.duration)?e.duration:5e3,n=h++,i=e.action&&e.action.callback,a=e.action&&e.action.url;e.type;e.id=n,i&&!e.action.onclick&&(e.action.onclick=["Snackbar._onActionClick","event",n]),e.bottom&&(e.style="bottom: "+e.bottom+"px");var o,r=Wd.elem(SnackbarItem(e));return function(e){Object(l.append)(e,document.body),setTimeout(function(){e.classList.add(f)},100)}(r),t&&(o=y(n,t)),Object(l.addEvent)(r,A,T,{passive:!0}),Object(l.addEvent)(r,v,D,{capture:!1}),Object(l.addEvent)(r,g,j,{passive:!0}),m[n]={id:n,timer:o,callback:i,url:a,duration:t},n}function y(e,t){return setTimeout(function(){w(e,!1)},t)}function w(e,t){var n=m[e],i=function(e){return Object(c.$)("."+d+e)}(e);n&&(n.timer&&clearTimeout(n.timer),m[e]=null),i&&function(e,t){if(Object(l.removeEvent)(e,A,T,{passive:!0}),Object(l.removeEvent)(e,v,D,{capture:!1}),Object(l.removeEvent)(e,g,j,{passive:!0}),t)return void Object(l.remove)(e);e.classList.add(p);if(!e)return;e.classList.add(_),setTimeout(function(){Object(l.remove)(e)},600)}(i,t)}var C=!1,k=null,S=0,E=!1,O=Object(l.getCw)();function T(e){if((O=Object(l.getCw)())>=u&&(E=!0),e.touches&&e.touches.length>1)C=!1;else{var t=e.target.closest(".SnackbarItem");t.classList.add("SnackbarItem--dragging");var n=domData(t,"snackbar-id");m[n].timer&&clearTimeout(m[n].timer),k=e.touches[0],S=e.touches[0].clientX,C=!0,document.body.style.overflow="hidden"}}function D(e){if(e.preventDefault(),e.touches&&e.touches.length>1)C=!1;else if(k&&C){var t=e.touches[0],n=e.target.closest(".SnackbarItem"),i=-(S-t.clientX);E&&(i=Math.min(i,0));var a=getX(n),o=(Object(l.getW)(n)+i)/2+a;O>=u&&Object(l.getW)(n)/2;var r=o>=.95*O||o<=O/.95-O,s=domData(n,"snackbar-id");m[s].canClose=r,setStyle.transform(n,1,[i,0])}}function j(e){var t=e.target.closest(".SnackbarItem");t.classList.remove("SnackbarItem--dragging");var n=domData(t,"snackbar-id"),i=m[n];if(m[n].dragging=!1,document.body.style.overflow="visible",i.canClose)return w(n),void setStyle.transform(t,1,[getX(t)>0?Object(l.getCw)():-Object(l.getCw)(),0]);m[n].timer=y(n,i.duration),t&&setStyle.transform(t,1,[0,0])}n.d(t,"init",function(){return b}),n.d(t,"close",function(){return w}),n.d(t,"SNACKBAR_TYPE_SUCCESS",function(){return 1}),n.d(t,"SNACKBAR_TYPE_ERROR",function(){return 2}),n.d(t,"SNACKBAR_TYPE_BOOKMARK",function(){return 3}),n.d(t,"SNACKBAR_TYPE_BULLYING",function(){return 4});t.default=s;window.SnackbarItem=s},W0P9:function(e,t,n){"use strict";n.r(t),n.d(t,"log",function(){return r}),n.d(t,"warn",function(){return s}),n.d(t,"error",function(){return l}),n.d(t,"debug",function(){return c});var i=n("W9Tc"),a="js_console_logs";function o(){return window.console&&Object(i.partConfigEnabled)(a)}function r(){var e;o()&&(window.console.log&&(e=window.console).log.apply(e,arguments))}function s(){var e;o()&&(window.console.warn?(e=window.console).warn.apply(e,arguments):r.apply(void 0,arguments))}function l(){var e;o()&&(window.console.error?(e=window.console).error.apply(e,arguments):r.apply(void 0,arguments))}function c(){var e;o()&&(window.console.debug?(e=window.console).debug.apply(e,arguments):r.apply(void 0,arguments))}},W38l:function(e,t,n){"use strict";n.r(t);var i={bluetooth:"2g",cellular:"2g",ethernet:"4g",mixed:"unknown",none:"none",other:"unknown",unknown:"unknown",wifi:"3g",wimax:"4g"};function a(){if(!1===navigator.onLine)return"none";var e=navigator.connection||navigator.webkitConnection||navigator.mozConnection;if(!e)return"unknown";if(e.effectiveType)return e.effectiveType;var t=+(e.downlinkMax||e.downlink);return t?t<50?"slow-2g":t<70?"2g":t<700?"3g":"4g":i[e.type]||"unknown"}var o=n("WwUR");n.d(t,"log",function(){return s}),n.d(t,"mark",function(){return l}),n.d(t,"error",function(){return c}),n.d(t,"clean",function(){return u}),n.d(t,"logQueueSize",function(){return d});var r={};function s(e,t){var n={action:t,startTime:Date.now(),networkType:a(),lpState:o.default.isLongPollingEnabled()};r[e]=n}function l(e,t){if(r[e]){var n=r[e],i=n.startTime,a=n.action,o=n.lpState,s=n.networkType;statlogsValueEvent("mvk_mail_send_time",Date.now()-i,a,t,o,s)}}function c(e,t,n){if(r[e]){var i=r[e],a=i.action,o=i.lpState,s=i.networkType;statlogsValueEvent("mvk_mail_send_error",0,a,t,n,o,s)}}function u(e){delete r[e]}function d(e){statlogsValueEvent("mvk_mail_send_queue_size",e,a())}},WwUR:function(e,t,n){"use strict";n.r(t);var i=n("OcsD"),a=n("+cqQ");function o(e,t){var n,i=new Promise(function(i){n=i,setTimeout(i.bind(null,t),1e3*e)});return{pause:function(){return i},abort:function(){n(t)}}}var r=n("cGUQ"),s=window.ajax,l=3;function c(e,t,n){var i;return void 0===n&&(n={}),i=window.XDomainRequest?new XDomainRequest:s._getreq(),{request:new Promise(function(a,o){var s,l=Date.now(),c=n.timeout||60,u=Object(r.toQueryString)(t);if(window.XDomainRequest)i.open("get",e+"?"+u),i.ontimeout=function(e){o([e,{}])},i.onerror=function(e){o([e,{}])},i.onload=function(){a([i.responseText,{}])},setTimeout(function(){i.send()},0);else{i.onreadystatechange=function(){4==i.readyState&&(clearInterval(s),i.status>=200&&i.status<300?a([i.responseText,i]):o([i.responseText,i]))};try{i.open("GET",e+"?"+u,!0)}catch(e){return o([e,i])}i.send()}s=setInterval(function(){Date.now()-l>1e3*c&&(window.browser.safari&&i.abort(),o(["",{}]),clearInterval(s))},1e3)}),cancel:function(){i.abort()}}}var u=n("jE6c");function d(e,t){void 0===t&&(t=[]);var n=e.split("_");return[n[0],n[1],t]}var f={};function _(e){if(f[e])return f[e];for(var t=e?e.length:0,n=[],i=[],a="",o=0;o<t;o++){var r=e[o],s=r.charCodeAt(0);s>=48&&s<=57||"_"===r||"-"===r?a+=r:"("!==r&&")"!==r&&":"!==r&&","!==r||(""!==a&&(i.push(a),n.push("id"),a=""),i.push(r),n.push(r))}a.length>0&&(i.push(a),n.push("id"));var l=function e(t,n,i,a){if(void 0===i&&(i=0),void 0===a&&(a=0),a>50)return[[],t.length];for(var o=[],r="";i<t.length;){var s=t[i];if("id"===s)r=n[i];else if(","===s&&r)o.push(d(r)),r="";else if("("===s){var l=e(t,n,i+1,a+1),c=l[0];i=l[1],o.push(d(r,c)),r=""}else if(")"===s)return""!==r&&o.push(d(r)),[o,i];i++}return r&&o.push(d(r)),[o,i]}(n,i)[0];return Object.keys(f).length>300&&(f={}),f[e]=l,l}function p(e,t){var n=[];e.fwd_count?n.push({type:"mail",id:-t,object:{fwd_count:e.fwd_count}}):e.fwd&&n.push({type:"mail",id:-t,object:{fwd_count:_(e.fwd).length}});for(var i=1;e["attach"+i+"_type"];++i)"call"===e["attach"+i+"_type"]?n.push({type:e["attach"+i+"_type"],id:e["attach"+i],initiatorId:Object(u.intval)(e["attach"+i+"_call_initiator_id"]),state:e["attach"+i+"_call_state"],duration:Object(u.intval)(e["attach"+i+"_call_duration"]),receiverId:Object(u.intval)(e["attach"+i+"_call_receiver_id"])}):n.push({type:e["attach"+i+"_type"],id:e["attach"+i],kind:e["attach"+i+"_kind"],productId:e["attach"+i+"_product_id"]});return e.geo&&n.push({type:"geo",id:e.geo}),n}var h="event_delete",m="event_set_flags",A="event_replace_flags",v="event_reset_flags",g="event_add_message",b="event_read_inbound",y="event_read_outbound",w="event_got_online",C="event_got_offline",k="event_chat_changed",S="event_chat_updated",E="event_typing",O="event_recoding_audio",T="event_video_call",D="event_unread_count",j="event_notify_settings_changed",I="event_empty",M="event_reset_directories",x="event_replace_directories",B="event_set_directories",P="event_resync",L="event_refresh_lp_key",R="event_delete_dialog",N="event_edit_message",F="event_replace_message",H="event_audio_start",U="event_waiting_for_reconnect",V="event_reconnecting",$="event_reconnected",q=2,W=1<<21;function z(e){var t,n=e[1],i=e[2],a=e[3],o=e[4],r=e[5],s=e[6],l=e[7],c=e[8],u=e[9],d=e[10],f=extend(s,l||void 0);return{type:g,messageId:intval(n),flags:intval(i),peerId:intval(a),date:intval(o),attaches:p(f,n),subject:s.title||"",text:r,kludges:f,randomId:intval(c),userId:(t=a,t>2e9?intval(f.from):intval(a)),update_time:d,chat_local_id:u}}var Q=202,Y=7,X=4,G=-3,K=-4,J=-5;function Z(e,t){e.waitAbortFns.push(t)}function ee(e){return e.map(function(e){switch(e[0]){case 0:return ee=e[1],{type:h,localId:ee};case 1:return Y=(Q=e)[1],X=Q[2],Z=Q[3],{type:A,messageId:Y,mask:X,peerId:Z};case 2:return function(e){var t=e[1],n=e[2],i=e[3];return{type:m,messageId:t,flags:n,peerId:i}}(e);case 3:return function(e){var t=e[1],n=e[2],i=e[3];return{type:v,messageId:t,flags:n,peerId:i}}(e);case 4:return z(e);case 5:return(W=z(e)).type=N,W;case 6:return function(e){var t=e[1],n=e[2],i=e[3];return{type:b,peerId:t,upToId:n,unread:i}}(e);case 7:return function(e){var t=e[1],n=e[2],i=e[3];return{type:y,peerId:t,upToId:n,unread:i}}(e);case 8:return p=(_=e)[1],g=_[2],q=_[3],{type:w,userId:-p,platform:g,lastSeenTs:q};case 9:return function(e){var t=e[1],n=e[2],i=e[3];return{type:C,userId:-t,reason:n,lastSeenTs:i}}(e);case 10:return function(e){var t=e[1],n=e[2],i=e[3];return{type:M,peerId:t,mask:n,local:void 0!==i&&i}}(e);case 11:return function(e){var t=e[1],n=e[2];return{type:x,peerId:t,mask:n}}(e);case 12:return function(e){var t=e[1],n=e[2],i=e[3];return{type:B,peerId:t,mask:n,local:void 0!==i&&i}}(e);case 13:return function(e){var t=e[1],n=e[2];return{type:R,peerId:t,localId:n}}(e);case 18:return function(e){var t=z(e);return t.type=F,t}(e);case 51:return function(e){var t=e[1],n=e[2];return{type:k,chatId:t,self:n}}(e);case 52:return function(e){var t=e[1],n=e[2],i=e[3];return{type:S,peerId:n,updateType:t,updateArg:i}}(e);case 63:return function(e){var t=e[1],n=e[2],i=e[3],a=e[4];return{type:E,peerId:t,userIds:n,totalCount:i,ts:a}}(e);case 64:return function(e){var t=e[1],n=e[2],i=e[3],a=e[4];return{type:O,peerId:t,userIds:n,totalCount:i,ts:a}}(e);case 70:return function(e){var t=e[1],n=e[2];return{type:T,userId:t,callId:n}}(e);case 80:return u=(c=e)[1],d=c[2],f=c[3],{type:D,count:u,countNotMuted:d,showOnlyNotMuted:f};case 114:return s=e[1],{type:j,peerId:(l=void 0===s?{}:s).peer_id,sound:l.sound,disabledUntil:l.disabled_until};case 116:return function(e){var t=e[1],n=void 0===t?{}:t,i=z([!1,n.id,n.flags,n.peer_id,n.date,n.message,extend(n.kludges,{title:n.title||""}),{},n.random_id,n.chat_local_id,n.update_time]);return i.type=N,i}(e);case 117:return o=e[1],{type:H,uuid:(r=void 0===o?{}:o).uuid,deviceName:r.device_name||""};case-1:return{type:P};case-2:return i=(n=e)[1],a=n[2],{type:L,key:i,url:a};case G:return t=e[1],{type:U,timeout:t};case K:return{type:V};case J:return{type:$};default:return function(e){return{type:I,params:e}}(e)}var t,n,i,a,o,r,s,l,c,u,d,f,_,p,g,q,W,Q,Y,X,Z,ee})}function te(e){if(e.isStoppedFn())return Promise.resolve({ts:0,updates:[]});var t=c(e.url,{act:"a_check",key:e.key,version:e.version,ts:e.ts,wait:25,mode:e.mode}),n=t.request,i=t.cancel;return e.stopFn=i,n.then(function(t){var n=t[0],i=t[1];return e.onData(e,i),e.waitTimeout=2,JSON.parse(n)}).catch(function(t){var n=t[1];return e.onData(e,n),Promise.reject(new Error(""))}).then(function(t){return function(e,t){var n=t.failed?o(X,null):{abort:function(){},pause:function(){return Promise.resolve()}},i=n.abort,a=n.pause;switch(t.failed){case 1:return Z(e,i),e.onHistoryLost(e,t).then(function(){return e.onResult({ts:t.ts,updates:[[-1]]})}).then(a).then(function(){return te(e)});case 2:return Z(e,i),e.onKeyExpired(e,t).then(function(t){var n=t[0],i=t[1],a=t[2],o=t[3];return e.onResult({ts:+o,updates:[[-2,n,i+"/"+a],[-1]]})}).then(a).then(function(){return te(e)});case 3:return e.onLpBroken(e,t);default:return Promise.resolve(t)}}(e,t)})}function ne(e){e.isStoppedFn()||te(e).then(e.onResult.bind(e)).then(function(){return e.isReconnecting&&ie(e,J)}).catch(function(t){return function(e,t){if(e.isStoppedFn())return;e.onRequestError(t),e.waitTimeout=Math.min(60,2*e.waitTimeout),ie(e,G);var n=o(e.waitTimeout,null),i=n.abort,a=n.pause;return Z(e,i),a().then(function(){return ie(e,K)})}(e,t)}).then(function(){return ne(e)})}function ie(e,t){e.isReconnecting=t===K,e.onResult({ts:e.ts,updates:[[t,e.waitTimeout]]})}function ae(e){return e||function(){}}function oe(e){return e?function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Promise.resolve(e.apply(void 0,t))}:function(){return Promise.reject()}}function re(e,t,n){var i=0,a=e,o=[],r=!1;function s(){!o.length||i>0||r||(t(o),o=[])}return{pause:function(){i++},resume:function(){i>0&&(i--,s())},onLp:function(e,t,i){r||(a>=e?(a=t,o.push.apply(o,i),s()):n&&(r=!0,n(a).then(function(e){var t=e[1],n=e[2];a=t,r=!1,o.push.apply(o,n),s()})))}}}var se={onNewMsg:Object(a.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags, isService }"),onEditMsg:Object(a.default)("{ peerId, msgId, authorId, text, date, hasAttachments, flags }"),onMsgReadByMe:Object(a.default)("msgId","dialogId"),onMsgReadByOther:Object(a.default)("msgId","dialogId"),onOnlineChange:Object(a.default)("{ userId, isOnline, onlinePlatform, lastActionTime }"),onTyping:Object(a.default)("dialogId","authorId"),onMultiTyping:Object(a.default)("peerId","userIds","totalCount"),onRecordingAudio:Object(a.default)("peerId","userIds","totalCount"),onMsgImportantRemove:Object(a.default)("msgId"),onMsgImportantAdd:Object(a.default)("msgId"),onMsgRequestChange:Object(a.default)("peerId","type"),onMsgRemove:Object(a.default)("msgId"),onMsgListen:Object(a.default)("msgId"),onMsgRestore:Object(a.default)("msgId"),onPeerKeyboard:Object(a.default)("peerId"),onPeerBanner:Object(a.default)("peerId"),onPeerConvert:Object(a.default)("peerId","convertId"),onPeerAdmin:Object(a.default)("peerId","userId","isAdmin"),onDialogImportant:Object(a.default)("peerId","isImportant"),onDialogRemove:Object(a.default)("peerId"),onUnreadCount:Object(a.default)("count"),onResync:Object(a.default)(),_onLpEvents:Object(a.default)("Array<Object>"),init:function(e){se._lpConnect&&(se._onLpEvents.off(),se._lpConnect.stopConnection(),se._lpQueue=null,se._lpConnect=null),se._lpConfig=e},isLongPollingEnabled:function(){return!(!se._lpConnect||se._lpConnect.isStopped())},on:function(){clog("[longpoll] start"),window.addEventListener("online",le),window.addEventListener("offline",le),se._lpConnect?se._lpConnect.reinitConnection():se._createLongpoll(se._lpConfig)},off:function(){clog("[longpoll] stop"),window.removeEventListener("online",le),window.removeEventListener("offline",le),se._lpConnect&&se._lpConnect.stopConnection()},pause:function(){clog("[longpoll] pause"),se._lpQueue&&se._lpQueue.pause()},resume:function(){clog("[longpoll] resume"),se._lpQueue&&se._lpQueue.resume()},abortWaiting:function(){clog("[longpoll] abort waiting"),se._lpConnect.abortWaiting()},_createLongpoll:function(e){if(!se._lpConnect){var t=re(e.ts,function(e){se._onLpEvents(e)}),n=function(e,t){var n=!!e.stopped,i={id:e.id,key:e.key,ts:e.ts,url:e.url,lpstat:e.lpstat||0,version:e.version||Y,mode:Q,waitTimeout:2,waitAbortFns:[],isReconnecting:!1,isStoppedFn:function(){return n},onResult:function(e){e.ts&&o(i.ts,e.ts,ee(e.updates))},onData:ae(t.onData),onRequestError:ae(t.onRequestError),onHistoryLost:oe(t.onHistoryLost),onKeyExpired:oe(t.onKeyExpired),onLpBroken:oe(t.onHistoryLost)},a=t.onEvents;function o(e,t,n){i.ts=t;for(var o=0;o<n.length;++o)n[o].type===L&&(i.key=n[o].key||"",i.url=n[o].url||"");a(e,t,n)}var r={options:i,isStopped:function(){return n},stopConnection:function(){n=!0,i.stopFn&&i.stopFn(),i.stopFn=void 0,this.abortWaiting()},reinitConnection:function(){this.stopConnection(),ie(i,K),n=!1,ne(i)},abortWaiting:function(){i.waitAbortFns.forEach(function(e){return e()}),i.waitAbortFns=[],i.waitTimeout=2},onLp:o};return ne(i),r}(e,{onEvents:function(e,n,i){i.forEach(function(i){t.onLp(e,n,[i])})},onHistoryLost:function(){clog("[longpoll] ts expired")},onKeyExpired:function(e){return clog("[longpoll] key expired"),t="/mail",(n={act:"get_key",user_id:e.id})&&(n.im_v=l),new Promise(function(e,a){s.post(t,n,{timeout:i,onDone:function(){e.apply(null,[Array.prototype.slice.call(arguments)])},onFail:function(){return a.apply(null,arguments),!0}})});var t,n,i},onLpBroken:function(){clog("[longpoll] broken, reload"),window.location.reload()}});se._lpQueue=t,se._lpConnect=n,se._onLpEvents(function(e){try{e.forEach(se._onEvent)}catch(e){console.error(e)}})}},_onEvent:function(e){var t=e.type;switch(t){case A:var n=e.flags,a=e.messageId;e.peerId;8&n?se.onMsgImportantAdd(a):se.onMsgImportantRemove(a),128&n||64&n?se.onMsgRemove(a):se.onMsgRestore(a);break;case m:var o=e.flags,r=e.messageId,s=e.peerId;8&o&&se.onMsgImportantAdd(r),(128&o||64&o)&&se.onMsgRemove(r,s),4096&o&&se.onMsgListen(r);break;case v:var l=e.flags,c=e.messageId;e.peerId;8&l&&se.onMsgImportantRemove(c),(128&l||64&l)&&se.onMsgRestore(c);break;case g:case N:case F:var u=e.messageId,d=e.peerId,f=e.randomId,_=e.text,p=e.flags,h=e.attaches,k=e.kludges,I=e.date,L=Object(i.toInt)(k.from_admin)||null,H=function(e){if(e.flags&q)return se._lpConfig.id;return e.userId}(e),U=!!k.source_act,V=t===N||t===F,$=p&q,z=!!(65536&p),Q=k.keyboard,Y=function(e,t){t&W&&function(e){e.fwd_count}(e)}(k,p),X={peerId:d,id:u,authorId:H,attaches:h,text:_,ts:I,flags:p,adminId:L,randomId:f,isService:V?void 0:U,edited:!!V||void 0,replaced:t===F,keyboard:Q,isStealth:z,isOut:$,hasReply:Y};V?se.onEditMsg(X):se.onNewMsg(X);break;case b:case y:var G=e.peerId,K=e.upToId;e.unread;t===b?se.onMsgReadByMe(K,G):se.onMsgReadByOther(K,G);break;case w:case C:var J=e.userId,Z=e.platform,ee=(e.reason,e.lastSeenTs),te="mobile";Z&&6!==Z&&7!==Z||(te="desktop"),se.onOnlineChange({userId:J,isOnline:t===w,onlinePlatform:te,lastActionTime:ee});break;case M:case B:var ne=e.mask,ie=e.peerId;e.local;1&ne&&se.onDialogImportant(ie,t===B);break;case x:var ae=e.mask,oe=e.peerId;e.local;se.onDialogImportant(oe,!!(1&ae));break;case R:var re=e.peerId;se.onDialogRemove(re);break;case S:var le=e.peerId,ce=e.updateType,ue=e.updateArg;if(11===ce&&se.onPeerKeyboard(le),10===ce&&se.onPeerBanner(le),13===ce&&se.onPeerConvert(ue,le),12===ce){var de="";switch(ue){case 3:de="created";break;case 2:de="rejected";break;case 1:de="accepted";break;case 0:de="canceled"}se.onMsgRequestChange(le,de)}3===ce&&se.onPeerAdmin(le,ue,!0),9===ce&&se.onPeerAdmin(le,ue,!1);break;case E:var fe=e.peerId,_e=e.userIds,pe=e.totalCount;e.ts;se.onMultiTyping(fe,_e,pe);break;case O:var he=e.peerId,me=e.userIds,Ae=e.totalCount;e.ts;se.onRecordingAudio(he,me,Ae);break;case T:break;case D:var ve=e.count,ge=e.countNotMuted,be=e.showOnlyNotMuted;se.onUnreadCount(be?ge:ve);break;case j:break;case P:se.onResync()}}};t.default=se;function le(e){"online"===e.type?(clog("[longpoll] online"),se._lpConnect.reinitConnection()):(clog("[longpoll] offline"),se._lpConnect.stopConnection())}},XCiN:function(e,t,n){"use strict";n.r(t);var i=n("izth");window.isBootstrapInited||(window.cur={destroy:[]},window.lang={},Object(i.setDocumentDomain)(),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),window.isBootstrapInited=!0)},XLP4:function(e,t){window.FeedAssistanceImportContacts={importContacts:function(e,t,i){if(!window.XMLHttpRequest||i)return;var a=domData(e,"service-id");return window.open(t),n[a]=e,!1}};var n={},i="feedAssistanceImportContacts__desc",a=!1;FeedAssistanceStats.registerTrackingCls("feedAssistance_importContacts"),FeedAssistanceStats.onStartViewElement(function(e){FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_IMPORT_CONTACTS&&(a=!0)}),Friends.onImportSuccess(function(){var e=arguments[0],t=arguments[2],o=n[e];if(o){var r=geByClass1(i,o);r.textContent=getLang("mobile_join_friends_found_count",t)}a&&FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,o,"m_mp",FeedAssistanceStats.EVENTS.SUB_EVENT_FILLED)})}),Friends.onImportFailed(function(e){var t=n[e];t&&(geByClass1(i,t).textContent=getLang("mobile_friends_import_error"))})},Y6JH:function(e,t,n){"use strict";n.r(t);var i=n("fdw3");var a=function(e,t){void 0===e&&(e="common"),void 0===t&&(t=""),Object(i.isObject)(e)&&(t=e.name?e.name:"",e=e.sprite?e.sprite:"");var n=e.split("/").join("-");return{class:"svgIcon svgIcon-"+n+" svgIcon-"+n+"__"+t,tag:"div"}};t.default=a},a0wW:function(e,t,n){"use strict";n.r(t),n.d(t,"FLAG_MP4",function(){return r}),n.d(t,"FLAG_GIF_AUTOPLAY",function(){return s}),n.d(t,"FLAG_SUPPORTS_HISTORY_API",function(){return l});var i=n("jk6M"),a=n("J8bf"),o={},r=0,s=1,l=2,c=function(){function e(){}return e.getFeatures=function(){return o},e.detectMp4Support=function(){var e=i.default.meizu||i.default.mi||i.default.uc_mini||0!==i.default.ios&&i.default.ios<10||i.default.chrome&&i.default.version.split(".")[0]<53,t=!1,n=document.createElement("video");return n.canPlayType&&""!==n.canPlayType("video/mp4")&&(t=!0),o.mp4=t,this.setFlag(r,t&&!e),t},e.detectAutoplay=function(){var e=this;return new Promise(function(t){if(o.autoplay)t(!0);else{if(i.default.ios&&i.default.safari_mobile&&parseInt(i.default.version,10)>=10)return o.autoplay=!0,void t(!0);o.autoplay=!1;var n=ce("video"),a=ce("source");a.src="data:video/mp4;base64,AAAAFGZ0eXBNU05WAAACAE1TTlYAAAOUbW9vdgAAAGxtdmhkAAAAAM9ghv7PYIb+AAACWAAACu8AAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAnh0cmFrAAAAXHRraGQAAAAHz2CG/s9ghv4AAAABAAAAAAAACu8AAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAFAAAAA4AAAAAAHgbWRpYQAAACBtZGhkAAAAAM9ghv7PYIb+AAALuAAANq8AAAAAAAAAIWhkbHIAAAAAbWhscnZpZGVBVlMgAAAAAAABAB4AAAABl21pbmYAAAAUdm1oZAAAAAAAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAVdzdGJsAAAAp3N0c2QAAAAAAAAAAQAAAJdhdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAFAAOABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAAEmNvbHJuY2xjAAEAAQABAAAAL2F2Y0MBTUAz/+EAGGdNQDOadCk/LgIgAAADACAAAAMA0eMGVAEABGjuPIAAAAAYc3R0cwAAAAAAAAABAAAADgAAA+gAAAAUc3RzcwAAAAAAAAABAAAAAQAAABxzdHNjAAAAAAAAAAEAAAABAAAADgAAAAEAAABMc3RzegAAAAAAAAAAAAAADgAAAE8AAAAOAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA4AAAAOAAAAFHN0Y28AAAAAAAAAAQAAA7AAAAA0dXVpZFVTTVQh0k/Ou4hpXPrJx0AAAAAcTVREVAABABIAAAAKVcQAAAAAAAEAAAAAAAAAqHV1aWRVU01UIdJPzruIaVz6ycdAAAAAkE1URFQABAAMAAAAC1XEAAACHAAeAAAABBXHAAEAQQBWAFMAIABNAGUAZABpAGEAAAAqAAAAASoOAAEAZABlAHQAZQBjAHQAXwBhAHUAdABvAHAAbABhAHkAAAAyAAAAA1XEAAEAMgAwADAANQBtAGUALwAwADcALwAwADYAMAA2ACAAMwA6ADUAOgAwAAABA21kYXQAAAAYZ01AM5p0KT8uAiAAAAMAIAAAAwDR4wZUAAAABGjuPIAAAAAnZYiAIAAR//eBLT+oL1eA2Nlb/edvwWZflzEVLlhlXtJvSAEGRA3ZAAAACkGaAQCyJ/8AFBAAAAAJQZoCATP/AOmBAAAACUGaAwGz/wDpgAAAAAlBmgQCM/8A6YEAAAAJQZoFArP/AOmBAAAACUGaBgMz/wDpgQAAAAlBmgcDs/8A6YEAAAAJQZoIBDP/AOmAAAAACUGaCQSz/wDpgAAAAAlBmgoFM/8A6YEAAAAJQZoLBbP/AOmAAAAACkGaDAYyJ/8AFBAAAAAKQZoNBrIv/4cMeQ==";var r=ce("source");r.src="data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA=",append(r,n),append(a,n),n.style.position="fixed",n.style.left="5000px",attr(n,"id","base64testvideo"),attr(n,"playsinline","playsinline"),attr(n,"webkit-playsinline","webkit-playsinline"),attr(n,"muted","muted"),attr(n,"autoplay","autoplay"),attr(n,"loop","loop"),append(n,document.body);var s=ge("base64testvideo");if(i.default.mobile&&i.default.ios&&i.default.ios<10)return o.autoplay=!1,remove(n),t(!1),void clearTimeout(e.autoDetectTimeout);if(!i.default.safari_mobile||i.default.safari_mobile&&parseInt(i.default.version,10)>=10){var l=n.play();void 0!==l&&l.then(function(){o.autoplay=!0,remove(n),t(!0),clearTimeout(e.autoDetectTimeout)}).catch(function(i){o.autoplay=!1,remove(n),t(!1),clearTimeout(e.autoDetectTimeout)})}s.onplay=function(){o.autoplay=!0,remove(n),t(!0),clearTimeout(e.autoDetectTimeout)},e.autoDetectTimeout=setTimeout(function(){s.paused||(o.autoplay=!0),remove(n),t(o.autoplay)},250)}})},e.getFlags=function(){return(Object(a.getCookie)("remixff")||"").split("").map(function(e){return+e?"1":"0"}).join("")},e.getFlag=function(e){var t=this.getFlags();return!!toInt(t[e])},e.setFlag=function(e,t){void 0===t&&(t=!1);var n=(Object(a.getCookie)("remixff")||"").split("");e>=n.length&&(n=Array.from(Array(e),function(e,t){return n[t]||"0"})),n[e]=t?"1":"0";var i=n.join("");Object(a.setCookie)("remixff",i,10)},e}();onDOMReady(function(){c.detectMp4Support()}),t.default=c},aXSb:function(e,t){var n=10;window.CreatePost={setMaxAttach:function(e){n=e},checkAttaches:function(){CreatePost.toggleEnableAttaches(mediaUpload.getAttachesCount()<n)},toggleEnableAttaches:function(e){void 0===e&&(e=!0),geByClass("cp_attach_btn","feed_add_form").forEach(function(t){t.classList.toggle("cp_disabled_btn",!e)}),["photo","video","audio","doc","poll"].forEach(function(t){Unfold.toggleItemEnabled(Unfold.getByName("attaches"),t,e)})}}},"aiw/":function(e,t,n){"use strict";n.r(t);var i=999999,a=0,o=0,r=null,s=null;function l(){var e=pageYOffset;0,e!==a&&e!==i&&(a=e,o=Math.max(o,e),scrollTo(0,i)),clearTimeout(s),s=setTimeout(function(){s=null,window.removeEventListener("scroll",l),scrollTo(0,i),setTimeout(function(){return scrollTo(0,i)},1e3)},150)}var c,u,d,f,_,p,h,m,A,v=n("H5mD"),g=0,b=0,y="",w=!1,C={},k=0;function S(e){if(y=e,w=!1,c=!1,d=0,f=0,p=0,h=0,C={},void 0,m="start",A=0,k=0,v.isIPhone)if("top"===y||"bottom"===y){I()<v.IPHONE_KEYBOARD_REJECT_OFFSET&&M(0);var t=document.body;_=t.offsetHeight,t.offsetWidth,window.addEventListener("scroll",O),"top"===y&&Object(v.isLandscapePhone)()||(D(),T())}else document.body.classList.add("ScrollViewsDisabled")}function E(){"top"===y||"bottom"===y?(u&&clearTimeout(u),window.removeEventListener("scroll",O)):document.body.classList.remove("ScrollViewsDisabled"),w=!1,y="",c=!1,_=0,0}function O(){if(D(),"top"!==y){if("bottom"===y){var e=pageYOffset,t=I();c&&(c=!1,e===p)||(v.isWKWebView?h<=5&&T():e>v.IPHONE_KEYBOARD_REJECT_OFFSET?e>t?(M(e),v.isWKWebView||T()):e<t?C[e]||e>j(t)?(C[e]=!0,T(_)):T():e!==j(t)&&T():t||(e<v.IOS_NO_KEYBOARD_ALLOWED_OFFSET?(d===e?f++:(d=e,f=1),f>=3&&(window.removeEventListener("scroll",O),M(d)),setTimeout(function(){T()},300)):T()))}}else{if(Object(v.isLandscapePhone)())return;if(v.isWKWebView)return void(0!==pageYOffset&&T(0));var n=innerHeight;if("start"===m&&(n<_?m="animate":T(1)),"animate"===m)if(A=_-n,k||(k=Math.max(1,Math.min(4,Math.floor(A/10)))),A<=0)m="stop";else{var i=v.isIPad?v.iosMajor<11?3:2:1;T(Math.min(A,k)*i)}"stop"===m&&T(1)}}function T(e){c=!0;var t,n=I();"bottom"===y?t=e||(!n||v.isWKWebView||v.isIPad?_:j(n)):"top"===y&&(t=isFinite(e)?e:1),h++,p=t,window.scrollTo(0,t)}function D(){u&&clearTimeout(u),w||(u=setTimeout(function(){w=!0,u=null,window.removeEventListener("scroll",O)},500))}function j(e){return v.isIPad||v.isWKWebView?e:90===Math.abs(window.orientation)&&screen.width>=375?e:(v.isIPhoneX?e-=v.IPHONE_X_SAFARI_BOTTOM_BAR:e-=v.IPHONE_SAFARI_BOTTOM_BAR,e)}function I(){return 90===Math.abs(window.orientation)?g:b}function M(e){90===Math.abs(window.orientation)?g=e:b=e}var x=null,B=0,P=0;function L(){if(!(visualViewport.height>=B)){var e=B-visualViewport.height;P!==e&&(!v.isWKWebView&&e<v.IOS_NO_KEYBOARD_ALLOWED_OFFSET?scrollTo(0,0):scrollTo(0,e))}}n.d(t,"onOpen",function(){return z}),n.d(t,"onClose",function(){return Q}),n.d(t,"isKeyboardOpen",function(){return Y}),n.d(t,"onCloseCallback",function(){return X}),n.d(t,"offCloseCallback",function(){return G}),n.d(t,"onOpenCallback",function(){return K}),n.d(t,"offOpenCallback",function(){return J});var R=!1,N=!1,F=!1,H=null,U=[],V=[],$=null,q=v.isScrollBasedViewport&&(v.isIPad||v.isWKWebView),W=v.isScrollBasedViewport&&v.iosMajor<=12;function z(e,t){void 0===e&&(e="default");var n=(void 0===t?{}:t).exitIfStarted,c=void 0!==n&&n;if(v.isIOS&&!(v.iosMajor<8)&&!(N&&c||R)){if($=e,N=!0,H&&(clearTimeout(H),H=null),"bottom"===e){if((Object(v.isLandscapePhone)()||!q&&!W)&&!function(){if(x||(x={onceBlocked:!1}),x.onceBlocked&&(x.opened=!0),!x.onceBlocked&&!x.opened){x.onceBlocked=!0;var e=document.activeElement;return e.blur(),e.focus(),!1}return x.opened=!0,window.visualViewport&&(B=visualViewport.height,P=0,setTimeout(L),visualViewport.addEventListener("scroll",L),visualViewport.addEventListener("resize",L)),!0}())return;!q&&W&&S(e),q&&function(e){void 0===e&&(e="default"),r&&(clearTimeout(r),r=null),s&&(clearTimeout(s),s=null),a=0,0,0,o=0,window.addEventListener("scroll",l),setTimeout(function(){scrollTo(0,i)},10),setTimeout(function(){scrollTo(0,i)},100),setTimeout(function(){scrollTo(0,i)},200),setTimeout(function(){scrollTo(0,i)},300),setTimeout(function(){scrollTo(0,i)},400),setTimeout(function(){scrollTo(0,i)},500)}()}else!q&&W&&S(e);V.length&&V.forEach(function(e){return e()}),R=!0,N=!1}}function Q(e){var t=(void 0===e?{}:e).exitIfStarted,n=void 0!==t&&t;if(v.isIOS&&!(v.iosMajor<8)&&(!F||!n)){if(F=!0,"bottom"===$){if((Object(v.isLandscapePhone)()||!q&&!W)&&(!x||x.onceBlocked&&!x.opened||(window.visualViewport&&(setTimeout(L),visualViewport.removeEventListener("scroll",L),visualViewport.removeEventListener("resize",L)),x=null,B=0,P=0,0)))return;if(!R)return;!q&&W&&E(),q&&(clearTimeout(r),clearTimeout(s),a=0,0,0,r=null,s=null,window.removeEventListener("scroll",l))}else!q&&W&&E();R=!1,F=!1,$=null,H&&clearTimeout(H),H=setTimeout(function(){scrollTo(0,0),U.length&&U.forEach(function(e){return e()})},10)}}function Y(){return R}function X(e){-1===U.indexOf(e)&&U.push(e)}function G(e){var t=U.indexOf(e);-1!==t&&U.splice(t,1)}function K(e){-1===V.indexOf(e)&&V.push(e)}function J(e){var t=V.indexOf(e);-1!==t&&V.splice(t,1)}},bRFj:function(e,t){window.Friends={onImportSuccess:befall("serviceId","friendsHtml","total"),onImportFailed:befall("serviceId"),accept:function(e,t,n,a,r,s,l,c){void 0===n&&(n="");void 0===a&&(a=null);void 0===r&&(r="");void 0===s&&(s="");void 0===l&&(l=o);void 0===c&&(c=o);f(i,e,t,n,a,r,s,l,c)},decline:function(e,t,n,i,r,s,l,c){void 0===n&&(n="");void 0===i&&(i=null);void 0===r&&(r="");void 0===s&&(s="");void 0===l&&(l=o);void 0===c&&(c=o);f(a,e,t,n,i,r,s,l,c)},makeImportRequest:function(e,t,n){if(!window.XMLHttpRequest)return void(window.location=e);ajax.plainpost(e,{_ajax:1},function(e){return function(e,t,n){var i=parseJSON(e),a=i.user,o=i.user_hash,f=i.contacts,p=r+n;if(i.error)return void _(n);ajax.post(p,{_ajax:1,user:a,userhash:o,hash:t,contacts:f},{onDone:function(e,t){return function(e,t,n){var i=geByClass1(s),a=geByClass1(c);addClass(l,i),a&&(a.innerHTML=t,addClass(u,a));autoScroll(function(){return geByClass1(d)},ImportedFriends,{no_cache:!0}),Friends.onImportSuccess(e,t,n),window.opener&&window.opener.Friends.onImportSuccess(e,t,n)}(n,e,t)},onFail:function(){return _(n)}})}(e,t,n)},function(){return _(n)},!0)}};var n="/friends",i="accept",a="decline",o=null,r="/friends.php?act=save_contacts&type=",s="friendsImport__loading",l=s+"_hidden",c="friendsImport__result",u=c+"_shown",d="friendsList__footerBtn_showMore";function f(e,t,i,a,o,r,s,l,c){var u={act:e,hash:i,id:t};a&&(u.from=a),o&&(u.block_id=o),r&&(u.ref=r),s&&(u.track_code=s);var d=n+obj2qs(u);ajax.post(d,{_ajax:1},{onDone:l,onFail:c})}function _(e){Friends.onImportFailed(e),window.opener&&(window.opener.Friends.onImportFailed(e),window.close())}},bYEY:function(e,t,n){"use strict";n.r(t);var i=n("QQoL"),a=function(){var e=window.store,t="/feed?section=notifications";return Object(i.default)({url:t,count:e.notificationsCount,onclick:["nav.onMenuItemClick",t]})};t.default=a;window.uBell=a},"bZ/P":function(e,t,n){"use strict";n.r(t);var i={};function a(e,t){return e+'="'+t+'"'}function o(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return a(e,r(n))}}function r(e){return e[0]+"("+e.slice(1).map(s).join(", ")+")"}function s(e){return"number"==typeof e||"event"===e||"this"===e?e:JSON.stringify(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39").replace(/</g,"&lt;").replace(/>/g,"&gt;")}Object.assign(i,{html:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var a="";return e.forEach(function(e,t){var i=n[t];a+=e+(i||0===i?i:"")}),a}}),Object.assign(i,{attr:a,onBlur:o("onblur"),onClick:o("onclick"),onFocus:o("onfocus"),onInput:o("oninput"),onKeyDown:o("onkeydown"),onKeyPress:o("onkeypress"),onKeyUp:o("onkeyup"),onMouseDown:o("onmousedown"),onMouseUp:o("onmouseup"),onScroll:o("onscroll"),onSubmit:o("onsubmit"),onTouchEnd:o("ontouchend"),onTouchMove:o("ontouchmove"),onTouchStart:o("ontouchstart"),onWheel:o("onwheel"),onChange:o("onchange")}),Object.assign(i,{list:function(e,t){void 0===t&&(t=null);Array.isArray(e)||(e=[e]);return t?e.map(t).join(""):e.join("")}}),Object.assign(i,{class:function(){for(var e=[],t=null,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return i.forEach(function(n){"string"==typeof n?(e.push(n),t=n):n&&(e=e.concat(function(e,t){var n,i=[];"string"==typeof t&&((n={})[t]=!0,t=n);return Object.keys(t).forEach(function(n){var a=t[n];!0===a?i.push(e+"_"+n):a&&i.push(e+"_"+n+"_"+a)}),i}(t,n)))}),e.join(" ")},parseClass:function(e,t){var n={};return t.trim().split(/\s+/).forEach(function(t){if(t!==e){var i=t.replace(e+"_","").split("_");n[i[0]]=!(i.length>1)||i[1]}}),n}});t.default=i;window.q=i},cGUQ:function(e,t,n){"use strict";n.r(t),n.d(t,"fromQueryString",function(){return l}),n.d(t,"toQueryString",function(){return s});var i=n("jE6c"),a={},o=function(e){if(a[e])return e;try{return encodeURIComponent(e)}catch(e){return""}},r=function(e){try{return decodeURIComponent(e)}catch(t){return a[e]=1,e}};function s(e,t){var n=[];for(var a in e)if(e.hasOwnProperty(a)&&null!=e[a]&&!Object(i.isFunction)(e[a]))if(Object(i.isArray)(e[a]))for(var r=0,s=0,l=e[a].length;r<l;++r)null==e[a][r]||Object(i.isFunction)(e[a][r])||(n.push(o(a)+"["+s+"]="+o(e[a][r])),++s);else n.push(o(a)+"="+o(e[a]));return t||n.sort(),n.join("&")}function l(e){if(!e)return{};var t={};return e=e.split("&"),Object(i.each)(e,function(e,n){var i=n.split("=");if(i[0]){var a=r(i[1]+"");if("[]"===i[0].substr(i.length-2)){var o=r(i[0].substr(0,i.length-2));t[o]||(t[o]=[]),t[o].push(a)}else t[r(i[0])]=a}}),t}},cLcH:function(e,t){window.FeedAssistanceExploreBait={onSubscribeLinkClick:function(e,t,d,f,p,h){var m=hasClass(e,n),A=m?f:d,v=m?getLang(s):getLang(r),g=!m,b=geByClass1(o,e),y=(w=e,C=domCA(w,u),intval(domData(C,"block-id")));var w,C;b&&(toggleClass(i,b,g),toggleClass(a,b,!g));attr(e,"aria-label",escapeAttr(v)),toggleClass(n,e,g),p===c?function(e,t,n,i){var a=n?Groups.leave:Groups.enter,o=n?FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_UNSUBSCRIBE:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_SUBSCRIBE;i&&_(o),a.call(Groups,e,t,l)}(t,A,m,h):function(e,t,n,i,a){var o=n?Friends.decline:Friends.accept,r=n?FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_UNSUBSCRIBE:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_SUBSCRIBE;a&&_(r),o.call(Friends,e,t,l,i)}(t,A,m,y,h);return!1}},FeedAssistanceStats.registerTrackingCls("post_exploreBait"),FeedAssistanceStats.onStartViewElement(function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_EXPLORE_BAIT){if(e._exploreBaitClickHandlerAdded)return;d=!0,addEvent(e,"click",function(e){!function(e){var t=e.target,n=p,i=Array.isArray(n),a=0;for(n=i?n:n[Symbol.iterator]();;){var o;if(i){if(a>=n.length)break;o=n[a++]}else{if((a=n.next()).done)break;o=a.value}if(!0===o.call(null,t))return}}(e)}),e._exploreBaitClickHandlerAdded=!0}}),nav.onBeforeGo(function(e){if(!d)return void(f=!1);if(!function(e){return e.tagName&&"explore-bait"===domData(e,"post-type")}(e))return;f=hasClass("item_replies",e),function(e){for(var t=0,n=["pi_text_more","wi_date","pi_text","i_replies","v_replies","item_replies"];t<n.length;t++){if(hasClass(n[t],e))return _(FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_OPENED),!0}}(e)}),page.onChange(function(){if(!d)return;f&&function(){var e=ge("nc_submit");addEvent(e,"click",function(){_(FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_COMMENT)})}()});var n="post__subscribeBtn_unsubscribe",i="post__subscribeBtnIcon_unsubscribe",a="post__subscribeBtnIcon_subscribe",o="post__subscribeBtnIcon",r="mobile_groups_you_are_in_public",s="mobile_groups_public_subscribe",l="feed",c="group",u=".post_exploreBait",d=!1,f=!1;function _(e){FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_EXPLORE_BAIT,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_EXPLORE_BAIT_SUB,e)})}var p=[function(e){if("A"!==e.tagName||!hasClass("item_sel",e))return hasClass("item_like",e)?(_(FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_LIKE),!0):(hasClass("i_like",e)||hasClass("v_like",e))&&!hasClass("item_sel",domPN(e))?(_(FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_LIKE),!0):void 0},function(e){if(domData(e,"post-owner-type"))return _("user"===domData(e,"post-owner-type")?FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_OPEN_USER:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_OPEN_GROUP),!0},function(e){var t={report:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_REPORT,hide:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_HIDE}[domData(e,"post-action")];if(t)return _(t),!0}]},ciqL:function(e,t){var n={show:function(e,t){window.grecaptcha?grecaptcha.reset():(window.recaptchaCallback=function(){n.onCallback(e)},document.body.appendChild(ce("script",{type:"text/javascript",src:"https://www.google.com/recaptcha/api.js?onload=recaptchaCallback&render=explicit&hl="+t})))},onResponse:function(e){ge("field_recaptcha").value=e,ge("recaptcha_form").submit()},onCallback:function(e){if(grecaptcha&&e){var t=geByClass1("recaptcha_box"),i=geByClass1("recaptcha",t);i&&(val(i,""),grecaptcha.render(i,{sitekey:e,callback:n.onResponse}))}}};window.ReCaptcha=n},eGQV:function(e,t,n){"use strict";n.r(t);var i=function(){function e(){this.registration=null,this._handlers=[]}e.isSupported=function(){try{return!(!window.fetch||!navigator.serviceWorker)}catch(e){return!1}};var t=e.prototype;return t.listenMessages=function(){navigator.serviceWorker.addEventListener("message",this._onmessage.bind(this))},t.register=function(t){if(!e.isSupported())return Promise.reject("SW: serviceWorker is unavailable");var n=t&&t.url;return n?navigator.serviceWorker.register(n,{scope:"/",updateViaCache:"none"}).then(function(e){return this.registration||(this.registration=e),e}.bind(this)):Promise.reject("SW: incorrect url")},t.getRegistration=function(){return e.isSupported()?navigator.serviceWorker.ready.then(function(e){return this.registration||(this.registration=e),e}.bind(this)):Promise.reject("SW: serviceWorker is unavailable")},t.unregister=function(){this.registration&&this.registration.unregister(),this._handlers.forEach(function(e){return e[0].removeEventListener(e[1],e[2])}),this._handlers=[]},t.update=function(){this.registration&&this.registration.update()},t._addEventListener=function(e,t,n,i){void 0===i&&(i=!0);var a=!1;this._handlers.forEach(function(i){i[0]===e&&i[1]===t&&i[2]===n&&(a=!0)}),a&&!i||(this._handlers.push([e,t,n]),e.addEventListener(t,n))},t.action_devicePixelRatio=function(){return window.devicePixelRatio},t.action=function(e,t){var n=null;return n=Array.isArray(e)?e:[[e,t]],this._message({actions:n}).then(function(e){return e.answers?Promise.resolve(1===n.length?e.answers[0]:e.answers):Promise.reject(new Error("ServiceWorker answer is incorrect"))})},t._message=function(e){var t=this;return this.getRegistration().then(function(){return new Promise(function(t,n){var i=new MessageChannel;i.port1.onmessage=function(e){this._messageCheck(e)?t(e.data.data):n(new Error("ServiceWorker message is incorrect"))}.bind(this),this.registration.active.postMessage(this._messageWrap(e),[i.port2])}.bind(t))})},t._onmessage=function(e){if(this._messageCheck(e)){var t=e.data.data;if(t.actions&&Array.isArray(t.actions)){var n=[];t.actions.forEach(function(t){var i="action_"+t[0],a=t[1],o=this[i]?this[i](a,e):void 0;o instanceof Promise||(o=Promise.resolve(o)),n.push(o)}.bind(this)),Promise.all(n).then(function(t){var n={};t.forEach(function(e,t){void 0!==e&&(n[t]=e)}),Object.keys(n).length&&e.ports[0].postMessage(this._messageWrap({answers:n}))}.bind(this))}}},t._messageCheck=function(e){return(""===e.origin||e.origin.match(/^https:\/\/([a-zA-Z0-9\-\.]+\.)?vk\.com$/))&&e.data&&e.data.data&&"sw"===e.data.type},t._messageWrap=function(e){return{type:"sw",data:e}},e}();i.SW_NOT_AVAILABLE_ERROR="SW: serviceWorker is unavailable";var a=n("H5mD"),o=function(){if(!("fetch"in window))return function(){};var e=["standalone","fullscreen","minimal-ui"],t="#f8f9fa",n=128,i=48,o=32,r=navigator.vendor&&-1!==navigator.vendor.indexOf("Apple");function s(e,t,n){void 0===n&&(n=!1);var i=l(e);if((i.drawImage(e,0,0),!n)&&255==i.getImageData(0,0,1,1).data[3])return null;return i.globalCompositeOperation="destination-over",i.fillStyle=t,i.fillRect(0,0,e.width,e.height),i.canvas.toDataURL()}function l(e){var t=void 0===e?{width:1,height:1}:e,n=t.width,i=t.height,a=document.createElement("canvas");return a.width=n,a.height=i,a.getContext("2d")}return function(){if(r){var c=document.head.querySelector('link[rel="manifest"]'),u=c?c.href:"",d=function(e){for(var t=function(t){var n=e[t];try{return new URL("",n),{v:function(e){return new URL(e,n).toString()}}}catch(e){}},n=0;n<e.length;++n){var i=t(n);if("object"==typeof i)return i.v}return function(e){return e}}([u,window.location]);Promise.resolve().then(function(){if(!u)throw'can\'t find <link rel="manifest" href=".." />\'';var e={};return"use-credentials"===u.crossOrigin&&(e.credentials="include"),window.fetch(u,e)}).then(function(e){return e.json()}).then(function(r){return function(r,c){var u=r.icons||[];u.sort(function(e,t){return parseInt(t.sizes,10)-parseInt(e.sizes,10)});var d=u.map(function(e){return function(e,t){var n=document.createElement(e);for(var i in t)n.setAttribute(i,t[i]);return n}("link",{rel:"apple-touch-icon",href:c(e.src),sizes:e.sizes})}),f=r.display,_=-1!==e.indexOf(f);p=r.background_color||t,h=function(e){var t=l();return t.fillStyle=e,t.fillRect(0,0,1,1),t.getImageData(0,0,1,1).data}(p).map(function(e){var t=e/255;return t<.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}),m=.2126*h[0]+.7152*h[1]+.0722*h[2],Math.abs(1.05/(m+.05)),r.name||r.short_name||document.title;var p,h,m;navigator.standalone||(A="apple-mobile-web-app-capable",(v=_)&&(!0===v&&(v="yes"),function(e,t){var n=document.createElement(e);for(var i in t)n.setAttribute(i,t[i]);document.head.appendChild(n)}("meta",{name:A,content:v})));var A,v;function g(e,a,s){var c=e.width,u=e.height,d=window.devicePixelRatio,f=l({width:c*d,height:u*d});if(f.scale(d,d),f.fillStyle=r.background_color||t,f.fillRect(0,0,c,u),f.translate(c/2,(u-o)/2),s){var _=s.width/d,p=s.height/d;p>n&&(_/=p/n,p=n),_>=i&&p>=i&&(f.drawImage(s,_/-2,p/-2,_,p),f.translate(0,p/2+o))}var h=document.createElement("link");return h.setAttribute("rel","apple-touch-startup-image"),h.setAttribute("media","screen and (orientation: "+a+")"),h.setAttribute("href",f.canvas.toDataURL()),h}var b=new Set;function y(e){var t=g(window.screen,"portrait",e),n=g({width:window.screen.height,height:window.screen.width},"landscape",e);b.forEach(function(e){return e.remove()}),document.head.appendChild(t),document.head.appendChild(n),b.add(t),b.add(n)}if(y(null),!d.length||a.isIPad)return;var w=d[0],C=new Image;C.crossOrigin="anonymous",C.onload=function(){if(y(C),r.background_color){var e=s(C,r.background_color);null!==e&&(w.href=e,d.slice(1).forEach(function(e){var t=new Image;t.crossOrigin="anonymous",t.onload=function(){var n=s(t,r.background_color,!0);e.href=n},t.src=e.href}))}},C.src=w.href}(r,d)}).catch(function(e){return console.warn("pwacompat.js error",e)})}}}(),r=n("JX7q"),s=n("dI71"),l=n("W9Tc");function c(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),i=new Uint8Array(n.length),a=0;a<n.length;++a)i[a]=n.charCodeAt(a);return i}var u=n("W0P9"),d=n("Xrg9"),f=function(){function e(e,t){var n=this;this.sw=e,this.SWClient=t,vk.id&&this.canBeEnabled().then(function(e){e&&(n.listenPermission(),n.loadEndpoint()&&n.update().then(n.checkMessageState.bind(n)))})}e.getPermission=function(){return Notification.permission};var t=e.prototype;return t.cleanNotification=function(){this.sw.action("cleanNotification")},t.canBeEnabled=function(){return Promise.resolve(this.isSupported())},t.isSupported=function(){return"PushManager"in window&&"Notification"in window&&this.SWClient.isSupported()},t.loadEndpoint=function(){return d.default.get("push_notifier_endpoint"+vk.id)||!1},t.saveEndpoint=function(e){d.default.set("push_notifier_endpoint"+vk.id,e||!1)},t.action=function(e,t){return this.sw.action(e,t)},t._needupdate=function(e){var t=Date.now(),n=this.loadEndpoint(),i=d.default.get("push_notifier_subscribed_ts"+vk.id),a=!1;return(n!==e.endpoint||!i||t-i>6e4)&&(d.default.set("push_notifier_subscribed_ts"+vk.id,t),a=!0),a},t.listenPermission=function(){var e=this;Object(l.partConfigEnabled)("push_notifier")&&navigator.permissions&&navigator.permissions.query&&navigator.permissions.query({name:"notifications"}).then(function(t){t.onchange=function(){return e.update()}})},t.update=function(){var t=this;return this.updatePermission().then(function(n){return n===e.PUSH_NOTIFIER_PERMISSION_GRANTED?t.subscribe().catch(function(t){t!==e.SUBSCRIBE_ERROR_NETWORK&&t("can not update subscribe")}):Promise.reject("premession_not_granted")}).catch(u.error)},t.updatePermission=function(){var t=e.getPermission();if(t!==e.PUSH_NOTIFIER_PERMISSION_GRANTED){var n=this.loadEndpoint();if(n)return this.unsubscribe(n).then(function(){return t})}return Promise.resolve(t)},t.processSubscribe=function(t){return t.subscribe({userVisibleOnly:!0,applicationServerKey:c(e.SERVER_KEY)})},t.setupSubscription=function(){var t=this;return new Promise(function(n,i){var a=e.getPermission(),o=function(){t.subscribe(!0).then(function(){n()}).catch(function(){i()})};a!==e.PUSH_NOTIFIER_PERMISSION_DENIED?a!==e.PUSH_NOTIFIER_PERMISSION_GRANTED?a===e.PUSH_NOTIFIER_PERMISSION_DEFAULT&&t.requestPermission().then(function(t){t===e.PUSH_NOTIFIER_PERMISSION_GRANTED?o():i()}):o():i(e.PUSH_NOTIFIER_BLOCKED_BY_BROWSER_SETTINGS)})},t.subscribe=function(t){var n=this;return this.sw.getRegistration().then(function(e){var t=e.pushManager;return t.getSubscription().then(function(e){if(e){var i=e.expirationTime;return i&&Date.now()>i-432e6?n.unsubscribe(n.loadEndpoint()).then(function(){return n.processSubscribe(t)}):e}return n.processSubscribe(t)})}).then(function(i){return new Promise(function(a,o){if(t||n._needupdate(i)){var r=i.getKey("p256dh"),s=i.getKey("auth");window.ajax.post(e.SERVER_URL,{act:"a_subscribe",endpoint:i.endpoint,key:r?btoa(String.fromCharCode.apply(null,new Uint8Array(i.getKey("p256dh")))):null,token:s?btoa(String.fromCharCode.apply(null,new Uint8Array(i.getKey("auth")))):null},{onDone:function(e){e?(n.saveEndpoint(i.endpoint),a()):o()},onFail:function(){return o(e.SUBSCRIBE_ERROR_NETWORK),!0}})}else a()})})},t.unsubscribe=function(t){var n=this;return this.sw.register().then(function(i){return i.pushManager.getSubscription().then(function(i){return i?i.unsubscribe().then(function(i){return i?new Promise(function(i,a){ajax.post(e.SERVER_URL,{act:"a_unsubscribe",endpoint:t},{onDone:function(e){e?(n.saveEndpoint(!1),i()):a()}})}):Promise.reject("ERROR: can not unsubscribe")}):(n.saveEndpoint(!1),Promise.reject("ERROR: no subscription"))})})},t.requestPermission=function(){var t=e.getPermission();return t===e.PUSH_NOTIFIER_PERMISSION_DEFAULT?new Promise(function(e,t){var n=Notification.requestPermission(function(t){e(t)});n instanceof Promise&&n.then(e,t)}):Promise.resolve(t)},t.checkMessageState=function(){var t=this;return new Promise(function(e){return setTimeout(e,5e3)}).then(function(){return t.action("getMessagesMetaData")}).then(function(t){return"object"==typeof t&&Object.keys(t).length?new Promise(function(n,i){window.ajax.post(e.SERVER_URL,{act:"a_update_messages_state",data:Object.entries(t)},{onDone:function(e){e?n(e):i("ERROR: act error")},onFail:function(){return i("ERROR: network error"),!0}})}):Promise.resolve({})}).then(function(e){try{return JSON.parse(e)}catch(e){return{}}}).then(function(e){return t.action("updateMessageNotifications",e)}).catch(function(e){return Object(u.error)(e)})},e}();f.SERVER_KEY="BPrntRk2W1_ISFwlgY-vz9tQDg9i1oSQ3-N8xyjdbNAbIOdZIGFdh5FlO7zn730UwU9Sayoec-Fpqq4JZFTyv60",f.SERVER_URL="push_notifier",f.PUSH_NOTIFIER_PERMISSION_GRANTED="granted",f.PUSH_NOTIFIER_PERMISSION_DEFAULT="default",f.PUSH_NOTIFIER_PERMISSION_DENIED="denied",f.PUSH_NOTIFIER_BLOCKED_BY_BROWSER_SETTINGS="BLOCKED_BY_BROWSER_SETTINGS",f.SUBSCRIBE_ERROR_NETWORK="SUBSCRIBE_ERROR_NETWORK";var _=f,p=n("PovR"),h=function(e){function t(t,n){var i;return i=e.call(this,t,n)||this,vk.id&&i.canBeEnabled().then(function(e){e&&(i.updateHeadClass(),i.handlerMessagesLP=i.handlerMessagesLP.bind(Object(r.default)(i)),page.onChange(function(){return i.updateHeadClass()}))}),i}Object(s.default)(t,e);var n=t.prototype;return n.canBeEnabled=function(){var t=this;return e.prototype.canBeEnabled.call(this).then(function(e){return e?t.isNativeAppInstalled().then(function(e){return!e}):Promise.resolve(!1)})},n.isSupported=function(){return e.prototype.isSupported.call(this)&&(browser.chrome||browser.mozilla)},n.updateHeadClass=function(){var e=_.getPermission();document.head&&(removeClass(document.head,"push_notifier_"+_.PUSH_NOTIFIER_PERMISSION_GRANTED),removeClass(document.head,"push_notifier_"+_.PUSH_NOTIFIER_PERMISSION_DENIED),removeClass(document.head,"push_notifier_"+_.PUSH_NOTIFIER_PERMISSION_DEFAULT),e&&addClass(document.head,"push_notifier_"+e),addClass(document.head,"push_notifier_supported"))},n.handlerMessagesLP=function(e,t){this.sw.action("removeMessageNotification",{peerId:t,msgId:e})},n.cleanNotification=function(){this.sw.action("cleanNotification")},n.removeLongPollListener=function(){this.lp&&this.lp.off(),this.lp=null},n.addLongPollListener=function(){window.isNewMail&&window.isNewLongpoll&&!this.lp&&(this.lp=window.im.onMsgReadByMe(this.handlerMessagesLP))},n.isNativeAppInstalled=function(){var e=Date.now(),n=d.default.get(t.PUSH_NOTIFIER_LS_KEY_RELATED_APPS_TS),i=d.default.get(t.PUSH_NOTIFIER_LS_KEY_RELATED_APPS);return new Promise(function(a){null!==i&&n&&e-n<t.PUSH_NOTIFIER_LS_TTL_RELATED_APPS?a(!!i):"getInstalledRelatedApps"in navigator?navigator.getInstalledRelatedApps().then(function(n){var i=Object.values(n).some(function(e){return"com.vkontakte.android"===e.id});d.default.set(t.PUSH_NOTIFIER_LS_KEY_RELATED_APPS_TS,e),d.default.set(t.PUSH_NOTIFIER_LS_KEY_RELATED_APPS,i),a(i)}).catch(function(){a(!1)}):a(!1)})},n.update=function(){var t=this;return e.prototype.update.call(this).then(function(){t.updateHeadClass(),t.addLongPollListener()})},n.unsubscribe=function(t){var n=this;return e.prototype.unsubscribe.call(this,t).then(function(){return n.removeLongPollListener()})},t}(_);h.PUSH_NOTIFIER_LS_KEY_RELATED_APPS="push_notifier_related_apps",h.PUSH_NOTIFIER_LS_KEY_RELATED_APPS_TS="push_notifier_related_apps_ts",h.PUSH_NOTIFIER_LS_TTL_RELATED_APPS=p.HOUR/2;var m=h;n.d(t,"init",function(){return b}),n.d(t,"isStandalone",function(){return y}),n.d(t,"isOfflineCapable",function(){return w});var A,v=new i;window.sw_client=v,window.SWClient=i,window.initPushNotifier=function(){try{window.PushNotifier=m,window.pushNotifier=new m(v,i)}catch(e){}};var g=!1;function b(){window.addEventListener&&(!function(){if(g=!0===navigator.standalone||window.matchMedia&&matchMedia("(display-mode: standalone)").matches,!history.replaceState)return;var e=location.search;if((e=(e=(e=e.replace(/(\?|&)mode\=([^&]+)(&)?/,"$1")).replace(/(\?|&)__appshell_fallback\=([^&]+)(&)?/,"$1")).replace(/(\?|&)+$/,""))!==location.search){var t=location.pathname+e+location.hash;history.replaceState(null,"",t)}}(),function(){if(!i.isSupported())return;v.listenMessages(),navigator.serviceWorker.addEventListener("message",function(e){var t=e.data;t&&t.action&&"update-ready"===t.action&&(hasUpdate=!0)})}(),window.addEventListener("beforeinstallprompt",function(e){e.preventDefault()}),window.addEventListener("appinstalled",function(){statlogsValueEvent("pwa_installed_event",1)}),"complete"===document.readyState?C():window.addEventListener("load",function(){C()}))}function y(){return g}function w(){return void 0===A&&(A=!(!i.isSupported()||!navigator.serviceWorker.controller)),A}function C(){window.vk&&window.vk.sw&&(v.register(window.vk.sw).then(function(e){},function(e){if(e!==i.SW_NOT_AVAILABLE_ERROR)throw e}),i.isSupported()&&navigator.serviceWorker.getRegistration().then(function(e){!function(e){if(!w())return;e&&e.active&&e.installing&&e.installing.postMessage({action:"activate"})}(e)}),o())}b()},eoxF:function(e,t){var n=function(){var e=null,t=!1,i=!1,a={},o=[],r=0,s=null,l="",c="";function u(e,t){return!t&&v(e)}function d(e){i=!1;var n=ge("medias_map"),a=ge("attached_wrap");n||(n=ce("div",{id:"medias_map",className:"pi_medias"}),append(n,a));var o=+e[1]||0,r=e[3]||"",s=e[4]||"",l=e[5]||"",c=(+e[6].lat||0)+"_"+(+e[6].lng||0),u=geByClass1("medias_map",n),d='<div class="medias_map_close" onclick="checkin.remove();"><i class="i_close">&nbsp;</i></div><div class="medias_map_label" onclick="checkin.changePlace();">'+r+(l?", "+l:s?", "+s:"")+"</div>",f='<input type="hidden" name="place_id" value="'+o+'"><input type="hidden" name="place" value="'+c+'">';if(u)val(u,d+f);else{d='<div class="medias_map">'+d+f+"</div>";val(n,d)}addClass("cp_geo_btn_sel","geo_btn"),t=!0,show(n)}function f(t){return v(e)}function _(){val("place_add_box",""),hide("place_add_box"),show("places_box")}function p(t,n){h();var i=a[n];i&&(e={latitude:+i[6].lat||0,longitude:+i[6].lng||0},n?d(i):m(e,i))}function h(e){if(!s)return!0;val("m",s),s=null,scrollToEl(geByClass1("create_post_extra","mcont"));var t=nav.path+(nav.params?"?"+nav.params:"");return nav.go(t,null,{push_only:!0,no_push:e}),!1}function m(e,n){i=!0;var a=ge("medias_map"),o=ge("attached_wrap");a||(a=ce("div",{id:"medias_map",className:"pi_medias"}),o.appendChild(a));var r=e.latitude,s=e.longitude,l=(window.devicePixelRatio,n&&n[4]||!1),c=geByClass1("medias_map",a),u=l?'<div class="medias_map_close" onclick="checkin.remove();"><i class="i_close">&nbsp;</i></div><div class="medias_map_label" onclick="checkin.changePlace();">'+l+"</div>":"",d='<input type="hidden" name="map" value="'+(r+"_"+s+"_0")+'">';c?val(c,u+""+d):val(a,'<div class="medias_map">'+u+d+"</div>");t=!0,addClass("cp_geo_btn_sel","geo_btn"),show(a)}function A(){e=null,a={},o=[],r=0,ajax.post(c,{_ajax:1}),remove("medias_map")}function v(e){var t=window.al;remove("feed_extra_field");var n=Math.round(1e8*e.latitude)/1e8,i=Math.round(1e8*e.longitude)/1e8,a=gpeByTag("form","geo_btn"),o=ce("input",{id:"feed_extra_field",type:"hidden",name:"add_place",value:n+","+i});if(!a)return nav.go(nav.path+"?act=places&lat="+n+"&lng="+i);var r=!1;return each(a,function(e,t){if("submit"===t.type)return r=t,!1}),r?(append(o,a),window.al&&t.ver?nav.go(r,null,{removeAfterNextResponse:!1}):a.submit()):void 0}function g(t){t&&t.coords&&u(e={latitude:+t.coords.latitude||0,longitude:+t.coords.longitude||0})}function b(e){n.remove(),hide("geo_waiting")}return{toggle:function(){t?n.remove():n.add()},addNewPlace:function(){var t=val("place_name_fld"),n=val("place_address_fld");return t?(lockButton("place_add_btn"),ajax.post("/places.php",{_ajax:1,act:"add_place",latitude:e.latitude,longitude:e.longitude,title:t,address:n,hash:l},{onDone:function(e,t){if(unlockButton("place_add_btn"),e){var n={};n[e]=t,extend(a,n),o.splice(o[0]?0:1,0,e),_(),p(null,e)}},onFail:function(){unlockButton("place_add_btn");var e=Array.prototype.slice.call(arguments),t=e.shift(),n=ge("place_add_form");switch(t){case 2:n&&n.submit()}}}),!1):(elfocus("place_name_fld"),!1)},addPlaceShow:function(t,n){var i=window.lang,a="/places.php"+obj2qs({act:"add_place",latitude:e.latitude,longitude:e.longitude,hash:l});val("place_add_box",'<h4 class="sub_header">'+i.mobile_geo_new_place_header+'</h4><div class="form_item fi_fat"><form id="place_add_form" action="'+a+'" method="post"><dl class="fi_row"><dt class="fi_label">'+i.mobile_geo_place_name_label+'</dt><dd class="iwrap"><input type="text" class="textfield" id="place_name_fld" name="title" /></dd></dl><dl class="fi_row"><dt class="fi_label">'+i.mobile_geo_place_address_label+'</dt><dd class="iwrap"><input type="text" class="textfield" id="place_address_fld" name="address" /></dd></dl><dl class="fi_row"><dd><input class="button" type="submit" id="place_add_btn" value="'+i.mobile_geo_place_add_btn+'" onclick="return checkin.addNewPlace(this);" /><a class="near_btn" onclick="checkin.addPlaceCancel(); return false;">'+i.mobile_cancel+"</a></dd></dl></form></div>"),val("place_name_fld",unescapeAttr(t)||""),val("place_address_fld",unescapeAttr(n)||""),hide("places_box"),show("place_add_box"),t?elfocus("place_address_fld"):elfocus("place_name_fld")},addPlaceCancel:_,selectPlace:p,changePlace:f,back:h,refreshCurrentPosition:function(){geo.getCurrentPosition(g,b)},getCurrentAddress:function(){return a[0]&&a[0][5]||""},savePlaces:function(e){extend(a,e)},add:function(n){if(!n&&t)return f();n&&(n.latitude||n.longitude)&&n.place?(e={latitude:+n.latitude||0,longitude:+n.longitude||0},n.place[1]?d(n.place):m(e,n.place),u(e,!0)):(geo.getCurrentPosition(g,b),show("geo_waiting"))},add_place:function(n){if(!n&&t)return f();n&&(n.latitude||n.longitude)&&n.place?(e={latitude:+n.latitude||0,longitude:+n.longitude||0},n.place[1]?d(n.place):m(e,n.place),u(e,!0)):(geo.getCurrentPosition(g,b),show("geo_waiting"))},remove:function(){t=!1,removeClass("cp_geo_btn_sel","geo_btn"),A()},stash:function(n){if(!n)return[e,t,i,a,o,r,s];e=n[0],t=n[1],i=n[2],a=n[3],o=n[4],r=n[5],s=n[6]},init:function(u,d,f){return hide("geo_waiting"),e=null,t=!1,i=!1,a={},o=[],r=0,s=null,l=d||"",c=f||"",u&&n.add(u),geo.init()}}}();window.checkin=n},eyw1:function(e,t){var n=function(){var e="/club",t="enter",n="leave",i=null;function a(t,n,i,a,o,r){var s=e+n+obj2qs({act:t,hash:i,id:n,from:a});ajax.post(s,{_ajax:1},{onDone:o,onFail:r})}return{enter:function(e,n,o,r,s){void 0===r&&(r=i),void 0===s&&(s=i),a(t,e,n,o,r,s)},leave:function(e,t,o,r,s){void 0===r&&(r=i),void 0===s&&(s=i),a(n,e,t,o,r,s)}}}();window.Groups=n},fWqt:function(e,t,n){"use strict";n.r(t);var i={};n.r(i),n.d(i,"onConfirmDelete",function(){return d}),n.d(i,"open",function(){return f}),n.d(i,"close",function(){return _}),n.d(i,"isDeleteMessagesForAll",function(){return p});var a=n("MUpH"),o=n("bZ/P"),r=n("+cqQ"),s=n("iS9e");function l(){var e=Object(a.default)(["\n    ","\n    ","\n  "]);return l=function(){return e},e}var c="MsgDeleteDialog__checkboxInput",u=null,d=Object(r.default)();function f(e){s.default.open({body:h(e),confirmText:lang.mobile_mail_delete_popup_delete,cancelText:lang.mobile_mail_delete_popup_cancel,onConfirm:o.default.onClick("MsgDeleteDialog.onConfirmDelete"),onClose:o.default.onClick("MsgDeleteDialog.close")})}function _(){var e=$("."+c);e&&(u=e.checked,lsSet("delete_message_for_all_checked",u)),s.default.close()}function p(){var e=$("."+c);return!!e&&e.checked}function h(e){var t,n,i=e.isEditing,a=e.canDeleteForAll;if(i)t=lang.mobile_mail_dialog_msg_delete_for_all;else{var r=Object.keys(store.mail.cur.msgSelected).length;t=langNumeric(r,lang.mobile_mail_dialog_msg_delete_N)}if(!i&&a){var s=lang.mobile_mail_delete_for_all,d=function(){if("boolean"!=typeof u){var e=!!lsGet("delete_message_for_all_checked");u=e}return u}()?"checked":"";n='\n      <div class="MsgDeleteDialog__checkbox">\n        <label class="MsgDeleteDialog__checkboxIn">\n          <input type="checkbox" class="'+c+'" '+d+'>\n          <span class="MsgDeleteDialog__checkboxLabel">'+s+"</span>\n        </label>\n      </div>\n    "}return o.default.html(l(),t,n)}t.default=i;window.MsgDeleteDialog=i},fYoA:function(e,t){window.SettingsNotifyGroup={},SettingsNotifyGroup._onChange=i;var n={notifyGroup:".settingsNotifyGroup",description:".settingsNotifyGroup__description"};function i(e,t){t.$control.closest(n.notifyGroup).$(n.description).innerHTML=e}},fdw3:function(e,t,n){"use strict";n.r(t),n.d(t,"isObject",function(){return l}),n.d(t,"isJS",function(){return c}),n.d(t,"log",function(){return u}),n.d(t,"mergeObjects",function(){return d}),n.d(t,"concatValues",function(){return f}),n.d(t,"isNewNavigation",function(){return _}),n.d(t,"isFinite",function(){return p}),n.d(t,"getLang",function(){return h}),n.d(t,"insertBetween",function(){return m}),n.d(t,"stringifyJSON",function(){return A}),n.d(t,"parseJSON",function(){return v}),n.d(t,"wrapCommunityMailUrl",function(){return g}),n.d(t,"mailReplaceMentions",function(){return b}),n.d(t,"mailReplaceDomainMentions",function(){return y}),n.d(t,"getState",function(){return w}),n.d(t,"wdToFlatArray",function(){return C});var i=n("9M99");n.d(t,"emojiToHTML",function(){return i.emojiToHTML});var a=n("qHA9");n.d(t,"isChatPeer",function(){return a.isChatPeer}),n.d(t,"isForwardedMessageId",function(){return a.isForwardedMessageId});var o=n("OcsD");n.d(t,"extend",function(){return o.extend});var r=n("j80l");n.d(t,"makeUrl",function(){return r.makeUrl});var s=n("TYsd");function l(e){return Object(o.isObject)(e)}function c(){return!0}function u(){var e;(e=console).log.apply(e,arguments)}function d(e,t){return Object.assign(e,t)}function f(e,t){return e+t}function _(){return window.isNewNavigation}function p(e){return window.isFinite(e)}function h(e){return window.getLang(e)}function m(e,t){var n=[];return e.forEach(function(i,a){var o=e[a+1],r=e[a+2];i&&n.push(i),i&&(o||r)&&n.push(t)}),n}function A(e){return JSON.stringify(e)}function v(e){return JSON.parse(e)}function g(e){return Object(a.wrapCommunityUrl)(e)}function b(e,t){return e.replace(a.MENTION_REGEXP,t)}function y(e,t){return e.replace(a.MENTION_DOMAIN_REGEXP,t)}function w(e){return window.isomorphicState[e]||[]}function C(e){return s.default.toFlatArray(e).map(s.default.innerItemToString)}},gF8j:function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return r}),n.d(t,"getVisibilityState",function(){return c}),n.d(t,"getVisiblityEvent",function(){return u});var i=n("uQjJ"),a=n("JuPy"),o=browser.iphone||browser.ipad||browser.ipod;function r(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=extend({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function s(e,t,n){Object(a.isMvk)()?window.addEvent(e,t,n,{passive:!0}):window.addEvent(e,t,n)}function l(e,t,n){Object(a.isMvk)()?window.removeEvent(e,t,n,{passive:!0}):window.removeEvent(e,t,n)}function c(){return document.visibilityState||document.webkitVisibilityState}function u(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}extend(r.prototype,i.default.prototype),extend(r.prototype,{stop:function(){this.started=!1,l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),Object(a.isMvk)()&&this._isTopLevel()&&u()&&l(document,u(),this.onVisiblityChange),Object(a.isMvk)()&&o||(l(this.opts.focusElement,"focus",this.cbActiveB),l(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!Object(a.isMvk)()&&browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),Object(a.isMvk)()&&this._isTopLevel()&&u()&&s(document,u(),this.onVisiblityChange),Object(a.isMvk)()&&o||(s(this.opts.focusElement,"focus",this.cbActiveB),s(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(s(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),s(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout))},getActiveTime:function(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange:function(){"visible"===c()?this.cbActiveB():this.cbInactiveB()},_isTopLevel:function(){var e=this.opts.focusElement;return e===window||e===document},_isFocused:function(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=c();return"string"==typeof t&&"visible"===t}return document.activeElement===e}})},gNTM:function(e,t){var n=function(){var e=null,t=!1;function i(e,t){var n=ge("medias_map"),i=ge("attached_wrap");n||(n=ce("div",{id:"medias_map",className:"pi_medias"}),i.appendChild(n));var a=e.latitude,o=e.longitude,r=(window.devicePixelRatio,geByClass1("medias_map",n)),s=t?'<div class="medias_map_close"><i class="i_close">&nbsp;</i></div><div class="medias_map_label">'+t+"</div>":"",l='<input type="hidden" name="map" value="'+(a+"_"+o+"_0")+'">';r?val(r,s+""+l):val(n,'<div class="meias_row medias_map" onclick="geoloc.remove();">'+s+l+"</div>");show(n)}function a(){e=null,remove("medias_map")}function o(t){var n;t&&t.coords&&(e={latitude:+t.coords.latitude||0,longitude:+t.coords.longitude||0},n=e,ajax.post("/places.php",{_ajax:1,act:"map_label",lat:n.latitude,lng:n.longitude},{onDone:function(e){hide("geo_waiting"),i(n,e)},onFail:r}))}function r(e){n.remove(),hide("geo_waiting")}return{toggle:function(){t?n.remove():n.add()},add:function(n){!n&&t||(t=!0,addClass("cp_geo_btn_sel","geo_btn"),n&&(n.latitude||n.longitude)?i(e={latitude:+n.latitude||0,longitude:+n.longitude||0},n.label):(geo.getCurrentPosition(o,r),show("geo_waiting")))},remove:function(){t&&(t=!1,removeClass("cp_geo_btn_sel","geo_btn"),a())},init:function(e){return e&&n.add(e),geo.init()}}}();window.geoloc=n},gunf:function(e,t){window.LoginHistory={_onSubmit:function(e,t,n){var i=geByClass1("loginHistory__iframe");preventEvent(e),t.submit(),addEvent(i,"load",function(){return nav.go(n,null,{isForm:!0})})}}},gy8s:function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("Mc5h"),o=n("9y81"),r=n("AXyT"),s=function(e){var t=i.default.class(e.mix,"Unfold",{position:e.position,asIcon:!!e.icon||!!e.icon_html,open:e.opened,withTitle:!!e.title}),n=i.default.list(e.items,c);return Wd.html({class:t,"data-name":e.name,onclick:e.onclick,inner:[l(e),{class:"Unfold__popup ScrollView "+e.popup_class,inner:Wd.wrap(n)}]})};function l(e){var t,n=e.title;if(e.icon)t=Object(o.default)({icon:e.icon});else if(e.icon_html)t=e.icon_html;else{for(var r=e.items,s=r.length,l="",c="",u=0;u<s;u++){var d=r[u];if(d&&d.active){l=d.text,c=d.activeCount;break}}t=[Object(a.default)({mix:"Unfold__triggerText",tag:"h1",inner:[Wd.html({class:"Unfold__triggerContent",inner:n?[{class:"Unfold__triggerContentTitle",inner:n},{class:"Unfold__triggerContentSubTitle",inner:l}]:[l,c?Wd.html(Object(a.default)({mix:"Unfold__triggerTextCount",inner:c})):""]})]}),Object(o.default)({mix:"Unfold__triggerIcon",icon:"reveal"})],t=i.default.list(t)}return{href:e.opened?e.close_url:e.open_url,class:"Unfold__trigger",onclick:["Unfold._onTriggerClick","event"],onmousedown:["Unfold._onTriggerMouseDown","this"],attrs:e.trigger_attrs,inner:Wd.wrap(t)}}function c(e){if(!e)return"";var t="";return e.icon&&(t="string"==typeof e.icon?Object(o.default)({mix:"Unfold__itemIcon",icon:e.icon}):Object(a.default)({mix:i.default.class("Unfold__itemIcon",e.icon.class)})),Object(a.default)({mix:i.default.class(e.mix,"_touched","replaceState","Unfold__item",{active:e.active,name:e.name,disabled:e.disabled}),url:e.url,tag:e.tag,attrs:e.attrs,inner:[t,Object(a.default)({mix:"Unfold__itemText",inner:[e.text,e.count?Object(a.default)({mix:"Unfold__itemCountHidden",inner:e.count}):""]}),e.count?Object(r.default)({mix:"Unfold__itemCount",gray:!0,value:e.count}):""]})}var u=n("jk6M");Object.assign(s,{onOpen:befall.kind("unfoldName"),getByName:function(e){return $(f.unfoldByName(e))},setActive:function(e,t){var n,i;1===arguments.length?e=(i=e).closest(f.unfold):i=e.$(f.itemByName(t));if((n=e.$(f.itemActive))&&i){n.classList.remove(d.itemActive),i.classList.add(d.itemActive);var a=e.$(f.triggerText),o=i.$(f.itemText);a.innerText=o.textContent.trim()}},setCount:function(e,t,n){var i=e.$(f.itemCountByName(t));r.default.setValue(i,n)},setTitle:function(e,t,n){e.$(f.itemByName(t)).$(f.itemText).innerText=n},toggleItemEnabled:function(e,t,n){void 0===n&&(n=!0);var i=e.$(f.itemByName(t));i&&i.classList.toggle(d.itemDisabled,!n)},changePosition:function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!1);var i;e.classList.remove(d.positionTopLeft,d.positionTopRight,d.positionBottomLeft,d.positionBottomRight),i=t?n?d.positionTopLeft:d.positionBottomLeft:n?d.positionTopRight:d.positionBottomRight;e.classList.add(i)}}),s._onTriggerMouseDown=p,s._onTriggerClick=_;var d={itemActive:"Unfold__item_active",itemDisabled:"Unfold__item_disabled",open:"Unfold_open",positionTopLeft:"Unfold_position_topLeft",positionTopRight:"Unfold_position_topRight",positionBottomLeft:"Unfold_position_bottomLeft",positionBottomRight:"Unfold_position_bottomRight"},f={unfold:".Unfold",unfoldByName:function(e){return'.Unfold[data-name="'+e+'"]'},itemActive:"."+d.itemActive,itemByName:function(e){return".Unfold__item_name_"+e},itemCountByName:function(e){return f.itemByName(e)+" .Unfold__itemCount"},item:".Unfold__item",itemDisabled:"."+d.itemDisabled,triggerText:".Unfold__triggerText",itemText:".Unfold__itemText",popup:".Unfold__popup"};function _(e){preventEvent(e)}function p(e){var t=e.closest(f.unfold),n=u.isTouch?"touchend":"mousedown",i=u.isTouch?"touchend":"mouseup",a=!u.isTouch&&window.innerWidth<882,o=t.getAttribute("data-name"),r=!1;function l(){t.classList.remove(d.open),document.removeEventListener("keydown",_),document.removeEventListener("touchmove",c),document.removeEventListener(n,h,!0),document.removeEventListener(i,p,!0)}function c(e){e.target.closest(f.popup)||l(),r=!0}function _(e){27===e.keyCode&&l()}function p(){document.addEventListener(n,h,!0)}function h(e){if(r)r=!1;else{var t=e.target.closest(f.itemDisabled);if(!t){var n=e.target.closest(f.item+"[href]");if(n)return void(u.default.safari&&u.default.safari_mobile&&u.default.version<9?setTimeout(l,500):(cancelEvent(e),nav.onBeforeGo(function(){l()}),nav.go(n)));if(n=e.target.closest(f.item+"[onmousedown]"))return void setTimeout(l);if(n=e.target.closest("label"+f.item))return void(u.default.safari&&u.default.safari_mobile&&u.default.version<9?setTimeout(l,500):setTimeout(l));if(n=e.target.closest("input[onchange]"))return void(u.default.safari&&u.default.safari_mobile&&u.default.version<9?setTimeout(l,500):setTimeout(l))}(u.isTouch||a||t)&&(e.preventDefault(),e.stopImmediatePropagation()),(a||!u.isTouch&&t)&&document.addEventListener("click",m,!0),t||l()}}function m(e){e.preventDefault(),e.stopImmediatePropagation(),document.removeEventListener("click",m,!0)}o&&s.onOpen(o)(),t.classList.add(d.open),document.addEventListener("keydown",_),document.addEventListener("touchmove",c),u.default.msie_mobile?document.addEventListener(i,p,!0):document.addEventListener(n,h,!0)}t.default=s;window.Unfold=s},hw56:function(e,t,n){"use strict";n.r(t),n.d(t,"getKeyboardState",function(){return o}),n.d(t,"getKeyboardType",function(){return r}),n.d(t,"setKeyboardType",function(){return s}),n.d(t,"loadDrafts",function(){return l}),n.d(t,"getPeerDraft",function(){return c}),n.d(t,"setPeerDraft",function(){return u}),n.d(t,"pushPeerAttachments",function(){return d}),n.d(t,"popPeerAttachments",function(){return f}),n.d(t,"setPeerTyping",function(){return _}),n.d(t,"removePeerTypingUser",function(){return p}),n.d(t,"filterPeerTypingUser",function(){return h}),n.d(t,"replacePeer",function(){return A}),n.d(t,"removePeer",function(){return v}),n.d(t,"addPeer",function(){return g}),n.d(t,"addPendingMsg",function(){return b}),n.d(t,"getPendingMsg",function(){return y}),n.d(t,"removePendingMsg",function(){return w}),n.d(t,"removeFailedMsg",function(){return C}),n.d(t,"failAllPendingMsgs",function(){return k}),n.d(t,"queueToPresendMsgs",function(){return S}),n.d(t,"saveFolderScroll",function(){return E}),n.d(t,"restoreFolderScroll",function(){return O});var i=n("wx14"),a=(n("2IoG"),n("qHA9"));function o(e){var t=store.mail.cur.keyboards,n=t[e];return n||(n=t[e]={}),n}function r(){return store.mail.cur&&store.mail.cur.keyboardType||""}function s(e){store.mail.cur&&(store.mail.cur.keyboardType=e)}function l(e){var t=store.mail.cur.drafts;return t||(t=lsGet("mail_drafts_"+e),t=store.mail.cur.drafts=t||{}),t}function c(e,t){var n=l(e);return n[t]||(n[t]={})}function u(e,t,n,a){var o=store.mail.cur.drafts;if(o||(o=store.mail.cur.drafts=o||{}),a){var r=o[t],s=r&&r.editing&&r.editing.id===a?r.editing:void 0;o[t]=Object(i.default)({},r,{editing:Object(i.default)({},s,n,{id:a})})}else o[t]=Object(i.default)({},o[t],n,{editing:void 0});lsSet("mail_drafts_"+e,o)}function d(e,t){var n=store.mail.peers[e];n.attachmentsStack.push(n.attachmentsHTML),n.attachmentsHTML=t}function f(e){var t=store.mail.peers[e],n=t.attachmentsStack.pop();n||(n=Brick({mix:"cp_attached_wrap",attrs:'id="attached_wrap"'})),t.attachmentsHTML=n}function _(e,t){var n=store.mail.cur.typings[e];if(n||(n=store.mail.cur.typings[e]={}),"text"!==t.type&&"audio"!==t.type||(t.count?n[t.type]=t:n[t.type]=null),n.text&&n.audio){var i=m(n.text,n.audio);n.mixed=i.count>1?i:null}else n.mixed=null}function p(e,t){var n=store.mail.cur.typings[e];if(n){var i=n.audio,a=n.text;if(i&&((i=h(i,t)).count?n.audio=i:n.audio=null),a&&((a=h(a,t)).count?n.text=a:n.text=null),n.text&&n.audio){var o=m(n.text,n.audio);n.mixed=o.count>1?o:null}else n.mixed=null}}function h(e,t){var n=e.users.filter(function(e){return e!==t});return n.length!==e.users.length&&(e.count=e.count-(e.users.length-n.length),e.users=n),e}function m(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){return e.count+=t.count,t.users.reduce(function(e,t){return-1===e.users.indexOf(t)?e.users.push(t):e.count--,e},e)},{users:[],count:0,type:"mixed"})}function A(e,t){var n=store.mail,i=n.scraps.folder,a=i.indexOf(e);-1!==a&&(t?i.splice(a,1,t):i.splice(a,1)),Object.keys(n.rolls.folder).forEach(function(i){var a=n.rolls.folder[i],o=a.indexOf(e);-1!==o&&(t?a.splice(o,1,t):a.splice(o,1))}),t&&(n.rolls.peer[t]=n.rolls.peer[e],n.reached.peer.before[t]=n.reached.peer.before[e],n.reached.peer.after[t]=n.reached.peer.after[e]),e!==t&&(n.rolls.peer[e]&&n.rolls.peer[e].forEach(function(i){var a=n.msgs[i];a&&(t?(a.peerId=t,a.authorId===e&&(a.authorId=t)):delete n.msgs[i])}),delete n.rolls.peer[e],delete n.reached.peer.before[e],delete n.reached.peer.after[e],delete n.members[e],delete n.peers[e])}function v(e,t){void 0===t&&(t={});var n=store.mail;if(!1!==t.lists){var i=n.scraps.folder,a=i.indexOf(e);-1!==a&&i.splice(a,1),Object.keys(n.rolls.folder).forEach(function(t){var i=n.rolls.folder[t],a=i.indexOf(e);-1!==a&&i.splice(a,1)})}!1!==t.msgs&&n.rolls.peer[e]&&n.rolls.peer[e].forEach(function(e){n.msgs[e]&&delete n.msgs[e]}),!1!==t.lists&&(delete n.rolls.peer[e],delete n.reached.peer.before[e],delete n.reached.peer.after[e]),!1!==t.data&&(delete n.members[e],delete n.peers[e])}function g(e,t){void 0===t&&(t={});var n=store.mail;if(t.msgs){var i=t.msgs;n.rolls.peer[e]=i,n.reached.peer.before[e]=!1,n.reached.peer.after[e]=!1}else n.rolls.peer[e]||(n.rolls.peer[e]=[],n.reached.peer.before[e]=!1,n.reached.peer.after[e]=!1);var a=n.msgs[n.rolls.peer[e][0]];n.rolls.folder.all.unshift(e),n.cur.folder&&n.scraps.folder.unshift(e),a&&(a.isUnread&&n.rolls.folder.unread.unshift(e),a.isImportant&&n.rolls.folder.important.unshift(e))}function b(e){var t=store.mail.presend;t.pending[e.peerId]||(t.pending[e.peerId]=[]),t.msgs[e.sendId]=e,t.pending[e.peerId].push(e.sendId)}function y(e,t){var n=store.mail.presend;return n.pending[t]?n.msgs[e]:null}function w(e){var t=store.mail.presend;if(t.pending[e.peerId]){var n=e.sendId;delete t.msgs[n],t.pending[e.peerId]=t.pending[e.peerId].filter(function(e){return e!==n})}}function C(e){var t=store.mail.presend;if(t.failed[e.peerId]){var n=e.sendId;delete t.msgs[n],t.failed[e.peerId]=t.failed[e.peerId].filter(function(e){return e!==n})}}function k(){var e=store.mail.presend,t={};Object.keys(e.msgs).forEach(function(n){var i=e.msgs[n];i.pending=!1,i.failed=!0,t[i.peerId]||(t[i.peerId]=[]),t[i.peerId].push(n)},{}),e.pending={},e.failed=t}function S(e){var t={};Object.keys(e.items).forEach(function(n){var i=e.items[n];t[n]=Object(a.sendDataToMessage)(i.data.data,-1!==e.failed.indexOf(n))});var n={};e.pending.forEach(function(e){var i=t[e];n[i.peerId]||(n[i.peerId]=[]),n[i.peerId].push(e)},{});var i={};e.failed.forEach(function(e){var n=t[e];i[n.peerId]||(i[n.peerId]=[]),i[n.peerId].push(e)},{}),store.mail.presend={msgs:t,pending:n,failed:i}}function E(e,t){var n=store.mail.cur;n&&(n.folderScroll||(n.folderScroll={}),n.folderScroll[e]=t)}function O(e){var t=store.mail.cur;if(t){t.folderScroll||(t.folderScroll={});var n=t.folderScroll[e]||0;return t.folderScroll[e]=0,n}}},iS9e:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P");function o(){var e=Object(i.default)(['\n    <div class="','">\n      <div class="mailDialog__overlay" ','></div>\n      <div class="mailDialog__wrap">\n        <div class="mailDialog__content">\n          <div class="mailDialog__close" ',"></div>\n          ",'\n          <div class="mailDialog__body">','</div>\n          <div class="mailDialog__footer">\n            <div class="mailDialog__button mailDialog__confirmButton" ',">",'</div>\n            <div class="mailDialog__button mailDialog__button_secondary mailDialog__closeButton" ',">","</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  "]);return o=function(){return e},e}var r=function(e){var t=e.onClose||a.default.onClick("MailDialog._onDialogClose"),n=a.default.class(e.class,"mailDialog",{}),i="";e.title&&(i='<div class="mailDialog__title">'+e.title+"</div>");return a.default.html(o(),n,t,t,i,e.body,e.onConfirm,e.confirmText,t,e.cancelText)};var s,l=n("UxAg"),c=n("OcsD");function u(){var e=Object(l.$)(".messenger__dialog");s=null,e.innerHTML=""}Object.assign(r,{open:function(e){s={},"function"==typeof e.onConfirm&&(s.onConfirm=e.onConfirm,e.onConfirm="");"function"==typeof e.onClose&&(s.onClose=e.onClose,e.onClose="");var t=Object(l.$)(".messenger__dialog"),n=r(e),i=Object(c.ceFromString)(n);s.onConfirm&&(Object(l.$)(".mailDialog__confirmButton",i).onclick=function(e){return s.onConfirm(e,t)});s.onClose&&Object(l.$$)(".mailDialog__overlay,.mailDialog__close,.mailDialog__closeButton",i).forEach(function(e){e.onclick=function(e){return s.onClose(e,t)}});t.innerHTML="",t.appendChild(i)},close:u,_onDialogClose:u});t.default=r;window.MailDialog=r},irqS:function(e,t,n){"use strict";n.r(t);var i={};n.r(i),n.d(i,"showCaptcha",function(){return we}),n.d(i,"renderBody",function(){return Ce});var a,o=n("MUpH"),r=n("bZ/P"),s=n("Mc5h"),l=(n("9y81"),n("O5lf")),c=n("AgBx"),u=n("QBkA"),d=n("rKp0"),f=n("u33z"),_=n("HPEO"),p=n("CkGd"),h=n("B5sG"),m=n("+cqQ"),A=n("DkIl"),v="recently",g="last_week",b="last_month",y="long_ago";function w(){store.mail&&store.mail.cur&&(store.mail.cur.peerId&&C())}function C(){var e=store.mail.cur;(e?e.peerId:null)?a=setTimeout(function(){O(),C()},3e4):k()}function k(){a&&clearTimeout(a)}function S(){$$(".mailHat").forEach(function(e){return e.outerHTML=Object(h.default)()})}function E(){}function O(){var e=window.lang,t=store.mail,n=t.cur,i=t.peers,a=n?n.peerId:null;if(a){var o=i[a];if(o.lastActionTime&&!o.isOnline){var r=n.timeShift,s=function(e,t){var n=window.lang,i="";e+=t;var a=parseInt(Date.now()/1e3)-e;if(a>7776e3)return"";if(a<60)i=n.mobile_profile_status_just_now;else if(a<3600){var o=intval(a/60);i=langWordNumeric(o,n.mobile_profile_status_word_mins_ago,n.mobile_profile_status_mins_ago)}else if(a<14400){var r=intval(a/3600);i=langWordNumeric(r,n.mobile_profile_status_word_hours_ago,n.mobile_profile_status_hours_ago)}else i=function(e){var t=1e3*e,n=new Date(t),i=new Date,a=window.lang;return n.getFullYear()!=i.getFullYear()&&n.getTime()<i.getTime()-1728e5||Math.abs(n.getTime()-i.getTime())>157248e5?langDate(t,a.mobile_mail_date,0,a.months_sm_of,!1):langDate(t,a.mobile_mail_short_date_time,0,a.months_sm_of,!1)}(e);return i}(o.lastActionTime,r);o.offlineText=s?langSex(o.sex,e.mobile_mail_last_activity_tip).replace("{time}",s):""}else o.canSeeOnline||(o.offlineText=function(e,t){var n;switch(e){case v:n=getLang("global_online_was_recently","raw");break;case g:n=getLang("global_online_was_week","raw");break;case b:n=getLang("global_online_this_month","raw");break;case y:n=getLang("global_online_long_ago","raw");break;default:return""}return langSex(t,n)}(o.onlineStatus,o.sex));S()}}Object.assign(h.default,{onUnreadClick:Object(m.default)(),onBackClick:Object(m.default)(),onBackToDialogClick:Object(m.default)(),onCancelEditing:Object(m.default)(),setModifiers:A.MailHat_convo.setModifiers,redrawCounter:function(){var e=store.mail.cur.countUnread;if(!nav.getQuery("community")){var t=geBySel1(".mmi_mail .mm_counter2");t&&(e>0?(t.innerText=e,attr(t,"style","display: inline")):hide(t))}window.isNewNavigation?Tabbar.setCounter(Tabbar.TAB_ID_MESSAGES,e):A.MailHat_main.setUnreadCount(e)},redrawOnline:O,redraw:S,startStatusUpdate:C,cancelStatusUpdate:k}),A.MailHat_main.onUnreadClick(h.default.onUnreadClick),A.MailHat_main.onBurgerClick(menu.open),A.MailHat_main.onCancelForwardTap(h.default.onBackToDialogClick),A.MailHat_convo.onBackTap(h.default.onBackClick),A.MailHat_convo.onCancelEditingTap(h.default.onCancelEditing),uVK.onReady(w),uVK.onReady(E),page.onChange(E);var T=h.default;window.uMailHat=h.default;var D=n("TYsd"),j=n("29dZ"),I=function(e){var t=window.lang;return D.default.html({class:"MessageRequestBox",inner:[{class:"MessageRequestBox__info",inner:t.mobile_mail_mrs_confirm_info},{class:"MessageRequestBox__buttons",inner:[Object(j.default)({theme:"negative",size:"normal",type:"button",inner:t.mobile_mail_mrs_button_reject,attrs:q.onClick("MessageRequestBox.reject","event","this",e)}),Object(j.default)({theme:"secondary",size:"normal",type:"button",inner:t.mobile_mail_mrs_button_accept,attrs:q.onClick("MessageRequestBox.accept","event","this",e)})]}]})};Object.assign(I,{accept:function(e,t,n){j.default.setLoading(t,!0),ajaxRequest("/mail",{act:"mrs_accept",peer_id:n,hash:store.mail.hash.mrs},function(e){e.error&&j.default.setLoading(t,!1)},function(){j.default.setLoading(t,!1)})},reject:function(e,t,n){j.default.setLoading(t,!0),ajaxRequest("/mail",{act:"mrs_reject",peer_id:n,hash:store.mail.hash.mrs},function(e){e.error&&j.default.setLoading(t,!1)},function(){j.default.setLoading(t,!1)})}});var M=I;var x=M;function B(){var e=Object(o.default)(['\n    <a href="/mail?act=mrs" class="messenger__mrsHintBox _touched">\n      ',"\n    </a>\n  "]);return B=function(){return e},e}function P(){var e=Object(o.default)(["\n    ",'\n    <div class="messenger__banner_content">\n      <div class="messenger__banner_text" ',">\n        ",'\n      </div>\n      <div class="messenger__banner_buttons">\n        ',"\n      </div>\n    </div>\n    ","\n  "]);return P=function(){return e},e}function L(){var e=Object(o.default)(['\n      <div class="messenger__banner_icon">\n        <img class="messenger__banner_icon_img" src="','">\n      </div>\n    ']);return L=function(){return e},e}function R(){var e=Object(o.default)(['\n    <div class="messenger__spinner">\n      ',"\n    </div>\n  "]);return R=function(){return e},e}function N(){var e=Object(o.default)(['\n    <div class="messenger__header">\n      ',"\n    </div>\n    ","\n  "]);return N=function(){return e},e}function F(){var e=Object(o.default)(['\n    <div class="messenger__convoListNotice">\n      ',"\n    </div>\n  "]);return F=function(){return e},e}function H(){var e=Object(o.default)(['\n    <div class="messenger__header">\n      ','\n      <div class="','">','</div>\n      <div class="messenger__pinned">',"</div>\n    </div>\n    ",'\n    <div class="','">\n      <div class="messenger__mrbox">','</div>\n      <div class="messenger__write">','</div>\n      <div class="messenger__acts">',"</div>\n    </div>\n  "]);return H=function(){return e},e}function U(){var e=Object(o.default)(['\n    <div class="','">\n      <div class="messenger__layer messenger__layer_main">\n        <div class="messenger__header">',"</div>\n        ",'\n      </div>\n      <div class="messenger__layer messenger__layer_convo">\n        ','\n      </div>\n      <div class="messenger__layer messenger__layer_page">','</div>\n      <div class="messenger__dialog"></div>\n    </div>\n  ']);return U=function(){return e},e}window.MessageRequestBox=M;var V=function(e){void 0===e&&(e={});var t=store.mail.cur,n=t.query,i=Object(d.default)({scrap:"folder"}),a=Object(d.default)({scrap:"search"}),o=e.page,r="all"!==t.folder||t.query||t.forwardFromId?0:t.countMR;return W({mix:K(),mailHat:T(),convo:z(),page:o,mrs:r,query:n,createChatUrl:"/mail?act=new_chat",scrapFolder:i,scrapSearch:a})};function W(e){var t=window.lang.mobile_mail_search_only_messages,n=Object(u.default)({query:e.query,createUrl:e.createChatUrl}),i=e.mrs?Z(e.mrs):"",a=r.default.onClick("Messenger._onSearchMsgsClick"),o=Object(c.default)({mix:"messenger__body",attrs:r.default.onScroll("Messenger._onMainScroll","this"),inner:[Object(s.default)({mix:"messenger__filter",inner:n}),Object(s.default)({mix:r.default.class("messenger__mrsHint",{hidden:!e.mrs}),inner:i}),Object(s.default)({mix:"messenger__searchMsgs",attrs:a,inner:t}),Object(s.default)({mix:"messenger__loadable",inner:[Object(s.default)({mix:"messenger__folderList",inner:e.scrapFolder}),Object(s.default)({mix:"messenger__searchList",inner:e.scrapSearch}),Q()]})]});return r.default.html(U(),e.mix,e.mailHat,o,e.convo,e.page)}function z(){var e=store.mail,t=e.cur,n=e.peers[t.peerId],i=T(),a=Y(),o=X(),l=Object(_.default)(),u=n&&n.canPin,f=Object(p.default)({canPin:u,isChannel:n.isChannel}),h=Object(d.default)({scrap:"peer"}),m=n.isIncomingMR?x(t.peerId):"",A=n.isRejectedMR?function(){var e=window.lang;return r.default.html(F(),e.mobile_mail_mrs_rejected_info)}():"",v=Object(c.default)({mix:"messenger__body",attrs:r.default.onScroll("Messenger._onConvoScroll","this"),inner:[Object(s.default)({mix:"messenger__spacer"}),Object(s.default)({mix:"messenger__convoList",inner:[h,A]}),Q()]}),g="messenger__banner";o&&(g+=" messenger__bannerVisible");var b=r.default.class("messenger__footer",{actionsOpen:J(),isIncomingMR:n.isIncomingMR});return r.default.html(H(),i,g,o,a,v,b,m,l,f)}function Q(){var e=Object(l.default)({mix:""});return r.default.html(R(),e)}function Y(){var e=store.mail,t=e.cur.peerId;return t&&e.peers[t].pinnedMsg}function X(){var e=store.mail,t=e.cur.peerId,n=t&&e.peers[t],i=n&&n.banner;if(!i)return"";var a="";i.icon&&(a=r.default.html(L(),i.icon));for(var o=i.buttons,s=o.length,l=[],c=0;c<s;c++)l.push(G(o[c],c));l=r.default.list(l);var u=Object(f.default)({class:"messenger__banner_close",onClick:r.default.onClick("uMessenger.onBannerButtonClick","event")}),d=r.default.onClick("uMessenger.onBannerTextClick","event");return r.default.html(P(),a,d,i.text,l,u)}function G(e,t){var n={};"secondary"===e.layout?n.secondary=!0:"tertiary"===e.layout?n.tertiary=!0:n.primary=!0;var i,a=r.default.class("messenger__banner_button",n),o=e.type;return"gifts_link"===e.type&&(o="link",i="_self"),Object(f.default)({class:a,text:e.text,type:"link"===o?"link":"button",link:"link"===o?{href:e.link,target:i}:null,onClick:r.default.onClick("uMessenger.onBannerButtonClick","event",t)})}function K(){var e,t,n=store.mail.cur;t=n.page?"view_page":n.peerId?"view_dialog":n.query&&"msgs"===n.tab?"view_searchMsgs":n.query?"view_searchPeers":"folder_"+n.folder;var i=n.peerId?store.mail.peers[n.peerId]:null;return r.default.class("e","messenger",{isIncomingMR:!!i&&i.isIncomingMR,isRejectedMR:!!i&&i.isRejectedMR},"uMessenger",((e={})[t]=!0,e.community=!!n.groupId,e))}function J(){var e=store.mail.cur.msgSelected;return Object.keys(e).length>0}function Z(e){var t=window.lang,n=langNumeric(e,t.mobile_mail_mrs_request_count);return r.default.html(B(),n)}var ee=n("jk6M"),te=n("Qz23");function ne(){Object(te.cleanScrollView)(W.getConvoBody()),removeEvent(W.getConvoBody(),"touchstart",ie,{passive:!0})}function ie(e){var t=e.target.closest(".msg__sticker");t&&Msg.onStickerTouchStart(e,t),(t||e.target.closest(".msg"))&&Msg._onTouchStart()}function ae(e,t){$$(".messenger__layer_"+e).forEach(function(e){e.classList.toggle("messenger__layer_loading",t)})}function oe(e){return $(".messenger__layer_"+e+" .messenger__body")}function re(e){W.onMainScroll(e)}function se(e){W.onConvoScroll(e),e._isScrolling=!0,function(e){void 0===e&&(e=null);return!window._preventedCheckTop&&(e&&function(e){return e.scrollHeight&&e.scrollTop<=2.5*window.innerHeight}(e))}(e)&&W.onConvoAtTop(),function(e){void 0===e&&(e=null);return e&&function(e){return e.scrollHeight&&e.scrollHeight-e.scrollTop-e.offsetHeight<=1.5*window.innerHeight}(e)}(e)&&W.onConvoAtBottom(),e._scrollingTimer&&clearTimeout(e._scrollingTimer),e._scrollingTimer=setTimeout(function(){e._isScrolling=!1},100)}function le(){var e,t,n=W.getConvoBody();n&&(n.prevHeight&&n.prevHeight!==n.offsetHeight&&(e=n,t=n.scrollBottom,e.scrollTop=e.scrollHeight-e.offsetHeight-t),n.prevHeight=n.offsetHeight,n.scrollBottom=function(e){return e.scrollHeight-e.scrollTop-e.offsetHeight}(n),ce&&requestAnimationFrame(le))}Object.assign(W,{scrollMainBodyToTop:function(){$(".messenger__layer_main .messenger__body").scrollTop=0},onMainScroll:Object(m.default)("scrollElem"),onQueryChange:u.default.onChange,onQueryClear:u.default.onClear,onSearchMsgsClick:Object(m.default)(),setQuery:u.default.setQuery,setQuerySilently:u.default.setQuerySilently,getMainBody:function(e){return oe("main")},setMainLoading:function(e){return ae("main",e)},onConvoAtTop:Object(m.default)(),onConvoAtBottom:Object(m.default)(),onConvoScroll:Object(m.default)("scrollElem"),setConvoLoading:function(e){return ae("convo",e)},getConvoBody:function(){return oe("convo")},scrollConvoToBottom:function(){var e=W.getConvoBody();e&&(e.scrollTop=e.scrollHeight)},redrawConvoLayer:function(){var e=z();ne(),$$(".messenger__layer_convo").forEach(function(t){t.innerHTML=e})},cleanConvoBody:ne,setupConvoBody:function(){Object(te.setScrollView)(W.getConvoBody(),{topBanner:!1}),addEvent(W.getConvoBody(),"touchstart",ie,{passive:!0})},getPageLayer:function(){return $(".messenger__layer_page")}}),W._onMainScroll=re,W._onConvoScroll=se,W._onSearchMsgsClick=W.onSearchMsgsClick;var ce=!1;if(V.startPolling=function(){ce=!0,le()},V.stopPolling=function(){ce=!1},Object.assign(V,{redraw:function(){$$(".uMessenger").forEach(function(e){return e.outerHTML=V()})},redrawView:function(){$$(".uMessenger").forEach(function(e){return e.className=K()});var e=store.mail,t=e.cur,n=e.peers;t.peerId&&(fe(),p.default.togglePin(n[t.peerId].canPin));_e()},redrawMailActions:function(){var e=J();$$(".messenger__layer_convo").forEach(function(t){t.$(".messenger__footer").classList.toggle("messenger__footer_actionsOpen",e),p.default.update();var n=store.mail,i=n.cur,a=n.peers;if(!i.peerId||!a[i.peerId].isIncomingMR){var o=t.$(".messenger__write").offsetHeight,r=t.$(".messenger__acts").offsetHeight-o,s=t.$(".messenger__body");requestAnimationFrame(function(){!s._fixed&&r&&(s.style.paddingBottom=r+"px",s._fixed=!0),r<=0&&(s.style.paddingBottom=0,s._fixed=!1)})}})},redrawPinnedMsg:fe,setPinnedVisibility:function(e){var t=store.mail,n=t.peers,i=t.cur,a=n[i.peerId].hasPinnedMsg;$$(".messenger").forEach(function(t){t.classList.toggle("messenger_pinnedVisible",a&&e),t.classList.toggle("messenger_pinnedHidden",a&&!e)})},redrawBanner:function(){var e=X();$$(".messenger__banner").forEach(function(t){t.innerHTML=e,t.classList.toggle("messenger__bannerVisible",!!e)})},redrawMRsHint:_e,expandPeerBefore:function(){if(!$(".load_before_closed"))return;var e=W.getConvoBody();if(ee.default.safari_mobile){var t=function(){var t=$$(".load_before_closed"),n=e.scrollHeight-e.scrollTop-e.offsetHeight;setStyle(e,"overflow","hidden"),t.forEach(function(e){return e.classList.remove("load_before_closed")});var i=e.scrollHeight-n-e.offsetHeight;setStyle(e,"overflow","auto"),e.scrollTop=i,AudioMessagePlayer.redrawWaves()};e.isScrolling?(de&&clearInterval(de),de=setInterval(function(){e.isScrolling||(clearInterval(de),t())},10)):t()}else if(e.scrollTop<=184){var n=$$(".load_before_closed"),i=e.scrollHeight-e.scrollTop-e.offsetHeight;n.forEach(function(e){return e.classList.remove("load_before_closed")});var a=e.scrollHeight-i-e.offsetHeight;e.scrollTop=a,AudioMessagePlayer.redrawWaves()}},scrollToMsg:function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var i=Msg.getElem(e);if(!i)return!1;var a=W.getConvoBody();if($(".mailScrap__loading_before"),t)a.scrollTop=i.offsetTop-.18*a.offsetHeight;else{var o=$(".typing_id_curConvo").offsetHeight;a.scrollTop=i.offsetTop-.5*(a.offsetHeight+2)+(i.offsetHeight+o)/2,i.offsetHeight>a.offsetHeight&&(a.scrollTop=i.offsetTop)}return n&&(addClass("msg_highlight",i),setTimeout(function(){removeClass("msg_highlight",i)},1500)),!0},loadMailPage:Object(m.default)()}),ee.default.safari_mobile){var ue=null;W.onConvoScroll(function(e){e.isScrolling=!0,ue&&clearTimeout(ue),ue=setTimeout(function(){return e.isScrolling=!1},50)})}var de=null;function fe(){var e=store.mail,t=e.peers,n=e.cur,i=Y(),a=t[n.peerId].hasPinnedMsg;$(".messenger__pinned").innerHTML=i,MailHat_convo.setHasPinnedMsg(a)}function _e(){var e=store.mail.cur,t=e.countMR,n=t&&"all"===e.folder&&!e.query&&!e.forwardFromId,i=$(".messenger__mrsHint");if(n){var a=t?Z(t):"";i.innerHTML=a}i.classList.toggle("messenger__mrsHint_hidden",!n)}var pe=n("cq4b"),he=n("/Id8"),me=n("fWqt"),Ae=n("UxAg"),ve=n("qHA9"),be=n("iS9e"),ye=n("p5n7");function we(e,t){be.default.open({body:Ce(e),title:lang.mobile_captcha_enter_code,confirmText:lang.mobile_captcha_send_btn,cancelText:lang.mobile_cancel,class:"MailCaptcha__dialog",onConfirm:function(n,i){var a,o=Object(Ae.$)('[name="'+e.key+'"]',i);o=o&&o.value||"",be.default.close(),Object(ve.mailRequest)(e.location,Object.assign({},e.post,(a={},a[e.key]=o,a))).then(function(e){t(Promise.resolve(e))},function(e){t(Promise.reject(e))})},onClose:function(){be.default.close(),t(null)}})}function Ce(e){return D.default.html({inner:[{class:"captcha_img",src:e.img,tag:"img"},{inner:[Object(ye.default)({name:e.key})],class:"MailCaptcha__input",tag:"div"}],class:"MailCaptcha__box",tag:"div"})}var ke=i,Se=n("/Rzu"),Ee=n("z9sQ"),Oe=n("OcsD"),Te=n("wMVj"),De={onTemplateInput:function(e,t,n,i){var a=$("."+n),o=i-t.value.length;a.textContent=o,a.className=Ee.default.class(n,{error:o<=0})},onButtonMouseDown:function(e,t){ee.default.safari_mobile||e.preventDefault()},onButtonClick:function(e,t,n){var i=$(".MailTemplatePage__TextTextarea"),a=i.value,o=i.selectionStart,r=i.selectionEnd;i.value=a.slice(0,o)+n+a.slice(r);var s=o+n.length;i.selectionStart=i.selectionEnd=s},onSave:function(e,t,n,i,a){var o=$(".MailTemplatePage__NameInput .TextInput__native"),r=$(".MailTemplatePage__TextTextarea");j.default.setLoading(t,!0),Object(Oe.ajaxRequest)("/mail",{act:"save_template",name:o.value,text:r.value,hash:i,id:n},function(e){if(e){if(e.error){var i=$(".MailTemplatePage__ErrorRow"),o=$(".MailTemplatePage__ErrorText");return j.default.setLoading(t,!1),i.hidden=!1,void(o.textContent=e.message)}if(store.mail.cur&&store.mail.cur.templates){var r=store.mail.cur.templates,s=n?r.findIndex(function(e){return e.id===n}):-1;-1!==s?r.splice(s,1,e.result):r.push(e.result)}Te.default.go(a)}},function(){j.default.setLoading(t,!1)})},onSubmit:function(e){e.preventDefault()}};window.MailTemplatePage=De;var je=function(e){var t=window.lang,n=Object(A.MailHat)({type:"page",left:Object(A.MailHat__icon)({icon:"back",url:"/mail"}),center:Object(A.MailHat__Title)({title:t.mobile_mail_mrs_page_title})}),i=[{class:"MessageRequestsPage__content ScrollView",inner:[{class:"MessageRequestsPage__info",inner:t.mobile_mail_mrs_page_info},D.default.wrap(Object(d.default)({scrap:"mrs"}))]},e.count?{class:"MessageRequestsPage__footer",inner:[Object(j.default)({theme:"negative",size:"large",type:"button",inner:t.mobile_mail_mrs_button_reject_all,attrs:r.default.onClick("MessageRequestsPage.rejectAll","event","this")})]}:null];return{class:"messenger__page MessageRequestsPage",inner:[{class:"messenger__header",inner:D.default.wrap(n)},{class:"messenger__body",inner:i}]}};Object.assign(je,{rejectAll:function(e,t){j.default.setLoading(t,!0),je.onRejectAll(t)},onRejectAll:befall()});var Ie=je;var Me=Ie;window.MessageRequestsPage=Ie;var xe,Be,Pe=n("M2vk"),Le=n("7jQU"),Re=n("HGMY"),Ne=n("9M99"),Fe=n("hw56"),He=n("H5mD"),Ue=n("aiw/"),Ve=n("W38l"),$e=n("HdGT"),qe=n("gF8j"),We=Object(m.default)();function ze(){Be=null,xe&&xe.stop()}function Qe(e,t){xe&&(xe.is_idle?Be[e]=t:setTimeout(t,0))}function Ye(){var e=Be;Be={},Object.keys(e).forEach(function(t){(0,e[t])()})}var Xe=null,Ge=null;function Ke(e){if(Ge&&(clearTimeout(Ge),Ge=null),Xe&&(Xe=Object.assign({},Xe,{fails:0})),"online"===e.type&&Xe){var t=Xe;Xe=null,Je(t)}}function Je(e){if(!1!==navigator.onLine)return Object(ve.mailRequest)("/mail",{act:"message",message_id:e.msgId,forcePinned:e.forcePinned}).then(function(t){e.onResult(t)}).catch(function(t){if(e.onTryError&&e.onTryError(t),!1!==navigator.onLine){var n=Math.min(1+(0|e.fails),6),i=Math.pow(2,Math.max(n-2,0));Xe=Object.assign({},e,{fails:n}),Ge=setTimeout(function(){Ge=null,Je(Xe)},1e3*i)}else Xe=Object.assign({},e,{fails:0})});Xe=Object.assign({},e,{fails:0})}window.addEventListener("online",Ke),window.addEventListener("offline",Ke);var Ze=n("UlUB"),et=n("BZzM"),tt=!1;uVK.onReady(Pt),W.onQueryChange(Nt),W.onQueryClear(Ft),Se.default.onTap(gt),T.onUnreadClick(st),T.onBackClick(rn),T.onBackToDialogClick(sn),T.onCancelEditing(Yn),_.default.onAttachedMsgsRemove(vt),_.default.onToBottomClick(Zt),_.default.onMessage(_t),$e.onMessage(ft),$e.onStopped(pt),$e.onMessageRemove(ht),$e.onCaptcha(ci),he.default.onClick(xn),he.default.onRestoreClick(Bn),he.default.onReplyClick(Pn),he.default.onForward(Rn),Voting.onHtmlUpdate(Kn),W.onMainScroll(Jt),W.onConvoScroll(en),W.onSearchMsgsClick(Rt),W.onConvoScroll(V.expandPeerBefore),W.onConvoAtTop(Xt),W.onConvoAtBottom(Gt),p.default.onCloseClick(Cn),p.default.onRemoveClick(kn),p.default.onImportantClick(Dn),p.default.onReplyClick(In),p.default.onForwardClick(Mn),p.default.onSpamClick(Tn),p.default.onPinClick(yn),p.default.onEditClick(wn),me.default.onConfirmDelete(En),PinnedMsg.onHideClick(Un),Me.onRejectAll(ni),im.onNewMsg(mt),im.onEditMsg(At),im.onMultiTyping(cn),im.onRecordingAudio(_n),im.onOnlineChange(pn),im.onMsgReadByMe(hn),im.onMsgReadByOther(mn),im.onMsgImportantRemove(yt),im.onMsgImportantAdd(bt),im.onMsgRemove(wt),im.onMsgListen(Ct),im.onPeerKeyboard(St),im.onPeerBanner(Dt),im.onPeerConvert(jt),im.onPeerAdmin(It),im.onMsgRequestChange(Mt),im.onDialogImportant(Et),im.onUnreadCount(Ot),im.onResync(Tt),We(si),AudioMessagePlayer.events.on("listened",li),nav.onPopState(An),nav.onBeforeGo(vn),nav.onBeforeGo2(gn),page.onChange(bn),uVK.onReady(qn),page.onChange(qn),uVK.onReady(Wn),page.onChange(Wn),page.onChange(dt),page.onChange(Gn),uVK.onReady(dt),uVK.onReady(Fn),uVK.onReady(Gn),uVK.onOrientationChange(ut),V.loadMailPage(Jn),V.onShowPinnedMsgClick=Hn,V.onHidePinnedMsgClick=Un,V.onBannerButtonClick=Vn,V.onBannerTextClick=$n;var nt=!1,it=0,at=[],ot=[],rt=Object(Ze.default)(function(){if(!at.length)return;var e=store.mail,t=e.members,n=e.cur,i=at,a=ot;at=[],ot=[],ajaxRequest("/mail",{act:"get_members",members:i},function(e){Object.assign(t,e),a.forEach(function(e){e===n.peerId&&Pe.default.redraw(),Se.default.redrawTyping(e)})})},3e3);function st(){W.scrollMainBodyToTop()}function lt(){Object(te.preventDocumentScroll)();var e=W.getMainBody();e&&Object(te.setScrollView)(e);var t=$(".leftMenu__searchItems");t&&Object(te.setScrollView)(t,{topBanner:!1,overscrollY:!1})}function ct(){Object(te.preventDocumentScroll)({topBanner:!1}),W.setupConvoBody()}function ut(){ee.default.safari_mobile&&document.activeElement.blur()}function dt(){var e=nav.getQuery("msg")||nav.getQuery("id")||nav.getQuery("edit_msg_id");e?requestAnimationFrame(function(){V.scrollToMsg(e)}):requestAnimationFrame(W.scrollConvoToBottom)}function ft(e){var t=store.mail.cur;Object(Fe.addPendingMsg)(e),t.peerId&&(0===e.sendId.indexOf("edit")?an(e):(Re.removeMsg(e),Re.addMsg(e),oi()))}function _t(e){store.mail.cur.peerId&&0===e.sendId.indexOf("edit")&&an(e)}function pt(){Object(Fe.failAllPendingMsgs)();var e=store.mail,t=e.cur,n=e.presend;if(t)if(t.peerId){if(n.failed[t.peerId]){var i=[];n.failed[t.peerId].map(function(e){var t=n.msgs[e];t&&(0===t.sendId.indexOf("edit")?an(t):i.push(t))}),Re.setMsgs(i)}}else Object.keys(n.failed).forEach(function(e){Se.default.redrawLastMsg(e)})}function ht(e){var t=store.mail.presend.msgs[e];t&&(Object(Fe.removePendingMsg)(t),Object(Fe.removeFailedMsg)(t),0===e.indexOf("edit")?store.mail.cur.peerId&&d.default.peerReplaceItems([t.id]):(store.mail.cur.peerId&&Re.removeMsg(t),oi()))}function mt(e){nn(e)}function At(e){nn(e)}function vt(){var e=store.mail,t=e.cur;e.peers;Object(Fe.setPeerDraft)(t.viewerId,t.peerId,{msgs:void 0},t.editing),t.msgAttached[t.peerId]=[],_.default.uiRedrawAttachments(t.peerId)}function gt(e){var t=store.mail,n=(t.cur,t.rolls),i=t.msgs,a=Number(qs2obj(e.split("?")[1]).peer);i[last(n.peer[a]||[])];return Lt(e)}function bt(e){var t=store.mail,n=t.cur,i=t.msgs,a=t.scraps,o=t.rolls,r=i[e];if(r&&(r.isImportant=!0,o.folder.important=o.folder.important.concat(e).filter(unique).sort(desc),he.default.toggleImportant(e,!0),"important"===n.folder)){var s=a.folder.slice();a.folder=a.folder.concat(e).filter(unique).sort(desc),d.default.redrawFolder(s)}}function yt(e,t){void 0===t&&(t=!0);var n=store.mail,i=n.cur,a=n.msgs,o=n.scraps,r=n.rolls,s=a[e];if(s&&(s.isImportant=!t,Object(pe.arrayRemove)(r.folder.important,e),he.default.toggleImportant(e,!1),"important"===i.folder)){var l=o.folder.slice();Object(pe.arrayRemove)(o.folder,e),d.default.redrawFolder(l)}}function wt(e){var t=store.mail,n=t.cur,i=t.msgs,a=t.scraps,o=t.rolls,r=t.peers,s=i[e];if(s&&!n.msgRemoved[e]){delete i[e],Object(pe.arrayRemove)(o.peer[s.peerId],e),n.peerId===s.peerId&&(Object(pe.arrayRemove)(a.peer,e),he.default.remove(e,!0),n.msgSelected[e]&&(delete n.msgSelected[e],p.default.setCount(Object.keys(n.msgSelected).length),V.redrawMailActions()),a.peer.length?d.default.checkDivider():d.default.redrawPeer()),s.isImportant&&n.countImportant--;var l=r[s.peerId],c=l.isIncomingMR,u=l.isRejectedMR;s.isUnread&&s.authorId!==n.viewerId&&(r[s.peerId].countUnread=r[s.peerId].countUnread-1,c||u||r[s.peerId].countUnread<=0&&(n.countUnread=n.countUnread-1),_.default.redrawToBottom(),T.redrawCounter()),o.peer[s.peerId].length?kt(s,e):ajaxRequest("/mail",{act:"get_last_msg",peer_id:s.peerId,user_id:n.userId},function(t,n){n&&(storeMethods.injectMail(t),o.peer[s.peerId].push(n)),kt(s,e)},function(){kt(s,e)})}}function Ct(e){var t=store.mail.msgs,n=t&&t[e];if(n){n.listened=!0,n.attachesHTML=n.attachesHTML.replace(/class="(im_msg_audiomsg(?:\w?\s?)*)"/g,'class="im_msg_audiomsg im_msg_audiomsg_listened"');var i=$$('.audio-msg-track[data-msg="'+e+'"]');i&&i.forEach(function(e){e.closest(".im_msg_audiomsg").classList.add("im_msg_audiomsg_listened")})}}function kt(e,t){var n=store.mail,i=n.cur,a=(n.msgs,n.scraps),o=n.rolls,r=n.peers,s=r[e.peerId],l=s.isIncomingMR,c=s.isRejectedMR;o.peer[e.peerId].length||(l||c?Object(pe.arrayRemove)(o.mrs,e.peerId):(Object(pe.arrayRemove)(o.folder.all,e.peerId),Object(pe.arrayRemove)(o.folder.unread,e.peerId),Object(pe.arrayRemove)(o.folder.unrespond,e.peerId)),"mrs"===i.page?Object(pe.arrayRemove)(a.mrs,e.peerId):"important"!==i.folder&&Object(pe.arrayRemove)(a.folder,e.peerId)),o.peer[e.peerId]=o.peer[e.peerId].filter(unique).sort(asc),l||c?o.mrs=o.mrs.filter(unique).sort(Nn):(0===s.countUnread&&(o.folder.unread=o.folder.unread.filter(function(t){return t!==e.peerId})),o.folder.all=o.folder.all.filter(unique).sort(Nn),o.folder.unread=o.folder.unread.filter(unique).sort(Nn),i.groupId&&(o.folder.unrespond=o.folder.unrespond.filter(unique).sort(Nn))),"mrs"===i.page?(a.mrs=a.mrs.filter(unique).sort(Nn),d.default.redrawMRs()):"important"===i.folder?(Object(pe.arrayRemove)(a.folder,t),d.default.redrawFolder()):"all"===i.folder?(a.folder=a.folder.filter(unique).sort(Nn),d.default.redrawFolder()):"unread"===i.folder?(0===r[e.peerId].countUnread&&Object(pe.arrayRemove)(a.folder,e.peerId),a.folder=a.folder.filter(unique).sort(Nn),d.default.redrawFolder()):"unrespond"===i.folder&&(a.folder=a.folder.filter(unique).sort(Nn),d.default.redrawFolder())}function St(e){var t=store.mail,n=t.peers,i=t.cur;if(n[e]){var a=Object(Fe.getKeyboardState)(e);if(!(Date.now()-a.updateTime<=500)){var o=a.updateTime;ajaxRequest("/mail",{act:"get_peers",peer_ids:[e]},function(t){o===a.updateTime&&(storeMethods.injectMail(t),e==i.peerId&&_.default.renderKeyboardIfNeeded({update:!0}))})}}}function Et(e,t){var n=store.mail.peers[e];n&&(n.isImportant=t),Se.default.redrawImportant(e,t)}function Ot(e){nav.getQuery("community")||function(e){if(setNotify(e),!window.al||!window.al.menu)return;var t=window.al,n=new Array(t.menu.length);n[3]=e,menu.refreshCounters(n)}(e);var t=store.mail.cur;t&&(t.countUnread=e,T.redrawCounter()),window.ExperimentalBadge&&window.ExperimentalBadge.set(e)}function Tt(){im.pause(),Bt(function(){im.resume()})}function Dt(e){Date.now()-it<=500||ajaxRequest("/mail",{act:"get_peers",peer_ids:[e]},function(t){var n=store.mail.cur;storeMethods.injectMail(t),e==n.peerId&&V.redrawBanner()})}function jt(e,t){im.pause(),ajaxRequest("/mail",{act:"get_peers",peer_ids:[t]},function(n){Object(Fe.replacePeer)(e,t),storeMethods.injectMail(n);var i=store.mail.cur;e===i.peerId?(d.default.redrawFolder(),t===i.peerId?$t(t):Lt("/mail?act=show&peer="+t,{replace:!0})):i.folder&&d.default.redrawFolder(),im.resume()})}function It(e,t,n){var i=store.mail,a=i.cur,o=i.peers;if(a){var r=o[e];r&&(t===a.userId&&(r.isAdmin=n),n&&!Object(pe.arrayContains)(r.adminIds,t)?r.adminIds.push(t):!n&&Object(pe.arrayContains)(r.adminIds,t)&&Object(pe.arrayRemove)(r.adminIds,t))}}function Mt(e,t){var n=store.mail,i=n.cur,a=n.rolls,o=n.scraps;i&&("created"!==t&&tt||("created"===t&&tt&&(tt=!1),"created"===t?xt(e,function(t,n){Object(Fe.removePeer)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&(a.mrs=a.mrs.concat(e).filter(unique).sort(Nn)),i.folder&&(d.default.redrawFolder(),V.redrawMRsHint()),i.peerId===e&&$t(e)}):"canceled"===t?xt(e,function(t,n){Object(Fe.removePeer)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&Object(pe.arrayRemove)(a.mrs,e),i.folder&&(d.default.redrawFolder(),V.redrawMRsHint()),i.peerId===e?$t(e):"mrs"===i.page&&(Object(pe.arrayRemove)(o.mrs,e),d.default.redrawMRs())}):"rejected"===t?xt(e,function(t,n){Object(Fe.removePeer)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&Object(pe.arrayRemove)(a.mrs,e),i.folder&&(d.default.redrawFolder(),V.redrawMRsHint()),i.peerId===e?$t(e):"mrs"===i.page&&(Object(pe.arrayRemove)(o.mrs,e),d.default.redrawMRs())}):"accepted"===t&&xt(e,function(t,n){Object(Fe.addPeer)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&Object(pe.arrayRemove)(a.mrs,e),i.folder&&(d.default.redrawFolder(),V.redrawMRsHint()),i.peerId===e?$t(e):"mrs"===i.page&&(Object(pe.arrayRemove)(o.mrs,e),d.default.redrawMRs())})))}function xt(e,t){im.pause(),ajaxRequest("/mail",{act:"mrs_get_peer",peer_id:e},function(e,n){t(e,n),im.resume()})}function Bt(e){var t=store.mail,n=t.cur,i=t.msgs,a=t.scraps,o=t.rolls;o.folder[n.folder]=[],a.folder=[],W.setMainLoading(!0),ajaxRequest("/mail",{act:"all"===n.folder?null:n.folder,offset:0},function(t,r){if(store.mail.cur){storeMethods.injectMail(t),"all"!==n.folder&&"unread"!==n.folder||Object.keys(t.msgs).forEach(function(e){e=toInt(e);var n=t.msgs[e].peerId;o.peer[n]=(o.peer[n]||[]).concat(e).filter(function(e){return!!i[e]}).filter(unique).sort(asc)});var s="important"===n.folder,l=s?desc:Nn,c=Object.keys(s?t.msgs:t.peers).map(toInt).sort(l).filter(function(e){return-1===a.folder.indexOf(e)}),u=[].concat(c).filter(unique).sort(l);o.folder[n.folder]=u,a.folder=first(20,u),store.mail.reached.folder[n.folder]=r,d.default.redrawFolder(),T.redrawCounter(),W.setMainLoading(!1),e&&e()}})}function Pt(){"/mail"!==location.pathname&&0!==location.pathname.indexOf("/write")||Zn()}function Lt(e,t){void 0===t&&(t={});var n=Ht(e);return e=makeUrl(e),n&&location.pathname+location.search!==e&&nav.go(e,!1,{push_only:!0,replace:!0===t.replace}),n}function Rt(){Lt("/mail?q="+store.mail.cur.query+"&tab=messages")}function Nt(e){var t=Nt;if(t.timer&&clearTimeout(t.timer),store.mail.cur){var n=store.mail.cur,i=!n.query;if(e){var a="msgs"===n.tab?"&tab=messages":"",o=makeUrl("/mail?q="+e+a);Ht(o),i?Lt(o):t.timer=setTimeout(function(){Lt(o,{replace:!0})},300)}else Lt("/mail",{replace:!0})}}function Ft(){W.setMainLoading(!1),W.setConvoLoading(!1),Nt.clearTimer(),Lt("/mail",{replace:!0})}function Ht(e){var t=(e=makeUrl(e)).split("?"),n=t[0],i=qs2obj(t[1]),a=store.mail,o=a.cur,s=a.scraps;if(o){var l=i.act,u=i.peer,f=i.chat,_=i.email,p=i.m,h=toInt(i.msg)||toInt(i.id)||null,m="messages"===i.tab?"msgs":"peers",v=i.q||"",g=+i.community||0;if(vn())return!0;if("/mail"!==n||"add_to_chat"===l||"flush_history"===l||"info"===l||"unpin"===l||"leave_chat"===l||"new_chat"===l||"chat_preview"===l||"return_to_chat"===l||"show_medias"===l||"toggle_community_block"===l||"community_toggle_important"===l||"ban_user"===l||"community_mark_answered"===l||"invite_link"===l||"reset_link"===l||"send"===l||"show"===l&&i.id||70==p||71==p||76==p||784==p||783==p||786==p||785==p||787==p)return clog("[mail nav] Exit Mail"),void ei();if((o.groupId?-o.groupId:0)===g){h&&(nt=!0),d.default.clearSystemMessage2();var b=u?toInt(u):f?toInt(f)+2e9:_?-toInt(_)-2e9:null,y="unread"===l||"important"===l||"unrespond"===l?l:"all",w=function(e){switch(e){case"template":case"mrs":case"msg":return!0}return!1}(l),C=!w&&!!o.page,k=o.query!==v||o.tab!==m;o.page;if(function(){var e=store.mail.cur;if(e.peerId||e.page||e.query)return!1;return!0}()&&Object(Fe.saveFolderScroll)(o.folder,W.getMainBody().scrollTop),C&&(o.page=null),k&&b&&("peers"===o.tab?store.mail.cur.mvk_entrypoint="conversations_search":"msgs"===o.tab&&(store.mail.cur.mvk_entrypoint="message_search")),o.peerId&&!b&&v)clog("[mail nav] Peer back to Search"),o.query=v,o.peerId=null,o.tab=m,qt(),W.setQuery(v),Yt();else if(k&&o.peerId===b)o.query=v,o.tab=m,s.search=[],o.tab!==m&&(store.mail.reached.search.msgs={}),V.redrawView(),W.setQuery(v),d.default.redrawSearch(),v?(clog("[mail nav] Search update"),Yt()):(clog("[mail nav] Search exit"),function(){var e=store.mail,t=e.cur,n=e.scraps;t.query="",t.tab="peers",n.search=[],V.redrawView(),d.default.redrawSearch(),W.setQuery("")}(),0===s.folder.length&&Qt());else if(w)clog("[mail nav] Enter Page: "+l),o.page=l,o.peerId&&(o.peerId=null,qt()),o.backUrl=ti({peerId:b}),V.redrawView(),function(e){var t=store.mail.cur,n=W.getPageLayer();"mrs"===t.page&&store.mail.mrs?(store.mail.scraps.mrs=store.mail.rolls.mrs.concat(),n.classList.toggle("messenger__layer_loading",!1),n.innerHTML=D.default.html(Me({count:t.countMR}))):(n.classList.toggle("messenger__layer_loading",!0),n.innerHTML=(i=Object(A.MailHat_page)(),a=Object(c.default)({mix:"messenger__body",inner:[Q()]}),r.default.html(N(),i,a)),ajaxRequest(e,{},function(e,t){t&&storeMethods.injectMail(t),n.classList.toggle("messenger__layer_loading",!1),n.innerHTML=e}));var i,a}(e);else{if(o.peerId&&o.peerId===b)return!0;o.peerId!==b||C&&b?b?(clog("[mail nav] Enter Dialog"),o.backUrl=ti({peerId:b}),$t(b,h)):(clog("[mail nav] Exit Dialog"),qt(),Ut(y),Qt()):b&&p?(clog("[mail nav] Peer System Msg"),store.mail.peers[b].systemMessageCode=toInt(p),d.default.updateClass("peer"),d.default.redrawSystemMessage(),W.scrollConvoToBottom()):(o.folder!==y||C&&y)&&(clog("[mail nav] Enter Folder"),Ut(y),Qt())}return!0}}}function Ut(e,t){void 0===t&&(t={restoreScroll:!0});var n=store.mail,i=n.cur,a=n.scraps,o=n.rolls;i.folder=e,Vt()?Bt():(t.restoreScroll?a.folder=(o.folder[e]||[]).concat():a.folder=first(20,o.folder[e]),d.default.folderSetItems(a.folder),V.redrawView(),T.redraw()),t.restoreScroll?W.getMainBody().scrollTop=Object(Fe.restoreFolderScroll)(e):W.getMainBody().scrollTop=0}function Vt(){var e=store.mail,t=e.rolls,n=e.cur,i=e.msgs,a=t.folder[n.folder];return!a||("important"===n.folder?a.some(function(e){return!i[e]}):a.some(function(e){return!(t.peer[e]&&t.peer[e].length>0)}))}function $t(e,t){var n=store.mail,i=n.cur,a=n.msgs,o=n.peers,r=n.scraps,s=n.rolls,l=n.reached;if(o[e]){var c=s.peer[e]||[];if(t||!(o[e].countUnread>1)||o[e].isIncomingMR||o[e].isRejectedMR){i.peerId=e,r.peer=[],Fn(),t?(r.peer=[t],s.peer[e]=[],l.peer.before[e]=!1,l.peer.after[e]=!1):(r.peer=last(20,c),p()),store.mail.reached.peer.after[e]=!0,d.default.updateClass("peer"),V.redrawView(),W.redrawConvoLayer(),qn(),T.startStatusUpdate(),d.default.peerSetItems(r.peer),ct(),$e.ready().then(function(){_.default.init()}),t||Wt(e);var u=o[e];t&&(d.default.updateClass("peer"),V.scrollToMsg(t)),t?Xt(t):Xt(),Object(et.resizePosters)(),requestAnimationFrame(function(){t||(W.scrollConvoToBottom(),$e.ready().then(function(){W.scrollConvoToBottom()})),AudioMessagePlayer.redrawWaves(),requestAnimationFrame(function(){t||W.scrollConvoToBottom()})}),u.banner&&"birthday"===u.banner.name&&statlogsValueEvent("gifts_im_birthday_banner","view",e)}else{W.setConvoLoading(!0),window._preventedCheckTop=!0,nt=!0,i.peerId=e,r.peer=[],Fn(),Se.default.redrawUnread(e),V.redrawView(),W.redrawConvoLayer(),qn(),T.startStatusUpdate(),p(),d.default.peerSetItems([]),ct(),$e.ready().then(function(){_.default.init()});var f={act:"show",peer_id:e,msg:"unread",reply_msg_id:i.msgReply[i.peerId]};ajaxRequest("/mail",f,function(t,n,i){if(store.mail.cur){var o=t.rolls.peer[e];if(storeMethods.injectMail(t),l.peer.after[e]=n,l.peer.before[e]=i,c=s.peer[e]||[],(Object(pe.arrayIntersects)(o,c)||n&&0===c.length)&&(s.peer[e]=c.concat(o).filter(unique).sort(asc)),store.mail.cur.peerId===e){_.default.preventShowToBottom(),r.peer=o.slice(),geByClass1("mailScrap__items_peer").innerHTML="",d.default.updateClass("peer"),d.default.peerSetItems(o),AudioMessagePlayer.redrawWaves(),Wt(e);var u=o.find(function(e){return a[e].isUnread});V.scrollToMsg(u,!0,!1),requestAnimationFrame(function(){window._preventedCheckTop=!1,nt=!1,W.setConvoLoading(!1)})}}})}}else ajaxRequest("/mail",{act:"get_peers",peer_ids:[e]},function(n){storeMethods.injectMail(n),o[e]?$t(e,t):window.location.reload()});function p(){i.forwardFromId&&(jn(),i.forwardFromId=null)}}function qt(e){void 0===e&&(e={});var t=store.mail,n=t.cur,i=t.scraps;T.cancelStatusUpdate(),Yn(),n.peerId=null,n.mvk_entrypoint="",i.peer=[],Fn(),n.hasAttachments=!1,e.keepSelected||(n.msgSelected={}),V.redrawView(),T.redraw(),_.default.reset(),W.cleanConvoBody(),lt(),requestAnimationFrame(function(){p.default.setCount(0),V.redrawMailActions(),Pe.default.redraw(),requestAnimationFrame(function(){d.default.peerSetItems(i.peer)})})}function Wt(e){Qe("read_dialog"+e,function(){!function(e){var t=store.mail.peers;if(!t)return;var n=t[e];if(n&&(n.isIncomingMR||n.isRejectedMR))return;!n||n.countUnread>0?ajaxRequest("/mail",{act:"read_dialog",peer_id:e,hash:n.hashRead},function(){hn(null,e)}):setTimeout(function(){hn(null,e)},500)}(e)})}function zt(e,t){Qe("read_dialog"+t,function(){!function(e,t){var n=store.mail.peers;if(!n)return;hn(null,t),ajaxRequest("/mail",{act:"read_message",msg_id:e,peer_id:t,hash:n[t].hashRead},function(){})}(e,t)})}function Qt(){var e=Qt,t=e.locked||(e.locked={}),n=store.mail,i=n.cur,a=n.scraps,o=n.rolls,r=n.reached,s=i.folder,l=a.folder,c=o.folder[s],u="folder_"+s,f=r.folder[s]&&last(l)===last(c);if(W.setMainLoading(0===l.length&&!f),!t[u]&&!f){var _="important"===s,p=Vt(),h=_?desc:Nn,m=[];if(0===l.length)m=first(20,c);else{var A=c.indexOf(last(l));m=A>=0?c.slice(A+1,A+21):[]}if(m.length&&!p){var v=l.concat(m).filter(unique).sort(h);a.folder=v,d.default.folderAddItems(m)}else{t[u]=!0;var g="all"===s?null:s,b=p?0:l.length;ajaxRequest("/mail",{act:g,offset:b},function(e,n){if(store.mail.cur){storeMethods.injectMail(e),Object.keys(e.peers).forEach(function(e){store.mail.reached.peer.after[e]=!0}),"all"!==s&&"unread"!==s||Object.keys(e.msgs).forEach(function(t){t=toInt(t);var n=e.msgs[t].peerId;o.peer[n]=(o.peer[n]||[]).concat(t).filter(unique).sort(asc)});var f=Object.keys(_?e.msgs:e.peers).map(toInt).sort(h).filter(function(e){return-1===l.indexOf(e)}),m=c.concat(f).filter(unique).sort(h);o.folder[s]=m,n&&(r.folder[s]=n),t[u]=!1,i.folder===s&&(a.folder=m,d.default.updateClass("folder"),d.default.folderAddItems(f),W.setMainLoading(!1),p&&(d.default.folderSetItems(a.folder),V.redrawView(),T.redraw()))}})}}}function Yt(){var e=Yt,t=e.locked||(e.locked={}),n=store.mail,i=n.cur,a=n.scraps,o=n.rolls,r=n.reached,s=i.tab,l=i.query,c="search_msgs_"+s+"_"+l,u=a.search,f=o.search[s][l]||[],_=r.search[s][l]&&last(u)===last(f);if(W.setMainLoading(0===u.length&&!_),!t[c]&&!_){var p=[];if("peers"===s&&(f.length||(f=function(){var e=store.mail,t=e.cur,n=e.peers,i=(e.rolls,Object.keys(n).map(toInt)),a=QuickSearch.getQueryREs(t.query),o=[];return a.forEach(function(e){i.forEach(function(t){n[t].title.match(e)&&o.push(t)})}),o.filter(unique).sort(Nn)}()),f.length))if(0===u.length)p=first(20,f);else{var h=f.indexOf(u);p=h>=0?f.slice(h+1,h+41):[]}if(p.length&&(a.search=u.concat(p).filter(unique),d.default.redrawSearch(),d.default.updateClass("search"),W.setMainLoading(!1)),!p.length||"peers"===s){var m="msgs"===s?{act:"search",q:l,offset:a.search.length,messages:1}:{act:"search",q:l};e.timer&&clearTimeout(e.timer),e.timer=setTimeout(function(){t[c]=!0,ajaxRequest("/mail",m,function(e,n){if(store.mail.cur){t[c]=!1,storeMethods.injectMail(e);var u=Object.keys("peers"===s?e.peers:e.msgs).map(toInt),_="peers"===s?Nn:desc,p=f.concat(u).filter(unique).sort(_);o.search[s][l]=p,n&&(r.search[s][l]=n),i.tab===s&&i.query===l&&(W.setMainLoading(!1),a.search=a.search.concat(u).filter(unique).sort(_),d.default.redrawSearch(),d.default.updateClass("search"))}})},300)}}}function Xt(e){if(!$(".load_before_closed")){var t=Xt,n=t.locked||(t.locked={}),i=store.mail,a=i.cur,o=i.scraps,r=i.rolls,s=i.reached;if(a){var l=a.peerId,c=o.peer,u=r.peer[l]||[],f="peer_before_"+l,p=s.peer.before[l]&&c[0]===u[0],h=a.msgReply[l];if(W.setConvoLoading(c.length<1&&!p),!n[f]&&!p){var m=W.getConvoBody(),A=!Object(pe.arrayIntersects)(c,u),v=first(c),g=v?u.indexOf(v):-1,b=0===c.length?last(10,u):g>=0?u.slice(g-20,g):[];if(b.length&&!e){if(m.scrollTop>6e3&&!A)return;if(window._preventedCheckTop)return;var y=o.peer.slice(),w=c.concat(b).filter(unique).sort(asc);o.peer=w,d.default.peerAddItemsBefore(b.filter(function(e){return-1===y.indexOf(e)})),AudioMessagePlayer.redrawWaves(),d.default.updateClass("peer"),W.setConvoLoading(!1)}else{if(!l)return;var C={act:"show",peer_id:l,msg:c[0],direction:e?"around":"before",reply_msg_id:h},k=c[0];n[f]=!0,ajaxRequest("/mail",C,function(t,i,a){if(store.mail.cur){e&&setTimeout(function(){nt=!1},10),n[f]=!1,t.peers=[],storeMethods.injectMail(t);var p=Object.keys(t.msgs).map(toInt).filter(function(e){return-1===c.indexOf(e)}),h=c.concat(p).filter(unique).sort(asc);if(a&&(s.peer.before[l]=!0),i&&(s.peer.after[l]=!0),u=r.peer[l]||[],(Object(pe.arrayIntersects)(h,u)||a&&0===u.length)&&(r.peer[l]=(r.peer[l]||[]).concat(h).filter(unique).sort(asc)),store.mail.cur.peerId===l){if(_.default.preventShowToBottom(),m.scrollTop>6e3&&!A)return;var v=o.peer.slice();o.peer=h,d.default.updateClass("peer"),k?(d.default.peerAddItemsBefore(p.filter(function(e){return-1===v.indexOf(e)&&e<k}),!0),d.default.peerAddItemsAfter(p.filter(function(e){return-1===v.indexOf(e)&&e>k}),!0)):d.default.peerAddItemsBefore(p,!0),e&&(V.scrollToMsg(e),W.setConvoLoading(!1)),AudioMessagePlayer.redrawWaves(),W.setConvoLoading(!1),null!=t.flags.stickersAutoplay&&StickersSettings.setAutoplay(t.flags.stickersAutoplay),V.expandPeerBefore(),setTimeout(V.expandPeerBefore,100),e&&jn(),_.default.redrawReply()}}})}}}}}function Gt(){var e=Gt,t=e.locked||(e.locked={}),n=store.mail,i=n.cur,a=n.scraps,o=n.rolls,r=n.reached;if(!nt&&i){var s=i.peerId,l=a.peer,c=o.peer[s]||[],u="peer_after_"+s;if(!(t[u]||r.peer.after[s]&&last(l)===last(c))){var f=W.getConvoBody(),_=!Object(pe.arrayIntersects)(l,c),p=function(){return f.scrollHeight-f.scrollTop-f.offsetHeight},h=last(l),m=h?c.indexOf(h):-1,A=m>=0?c.slice(m+1,m+21):[];if(!A.length||nav.getQuery("msg")||nav.getQuery("id")){if(!s)return;var v={act:"show",peer_id:s,msg:last(l),direction:"after"};t[u]=!0,ajaxRequest("/mail",v,function(e,n){if(store.mail.cur){t[u]=!1,e.peers=[],storeMethods.injectMail(e);var i=Object.keys(e.msgs).map(toInt).filter(function(e){return-1===l.indexOf(e)}).sort(asc),f=l.concat(i).filter(unique).sort(asc);if(n&&(r.peer.after[s]=n),c=o.peer[s]||[],(Object(pe.arrayIntersects)(f,c)||n&&0===c.length)&&(o.peer[s]=(o.peer[s]||[]).concat(f).filter(unique).sort(asc)),store.mail.cur.peerId===s){if(p()>6e3&&!_)return;n&&d.default.updateClass("peer"),a.peer=f,d.default.updateClass("peer"),d.default.peerAddItemsAfter(i),AudioMessagePlayer.redrawWaves()}}})}else{if(p()>6e3&&!_)return;var g=l.concat(A).filter(unique).sort(asc);a.peer=g,d.default.peerAddItemsAfter(A),d.default.updateClass("peer"),AudioMessagePlayer.redrawWaves()}}}}Nt.clearTimer=function(){self=Nt,self.timer&&(clearTimeout(self.timer),self.timer=null)};var Kt=!1;function Jt(e){var t=store.mail,n=t.cur,i=t.scraps,a=t.rolls,o=e.scrollTop,r=e.scrollHeight,s=e.offsetHeight;if(n)if(!n.query&&o<=20&&i.folder.length){if(Kt){Kt=!1;i.folder.slice();i.folder=first(20,a.folder[n.folder]),d.default.folderCutItems(20)}}else o>20&&(Kt=!0,r-o-s<window.innerHeight&&(n.query?Yt():Qt()))}function Zt(){var e=store.mail,t=e.cur,n=e.scraps,i=e.rolls,a=e.reached,o=n.peer,r=i.peer[t.peerId]||[];if(r.length&&last(o)===last(r)&&a.peer.after[t.peerId])W.scrollConvoToBottom(),_.default.hideToBottom(),d.default.updateClass("peer");else{var s=t.peerId;ajaxRequest("/mail",{act:"show",peer_id:s},function(e,t){if(store.mail.cur){var o=e.rolls.peer[s];i.peer[s]=o.slice(),storeMethods.injectMail(e),a.peer.after[s]=!0,store.mail.cur.peerId===s&&(_.default.preventShowToBottom(),n.peer=o.slice(),geByClass1("mailScrap__items_peer").innerHTML="",d.default.peerAddItemsBefore(o),d.default.updateClass("peer"),W.scrollConvoToBottom(),AudioMessagePlayer.redrawWaves())}})}}function en(e){var t=en;t.timer||(t.timer=setTimeout(function(){t.timer=null,function(e){var t=store.mail,n=t.cur,i=t.scraps,a=t.msgs,o=t.peers;if(!n)return;var r=i.peer.find(function(e){return a[e]&&a[e].isUnread&&a[e].authorId!==n.viewerId}),s=e.scrollTop,l=e.scrollHeight-s-e.offsetHeight;if(r){var c=he.default.getElem(r),u=e.scrollHeight-c.offsetTop;l-u<=100&&Wt(n.peerId)}e._prevScroll||(e._prevScroll=0),l<300&&$(".mailScrap_reachedAfter")?_.default.hideToBottom():s>e._prevScroll-5||n.peerId&&o[n.peerId].countUnread?_.default.showToBottom():_.default.hideToBottom();e._prevScroll=s}(e)},50))}function tn(e){for(var t=0,n=e.attaches.length;t<n;t++){if("sticker"===e.attaches[t].type)return!1}var i=store.mail.cur;return i.userId===e.peerId&&!i.groupId||e.isOut}function nn(e){var t,n=e.peerId,i=e.id,a=e.authorId,o=e.attaches,r=e.adminId,s=e.isService,l=e.isStealth,c=e.isOut,u=e.keyboard,d=store.mail,f=(d.cur,d.peers),_=(d.msgs,d.members),p=f[n]&&f[n].pinnedMsgId===i,h=Object(ve.getMsgSendId)(e),m=Object(Fe.getPendingMsg)(h,n),A=!(!m&&!e.replaced);if(m?(Ve.mark(h,"opt_to_lp"),t=function(e){return!!e.length}(o)):t=s||o.length||p||!f[n]||!_[a]||r&&!_[r],m){var v=function(e){var t=store.mail.cur;if(Object(Fe.removePendingMsg)(e),$e.remove(e.sendId,"silent"),t.peerId&&-1===e.sendId.indexOf("edit"))return Re.getMsg(e)}(m),g=Object.assign({},m,{id:i,failed:!1,pending:!1,waiting:!0,sendId:void 0,canEdit:tn(e)});if(storeMethods.injectMsg(g),an(g,{existingElem:v}),!t)return void Ve.clean(h)}if(!u||!u.inline){if((u||t)&&!c&&!e.edited)Object(Fe.getKeyboardState)(n).updateTime=Date.now();!u||t||c||e.edited||function(e){var t=e.peerId,n=e.authorId,i=e.msgId,a=e.keyboard,o=store.mail.peers[t];o&&(o.keyboard=Object(ve.prepareKeyboard)({keyboard:a,authorId:n,msgId:i}))}({peerId:n,authorId:a,msgId:i,keyboard:u})}if(t)return im.pause(),void Je({msgId:i,forcePinned:p,onTryError:function(e){var t=e.type;h&&(Ve.error(h,"server_load_attach",t),Ve.clean(h))},onResult:function(e){var t=e[0],a=e[1];h&&(Ve.mark(h,"attach"),Ve.clean(h)),store.mail.cur&&(storeMethods.injectMail(t),a&&function(e,t){var n=t.unpin,i=t.pinned,a=store.mail,o=a.cur,r=a.peers;if(n){r[e].pinnedMsg="",r[e].hasPinnedMsg=!1;var s=zn();delete s[e],Qn(s),o.peerId===e&&(V.redrawPinnedMsg(),qn())}else i&&(r[e].pinnedMsg=i,r[e].hasPinnedMsg=!0,o.peerId===e&&(V.redrawPinnedMsg(),qn()))}(n,a),an(t.msgs[i],{isStealth:l,isServerMsg:!0,isReplace:A}),im.resume())}});var b=function(e){var t,n=e.peerId,i=e.id,a=e.authorId,o=e.isOut,r=e.text,s=e.ts,l=e.flags,c=e.adminId,u=e.isService,d=store.mail,f=d.cur,_=(d.peers,d.msgs),p=d.members,h=Object(ve.formatTime)(s,f.timeShift),m=_[i],A="";r&&(A=r.replace(/<br>/g,"\n").replace(ve.MENTION_DOMAIN_REGEXP,"@$3").replace(ve.MENTION_REGEXP,"@$1 ($3)"));t=e.replaced?!!m&&m.edited:!!e.edited;var v=r,g=r;g=Object(ve.wrapLinks)(g,l),g=Object(ve.wrapMention)(g),g=Object(Ne.emojiToHTML)(g);var b=e.keyboard;b=b&&b.inline?Object(ve.prepareKeyboard)({keyboard:b,authorId:a,msgId:i}):null;var y={id:i,peerId:n,authorId:a,ts:s,date:h,dateShort:h,text:g,textInput:A,body:v,isUnread:!m||m.isUnread,edited:t,canEdit:tn(e),isOut:o,isService:u,keyboard:b,attaches:{},forwards:[],hasReply:!!e.hasReply};c&&(y.adminName=c===f.userId?lang.mobile_mail_you:p[c].name,y.adminUrl=p[c].url);return y}(e);storeMethods.injectMsg(b),an(b,{isStealth:l,isReplace:A})}function an(e,t){var n=void 0===t?{}:t,i=n.isStealth,a=n.isServerMsg,o=n.isReplace,r=n.existingElem,s=store.mail,l=s.cur,c=s.peers,u=(s.msgs,s.members,s.rolls),f=s.scraps,p=s.reached,h=e.peerId,m=(e.keyboard,e.authorId),A=e.isOut,v=e.id,g=!A,b=c[h]&&0===c[h].countUnread&&g,y=o||!!e.edited,w=c[h],C=w.isIncomingMR,k=w.isRejectedMR,S=W.getConvoBody(),E=!1;if(e.isUnread&&(E=l.viewerId===h||l.peerId===h&&g&&S.scrollHeight-S.scrollTop-S.offsetHeight<400&&!!$(".mailScrap_reachedAfter")),E&&g&&!C&&!k&&zt(v,h),!y){var O=last(u.peer[h]||[]);u.peer[h]=(u.peer[h]||[]).concat(v).filter(unique).sort(asc),i||C||k||(u.folder.all=u.folder.all.concat(h).filter(unique).sort(Nn),p.peer.after[h]||(p.peer.after[h]=!0,p.peer.before[h]=!1));var D=c[h];if(g&&(h===l.peerId&&_.default.renderKeyboardIfNeeded({update:!0}),i||(C||k||(u.folder.unread=u.folder.unread.concat(h).filter(unique).sort(Nn)),a||(D.countUnread||(D.countUnread=0),D.countUnread+=1)),h!==l.peerId&&i||_.default.redrawToBottom()),!i&&!C&&!k)if(b&&(l.countUnread+=1,T.redrawCounter()),l.groupId&&(g?u.folder.unrespond=u.folder.unrespond.concat(h).filter(unique).sort(Nn):Object(pe.arrayRemove)(u.folder.unrespond,h)),"all"===l.folder){var j=f.folder.slice();f.folder=f.folder.concat(h).filter(unique).sort(Nn),d.default.redrawFolder(j)}else if("unread"===l.folder&&m!==l.viewerId){var I=f.folder.slice();f.folder=f.folder.concat(h).filter(unique).sort(Nn),d.default.redrawFolder(I)}else if("unrespond"===l.folder){var M=f.folder.slice();g?f.folder=f.folder.concat(h).filter(unique).sort(Nn):Object(pe.arrayRemove)(f.folder,h),d.default.redrawFolder(M)}if(C&&(u.mrs=u.mrs.concat(h).filter(unique).sort(Nn),"mrs"===l.page)){var x=f.mrs.slice();f.mrs=f.mrs.concat(h).filter(unique).sort(Nn),d.default.redrawMRs(x)}if(l.peerId!==h||!Object(pe.arrayIntersects)(f.peer,u.peer[h])&&0!==f.peer.length||last(f.peer)!==O)r&&r.remove();else{f.peer.slice();f.peer=f.peer.concat(v).filter(unique).sort(asc);var B=on(function(){r?d.default.peerAddElemAfter(v,r):d.default.peerAddItemsAfter([v])});g&&!B&&_.default.showToBottom(),m===l.viewerId&&d.default.removeDivider()}var P=Object(Le.uTyping_getPeerTyping)(h);P&&P.users.length&&(Object(Fe.removePeerTypingUser)(h,m),h===l.peerId&&Pe.default.redraw(),Se.default.redrawTyping(h))}var L=v===Object(Se.uConvo_getLastMsgId)(h);y&&(L?on(function(){return d.default.peerReplaceItems([v])}):d.default.peerReplaceItems([v])),!i&&L&&(Se.default.redrawLastMsg(h),Se.default.redrawUnread(h),StickersAnimation.checkSettingsAndLoad(e.id)),h===l.peerId&&AudioMessagePlayer.redrawWaves()}function on(e){var t=W.getConvoBody(),n=t.scrollTop+t.offsetHeight>=t.scrollHeight-2;e();var i=t.scrollHeight-t.scrollTop-t.offsetHeight<400;return n&&W.scrollConvoToBottom(),i}function rn(){if(store.mail.cur){var e=store.mail.cur.backUrl;if(store.mail.cur.backUrl=null,lt(),e)history.back();else Lt(function(){var e=store.mail.cur;return"mrs"===e.page?"/mail":"template"===e.page?"/mail?act=show&peer="+nav.getQuery("from"):e.tab?"/mail":(e.peerId,"/mail")}(),{replace:!0})}}function sn(){var e=store.mail.cur,t=e.msgSelected,n=e.forwardFromId;e.forwardFromId=null,Object.keys(t).forEach(function(e){delete t[e]}),he.default.unselectAll(),V.redrawMailActions(),n&&$t(n)}var ln={};function cn(e,t,n){var i=store.mail,a=i.cur,o=i.peers,r=o?o[e]:null;if(r&&!r.isIncomingMR&&!r.isRejectedMR){var s=Object(Fe.filterPeerTypingUser)({type:"text",users:t,count:n},a.viewerId);Object(Fe.setPeerTyping)(e,s);var l=ln[e];l&&clearTimeout(l),s.count&&s.users.length&&(ln[e]=setTimeout(function(){ln[e]=null,cn(e,[],0)},7e3),ai(s.users,e)),e===a.peerId&&Pe.default.redraw(),Se.default.redrawTyping(e)}}var un,dn,fn={};function _n(e,t,n){var i=store.mail,a=i.cur,o=i.peers;if(o?o[e]:null){var r=Object(Fe.filterPeerTypingUser)({type:"audio",users:t,count:n},a.viewerId);Object(Fe.setPeerTyping)(e,r);var s=fn[e];s&&clearTimeout(s),r.count&&r.users.length&&(fn[e]=setTimeout(function(){fn[e]=null,_n(e,[],0)},7e3),ai(r.users,e)),e===a.peerId&&Pe.default.redraw(),Se.default.redrawTyping(e)}}function pn(e){var t=e.userId,n=e.isOnline,i=e.onlinePlatform,a=e.lastActionTime,o=store.mail,r=o.cur,s=o.peers[t];s&&s.canSeeOnline&&(s.isOnline=n,e.isOnline&&(s.onlinePlatform=i),a&&(s.lastActionTime=a),Se.default.redrawOnline(t),r.peerId===t&&T.redrawOnline())}function hn(e,t){var n=store.mail,i=n.cur,a=n.peers,o=n.msgs,r=n.scraps,s=n.rolls;if(i){var l=i.peerId===t?r.peer:[],c=s.peer[t]||[],u=a[t];if(c.concat(l).forEach(function(e){var t=o[e];t&&t.isUnread&&t.authorId!==i.viewerId&&(delete t.isUnread,he.default.markAsRead(e))}),u?u.countUnread&&(i.countUnread-=1,u.countUnread=0):i.countUnread-=1,Object(pe.arrayRemove)(s.folder.unread,t),"unread"===i.folder){var f=r.folder.slice();Object(pe.arrayRemove)(r.folder,t),d.default.redrawFolder(f)}T.redrawCounter(),_.default.redrawToBottom(),Se.default.redrawUnread(t)}}function mn(e,t){var n=store.mail,i=n.cur,a=n.msgs,o=n.rolls,r=n.scraps,s=o.peer[t]||[];if(a[e])for(var l=s.indexOf(e);l>=0;){var c=a[s[l]];c.authorId===i.viewerId&&c.isUnread&&(delete c.isUnread,he.default.markAsRead(c.id)),l--}else last(s)&&e<=last(s)&&s.forEach(function(e){var t=a[e];t.authorId===i.viewerId&&t.isUnread&&(delete t.isUnread,he.default.markAsRead(t.id))});i.peerId===t&&r.peer.forEach(function(e){var t=a[e];t.authorId===i.viewerId&&t.isUnread&&(delete t.isUnread,he.default.markAsRead(t.id))}),Se.default.redrawUnread(t)}function An(){if(vn())return!0;var e=store.mail.cur;if(e&&(e.backUrl=null),e&&e.forwardFromId)return sn(),!0;ee.default.safari_mobile&&document.activeElement.blur();var t=qs2obj(location.search.slice(1)).act;if(!$(".uMessenger")&&"/mail"===location.pathname&&"show_medias"!==t)return nav.go(location,null,{no_push:!0,need_restore:!1}),!0;var n=new RegExp(/z=photo/).test(location.search);if($(".uMessenger")&&!n&&!ge("z_photoview")&&!ge("StoriesView")){var i=Ht(location.pathname+location.search);return i&&nav.go(location.pathname+location.search,null,{no_push:!0,push_only:!0}),i}}function vn(){var e=vn;if(mediaUpload.isUploading)return e.noAlert||alert(unescapeAttr(lang.mobile_mail_wait_until_uploaded)),e.noAlert=!0,setTimeout(function(){e.noAlert=!1},10),!0}function gn(e,t,n,i){void 0===i&&(i={});var a=store.mail.cur;if(!("/mail"===n&&a&&a.groupId||i.replace))return!t.m&&geByClass1("uMessenger")?Lt(n):void 0}function bn(){window.isNewMail&&(store.mail.cur?"/mail"!==location.pathname&&0!==location.pathname.indexOf("/write")?ei():Zn():Nt.clearTimer())}function yn(){var e=store.mail,t=e.cur,n=(e.msgs,e.peers),i=e.hash,a=t.msgSelected,o=toInt(Object.keys(a)[0]),r=n[t.peerId];t.hasAttachments=!1,t.msgSelected={},r.pinnedMsgId=o,r.hasPinnedMsg=!0,he.default.unselectAll(),V.redrawMailActions(),ajaxRequest("/mail?act=pin",{hash:i.pin,chat:nav.getQuery("chat")||store.mail.cur.peerId-2e9,msg:o,_ajax:1})}function wn(){var e,t=store.mail,n=t.cur,i=t.msgs,a=(t.peers,t.hash),o=(t.replies,t.pendingReplies,n.msgSelected),r=toInt(Object.keys(o)[0]),s=n.peerId,l=Object(Fe.getPeerDraft)(n.viewerId,n.peerId),c=i[r],u=function(e){c.hasReply||l&&l.editing&&l.editing.id==r&&l.msgs&&(n.msgAttached[s]=l.msgs),c.hasReply?n.msgReply[s]=c.reply:n.msgReply[s]=null,_.default.redrawReply(),_.default.onAttachedMsgsRemove(),_.default.uiRedrawAttachments(s),_.default.setModifiers({editing:!0}),T.setModifiers({editing:!0}),V.redrawMailActions(),Cn(),_.default.setText(e)};if(n.editing==r)return e=l&&l.editing&&l.editing.id==r?l.editing.text||"":c.textInput,void u(e);n.editing=r,Xn(),ajaxRequest("/mail?act=edit_message_start",{hash:a.edit,edit_msg_id:r,peerId:s,_ajax:1},function(e,t){Object(Fe.pushPeerAttachments)(n.peerId,e),u(t)})}function Cn(){var e=store.mail.cur.msgSelected;Object.keys(e).forEach(function(t){delete e[t]}),he.default.unselectAll(),p.default.setCount(0),V.redrawMailActions()}function kn(){var e=store.mail,t=(e.msgs,e.cur),n=Object.keys(t.msgSelected).every(Sn);1!==Object.keys(t.msgSelected).length||n?me.default.open({canDeleteForAll:n}):On()}function Sn(e){var t=store.mail,n=t.msgs,i=(t.cur,t.peers),a=vk.id,o=n[e],r=nav.getQuery().community,s=i[o.peerId];return!!o&&(o.authorId!==a&&o.authorId!==-r?s.isAdmin&&-1===s.adminIds.indexOf(o.authorId):!(o.peerId===a&&!r)&&(333!==o.peerId&&(!(Date.now()/1e3-o.ts>86400)&&!(s.kicked||s.closed||s.unableToWrite||s.kickedMessage))))}function En(){var e=store.mail.cur.editing;e?(!function(e){var t=store.mail,n=t.cur,i=(t.hash,t.msgs,t.peers),a=n.peerId;wt(e),ajaxRequest("/mail",{act:"delete_for_all",peer:a,ids:e+"",hash:i[a].hashRemove},function(){}),V.redrawMailActions()}(e),Yn(!0)):On(!1,me.default.isDeleteMessagesForAll()),me.default.close()}function On(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var n=store.mail,i=n.cur,a=(n.hash,n.msgs,n.peers),o=i.peerId,r=i.msgRemoved,s=i.msgSelected,l=Object.keys(s);l.forEach(function(n){delete s[n=+n],t?wt(n):(r[n]=!e||"spam",e?he.default.spam(n):he.default.remove(n))}),ajaxRequest("/mail",{act:t?"delete_for_all":e?"spam":"delete",peer:o,ids:l.join(","),hash:a[o].hashRemove},function(){}),V.redrawMailActions()}function Tn(){On(!0)}function Dn(){var e=store.mail,t=e.cur,n=e.hash,i=e.msgs,a=t.msgSelected,o=Object.keys(a),r=o.some(function(e){return!i[e].isImportant})?1:0;o.forEach(function(e){delete a[e],i[e].isImportant!=!!r&&(r?t.countImportant++:t.countImportant--),i[e].isImportant=!!r,he.default.toggleImportant([e],!!r)}),ajaxRequest("/mail",{act:"mark_important",ids:o,hash:n.important,val:r},function(){}),he.default.unselectAll(),V.redrawMailActions()}function jn(){var e=store.mail.cur,t=e.peerId,n=Object.keys(e.msgSelected).map(toInt);e.msgAttached[t]=n,Object(Fe.setPeerDraft)(e.viewerId,e.peerId,{msgs:n,reply:void 0},e.editing),e.msgReply[t]&&!e.editing&&ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),e.msgReply[t]=null,e.msgSelected={},he.default.unselectAll(),p.default.setCount(0),_.default.redrawReply(),_.default.uiRedrawAttachments(t),V.redrawMailActions()}function In(){var e=store.mail,t=e.cur,n=e.flags,i=e.pendingReplies,a=t.peerId;if(!Object(ve.isContactPeer)(a)){if(!n.replies)return jn();var o=toInt(Object.keys(t.msgSelected)[0]);t.msgReply[a]=o,i[o]=he.default.getReplyDataFromHTML(o),Object(Fe.setPeerDraft)(t.viewerId,t.peerId,{reply:o,msgs:void 0},t.editing),ajaxRequest("/mail",{act:"reply_start",hash:store.mail.hash.reply,peer_id:store.mail.cur.peerId,msg_id:o}),t.msgAttached[a]=[],t.msgSelected={},he.default.unselectAll(),p.default.setCount(0),_.default.redrawReply(),_.default.uiRedrawAttachments(a),V.redrawMailActions(),_.default.openKeyboard("text")}}function Mn(){var e=store.mail.cur;e&&(Object(ve.isContactPeer)(e.peerId)||(e.forwardFromId=e.peerId,e.query="",e.tab="peers",W.setQuerySilently(""),qt({keepSelected:!0}),Ut("all",{restoreScroll:!1}),Qt()))}function xn(e){if(store.mail.cur){var t=store.mail,n=t.cur,i=t.peers,a=t.msgs,o=t.flags,r=n.msgRemoved,s=n.msgSelected,l=i[n.peerId];if(_.default.hideStickersPanel(),!r[e]){s[e]?delete s[e]:s[e]=!0;var c=Object.keys(s),u=c.length,d=1===u&&c[0]==i[n.peerId].pinnedMsgId,f=c.reduce(function(e,t){return e&&a[t].isImportant},!0);p.default.setCount(u),p.default.setModifiers({pinned:d,important:f}),p.default.setLabels({pinned:d,important:f}),Object(ve.isContactPeer)(n.peerId)?p.default.toggleQuickButtons(!1):p.default.toggleQuickButtons(!0),o.replies&&(1!==u||l.isIncomingMR?p.default.setReplyAvailable(!1):p.default.setReplyAvailable(!0));var h=toInt(Object.keys(s)[0]),m=1==u&&a[h];if(p.default.setEditAvailable(m&&m.canEdit&&!l.unableToWrite),p.default.setImportantAvailable(u>0&&n.viewerId>0),l.canPin){var A=toInt(Object.keys(s)[0]);p.default.togglePin(1===u&&A!==l.pinnedMsgId)}else p.default.togglePin(!1);V.redrawMailActions()}}}function Bn(e){var t=store.mail,n=t.cur,i=t.hash,a=t.msgs[e],o="spam"===n.msgRemoved[e]?"nospam":"restore";delete n.msgRemoved[e],he.default.restore(e),ajaxRequest("/mail",{act:o,id:e,hash:i.restore},function(){}),a.isImportant&&(n.countImportant++,bt(e)),d.default.redrawFolder()}function Pn(e,t,n){var i=store&&store.mail&&store.mail.cur;if(i&&e){var a=store.mail.forwards[n];if(a.peerId&&a.peerId===i.peerId&&!i.msgRemoved[e])V.scrollToMsg(e)||ajaxRequest("/mail",{act:"get_msgs",msgs:[e]},function(i){storeMethods.injectMail(i);var a=store.mail,o=a.msgs,r=a.cur;r.peerId&&(o[e]?$t(r.peerId,e):Ln(e,t,n))});else Ln(e,t,n)}else Ln(e,t,n)}function Ln(e,t,n){if(t){var i=nav.getQuery();"show"===i.act&&(i.msg=t,nav.go(location.pathname+obj2qs(i),!1,{replace:!0,push_only:!0}))}var a=Object(he.Msg_makeReplyLink)(e,t,n);nav.go(a,null,{force:!0})}function Rn(e){var t,n=store.mail.cur;n&&(n.msgSelected=((t={})[e]=!0,t),statlogsValueEvent("messages_channel_forward_click",0),Mn())}function Nn(e,t){var n=store.mail,i=n.rolls,a=n.presend,o=n.msgs,r=i.peer[e]||[0],s=i.peer[t]||[0],l=ri(a.pending[e],function(e){return-1===e.indexOf("edit")}),c=ri(a.pending[t],function(e){return-1===e.indexOf("edit")}),u=last(r),d=last(s),f=Math.max(l?a.msgs[l].ts:0,u?o[u].ts:0);return Math.max(c?a.msgs[c].ts:0,d?o[d].ts:0)-f}function Fn(){if(store.mail.cur){var e=!!store.mail.cur.peerId;$$(".vk__page_mail").forEach(function(t){return t.classList.toggle("messenger_noPullToRefresh",e)})}}function Hn(){var e=store.mail.cur.peerId,t=$(".pinnedMsg");if(t){Number(t.dataset.id);var n=zn();delete n[e],Qn(n),qn()}}function Un(){var e=store.mail.cur.peerId,t=$(".pinnedMsg");if(t){var n=Number(t.dataset.id),i=zn();i[e]=n,Qn(i),qn()}}function Vn(e,t){var n,i=store.mail,a=i.cur,o=i.peers[a.peerId],r=o.banner;void 0!==t&&(n=o.banner&&o.banner.buttons[t],"birthday"===r.name&&"gifts_link"===n.type&&statlogsValueEvent("gifts_im_birthday_banner","click",a.peerId)),ajaxRequest("/mail",{act:"banner_callback",hash:o.hashBanner,peer_id:a.peerId,callback_data:n&&n.callback_data}),it=Date.now(),o.banner=null,V.redrawBanner()}function $n(e){var t=$(".messenger__banner_content");t&&t.classList.toggle("messenger__banner_contentExpanded")}function qn(){var e=store.mail,t=e.cur;e.peers;if(t){var n=t.peerId;if(n){var i=$(".pinnedMsg"),a=zn()[n],o=i?intval(i.dataset.id):null;V.setPinnedVisibility(o&&a!==o)}}}function Wn(){if(store.mail.cur&&store.mail.cur.peerId){var e=$(".pinnedMsg");if(e)if(!Number(e.dataset.id)){var t=store.mail.cur.peerId,n=zn();delete n[t],Qn(n)}}}function zn(){return lsGet("messenger.pinHidden")||{}}function Qn(e){lsSet("messenger.pinHidden",e)}function Yn(e){var t=store.mail.cur;if(t&&t.editing){t.editing=!1,Xn(),!0!==e&&ajaxRequest("/mail?act=edit_message_cancel",{peerId:t.peerId}),Object(Fe.popPeerAttachments)(t.peerId),Object(Fe.setPeerDraft)(t.viewerId,t.peerId,{});var n=Object(Fe.getPeerDraft)(t.viewerId,t.peerId);t.msgAttached[t.peerId]=n.msgs||[],t.msgReply[t.peerId]=n.reply||null,_.default.setText(n&&n.text||""),_.default.setModifiers({editing:!1}),T.setModifiers({editing:!1}),_.default.uiRedrawAttachments(t.peerId),_.default.redrawReply();var i=W.getConvoBody();i.scrollTop+i.offsetHeight>=i.scrollHeight-2&&W.scrollConvoToBottom()}}function Xn(){var e=nav.getQuery();store.mail.cur.editing?e.edit_msg_id=store.mail.cur.editing||void 0:delete e.edit_msg_id,nav.go(location.pathname+obj2qs(e),!1,{replace:!0,push_only:!0})}function Gn(){if(store.mail.msgs){var e=+nav.getQuery("edit_msg_id");e&&store.mail.msgs[e]&&(store.mail.cur.msgSelected[e]=!0,wn())}}function Kn(e){var t=e.closest("."+he.default.class);if(t){var n=he.default.getId(t);store.mail.msgs[n].textFull=he.default.getTextHtml(t)}}function Jn(e){Lt(e)}function Zn(){var e;store.mail.cur&&(window.isCustomScroll&&Object(te.restoreDocumentScroll)(),!store.mail.cur&&!store.mail.page||store.mail.cur.peerId||lt(),store.mail.cur.peerId&&ct(),$e.ready().then(ii).then(function(){oi(),store.mail.cur.peerId&&(_.default.init(),hn(0,store.mail.cur.peerId)),nav.getQuery("msg")||nav.getQuery("id")||W.scrollConvoToBottom()}),im.on(),xe||((xe=new qe.default({id:"mail_user",element:document,focusElement:window,triggerEvents:"mouseover mousedown keypress touchstart",idleTimeout:15e3})).on("unidle",Ye),xe.on("unidle",We)),Be={},xe.start(),e=qs2obj(location.search.slice(1)),store.mail.cur.mvk_entrypoint=e.mvk_entrypoint||"notifications"===e.from&&"notifications"||"",V.startPolling(),addEvent(window,"resize",et.resizePosters),window.ExperimentalBadge&&window.ExperimentalBadge.set(store.mail.cur.countUnread),Ue.onOpenCallback(ui),Ue.onCloseCallback(di))}function ei(){if(store.mail.cur){if(Ue.onOpenCallback(ui),Ue.onCloseCallback(di),!document.body.classList.contains("vk__page_mail"))return im.off(),ze(),void storeMethods.resetMail();Object(te.restoreDocumentScroll)(),W.cleanConvoBody(),im.off(),ze(),V.stopPolling(),T.cancelStatusUpdate(),d.default.resetPrevScraps(),storeMethods.resetMail()}}function ti(e){var t=e.peerId,n=store.mail.cur,i=null;if("mrs"===n.page)i="/mail?act=mrs";else if("template"===n.page)i="/mail?act=template";else if("msg"===n.page)i="/mail?act=show=peer="+t;else if(n.forwardFromId&&n.forwardFromId!==t)i="/mail?act=show&peer="+n.forwardFromId;else if(n.query){var a="msgs"===n.tab?"&tab=messages":"";i="/mail?q="+n.query+a}else if(n.peerId)i="/mail?act=show&peer="+n.peerId;else if(n.folder&&!n.forwardFromId){var o="";"all"!==n.folder&&(o="?act="+n.folder),i="/mail"+o}return i}function ni(){var e=store.mail.cur.countMR,t=store.mail.rolls.mrs;store.mail.cur.countMR=0,tt=!0,store.mail.rolls.mrs=[],t.forEach(function(e){Object(Fe.removePeer)(e)}),ajaxRequest("/mail",{act:"mrs_reject",all:!0,hash:store.mail.hash.mrs},function(n){if(n.error)return store.mail.cur.countMR=e,store.mail.rolls.mrs=t,tt=!1,void Me.cancelRejeectLoading();V.redrawView(),Lt("/mail")},function(){store.mail.cur.countMR=e,store.mail.rolls.mrs=t,tt=!1,Me.cancelRejeectLoading()})}function ii(){store.mail.cur&&Object(Fe.queueToPresendMsgs)($e.getItems())}function ai(e,t){var n=store.mail.members;(e=e.filter(function(e){return!n[e]})).length&&(at=at.concat(e),ot.push(t),rt())}function oi(){var e=store.mail,t=e.rolls,n=e.scraps,i=e.cur;t.folder.all=t.folder.all.filter(unique).sort(Nn),"all"===i.folder&&(n.folder=n.folder.filter(unique).sort(Nn),d.default.redrawFolder())}function ri(e,t){if(!e||!e.length)return null;for(var n=e.length-1;n>=0;n--)if(t(e[n],n))return e[n];return null}function si(){im.abortWaiting()}function li(e){var t=+e.getAttribute("data-msg");if(t&&!Object(ve.isForwardedMessageId)(t)&&store.mail.cur){var n=store.mail.msgs[t],i=n&&store.mail.peers[n.peerId];i&&!n.listened&&n.authorId!==store.mail.cur.viewerId&&n.peerId===store.mail.cur.peerId&&Object(ve.mailRequest)("/mail",{act:"listen_audiomsg",msg_id:t,hash:i.hashRead})}}function ci(e,t){ke.showCaptcha(e,t)}function ui(){un&&clearTimeout(un),un=setTimeout(function(){return addClass($(".messenger__layer_convo"),fi())},200)}function di(){un&&clearTimeout(un),un=setTimeout(function(){return removeClass($(".messenger__layer_convo"),fi())},200)}function fi(){return dn||(dn="messenger__layer_convo--iosKeyboard",He.isIPad&&He.isIOSChrome&&He.iosMajor>=11&&(dn="messenger__layer_convo--iosKeyboardChrome"),dn)}n.d(t,"Messenger",function(){return W});t.default=V;window.uMessenger=V,window.Messenger=W},"is+u":function(e,t){var n=need("Voting");function i(e){o(e.$voting,e.url)}function a(e,t){o(t.$voting,e,!0)}function o(e,t,i){var a=setTimeout(function(){n.setLoading(e)},140);ajax.post(t,{_ajax:1},{onDone:function(t,o){domData(e,"is-web-view")&&n._onPollChanged&&n._onPollChanged(e,i),clearTimeout(a),n.setHtml(t,o)}})}window.uVoting={},uVoting._onSubmit=i,uVoting._onRevoteClick=a},izth:function(e,t,n){"use strict";function i(){var e=(document.domain||"").match(/(m\.)?([a-zA-Z]+\.[a-zA-Z]+\.?)$/);window.locDomain="https:"===location.protocol?e[2]:e[0];var t=navigator.userAgent.toLowerCase();!/opera/i.test(t)&&/msie 6/i.test(t)&&document.domain===window.locDomain||(document.domain=window.locDomain)}n.r(t),n.d(t,"setDocumentDomain",function(){return i})},j80l:function(e,t,n){"use strict";function i(e,t){var n=need("nav");if(!t)return e;var i=e.split("?"),a=i[0],o=i[1],r={},s=[];return o&&o.split("&").map(function(e){var n=e.split("="),i=n[0],a=n[1];i in t||(t[i]=a)}),Object.keys(t).forEach(function(e){var i,a=t[e];!0===a&&(a=n.getQuery(e)),("string"==typeof(i=a)&&i||function(e){return"number"==typeof e&&!isNaN(e)}(a))&&(r[e]=a)}),Object.keys(r).forEach(function(e){s.push(e+"="+encodeURIComponent(r[e]))}),0===s.length?a:a+"?"+s.join("&")}n.r(t),n.d(t,"makeUrl",function(){return i}),n.d(t,"parseURL",function(){return o}),t.default=window.Url={make:i};var a=["protocol","hostname","host","pathname","port","search","hash","href"];function o(e){var t=window.ce("a",{href:e}),n=a.reduce(function(e,n){return e[n]=t[n],e},{});return n.requestUri=""+n.pathname+n.search,n}},kYGI:function(e,t){var n={tt:!1,handlers:[],show:function(){n.shown||(n.tt=Array.prototype.slice.call(arguments))},hide:function(){n.tt&&(n.tt=!1)},addHandler:function(e){e&&n.handlers.push(e)},removeHandler:function(e){e?each(n.handlers,function(t){if(e===this)return n.handlers.splice(t,1),!1}):n.handlers=[]},onClose:function(){each(n.handlers,function(){this()})},clear:function(){n.tt&&(n.hide(),n.onClose(),n.removeHandler())},closeByTap:function(e){if(!n.tt||!e.target)return!1;var t=e.target;do{for(var i=0;i<n.tt.length;i++)if(t===n.tt[i])return!1}while(t=t.parentNode);return n.hide(),n.onClose(),!0}};window.tooltip=n},l51W:function(e,t){var n=function(){function e(e){var t=e.closest(".si_body");return{buttons:$(".si_links",t),message:$(".si_msg",t)}}return{sendRequest:function(t,n){t&&t.preventDefault();var i=n.getAttribute("href");ActionMenu.closeMenu();var a=e(n);ajax.post(i,{_ajax:1},{onDone:function(e){!function(e){hide(e.buttons),show(e.message)}(a),val(a.message,e)}})},cancelRequest:function(t,n){t&&t.preventDefault();var i=n.getAttribute("href"),a=e(n);ajax.post(i,{_ajax:1},{onDone:function(e){}}),function(e){hide(e.message),show(e.buttons)}(a)}}}();window.GroupsInvite=n},ldCb:function(e,t){window.Informer={close:function(e){hide(e)}}},lkNA:function(e,t,n){"use strict";function i(e,t){var n,i=t.timeout,a=t.onLoad,o=t.onError,r=document.createElement("script");function s(e){r.readyState&&"loaded"!=r.readyState&&"complete"!=r.readyState||(c(),a&&a())}function l(e){c(),o&&o()}function c(){clearTimeout(n),r.removeEventListener("load",s),r.removeEventListener("readystatechange",s),r.removeEventListener("error",l)}return r.addEventListener("load",s),r.addEventListener("readystatechange",s),r.addEventListener("error",l),r.src=e,document.head.appendChild(r),i&&(n=setTimeout(l,i)),{destroy:function(){c()}}}n.r(t),n.d(t,"loadScript",function(){return i})},mXGF:function(e,t){var n,i,a,o,r,s,l,c=(n="_audioSnippet",i="audio_item",a="audioPlaylist__add_added",o="data-follow_text",r="data-unfollow_text",s="_audioPlaylistsPage__item",l="audioPlaylistsPage__item_removed",{playPause:function(e,t){preventEvent(e);var a=gpeByClass(n,t),o=geByClass1(i,a);audioplayer.playPause(e,attr(o,"data-id")),toggleClass("audioSnippet__playpause_paused",t)},followPlaylist:function(e,t){preventEvent(e);var n=geByClass1(s+attr(t,"data-playlist_owner_id")+"_"+attr(t,"data-playlist_id"));hasClass(a,t)?(t.innerText=attr(t,o),addClass(l,n)):(t.innerText=attr(t,r),removeClass(l,n)),function(e){ajax.post("/audio",{_ajax:1,act:"follow_playlist",playlist_owner_id:attr(e,"data-playlist_owner_id"),playlist_id:attr(e,"data-playlist_id"),hash:attr(e,"data-hash")},{redirectToLoginPage:!0})}(t),toggleClass(a,t)},tplSearchBlockItem:function(e){return'<div class="audioPlaylists__item">\n              <a href="'+e.href+'" class="audioPlaylists__itemLink al_playlist">'+e.title+'</a>\n              <span class="audioPlaylists__itemCover" style="'+e.thumb_style+'">'+e.grid_covers+'</span>\n              <span class="audioPlaylists__itemTitle">'+e.title+'</span>\n              <span class="audioPlaylists__itemAuthor">'+e.author_name+'</span>\n              <span class="audioPlaylists__itemStats">'+e.short_stats+"</span>\n            </div>"},tplSearchBlock:function(e,t,n,i){return e?'<div class="audioPlaylists">\n                <div class="audioPlaylists__header">\n                  <div class="audioPlaylists__cell">\n                    <div class="audioPlaylists__title">'+n+'</div>\n                  </div>\n                  <div class="audioPlaylists__cell">'+i+'</div>\n                </div>\n                <div class="audioPlaylists__body _preventMenuOpen">\n                  <div class="audioPlaylists__items">\n                    '+e+"\n                  </div>\n                </div>\n              </div>":""},tplSearchListItem:function(e,t){void 0===t&&(t=!1);var n='<div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_actions">\n                <div class="audioPlaylistsPage__menu ai_menu_wrap">\n                  <a href="#" class="ai_menu_toggle_button" onclick="ActionMenu.toggleMenu(event, this);"></a>\n                  <i class="i_pointer"></i>\n                  <div class="ai_menu wi_actions">\n                    '+e.follow_link+"\n                    "+e.publish_link+"\n                  </div>\n                </div>\n             </div>\n             "+e.actions;return t&&(n='<div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_actions">\n                   <div class="audioPlaylistsPage__menu ai_menu_wrap">\n                     <a href="#" class="ai_menu_toggle_button"></a>\n                   </div>\n                 </div>'),'<div class="audioPlaylistsPage__item _audioPlaylistsPage__item'+e.owner_id+"_"+e.id+'">\n              <div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_link">\n                <a href="'+e.href+'" class="audioPlaylistsPage__itemLink">'+e.title+'</a>\n                <span class="audioPlaylistsPage__container">\n                  <span class="audioPlaylistsPage__cell audioPlaylistsPage__cell_cover">\n                    <span class="audioPlaylistsPage__cover" style="'+e.thumb_style+'">'+e.grid_covers+'</span>\n                  </span>\n                  <span class="audioPlaylistsPage__cell audioPlaylistsPage__cell_desc">\n                    <span class="audioPlaylistsPage__title">'+e.title+'</span>\n                    <span class="audioPlaylistsPage__author">'+e.author_name+'</span>\n                    <span class="audioPlaylistsPage__stats">'+e.short_stats+"</span>\n                  </span>\n                </span>\n              </div>\n              "+n+"\n            </div>"},tplSearchListNull:function(e){return'<div class="audioPlaylistsPage__notFound">\n              '+e+"\n            </div>"},tplPlaylistsPage:function(e,t){return void 0===t&&(t=""),'<div class="PageBlock">\n              <div class="audioPlaylistsPage">\n                <div class="audioPage__search">\n                  '+t+'\n                </div>\n                <div class="audioPlaylistsPage__list _si_container" id="au_search_playlist_items">\n                  '+e+"\n                </div>\n              </div>\n            </div>"},tplPlayerSearch:function(e,t){void 0===e&&(e=""),void 0===t&&(t=!1);var n=window.lang,i=(escapeAttr(e),n.mobile_audio_search_btn,function(e,t){return void 0===e&&(e=""),void 0===t&&(t=""),'<div class="audioPage__search">\n              <div class="hp_block">\n                '+e+'\n                <div class="qsearch">\n                  <table class="row_table">\n                    <tr>\n                      <td class="row_table_main_column">\n                        <div class="qs_field_wrap">\n                          <div class="iwrap">\n                            <input id="au_search_field" type="text" class="textfield qs_textfield" name="q" placeholder="'+n.mobile_audio_search_placeholder_simple+'">\n                          </div>\n                        </div>\n                      </td>\n                      <td class="row_table_last_column">\n                        '+t+"\n                      </td>\n                    </tr>\n                  </table>\n                </div>\n              </div>\n            </div>"});return t?i():function(e,t,n){return'<form action="/audio" class="qsearch" onsubmit="return cur.au_search.go(event);">'+e(t,n)+"</form>"}(i)},copyValue:function(e,t){var n=val(e),i=ge(t+"_field");val(i,n),cur&&cur[t]&&cur[t].go();var a=geBySel1(".audioPage__tabs .tab_item_cur");a&&toggleClass("tab_item_cur_noactive",a,n)}});window.AudioPlaylist=c},myok:function(e,t,n){"use strict";n.r(t);var i=n("TYsd"),a=n("BoyB"),o={className:"Btn",setLoading:function(e,t,n){void 0===n&&(n="");if(!e)return;var i=e.classList.contains(r.loading);if(t){if(i)return;var o=e.classList.contains(r.secondary);!n&&o&&(n="white");var l=Object(a.default)({mix:r.loader,white:"white"===n,large:!0});e.classList.add(r.loading),e.insertAdjacentHTML("afterbegin",l)}else{if(!i)return;var c=e.$(s.loader);e.classList.remove(r.loading),c.remove()}},setDisabled:function(e,t){void 0===t&&(t=!0);e.disabled=t}};t.default=o,o._onClick=l;var r={loading:"Btn_loading",secondary:"Btn_theme_secondary",loader:"Btn__loader"},s={loader:"."+r.loader};function l(e,t,n){e.preventDefault(),i.default.handle(n,{$btn:t})}},nXjO:function(e,t){var n={OPEN_CLASS:"reply_owner_show",OPEN_BOTTOM_CLASS:"reply_owner_open_bottom",NO_LIMIT_CLASS:"reply_owner_picker_nolimit",CONTAINER_CLASS:"reply_owner_picker_container",PICKER_CLASS:"reply_owner_picker",PICKER_ITEM_CLASS:"reply_owner_option",LOADING_CLASS:"reply_owner_loading",IMAGE_CLASS:"_reply_owner_image",SELECTED_IMAGE_CLASS:"_reply_owner_selected_image",SELECTED_IMAGE_CONTAINER_CLASS:"reply_owner_selected_image",OPTION_CLASS:"reply_owner_option",PICKER_MAX_HEIGHT:null,LOADING_SHOW_TIME:300,container:null,picker:null,clickEvent:"ontouchend"in document.documentElement?"touchend":"click",clickHandler:null,requestHandler:null,request:null,loading:!1,setElements:function(e){this.container=gpeByClass(this.CONTAINER_CLASS,e),this.picker=geByClass1(this.PICKER_CLASS,this.container),this.clickHandler=this.clickHandler||bind(this.onDocumentClick,this),this.requestHandler=this.requestHandler||bind(this.onDocumentClickBeforeLoad,this)},unsetElements:function(){removeEvent(document.body,this.clickEvent,this.clickHandler),removeEvent(document.body,this.clickEvent,this.requestHandler),this.container=this.picker=null},show:function(e){this.setElements(e),addClass(this.OPEN_CLASS,this.container),this.calcPosition()},hide:function(){removeClass(this.OPEN_CLASS,this.container),removeClass(this.OPEN_BOTTOM_CLASS,this.container),this.unsetElements()},toggle:function(){toggleClass(this.OPEN_CLASS,this.container),this.calcPosition(),hasClass(this.OPEN_CLASS,this.container)?(this.scrollToSelected(),addEvent(document.body,this.clickEvent,this.clickHandler)):(this.hide(),this.unsetElements())},calcPosition:function(){var e=ge("mhead").offsetHeight,t=this.picker.getBoundingClientRect(),n=domClosestOverflowHidden(this.picker),i=!0;n&&n.getBoundingClientRect().bottom<this.container.getBoundingClientRect().bottom+this.PICKER_MAX_HEIGHT?i=!1:hasClass(this.LOADING_CLASS,this.container)?i=t.top-e-this.PICKER_MAX_HEIGHT+t.height<0:hasClass(this.OPEN_BOTTOM_CLASS,this.container)||(i=t.top-e<0),toggleClass(this.OPEN_BOTTOM_CLASS,this.container,i)},onDocumentClick:function(e){var t=e.target;t===this.container||gpeByClass(this.CONTAINER_CLASS,t)||this.hide()},onDocumentClickBeforeLoad:function(e){var t=e.target;t===this.container||gpeByClass(this.CONTAINER_CLASS,t)||this.cancelRequest()},cancelRequest:function(){this.request&&(this.request.abort(),this.unsetElements())},getList:function(){var e=this;if(!this.loading){this.PICKER_MAX_HEIGHT=parseInt(getStyle(this.picker,"maxHeight"),10);var t=geBySel1('input[name="from_oid"]',this.container).value,n=geBySel1('input[name="post_oid"]',this.container).value;this.loading=!0;var i=setTimeout(function(){addClass(e.LOADING_CLASS,e.container),e.calcPosition()},this.LOADING_SHOW_TIME);addEvent(document.body,this.clickEvent,this.requestHandler),this.request=ajax.post("/wall.php",{act:"get_reply_clubs_list",oid:t,post_oid:n},{onDone:function(t){clearTimeout(i),e.picker.innerHTML=t,e.onLoadEnd(),e.toggle(e.picker)},onFail:function(){e.onLoadEnd()}})}},onLoadEnd:function(){this.loading=!1,removeClass(this.LOADING_CLASS,this.container),removeEvent(document.body,this.clickEvent,this.requestHandler)},onChange:function(e){var t=gpeByClass(this.OPTION_CLASS,e),n=geByClass1(this.IMAGE_CLASS,t).src;each(geByClass(this.SELECTED_IMAGE_CLASS),function(){this.src=n}),attr(geByClass1("al"+this.SELECTED_IMAGE_CLASS),"href",attr(t,"data-href")),this.hide()},onClick:function(e){this.setElements(e),geByClass(this.PICKER_ITEM_CLASS,this.picker).length?this.toggle():this.getList()},scrollToSelected:function(){var e=gpeByClass(this.OPTION_CLASS,geBySel1(":checked",this.picker));this.PICKER_MAX_HEIGHT||(this.PICKER_MAX_HEIGHT=parseInt(getStyle(this.picker,"maxHeight"),10)),e&&(this.picker.scrollTop=e.offsetTop-this.PICKER_MAX_HEIGHT/2+e.offsetHeight/2)}};window.replyOwnerPicker=n},p5n7:function(e,t,n){"use strict";n.r(t);var i=n("z9sQ"),a=function(e){var t=e.style||[],n=e.class||e.mix,a=e.prefix,o=e.postfix,r=function(e){var t=[];isArray(e.on_key_down)?(e.on_key_down.push("event"),t=e.on_key_down):e.on_key_down&&(t=[e.on_key_down,"event"]);return{class:"TextInput__native",id:e.id,tag:"input",type:e.type,name:e.name,value:e.value,spellcheck:e.spellcheck+"",placeholder:e.placeholder,autocapitalize:!1===e.autocapitalize?"off":null,autocomplete:!1===e.autocomplete?"off":null,tabindex:e.tabindex,readonly:e.readonly,disabled:e.disabled,oninput:e.on_change,onkeydown:t,onblur:e.onblur,onfocus:e.onfocus,maxlength:e.maxlength}}(e);return{class:[i.default.class("TextInput",{style_stretch:t.stretch,prefixed:!!a,hidden:"hidden"===e.type,error:t.error}),n],tag:"label",onclick:e.on_click,inner:a||o?[a?{class:i.default.class("TextInput__prefix",{rightPadding:a.with_right_padding,gray:a.gray}),inner:a.text}:null,{class:"TextInput__nativeWrap",inner:r},o?{class:"TextInput__postfix",inner:o.text}:null]:r}};Object.assign(a,{setPrefix:function(e,t){e.$(o.prefix).innerText=t},getValue:function(e){return e.$(o.native).value}});var o={native:".TextInput__native",prefix:".TextInput__prefix"};t.default=a;window.TextInput=a},qHA9:function(e,t,n){"use strict";n.r(t),n.d(t,"MENTION_REGEXP",function(){return l}),n.d(t,"MENTION_DOMAIN_REGEXP",function(){return c}),n.d(t,"MENTION_CLIENTSIDE_REGEXP",function(){return u}),n.d(t,"UNKNOWN_ERROR",function(){return f}),n.d(t,"STICKER_HEIGHT",function(){return _}),n.d(t,"isContactPeer",function(){return p}),n.d(t,"isCommunityPeer",function(){return h}),n.d(t,"isChatPeer",function(){return m}),n.d(t,"isUser",function(){return A}),n.d(t,"formatTime",function(){return v}),n.d(t,"wrapMention",function(){return g}),n.d(t,"wrapCommunityUrl",function(){return b}),n.d(t,"sendDataToMessage",function(){return y}),n.d(t,"getMsgSendId",function(){return w}),n.d(t,"mailRequest",function(){return C}),n.d(t,"getStickerSize",function(){return k}),n.d(t,"prepareKeyboard",function(){return S}),n.d(t,"isForwardedMessageId",function(){return E});var i=n("wTgh");n.d(t,"wrapLinks",function(){return i.wrapLinks});var a,o=n("wMVj"),r=n("9M99"),s=n("OcsD"),l=/\[((id|club)\d+)\|([\S\s]+?)]/g,c=/\[((id|club)\d+)\|@([\S\s]+?)]/g,u=/\[(().+)\|([\S\s]+?)]/g,d=-180,f=10,_=128;function p(e){return e>19e8&&e<=2e9}function h(e){return e>-1e9&&e<0}function m(e){return e>2e9}function A(e){return e>0&&e<=19e8}function v(e,t){void 0===t&&(t=0);var n=new Date(1e3*e),i=n.getTimezoneOffset(),a=-t/60+d;if(i!==a){var o=60*(a-i)*1e3;n.setTime(1e3*e-o)}var r=n.getHours(),s=n.getMinutes();return r+":"+(s<10?"0":"")+s}function g(e,t){var n;return n=t?u:l,e.replace(n,function(e,t,n,i){return'<a href="/'+t+'" class="mem_link">'+i+"</a>"})}function b(e){var t=o.default.getQuery("community");return t&&(e+="&community="+t),e}function y(e,t){var n,o,s=store.mail,l=s.cur,c=s.members,u=Date.now()/1e3,d=v(u,l.timeShift),f=e.message||"";"send"!==e.act&&e.id&&(n=store.mail.msgs[e.id]),a||(a=document.createElement("div")),a.textContent=f,f=a.innerHTML,a.textContent="";var p,h={};if(e.media&&0===e.media.indexOf("sticker")){h.sticker=1;var m=+e.media.replace("sticker","");m&&(p={id:m,url:Stickers.getStickerUrl(m,k()),height:_})}else for(var A,b=1;A=e["attach"+b+"_type"];b++)h[A]?h[A]+=1:h[A]=1;o=e.attached_messages?(e.attached_messages+"").split(";"):e.mail_edit_attach_fwd&&n?n.forwards.concat():[];var y=!!e.has_reply,w="send"===e.act?"send"+e.random_id:"edit"+e.id,C=f,S=C=(C=C.replace(/\n/g,"<br>")).replace(/(@|\*)(\S+)(?: +\(([^\n]+?)\))?/g,function(e,t,n,i){i||(i=t+n);for(var a=0,o="id",r=Object.keys(c),s=0,l=r.length;s<l;s++){var u=r[s];if(c[u]&&c[u].domain===n){a=u;break}}return"-"===a[0]&&(a=a.slice(1),o="club"),"["+o+a+"|"+i+"]"});S=g(S=Object(i.wrapLinks)(S),!0),S=Object(r.emojiToHTML)(S);var E={id:"send"===e.act?w:e.id,sendId:w,peerId:"send"===e.act?e.to:e.peerId,authorId:l.viewerId,adminId:l.groupId?l.userId:void 0,ts:u,date:d,dateShort:d,text:S,textInput:f,body:C,isUnread:!n||n.isUnread,isOut:!0,edited:"send"!==e.act,canEdit:!1,attaches:h,forwards:y?[]:o,hasReply:y,reply:y?o[0]:void 0,pending:!t,failed:!!t,attachesLoading:!!Object.keys(h).length};return l.groupId&&(E.adminName=lang.mobile_mail_you,E.adminUrl=c[l.userId].url),p&&(E.sticker=p),E}function w(e){return e.edited?"edit"+e.id:"send"+e.randomId}function C(e,t){return new Promise(function(n,i){Object(s.ajaxRequest)(e,t,function(e){e.error?i({type:"server",code:e.code||0,message:e.message||""}):n(e.result)},function(e,t,n){var a=null,o="unknown",r=0;if(n instanceof XMLHttpRequest){var s=n;0===s.status?o="network":(o="server_status",r=s.status)}else 0===e&&null==t&&null==n?o="response_parsing":e===ajax.RESPONSE_CAPTCHA?(o="captcha",a=n):o="unknown";i({type:o,code:r,message:"",data:a})})})}function k(){return hasClass("x2",document.body)?2*_:_}function S(e){var t=e.keyboard,n=e.authorId,i=e.msgId;if(t.buttons&&t.buttons.length){t=Object.assign(t,{author_id:n,chat_local_id:i});var a=document.createElement("div");t.buttons.forEach(function(e){e.forEach(function(e){var t=e.action.label;a.textContent=t;var n=a.innerHTML;e.action.label=Object(r.emojiToHTML)(n),e.action.rawLabel=t})}),a=null}else t=null;return t}function E(e){return!isFinite(e)&&("string"!=typeof e||"~"!==e[0])}},"r/ag":function(e,t,n){"use strict";n.r(t);var i=n("Po+v"),a=n("1By4"),o=n("UxAg"),r=n("j80l"),s="pop_",l=200;Object.assign(i.default,{open:function(e,t,n){void 0===n&&(n={});var i=n,a=i.hash,o=i.oncloseCallback;C(e),h=Boolean(n.forceScrollDisable),t&&(e=e.cloneNode(!0),document.body.appendChild(e),e.appendedToBody=!0);e.classList.add(u.open);var r=e.$(d.scroll);y(e),o&&A.push([e,o]);if(r){if(g(e,r),e.onResizeHandler=function(){g(e,r)},addEvent(window,"resize",e.onResizeHandler),!window.MutationObserver)return e;e.scrollContentObserver=new MutationObserver(e.onResizeHandler),e.scrollContentObserver.observe(r,{childList:!0,subtree:!0})}if(a){var l="#"+s+a;nav.saveScrollPosition(),nav.set({nav:extend({},nav,{path:nav.path,push:"#"+s+a})}),m[l]=e}return e},close:b});i.default;i.default._onOverlayClick=v,i.default._onTouchMove=function(){};var c,u={popup:"Popup",open:"Popup_open",wrap:"Popup__wrap",hasScroll:"Popup_hasScroll",scrollView:"ScrollView",closing:"Popup--closing"},d={open:"."+u.open,popup:"."+u.popup,wrap:"."+u.wrap,scroll:".Popup__scroll",header:".Popup__header",footer:".Popup__footer"},f=!1,_=null,p=null,h=!1,m={},A=[];function v(e,t,n){var i=e.closest(d.popup);t&&a.default.handle(t,{$popup:i}),n&&b(i)}function g(e,t){var n=e.$(d.header),i=e.$(d.footer);t.scrollHeight-6>t.offsetHeight?(addClass(e,u.hasScroll),addClass(t,u.scrollView),ContentScrollView.restore()):(removeClass(e,u.hasScroll),removeClass(t,u.scrollView),t.scrollTop=0);var a=getCh(),o=0,r=0;n&&(o=n.offsetHeight),i&&(r=i.offsetHeight);var s=Math.min(a-o-r-100,420);setStyle(t,"max-height",s+"px")}function b(e,t){void 0===t&&(t={});var n=t.smooth;e&&!e.classList.contains(u.popup)&&(e=e.closest(d.popup)),e||(e=Object(o.$)(d.open));var i=Object(o.$)(d.wrap,e);if(n)return e.classList.add(u.closing),setStyle.transform(i,1,[0,"100%"]),setTimeout(function(){b(e,!1)},l);if(e.classList.remove(u.open),e.appendedToBody&&document.body.contains(e)&&document.body.removeChild(e),e.classList.remove(u.closing),setStyle.transform(i),removeEvent(window,"resize",e.onResizeHandler),e.scrollContentObserver&&e.scrollContentObserver.disconnect(),Object(o.$)(d.open)||w(),nav.cur&&nav.cur.startsWith("#"+s)){var a=r.default.make(nav.path,qs2obj(nav.params));nav.set({nav:extend({},nav,{cur:nav.path,path:nav.path||"",push:a||""})})}var c,f=(c=e,(A.find(function(e){return e[0]===c})||[])[1]);f&&(f(),C(e)),window.cur&&window.cur.app&&window.cur.app.frame&&window.cur.app.frame.focus()}function y(e){if(window.MutationObserver&&!f){var t=document.body;_=t.style.overflow,f=!0,browser.ios||browser.ipad||(t.style.overflow="hidden"),h&&(t.style.height="100%",document.documentElement.style.overflow="hidden"),p=new MutationObserver(function(){t.contains(e)||w()}),c=scrollTop(),document.body&&(document.body.classList.add("fixed"),setStyle(document.body,{top:"-"+c+"px"}),browser.safari&&getCw()<882&&document.scrollingElement&&(document.scrollingElement.scrollTop=c,setTimeout(function(){document.scrollingElement.scrollTop=c},100),setTimeout(function(){document.scrollingElement.scrollTop=c},300))),p.observe(document.body,{attributes:!0,childList:!0,subtree:!0})}}function w(){window.MutationObserver&&f&&(document.body.style.overflow=_,h&&(document.documentElement.style.overflow="initial"),p.disconnect(),document.body&&(document.body.classList.remove("fixed"),setStyle(document.body,{top:""}),scrollTop(c)),f=!1)}function C(e){var t=A.findIndex(function(t){return t[0]===e});t>=0&&A.splice(t,1)}nav.onPopState&&nav.onPopState(function(){var e=m[nav.cur];e&&(b(e),delete m[nav.cur])}),n.d(t,"POPUP_DISAPPEAR_TIME",function(){return l}),n.d(t,"POPUP_NAV_PREFIX",function(){return s}),window.Popup=i.default;t.default=i.default},rKUZ:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("z9sQ"),r=n("BoyB");function s(){var e=Object(i.default)(['\n    <div class="typing__dotsWrap">\n      <div class="typing__dots">...</div>\n    </div>\n  ']);return s=function(){return e},e}function l(){var e=Object(i.default)(['\n    <div class="','">\n      ','\n      <div class="typing__names">',"</div>\n      ","\n    </div>\n  "]);return l=function(){return e},e}var c=function(e){var t,n,i=e.dimmed,c=e.animation,f=!!e.compact,_=e.typingCount,p=a.default.class("typing",{dimmed:i,id:e.id,empty:u(_),animation:c}),h=d(e);"audio"===c?(t=Object(r.default)({class:o.default.class("typing__loading",{audio:!0,compact:f})}),n=""):"dots"===c?(t=Object(r.default)({class:o.default.class("typing__loading",{audio:!1,compact:f})}),n=""):"simple-dots"===c&&(t="",n=a.default.html(s()));return a.default.html(l(),p,t,h,n)};function u(e){return!e}function d(e){return"audio"===e.text?function(e,t){var n=window.lang;if(!Array.isArray(e))return e?n.mobile_mail_recaudio_1_short:"";var i=e,a=t,o="";if(1===a&&i.length>=1){var r=i[0];o=(o=n.mobile_mail_recaudio_1).replace("{name}",r)}else if(2===a&&i.length>=2){var s=i[0],l=i[1];o=(o=(o=n.mobile_mail_recaudio_2).replace("{name1}",s)).replace("{name2}",l)}else if(a>1&&i.length>=1){var c=i[0];o=(o=(o=n.mobile_mail_recaudio_many).replace("{name}",c)).replace("{count}",a-1)}else a>=1&&!i.length&&(o=langNumeric(a,n.mobile_mail_recaudio_N_unknown));return o}(e.typing,e.typingCount):"mixed"===e.text?function(e,t){var n=window.lang;if(!Array.isArray(e))return"";var i=e,a=t,o="";if(1===a&&i.length>=1)o="";else if(2===a&&i.length>=2){var r=i[0],s=i[1];o=(o=(o=n.mobile_mail_mixtyping_2).replace("{name1}",r)).replace("{name2}",s)}else if(a>1&&i.length>=1){var l=i[0];o=(o=(o=n.mobile_mail_mixtyping_many).replace("{name}",l)).replace("{count}",a-1)}else a>=1&&!i.length&&(o=langNumeric(a,n.mobile_mail_mixtyping_N_unknown));return o}(e.typing,e.typingCount):function(e,t){var n=window.lang;if(!Array.isArray(e))return e?n.mobile_mail_typing_1_short:"";var i=e,a=t,o="";if(1===a&&i.length>=1){var r=i[0];o=(o=n.mobile_mail_typing_1).replace("{name}",r)}else if(2===a&&i.length>=2){var s=i[0],l=i[1];o=(o=(o=n.mobile_mail_typing_2).replace("{name1}",s)).replace("{name2}",l)}else if(a>1&&i.length>=1){var c=i[0];o=(o=(o=n.mobile_mail_typing_many).replace("{name}",c)).replace("{count}",a-1)}else a>=1&&!i.length&&(o=langNumeric(a,n.mobile_mail_typing_N_unknown));return o}(e.typing,e.typingCount)}var f=n("UxAg");Object.assign(c,{setTyping:function(e,t){var n="string"==typeof e?Object(f.$)(".typing_id_"+e):e,i=n.$(".typing__names");n.classList.toggle("typing_empty",u(t.typingCount)),i.innerHTML=d(t)},getElem:function(e){return Object(f.$)(".typing_id_"+e)}});t.default=c;window.Typing=c,Object.assign(window,{Typing_renderNames:d,Typing_isEmpty:u})},rKp0:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("Mc5h"),r=n("O5lf"),s=n("M2vk"),l=n("5qQ6"),c=n("/Rzu"),u=n("HGMY"),d=n("TYsd");function f(){var e=Object(i.default)(['\n    <div class="mailScrap__systemMessage" ',">\n      ","\n    </div>\n  "]);return f=function(){return e},e}function _(){var e=Object(i.default)(['\n    <div class="mailScrap__empty mailScrap__empty_','">\n      ',"\n    </div>\n  "]);return _=function(){return e},e}function p(){var e=Object(i.default)(['\n    <div class="','">\n      ',"\n    </div>\n  "]);return p=function(){return e},e}function h(){var e=Object(i.default)(['\n    <div class="','">\n      ',"\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n    </div>\n  "]);return h=function(){return e},e}var m=function(e){var t=e.scrap,n="peer"===t,i=C(t),r=n?y("before"):"",l=y("after"),c=y("center"),p=function(e){var t,n=a.default.class("mailScrap__items",((t={})[e]=!0,t)),i=A(e);return Object(o.default)({mix:n,inner:i})}(t),m=function(e){var t=w(e);return a.default.html(_(),e,t)}(t),v=n?Object(s.default)():"",g=n?d.default.html(Object(u.default)()):"",b=n?(k=store.mail.cur.notification||"",S=a.default.onClick("MailScrap.clearSystemMessage2"),a.default.html(f(),S,k)):"";var k,S;return a.default.html(h(),i,r,p,m,l,g,v,b,c)};function A(e){for(var t=store.mail,n=t.cur,i=t.msgs,o=t.scraps[e],r=o.length,s=[],l=!1,c=0;c<r;c++){if(c>0&&"peer"===e&&!l){var u=i[o[c-1]],d=i[o[c]];if(d.isUnread&&!u.isUnread&&d.authorId!==n.viewerId){l=!0,s.push(v(e,o[c],!0));continue}}s.push(v(e,o[c]))}return a.default.list(s)}function v(e,t,n){void 0===n&&(n=!1);var i=store.mail.cur,a="";if("folder"===e)a="important"===i.folder?g(t):b(t);else if("search"===e){if("peers"===i.tab)a=function(e){return Object(c.default)(e)}(t);else a=g(t)}else if("peer"===e){a=function(e,t){void 0===t&&(t=!1);return Object(l.default)({msgId:e,withDivider:t})}(t,n)}else if("mrs"===e){a=b(t)}return a}function g(e){var t=store.mail.msgs[e].peerId;return Object(c.default)(t,e)}function b(e){return Object(c.default)(e,"last")}function y(e){var t,n=a.default.class("mailScrap__loading",((t={})[e]=!0,t)),i=Object(r.default)({mix:""});return a.default.html(p(),n,i)}function w(e){var t=window.lang,n=store.mail.cur,i="";switch(e){case"peer":i=t.mobile_mail_history_is_empty;break;case"mrs":i=t.mobile_mail_mrs_empty_info;break;case"folder":i={all:t.mobile_mail_no_messages,important:t.mobile_mail_no_important,unread:t.mobile_mail_no_unreaded,unrespond:t.mobile_mail_sublist_empty}[n.folder];break;case"search":"msgs"===n.tab&&(i=t.mobile_mail_not_found),"peers"===n.tab&&(i=t.mobile_mail_no_peers)}return i}function C(e){var t,n=store.mail,i=n.cur,o=n.reached,r=!0,s=!1,l=!1,c=!1;if("peer"===e){var u=i.peerId,d=n.scraps.peer,f=d.length,_=n.rolls.peer[u]||[];r=o.peer.before[u]&&d[0]===_[0],s=last(d)===last(_)&&o.peer.after[u],0===f&&(s=!0);var p=u?n.peers[u]:null;p&&(l=!!p.systemMessageCode,p.isChannel&&(c=p.ownerId!==i.viewerId))}else if("mrs"===e)s=o.mrs;else if("folder"===e)s=o.folder[i.folder];else if("search"===e){var h=i.tab;i.query;if("peers"===h){var m=n.scraps.search.length;s=o.search[i.tab][i.query]||m>0}else s=o.search[i.tab][i.query]}return a.default.class("mailScrap",((t={})[e]=!0,t.empty=function(e){var t=store.mail,n=t.cur,i=t.scraps,a=t.reached,o=!1;switch(e){case"peer":var r=n.peerId,s=t.rolls.peer[r];0===(s?s.length:0)&&a.peer.after[r]&&a.peer.before[r]&&(o=!0);break;case"mrs":0===i.mrs.length&&a.mrs&&(o=!0);break;case"folder":0===i.folder.length&&a.folder[n.folder]&&(o=!0);break;case"search":0===i.search.length&&a.search[n.tab][n.query]&&(o=!0)}return o}(e),t.systemMessage=l,t.reachedBefore=r,t.reachedAfter=s,t.tab="search"===e&&i.tab,t.isChannel=c,t))}n("+cqQ");var k=n("irqS"),S=n("BZzM"),E=(n("s0aB"),n("GR/G")),O=n.n(E);Object.assign(m,{updateClass:x,clearSystemMessage2:function(){remove(geByClass1("service_msg_box"))},onSystemMessageClick:function(){!function(){var e=store.mail,t=e.cur;e.peers[t.peerId].systemMessageCode=null,x("peer"),B()}()},resetPrevScraps:function(){T={folder:[],search:[],peer:[]}},redrawPeer:function(){M("peer",store.mail.scraps.peer),$$(".mailScrap_peer").forEach(function(e){return e.className=C("peer")}),$$(".mailScrap__empty_peer").forEach(function(e){return e.innerHTML=w("peer")})},redrawFolder:function(e){var t=store.mail,n=t.cur,i=t.scraps;n.folder;M("folder",i.folder,e),$$(".mailScrap_folder").forEach(function(e){return e.className=C("folder")}),$$(".mailScrap__empty_folder").forEach(function(e){return e.innerHTML=w("folder")})},redrawSearch:function(){$$(".mailScrap__items_search").forEach(function(e){return e.innerHTML=A("search")}),$$(".mailScrap_search").forEach(function(e){return e.className=C("search")}),$$(".mailScrap__empty_search").forEach(function(e){return e.innerHTML=w("search")})},redrawMRs:function(e){M("mrs",store.mail.scraps.mrs,e),$$(".mailScrap_mrs").forEach(function(e){return e.className=C("mrs")}),$$(".mailScrap__empty_mrs").forEach(function(e){return e.innerHTML=w("mrs")})},redrawSystemMessage:B,folderSetItems:function(e){$$(".mailScrap__items_folder").forEach(function(t){return t.innerHTML=I(e,!0)}),$$(".mailScrap_folder").forEach(function(e){return e.className=C("folder")}),$$(".mailScrap__empty_folder").forEach(function(e){return e.innerHTML=w("folder")})},folderAddItems:function(e){$$(".mailScrap__items_folder").forEach(function(t){return t.insertAdjacentHTML("beforeend",I(e))})},folderCutItems:function(e){$$(".mailScrap_folder .mailScrap__items").forEach(function(t){[].slice.call(t.children).slice(e).forEach(function(e){return t.removeChild(e)})})},peerAddElemAfter:function(e,t){var n=$(".mailScrap__items_peer");if(!n)return;var i=ceFromString(j([e],!0));n.appendChild(t),O()(t,i),x("peer")},peerAddItemsBefore:function(e,t){void 0===t&&(t=!1);x("peer"),e=e.filter(unique).filter(function(e){return!$(".msg_id_"+e)});var n=k.Messenger.getConvoBody();n.scrollHeight,n.scrollTop,n.offsetHeight;window._preventedCheckTop=!0,setTimeout(function(){return window._preventedCheckTop=!1});var i='\n    <div class="load_before load_before_closed">\n      '+j(e,t)+"\n    </div>\n  ";return $$(".mailScrap__items_peer").forEach(function(e){return e.insertAdjacentHTML("afterbegin",i)}),void uMessenger.expandPeerBefore()},peerAddItemsAfter:function(e,t,n){void 0===t&&(t=!1);e=e.filter(unique).filter(function(e){return!$(".msg_id_"+e)}),$$(".mailScrap__items_peer").forEach(function(n){n.insertAdjacentHTML("beforeend",j(e,t))}),x("peer"),Object(S.resizePosters)()},peerReplaceItems:function(e){e.forEach(function(e){var t=$(".msg_id_"+e),n=ceFromString(j([e],!0));O()(t,n)}),Object(S.resizePosters)()},peerSetItems:function(e){e=e.filter(unique),$$(".mailScrap__items_peer").forEach(function(t){return t.innerHTML=j(e)})},peerGoToBottom:function(){var e=k.Messenger.getConvoBody();e.scrollTop=e.scrollHeight},removeDivider:D,checkDivider:function(){var e=last($(".mailScrap__items_peer").children);e&&e.classList.contains("msg__newMsgsDivider")&&D()}}),uVK.onReady(function(){if(store.mail&&store.mail.scraps){var e=store.mail.scraps;T.folder=e.folder.slice(),T.search=e.search.slice(),T.peer=e.peer.slice()}});var T={folder:[],search:[],peer:[]};function D(){remove($(".msg__newMsgsDivider"))}function j(e,t){void 0===t&&(t=!1),e=e.filter(unique);var n,i=store.mail,a=i.cur,o=i.msgs,r=!!$(".msg__newMsgsDivider");return e.map(function(e,i){var s=o[e];return i>0&&!r&&!t&&!n.isUnread&&s.isUnread&&s.authorId!==a.viewerId?(n=s,r=!0,v("peer",e,!0)):(n=s,v("peer",e))}).join("")}function I(e,t){return void 0===t&&(t=!1),(e=e.filter(unique)).map(function(e){return $(".mailScrap__items_folder .convo_id_"+e)&&!t?"":v("folder",e)}).join("")}function M(e,t,n){!function(e,t,n,i){void 0===i&&(i=null);var a=[];if(!e)return;i||(e.innerHTML="",i=[]);if(0===n.length)return void(e.innerHTML="");n.forEach(function(n,a){var o=i.indexOf(n);-1===o?(i.splice(a,0,n),domInsert(e,t(n),a)):o!==a&&(i.splice(o,1),i.splice(a,0,n),before(e.children[o],e.children[a]))}),i.forEach(function(t,i){-1===n.indexOf(t)&&a.push(e.children[i])}),a.forEach(remove)}($(".mailScrap__items_"+e),function(t){return v(e,t)},t,n)}function x(e){$$(".mailScrap_"+e).forEach(function(t){return t.className=C(e)})}function B(){$$(".mailScrap__systemMessage").forEach(function(e){e.innerHTML=store.mail.cur.notification||""})}t.default=m;window.MailScrap=m},s0aB:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("Mc5h"),r=n("AXyT"),s=n("9y81"),l=n("KMpi"),c=n("rKUZ");function u(){var e=Object(i.default)(['\n    <div class="','" ',">\n      ","\n      ",'\n      <a class="convo__body" href="','">\n        <div class="convo__row convo__row_title">\n          <div class="convo__title">','</div>\n          <div class="convo__row_right">\n            ','\n            <div class="convo__date">','</div>\n          </div>\n        </div>\n        <div class="convo__row convo__row_text">\n          <div class="convo__typing">','</div>\n          <div class="convo__text">','</div>\n          <div class="convo__row_right convo__unreadBox" ',">\n            ",'\n            <div class="convo__unreadOut"></div>\n          </div>\n          <div class="convo__status">',"</div>\n        </div>\n      </a>\n    </div>\n  "]);return u=function(){return e},e}var d=function(e){var t,n,i=e.more,o="",d="",p=0,h=!1,m="";i&&(o=i.text,d=i.date,p=i.unreadCount,h=i.muted,m=i.typing?Object(c.default)(i.typing):"",t=i.pending,n=i.failed,(t||n)&&(d=""));var A=a.default.class("clickable","convo",{id:e.id,short:!i,last:e.isLast,typing:!!m,important:e.important,unread:e.isLast&&p>0,unreadOut:e.isLast&&p<0}),v=Object(l.default)({mix:"convo__avatar",photos:e.photos,url:e.profileUrl}),g=e.isLast?Object(r.default)({mix:"convo__unread",value:p,gray:h}):"",b=_({pending:t,failed:n}),y=f(e.online),w=Object(s.default)({mix:"convo__star",icon:"star",blue:!0}),C=e.url,k=a.default.onClick("Convo._onClick","event",C);return a.default.html(u(),A,k,y,v,e.url,e.title,w,d,m,o,b?"hidden":"",g,b)};function f(e){return"mobile"===e?Object(s.default)({mix:a.default.class("convo__online",{mobile:!0}),icon:"phone"}):"desktop"===e?Object(o.default)({mix:a.default.class("convo__online",{desktop:!0})}):Object(o.default)({mix:"convo__online"})}function _(e){var t=window.lang;return e.pending?'<div class="convo__pending"></div>':e.failed?'<div class="convo__failed">'+t.mobile_mail_send_error+"</div>":""}var p=n("UxAg"),h=n("+cqQ");n("jk6M");function m(e,t){e.target.closest("a.convo__avatar")||(e.stopPropagation(),e.preventDefault(),d.onTap(t))}Object.assign(d,{onTap:Object(h.default)("url"),setOnline:function(e,t){Object(p.$$)(".convo_id_"+e+" .convo__online").forEach(function(e){e.outerHTML=f(t)})},setLastMsg:function(e,t,n){var i=n.dateShort,a=n.pending,o=n.failed;Object(p.$$)(".convo_last.convo_id_"+e).forEach(function(e){e.$(".convo__text").innerHTML=t,e.$(".convo__status").innerHTML=_({pending:a,failed:o}),a||o?(e.$(".convo__date").innerText="",e.$(".convo__unreadBox").hidden=!0):(e.$(".convo__date").innerText=i,e.$(".convo__unreadBox").hidden=!1)})},setTyping:function(e,t){Object(p.$$)(".convo_last.convo_id_"+e).forEach(function(e){var n=e.$(".convo__typing"),i=t.typing;if(t.typingCount&&(!0===i||Array.isArray(i))){var a=n.$(".typing"),o=a&&q.parseClass("typing",a.className);a&&o.animation===t.animation?c.default.setTyping(a,t):(e.classList.add("convo_typing"),n.innerHTML=Object(c.default)(t))}else n.innerHTML="",e.classList.remove("convo_typing")})},setUnreadCount:function(e,t){Object(p.$$)(".convo_last.convo_id_"+e).forEach(function(e){var n=e.$(".Oval");e.classList.toggle("convo_unread",t>0),e.classList.toggle("convo_unreadOut",t<0),r.default.setValue(n,t)})},setImportant:function(e,t){Object(p.$$)(".convo_id_"+e).forEach(function(e){e.classList.toggle("convo_important",t)})}}),d._onClick=m;t.default=d;window.Convo=d,window.Convo__online=f},sc7o:function(e,t,n){"use strict";n.r(t);var i=n("+cqQ");window.uVK={onReady:Object(i.default)(),onResize:Object(i.default)(),onOrientationChange:Object(i.default)()},onDOMReady(function(){if(window.isNewMail&&document.body){uVK.onReady();var e=document.body.getAttribute("onresize"),t=document.body.getAttribute("onorientationchange");document.body.setAttribute("onresize","uVK.onResize(); "+e),document.body.setAttribute("onorientationchange","uVK.onOrientationChange(); "+t)}})},t7Ww:function(e,t,n){"use strict";n.r(t),n.d(t,"ModalMenuBtn",function(){return o});var i=n("r/ag"),a=n("29dZ");function o(e){var t=e.class?" "+e.class:"";return Object(a.default)({url:e.url,class:"ModalMenu__btn ModalMenu__item"+t,theme:e.theme?e.theme:"none",size:e.size?e.size:"",inner:e.inner,on_click:e.onclick,use_native_onclick:!0,attrs:e.attrs})}t.default=function(e){var t=e.attached?"ModalMenu--attached":"",n=window.lang,o=[];if(e.title&&o.push({class:"ModalMenu__title",inner:e.title}),e.body&&o.push({class:"ModalMenu__body",inner:e.body}),isArray(e.items)){var r=e.items.map(function(e){return e});o.push(r)}return e.close&&o.push(Object(a.default)({class:"ModalMenu__btn ModalMenu__cancel",theme:"secondary",size:"large",inner:e.closeText?e.closeText:n.mobile_cancel,on_click:e.onClose?e.onClose:["ModalMenu.close","this"],use_native_onclick:!0})),Object(i.default)({class:"ModalMenu "+e.class+" "+t,on_overlay_click_native:e.on_overlay_click?e.on_overlay_click:["ModalMenu.close","this"],content:o})}},tgcV:function(e,t,n){"use strict";function i(e){return new Promise(function(t,n){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=e,i.onload=function(){return t(i)},i.onerror=function(){return n(new Error("Stylesheet load error for "+e))},document.head.appendChild(i)})}function a(e){var t,n=(t=e,new Promise(function(e,n){var i=new XMLHttpRequest;i.open("GET",t),i.onload=function(){200===i.status?e(i.response):n(i.response)},i.onerror=function(){n(i.response)},i.send()}));return n.then(function(e){var t=document.createElement("style");t.innerHTML=e,document.head.appendChild(t)}),n}var o;n.r(t),n.d(t,"addStatic",function(){return f}),n.d(t,"preloadStaticForNavigation",function(){return _}),n.d(t,"initStaticManager",function(){return p});var r=[];function s(e,t){var n=e+"?"+t,i=new Promise(function(t,i){var a,o,r;a=n,o=function(n){n?(window.stManager.staticFiles[e]=null,i(n)):t()},(r=document.createElement("script")).src=a,r.onload=function(){return o(null,r)},r.onerror=function(){return o(new Error("Script load error for "+a))},document.head.appendChild(r)});return window.stManager.staticFiles[e]=i,i}function l(e,t){var n=(function(){if(void 0!==o)return o;try{var e=document.createElement("b");e.style.display="flex",o="flex"===e.style.display}catch(e){o=!1}return o}()?i:a)(e+"?"+t).catch(function(){return window.stManager.staticFiles[e]=null,Promise.resolve()});return window.stManager.staticFiles[e]=n,n}function c(e){window.stManager.staticFiles[e]=Promise.resolve()}function u(){window.vk&&window.vk.stFiles?(Object.keys(window.vk.stFiles).forEach(function(e){return c(e)}),window.vk.stFiles=[]):setTimeout(u,0)}function d(e){r[e]&&r[e]()}function f(e){return void 0===e&&(e={}),Promise.all(Object.keys(e).map(function(t){return n=t,i=e[t],window.stManager.staticFiles[n]||(n.includes(".js")?s(n,i):n.includes(".css")?l(n,i):Promise.resolve());var n,i}))}function _(e){var t=window.vk.stNavMap||{};for(var n in t){if(t.hasOwnProperty(n))if(new RegExp(n).test(e)){f(t[n]||{});break}}}function p(){u(),window.stManager={done:d,staticFiles:[],registerLoadedScript:c}}},"tlL+":function(e,t){window.FriendsRecommendedSlider={init:function(){window.cur&&(y($("."+p)),cur.destroy.push(function(){v=null,g=null,b=null}))},hideRecommended:function(e,t,o,r){var s=gpeByClass(a,e);if(!s)return r&&cancelEvent(r);var l=k(s),c=domData(s,"code")||domData(l,"code"),u=domData(l,"ref");!function(e){var t=k(e);remove(e),b=null,g=null,w().length||C(t)}(s);var d=n+obj2qs({act:i,hash:o,id:t,track_code:c,ref:u});return ajax.post(d,{_ajax:1}),r&&cancelEvent(r)},hideBlock:C,acceptFriend:function(e,t,n,i){if(hasClass(o,e))return i&&cancelEvent(i);var s=gpeByClass(a,e),d=k(e),f=domData(s,"code")||domData(d,"code"),p=domData(d,"ref");return addClass(r,e),lockButton(e),Friends.accept(t,n,"user_rec",0,p,f,function(t){var n=t||getLang(l);unlockButton(e),removeClass(r,e),addClass(o,e),e.textContent=n,function(e){var t=function(e){var t=domCA(e,_);if(!t)return;return geByClass1(c,t)}(e);addClass(u,t)}(e)},function(t,n){t===A&&nav.hard_go(n),removeClass(r,e),unlockButton(e)}),i&&cancelEvent(i)},onOpenUser:function(e){var t=gpeByClass(a,e);if(!t)return;var n=k(t),i=domData(t,"uid")||"",o=domData(t,"code")||domData(n,"code"),r=domData(n,"ref");FriendsStats.log(FriendsStats.EVENTS.EVENT_OPEN_USER,{uid:i,ref:r,trackCode:o})},onScroll:throttle(y,50)};var n="/friends",i="hide_possible",a="prettyCard",o="prettyCard__button_accepted",r="prettyCard__button_loading",s="recommended_carousel",l="mobile_friends_feed_recom_got_notification",c="prettyCard__closeButton",u="prettyCard__closeButton_hidden",d="Slider__line",f="Slider__scroll",_=".prettyCard",p="friendsRecommendedSliderWrap",h=500,m=3,A=2,v=null,g=null,b=null;function y(e){if(!v&&e&&(v=k(e)),v&&(v._lastScroll=v.scrollLeft,!e.ajaxIsRunning)){var t=v.scrollLeft,i=function(){if(g)return g;if(!v)return{};var e=getSize(v)[0],t=getX(v),n=w(),i=getX(n[0])-t,a=getSize(n[0])[0],o=getX(n[1])-t-i-a,r=Math.floor(a/3);return g={width:e,itemWidth:a+o,leftMargin:i,part:r,scrollWidth:v.scrollWidth}}(),a=Math.max(0,Math.floor((t-i.leftMargin)/i.itemWidth)),o=Math.max(0,Math.floor((t+i.width-i.leftMargin)/i.itemWidth));a*i.itemWidth+i.itemWidth-i.part<t&&a++,o*i.itemWidth+i.part>t+i.width&&o--;var r=w();a=Math.max(0,a),o=Math.min(r.length,o);for(var l=domData(v,"ref"),c=domData(v,"code"),u=a;u<=o;u++){var f=r[u];if(f&&!f.viewed){f.viewed=!0;var _=domData(f,"uid")||"",p=domData(f,"code")||c;FriendsStats.log(FriendsStats.EVENTS.EVENT_VIEW_USER,{uid:_,pos:u,ref:l,trackCode:p})}}!e.allLoaded&&t+i.width>=i.scrollWidth/2&&function(e){(e=k(e)).currentPage=e.currentPage||1;var t=domData(e,"next")||"";if(e.allLoaded||!t||e.currentPage++>=m)return void(e.allLoaded=!0);var i=domData(e,"code")||"",a=domData(e,"ref")||"",o=intval(domData(e,"friend-id")),r=n+obj2qs({act:s,next:t,ref:a,friendId:o,track_code:i});e.ajaxIsRunning=!0,ajax.post(r,{_ajax:1},{onDone:function(t,n){if(t){var i=geByClass1(d,e),a=cdf(t);append(a,i),g=null,b=null}domData(e,"next",n||null),e.allLoaded=!n,e.ajaxIsRunning=!1},onFail:function(){setTimeout(function(){return e.ajaxIsRunning=!1},h)}})}(e)}}function w(){return b||(v&&(b=geByClass(a,v)),b||[])}function C(e,t){var n=gpeByClass(p,e);if(!n)return t&&cancelEvent(t);var i=v;if(!i&&e&&(i=k(n)),i){var a=domData(i,"code"),o=domData(i,"ref");FriendsStats.log(FriendsStats.EVENTS.EVENT_HIDE_BLOCK,{ref:o,trackCode:a})}if(remove(n)){var r=nav.getQuery();delete r.recs,nav.go(location.pathname+obj2qs(r),!1,{replace:!0,push_only:!0})}return t&&cancelEvent(t)}function k(e){var t;return hasClass(e,f)?t=e:(t=geByClass1(f,e))||(t=gpeByClass(f,e)),t}},tqja:function(e,t){var n,i,a=(n="_locked",i={1:"SEND_EMAIL",2:"CALL_PHONE",6:"OPEN_GROUP_APP"},{processButton:function(e,t,a,o,r,s){if(void 0===s&&(s=!1),e.classList.contains(n))return!1;var l=!0;return i[t]&&(l=!1),e.classList.add(n),ajax.post("/groups",{_ajax:1,act:"proxy_cta_button",action:t,resource:a,group_id:o,hash:r},{onDone:function(){if(e.classList.remove(n),s)s();else if(l){var t=attr(e,"href");nav.go(t)}}}),!l}});window.GroupActionButton=a},u33z:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P");function o(){var e=Object(i.default)(['\n    <button type="','" class="','" ',">\n      ","\n    </button>\n  "]);return o=function(){return e},e}function r(){var e=Object(i.default)(['\n      <a class="','" href=',' target="','" ',">\n        ","\n      </a>\n    "]);return r=function(){return e},e}var s=function(e){var t=e.class?" "+e.class:"";if(t="MailButton"+t,"link"===e.type&&e.link){var n=e.link.href,i=e.link.target||"_blank";return a.default.html(r(),t,n,i,e.onClick,e.text)}var s=e.type;"button"===s&&"submit"===s||(s="button");return a.default.html(o(),s,t,e.onClick,e.text)};t.default=s;window.MailButton=s},uQjJ:function(e,t,n){"use strict";n.r(t);var i=n("4O8T"),a=n.n(i);window.EventEmitter=a.a,t.default=a.a},uo4j:function(e,t){ownerPhotoUpload.onUploadedDone(function(e){var t=geByClass1(n);if(t){var s=geByClass1(i,t),d=geByClass1(o,t),f=geByClass1(a,t),_=geByClass1(r,t);(function(e,t){if(window.Image){var n=new Image;n.onload=function(){return u(e,t)},n.src=e}else u(e,t)})(e=function(e){return e.replace(/"/g,"").replace(/'/g,"").replace(/</g,"").replace(/>/g,"")}(e),s),f&&(f.textContent=getLang(l)),d&&(d.textContent=getLang(c)),FeedAssistance.setFilled(t),remove(_)}}),FeedAssistanceStats.registerTrackingCls("feedAssistance_profilePhoto");var n="feedAssistance_profilePhoto",i="feedAssistanceProfilePhotoContent__avatar",a="feedAssistanceProfilePhotoContent__title",o="feedAssistanceProfilePhotoContent__desc",r="feedAssistance__footerButton",s="feedAssistanceProfilePhotoContent__avatar_uploaded",l="mobile_assistance_profile_photo_uploaded_title",c="mobile_assistance_profile_photo_uploaded_desc";function u(e,t){var n;t&&(addClass(s,t),setStyle(t,"background-image","url("+e+")")),n=e,geByClass("al_u"+vk.id).forEach(function(e){domData(e,"photo")&&domData(e,"photo",n);var t=geByClass1("_u"+vk.id,e);t&&"IMG"===t.tagName&&(t.src=n)})}},vOyG:function(e,t){e.exports=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","onmouseenter","onmouseleave","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur","oninput","oncontextmenu","onfocusin","onfocusout"]},vZUn:function(e,t){var n=function(){var e,t,i,a,o,r,s,l,c,u,d,f,_,p,h=1,m=!1,A={},v={},g={},b=null,y=null,w=!1,C=null,k=null,S=!0,E=0,O=!1;function T(){if(!(e=geByClass1("photo_view","m")))return nav.al_go(nav.cur),!1;if(t=geByClass1("pv_summary",e),geByClass1("photo_msg",e),d=geByClass1("pv_tag_wrap",e),o=geByClass1("pv_body",e),r=geByClass1("thumb_item",o),a=geByClass1("pv_nav",o),c=geByClass1("pv_photo_wrap",r),s="a"==tag(r)&&r,l=geByTag1("img",r),u=geByClass1("pv_footer",e),(i=geByClass1("summary_loading",t))||(i=ce("div",{innerHTML:'<i class="i_loading"></i>',className:"summary_loading"},{display:"none"}),t.appendChild(i)),m=hasClass("pv_touch_full",o),a){var n=geByClass1("pv_nav_left",a),h=geByClass1("pv_nav_z",a),A=geByClass1("pv_nav_right",a);f=geByClass1("pv_nav_link",n),p=geByClass1("pv_nav_link",h),_=geByClass1("pv_nav_link",A),attr(f,"onclick","return photo.prev(event);"),attr(_,"onclick","return photo.next(event);"),attr(s,"onclick",!m&&"return photo.next(event);"),ajax.prepare_click([f,_,s])}return removeEvent(window,"orientationchange",L),addEvent(window,"orientationchange",L),!0}function D(){var t=window.photoview;return!!t&&(!!O||(O=!0,t.onPhotoChange=function(e,t){E=e,N(e,t)},t.onUpdate=function(){},t.onClose=function(t){if(uRegisterFloatBtn.show(),!function(e){var t=qs2obj(nav.params);if(delete t.z,!e.local&&!e.crop){if(nav.tryHistoryBack())return!1;var n=nav.path+obj2qs(t)+nav.hash;nav.go(n,null,{push_only:!0})}return!0}(t))return!0;var n=qs2obj(nav.params);e&&n.list==y&&R(E,!0)},!0))}function j(e){var t=window.photoview,n=[];return each(e,function(e,t){if(!t)return!0;n.push(A[t.id]=t)}),b&&t&&t.saveSource(B(b)),n}function I(e){return A[e]||{}}function M(e,t,n){if(null!==t){v[e]||(v[e]=new Array(n||len(t))),j(t);var i=v[e];w&&i.reverse(),extend(i,t),w?(b=copy(i),i.reverse()):b=i}else delete v[e]}function x(e){if("string"!=typeof e)return e;var t=v[e]||[];return w?copy(t).reverse():t}function B(e){var t=x(e),n=new Array(t.length),i=qs2obj(nav.params);for(var a in delete i.z,t){var o=b[a],r="",s="";o.hash&&(s=obj2qs({hash:o.hash,mp4:!0})),o.isDoc?(r="doc"+o.id+s,n[a]={id:o.id,photo_url:"/"+r,src:o.original_src,isDoc:!0,hasVideo:o.hasVideo}):(r="photo"+o.id+"?list="+y+(w?"&rev=1":"")+(k?"&from="+k:""),n[a]={id:o.id,photo_url:"/"+r,like_url:"/like?act="+(o.likes_me?"del":"add")+"&object=photo"+o.id+"&from="+encodeURIComponent(r)+"&list="+y+"&hash="+o.like_hash,likes_me:o.likes_me,src:o.original_src,max_src:o.max_src,tags:o.tags,caption:o.caption,likes_cnt:o.likes_cnt,replies_cnt:o.replies_cnt,market_tags:o.market_tags})}return n}function P(e,t){for(var n in t||(t=b),t)if(b[n].id==e)return+n;return-1}function L(){nav.hash||onDOMReady(function(){if(geByClass1("photo_view")){var e=scrollTop();o&&getY(o)<e&&scrollToEl(o)}})}function R(i,a,r){var A=window.cur,v=window.lang,y=b[i],O=1==b.length;if(y){nav.hash?scrollToHash(nav.hash):L();var T={};C&&(T.list=C),w&&(T.rev=1),k&&(T.from=k);var D=obj2qs(T),j="photo"+y.id+D,I=y.photo,M=(H(i-1)||{}).id,x=(H(i+1)||{}).id;if(O||(s.href="/photo"+x+D,f&&(f.href="/photo"+M+D),_&&(_.href="/photo"+x+D),ajax.prepare_click([f,_,s])),m){var B="photo"+y.id+"/"+C+(w?"/rev":""),P=extend({},T,{z:B}),R="/photo"+y.id+obj2qs(P);if(zlayer._lastNav){var N=zlayer._lastNav;(P=qs2obj(N.params)).z=B,R=N.path+obj2qs(P)+N.hash}p&&(p.href=R),ajax.prepare_click(p),attr(p,"onclick","return photo.fullscreen('"+escapeAttr(R)+"', event);")}if(l&&l.src!=I){l.onload=null,remove(l);var F="";each(y.tags,function(e,t){if(!e||0==e)return!0;var n=t[0][0],i=t[0][1],a=t[0][2],o=t[0][3];F+='<div class="pv_tag" style="left: '+n+"%; top: "+i+"%; width: "+a+"%; height: "+o+'%;" id="pv_tag'+e+'" onclick="return photo.selectTag('+e+', event, true);"><div class="fill"></div></div>'}),val(c,'<img src="'+I+'" alt="" class="ph_img" />'+F),l=geByTag1("img",c)}toggleClass("photo_deleted",e,!!y.deleted),toggleClass("pv_one_photo",o,1==b.length),val(t,(v.mobile_photos_photo_header||"").replace("%s",E+1).replace(/%s|{count}/,b.length)),val(d,y.tag_info||"");var V="",$=(A.sticker_panel||"").split("photo-0_0").join("photo"+y.id),q=(y.comments_html||"").split("\x3c!--stickers_panel--\x3e").join($);if(y.caption&&(V+='<div class="mv_description">'+y.caption+"</div>"),y.tags_list&&(V+='<dl class="pv_tags_list si_row"><dt>'+v.mobile_photos_on_this_photo+"</dt><dd>"+y.tags_list+"</dd></dl>"),y.was_edited&&(V+='<dl class="si_row"><dt>'+v.mobile_photos_photo_was_edited+"</dt></dl>"),y.album_link&&(V+='<dl class="si_row"><dt>'+v.mobile_photos_photo_album_label+"</dt><dd>"+y.album_link+"</dd></dl>"),y.author_link&&(V+='<dl class="si_row"><dt>'+v.mobile_photos_photo_author_label+"</dt><dd>"+y.author_link+"</dd></dl>"),(y.date||y.likes||y.publish)&&(V+='<div class="vi_values">'+(y.date||"")+(y.likes||"")+(y.publish||"")+"</div>"),val(u,'<div class="like_box bl_cont"><div class="photo_msg bl_none">'+(y.deleted||"")+'</div><div class="mv_details">'+V+'</div><ul class="mv_actions">'+(y.actions||"")+'</ul></div><div class="comments_wrap bl_cont">'+q+"</div>"),post.stickersInit(),A.replyTo=0,ajax.refreshLinks(y.fv_link,y.app_link),n.closeTags(),!a){var W="/"+j;nav.go(W,null,{no_push:a,push_only:!0,replace:r}),window.isNewNavigation&&page.save(W,{st:scrollTop(),page:ge("m"),state:page.stash(),cur:window.cur,options:{replacePrevPage:!0}},!1)}}S||(U(),function(){for(var e=0,t=E+1;e<h;e++){var n=H(e+t),i=n&&n.photo;if(i&&!g[i]){var a=g[i]=new Image;a.src=i,a.onload=function(){g[i]=!0}}}}())}function N(e,t){void 0===t&&(t={});var n=t,i=n.isDoc,a=n.hash,o=n.hasVideo,r=window.photoview,s=b[e];b.length;if(s){var l=qs2obj(nav.params);if(l.z=i?"doc"+s.id+"/"+a:"photo"+s.id+"/"+C+(w?"/rev":""),t.no_open||r.open(e,B(b),{local:t.local,isDoc:i,hasVideo:o}),!t.local&&!t.crop){var c=nav.path+obj2qs(l)+nav.hash;nav.go(c,null,{no_push:t.no_push,push_only:!0,replace:t.replace,nav_init:!t.no_open,nav_incr:!0})}}t.local||t.crop||U(!0,i)}var F=!1;function H(e){return e>0?e%=b.length:e=(100*b.length+e)%b.length,b[e]}function U(e,t){if(void 0===t&&(t=!1),!F){for(var n=window.photoview,a=!1,o=1,r=0;r<5;r++){if(!(l=H(s=r+E))||!l.owner_id){a=s,o=1;break}}if(!1===a)for(r=-1;r>-3;r--){var s,l;if(!(l=H(s=r+E))||!l.owner_id){a=s,o=-1;break}}if(!1!==a){var c=H(E);if(c){F=!0,show(i);var u=window.cur,d=c.owner_id||(c.id||"").split("_")[0],f=Gif.isMp4Supports()&&c.hasVideo,_=s==E&&c.id?(t?"/doc":"/photo")+c.id+(c.hash?"?hash="+c.hash:"")+(f?"&mp4":""):"/photos.php",p={_ajax:1,oid:d,list:y,offset:a,direction:o,rev:w?1:0};u.stickers||(p.need_stickers=1),nav.getQuery("community")&&(p.community=nav.getQuery("community")),ajax.post(_,p,{onDone:function(t,a,o,r){hide(i),F=!1,o&&(u.replyNames||(u.replyNames={}),extend(u.replyNames,o)),r&&extend(u,r),M(y,t,a||b.length),e?n&&n.saveSource(B(y),!1,!0):R(E,!0)}})}}}}function V(e,t,n,i,a){if(b=[],e){var o=gpeByClass("thumbs_list",e)||gpeByClass("wiki_body",e);o&&each(geByTag("img",o),function(){var e=attr(this,"data-id"),t=attr(this,"data-src_big");if(!e||!t)return!0;var n=(t=t.split("|"))[0],i=+t[1]||0,a=+t[2]||0;b.push({id:e,original_src:n,width:i,height:a})})}b.length||b.push({id:t,original_src:!0,isDoc:n,hasVideo:i,hash:a})}function $(){addClass("pv_icons_hide",o)}return{save:j,get:I,saveSource:M,getSource:x,clear:function(){removeEvent(window,"orientationchange",L)},open:function(e,t,n,i,a){if(checkEvent(n))return!0;if(!T())return!0;if(w=!1,"/rev"==t.substr(-4)&&(t=t.slice(0,-4),w=!0),k=i||null,t)y=t;else{var o=I(e);y=o.album?"album"+o.album:""}if(C=y,b=x(y),-1===(E=P(e,b))){if(!(o=I(e)).id)return!1;b=[o],E=0}S=b.length<2,!1;var r=b[E]&&e!=b[E].id;return R(E,a&&!r,r),!1},prev:function(e){return!!checkEvent(e)||!(F&&!H(E-1))&&(!T()||(S?n.close():(--E<0&&(E=b.length-1),R(E),$(),!1)))},next:function(e){return!!checkEvent(e)||!(F&&!H(E+1))&&(!T()||!S&&(++E>=b.length&&(E=0),R(E),$(),!1))},close:function(e,t){return!!checkEvent(e)},fullscreen:function(e,t){return!!hasClass("pv_photo_tags_selected",o)||nav.go(unescapeAttr(e),t,{need_restore:!0})},showIcons:function(){var e=geByClass1("photo_view","m");if(!e)return!1;var t=geByClass1("pv_body",e);if(!t)return!1;setTimeout(function(){removeClass("pv_hidden_icons",t),setTimeout(function(){addClass("pv_icons_hide",t)},2e3)},10)},selectTag:function(e,t,n){if(n&&!hasClass("pv_photo_tags_selected",o))return!0;var i=ge("pv_tag"+e),a=geByClass1("pv_tag_selected","pv_photo_tags_wrap"),r=ge("pv_tag_label"+e),s=geByClass1("pv_tag_label_selected","pv_tags_list");return hasClass("pv_tag_selected",i)||(removeClass("pv_tag_selected",a),addClass("pv_tag_selected",i)),hasClass("pv_tag_label_selected",r)?nav.go(r,t):(removeClass("pv_tag_label_selected",s),addClass("pv_tag_label_selected",r),addClass("pv_photo_tags_selected",o),cancelEvent(t),!1)},closeTags:function(e){if(!hasClass("pv_photo_tags_selected",o))return!0;var t=geByClass1("pv_tag_selected","pv_photo_tags_wrap"),n=geByClass1("pv_tag_label_selected","pv_tags_list");return t&&removeClass("pv_tag_selected",t),n&&removeClass("pv_tag_label_selected",n),removeClass("pv_photo_tags_selected",o),cancelEvent(e),!1},init:function(e,t,i,a,o,r,s){h=isUndefined(s.preload)?1:s.preload,w=!!o,n.saveSource(e,t,i),onDOMReady(function(){n.open(a,e+(o?"/rev":""),null,r,!0)})},zopen:function(e,t,n,i,a){if(void 0===a&&(a={}),checkEvent(t))return!0;var o=a,r=o.isDoc,s=o.hasVideo,l=o.hash;if(D(),w=!1,"/rev"==i.substr(-4)&&(i=i.slice(0,-4),w=!0),delete qs2obj(nav.params).z,k=a.from||!1,i)y=i;else{var c=I(n);y=c.album?"album"+c.album:""}if(C=y,(b=x(y))[0]&&b[0].isDoc&&b[0].hasVideo!==s&&(b=[]),b.length||V(e,n,r,s,l),-1===(E=P(n,b))&&(V(e,n,r,s,l),E=P(n,b)),-1===E){if(!(c=I(n)).id)return!0;b=[c],E=0}S=b.length<2,!1;var u=b[E]&&n!=b[E].id;return N(E,{no_push:a.no_push&&!u,replace:u,local:a.local,isDoc:r,hasVideo:s,hash:l}),uRegisterFloatBtn.hide(),cancelEvent(t),!1},zclose:function(e,t){return uRegisterFloatBtn.show(),!!checkEvent(e)}}}();window.photo=n},w1QQ:function(e,t){window.FeedAssistance={hide:function(e,t,a){var s=domCA(e,o),l=hasClass(s,r);remove(s),l||function(e,t,a){var o=FeedAssistanceStats.getFromRef(e);ajax.post(n,{_ajax:1,type:t,hash:a,act:i,from:o})}(e,t,a);return!1},setFilled:function(e){var t=hasClass(e,a)?e:domCA(e,o);addClass(r,t)}};var n="/feed",i="hide_assistance",a="feedAssistance",o="."+a,r="feedAssistance_filled"},wTbK:function(e,t,n){"use strict";n.r(t);var i,a=n("t7Ww"),o=n("r/ag"),r=n("UxAg"),s=882,l=!1,c=null,u=0,d=0,f={},_=Object(r.$)(".Popup__wrap",i);function p(e,t,n,a){void 0===a&&(a={}),i=o.default.open(e,t,{hash:n}),f=a,_=Object(r.$)(".Popup__wrap",i),void 0===a.swipeDown&&(a.swipeDown=!0),a.swipeDown&&window.innerWidth<s&&(setStyle.transform(_,1,[0,0]),scrollTop(0),addEvent(_,"touchstart",m,{passive:!0}),addEvent(_,"touchmove",v,{capture:!0}),addEvent(_,"touchcancel touchend",g,{passive:!0}))}function h(e,t){void 0===t&&(t={});var n=e.closest(".ModalMenu")||e;innerWidth<s?(o.default.close(n,{smooth:!0}),t.onClose&&t.onClose()):setTimeout(function(){o.default.close(n),t.onClose&&t.onClose()}),removeEvent(_,"touchstart",m,{passive:!0}),removeEvent(_,"touchmove",v,{capture:!0}),removeEvent(_,"touchcancel touchend",g,{passive:!0}),c=null,u=0,A=!1,d=0,i=null,_=null,f={}}function m(e){if(e.touches&&e.touches.length>1)l=!1;else{var t=e.target.closest(".ScrollView")||Object(r.$)(".ScrollView",e.target);Object(r.$)(".ModalMenu").classList.contains("ModalMenu--blocked")||(c=e.touches[0],u=e.touches[0].clientY,l=!(t&&t.scrollTop>1))}}var A=!1;function v(e){if(e.touches&&e.touches.length>1)l=!1;else if(c&&l){var t=e.touches[0],n=-Math.min(0,u-t.clientY);0!==n&&(cancelEvent(e),d=n,A||(i.classList.add("ModalMenu--dragging"),A=!0),setStyle.transform(_,1,[0,n]))}}function g(){l&&(l=!1,i.classList.remove("ModalMenu--dragging"),d>_.clientHeight/3?h(i,f):(i.classList.add("ModalMenu--restore"),setStyle.transform(_,1,[0,0]),setTimeout(function(){i&&i.classList.remove("ModalMenu--restore")},200)))}addEvent(window,"keydown",function(e){var t=Object(r.$)(".ModalMenu");if(t)switch(e.keyCode){case 27:h(t,f)}}),n.d(t,"open",function(){return p}),n.d(t,"close",function(){return h}),n.d(t,"ModalMenuBtn",function(){return a.ModalMenuBtn});t.default=a.default;window.ModalMenu=a.default,extend(a.default,{open:p,close:h})},wTgh:function(e,t,n){"use strict";function i(e,t){void 0===t&&(t=0);var n=32768&t;return e=(e=e.replace(/([a-zA-Z\-_\.0-9]+@[a-zA-Z\-_0-9]+\.[a-zA-Z\-_\.0-9]+[a-zA-Z\-_0-9]+)/g,function(e){return'<a href="mailto:'+e+'">'+e+"</a>"})).replace(/(https?:\/\/)?(([A-Za-z--0-9@][A-Za-z--0-9@\-\_\.]*[A-Za-z--0-9@])(\/([A-Za-z--0-9@\-\_#%&?+\/\.=;:~]*[^\.\,;\(\)\?<\&\s:])?)?)/gi,function(){var e=arguments[3],t=arguments[2],i=arguments[0],a=arguments[1]||"http://";if(-1==e.indexOf(".")||-1!=e.indexOf(".."))return i;var o=e.split(".").pop();if(o.length>7||-1==indexOf("place,camera,info,name,academy,aero,arpa,coop,media,museum,mobi,travel,xxx,asia,biz,com,net,org,gov,mil,edu,int,tel,ac,ad,ae,af,ag,ai,al,am,an,ao,aq,ar,as,at,au,aw,ax,az,ba,bb,bd,be,bf,bg,bh,bi,bj,bm,bn,bo,br,bs,bt,bv,bw,by,bz,ca,cc,cd,cf,cg,ch,ci,ck,cl,cm,cn,co,cr,cu,cv,cx,cy,cz,de,dj,dk,dm,do,dz,ec,ee,eg,eh,er,es,et,eu,fi,fj,fk,fm,fo,fr,ga,gd,ge,gf,gg,gh,gi,gl,gm,gn,gp,gq,gr,gs,gt,gu,gw,gy,hk,hm,hn,hr,ht,hu,id,ie,il,im,in,io,iq,ir,is,it,je,jm,jo,jp,ke,kg,kh,ki,km,kn,kp,kr,kw,ky,kz,la,lb,lc,li,lk,lr,ls,lt,lu,lv,ly,ma,mc,md,me,mg,mh,mk,ml,mm,mn,mo,mp,mq,mr,ms,mt,mu,mv,mw,mx,my,mz,na,nc,ne,nf,ng,ni,nl,no,np,nr,nu,nz,om,pa,pe,pf,pg,ph,pk,pl,pm,pn,pr,ps,pt,pw,py,qa,re,ro,ru,rs,rw,sa,sb,sc,sd,se,sg,sh,si,sj,sk,sl,sm,sn,so,sr,st,su,sv,sy,sz,tc,td,tf,tg,th,tj,tk,tl,tm,tn,to,tp,tr,tt,tv,tw,tz,ua,ug,uk,um,us,uy,uz,va,vc,ve,vg,vi,vn,vu,wf,ws,ye,yt,yu,za,zm,zw,,,,,,cat,pro,local".split(","),o))return i;if(-1!=i.indexOf("@"))return i;try{i=decodeURIComponent(i)}catch(e){}return i.length>55&&(i=i.substr(0,53)+".."),i=htsc(i),!n&&e.match(/^([a-zA-Z0-9\.\_\-]+\.)?(vkontakte\.ru|vk\.com|vkadre\.ru|vshtate\.ru|userapi\.com|vk\.me)$/)?'<a href="'+(a+(t=replaceEntities(t).replace(/([^a-zA-Z0-9#%;_\-.\/?&=\[\]])/g,encodeURIComponent))).replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'">'+i+"</a>":'<a href="/away?to='+encodeURIComponent(a+replaceEntities(t))+'" target="_blank">'+i+"</a>"})}n.r(t),n.d(t,"wrapLinks",function(){return i})},wZhO:function(e,t,n){"use strict";n.r(t),t.default=function(e){void 0===e&&(e={});return{attrs:{"data-playlist-id":e.playlist_id},inner:e.inner,class:"AudioPlaylistRoot"}}},wcVR:function(e,t,n){"use strict";n.r(t);var i={_def_opts:{enableHighAccuracy:!0,maximumAge:3e5,timeout:6e4},_provider:null,initW3C:function(){i._provider=navigator.geolocation,i.getCurrentPosition=function(e,t,n){i._provider.getCurrentPosition(function(t){void 0!==t.latitude?e(extend(t,{coords:extend(t.coords||{},{latitude:t.latitude,longitude:t.longitude})})):e(t)},t,n)}},initGears:function(){var e=window.google;i._provider=e.gears.factory.create("beta.geolocation")},initSymbian:function(){var e=window.device;i._provider=e.getServiceObject("Service.Location","ILocation"),i.getCurrentPosition=function(e,t){i._provider.ILocation.GetLocation({LocationInformationClass:"BasicLocationInformation"},function(n,i,a){4==i?t({code:2,message:"Position unavailable"}):e({timestamp:null,coords:{latitude:a.ReturnValue.Latitude,longitude:a.ReturnValue.Longitude,altitude:a.ReturnValue.Altitude,heading:a.ReturnValue.Heading}})})}},initPalm:function(){i.getCurrentPosition=function(e,t,n){var i={};n&&(n.enableHighAccuracy&&1==n.enableHighAccuracy&&(i.accuracy=1),n.maximumAge&&(i.maximumAge=n.maximumAge),n.responseTime&&(n.responseTime<5?i.responseTime=1:n.responseTime<20?i.responseTime=2:i.timeout=3)),new window.Mojo.Service.Request("palm://com.palm.location",{method:"getCurrentPosition",parameters:i,onSuccess:function(t){e({timestamp:t.timestamp,coords:{latitude:t.latitude,longitude:t.longitude,heading:t.heading}})},onFailure:function(e){1==e.errorCode?t({code:3,message:"Timeout"}):2==e.errorCode?t({code:2,message:"Position unavailable"}):t({code:0,message:"Unknown Error: webOS-code"+e.errorCode})}})}},getCurrentPosition:function(e,t,n){i._provider.getCurrentPosition(e,t,extend(i._def_opts,n||{}))},init:function(){var e=window,t=e.google,n=e.device,a=e.Mojo;try{var o="undefined";if(typeof navigator.geolocation!==o)i.initW3C();else if(typeof window.google!==o&&typeof t.gears!==o)i.initGears();else if(typeof n!==o&&typeof n.getServiceObject!==o)i.initSymbian();else{if(typeof a===o||"Mojo.Service.Request"==typeof a.Service.Request)return!1;i.initPalm()}}catch(e){return!1}return!0}};window.geo=i,t.default=i},wyHI:function(e,t){var n=window,i=n.gpeByClass,a=n.hasClass,o=n.addClass,r=n.removeClass,s=n.geByClass1,l=n.setStyle,c=n.tooltip,u=n.ajax;window.Fave={showActionsTT:function(e,t){cancelEvent(t);var n=i("FaveArticles__row",e);if(a(n,"wi_actions_opened"))Fave.hideActionsTT();else{var r=s("wi_actions_wrap",n),u=s("FaveArticles__row_actions",n);l(r,"top",e.offsetTop+e.offsetHeight+"px"),o(n,"wi_actions_opened"),c.addHandler(Fave.hideActionsTT),c.show(r,u)}},hideActionsTT:function(){r("wi_actions_opened",s("wi_actions_opened")),c.hide()},removeArticle:function(e,t,n){Fave.hideActionsTT();var a=i("FaveArticles__row",e);o(a,"removed"),u.post("fave.php",{act:"defave_article",link:t,hash:n},{onFail:function(){return r(a,"removed")}})},restoreArticle:function(e,t,n){var a=i("FaveArticles__row",e);r(a,"removed"),u.post("fave.php",{act:"enfave_article",link:t,hash:n},{onFail:function(){return o(a,"removed")}})}}},xk4V:function(e,t,n){var i=n("4fRq"),a=n("I2ZF");e.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var r=(e=e||{}).random||(e.rng||i)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var s=0;s<16;++s)t[o+s]=r[s];return t||a(r)}},yuVR:function(e,t){var n=1e4,i="friendsStat.events",a="/friends",o="stats",r=null;function s(){clearTimeout(r);var e=lsGet(i)||[];if(e.length){lsSet(i);var t,n={act:o};n=extend(n,(t={},each(e,function(){t[this.type]?t[this.type].push(this.data):t[this.type]=[this.data]}),t)),ajax.post(a,n)}}window.FriendsStats={log:function(e,t){var a=function(e,t){var n=[],i=(new Date).getTime();switch(e){case FriendsStats.EVENTS.EVENT_VIEW_USER:n=[t.uid,i,t.pos,t.ref,t.blockType,t.trackCode];break;case FriendsStats.EVENTS.EVENT_HIDE_BLOCK:n=[i,t.ref,t.trackCode];break;case FriendsStats.EVENTS.EVENT_OPEN_USER:n=[t.uid,i,t.ref,t.trackCode]}return n.join("|")}(e,t);if(!a)return;var o=lsGet(i)||[];o.push({type:e,data:a}),lsSet(i,o),clearTimeout(r),r=setTimeout(s,n)},EVENTS:{EVENT_VIEW_USER:"show_user_rec",EVENT_HIDE_BLOCK:"hide_block",EVENT_OPEN_USER:"open_user"}},r=setTimeout(s,n)},z9sQ:function(e,t,n){"use strict";n.r(t);n("OcsD");var i={class:function(e,t,n){void 0===t&&(t={});void 0===n&&(n="_");var i=[e];return Object.keys(t).forEach(function(o){if(a(o)){var r=t[o];!0===r?i.push(""+e+n+o):a(r)&&i.push(""+e+n+o+n+r)}}),i.join(" ")},setMod:function(e,t,n){var i,o=new RegExp("\\s*"+t+"(_[-a-zA-Z]+)?");i=!0===n?" "+t:a(n)?" "+t+"_"+n:"";o.test(e.className)?e.className=e.className.replace(o,i):e.className+=i}};function a(e){return"number"==typeof e||"string"==typeof e&&e}t.default=i;window.Bem=i},zHNa:function(e,t){var n=need("Control"),i=need("Popup"),a={init:function(){var e=geByClass1("_adultConfirm"),t=geByClass1("_adultConfirm__submit",e),i=geByClass1("adultConfirm__checkbox",e);toggleClass("adultConfirm__submit_disabled",t,!n.isChecked(i))},toggle:function(e){var t=gpeByClass("_adultConfirm",e.$control),n=geByClass1("_adultConfirm__submit",t);toggleClass("adultConfirm__submit_disabled",n,!e.checked)},submit:function(e,t){if(cancelEvent(e),!hasClass("adultConfirm__submit_disabled",t)){var n=gpeByClass("_adultConfirm",t),a=geByClass1("_adultConfirm__form",n),o={_ajax:1};each(geByTag("input",a),function(e,t){var n=t.type.toLowerCase(),i=t.name.toLowerCase();"hidden"!==n&&"checkbox"!==n&&"radio"!==n||(o[i]=t.value)});var r=attr(a,"action");ajax.post(r,o),i.close()}},back:function(e){cancelEvent(e),window.history?window.history.back():window.location="/"}};window.AdultConfirm=a},zouF:function(e,t,n){"use strict";n.r(t),n.d(t,"Confirm",function(){return s});var i=n("OcsD"),a=n("TYsd"),o=n("Po+v"),r=n("z9sQ");function s(e,t,n,r){void 0===r&&(r={});var s=Object(i.ceFromString)(a.default.html(Object(o.default)({id:r.id,class:"Confirm",scrollable:!0,header:{title:r.title||getLang("mobile_warning_header")},content:[e,{class:"Popup__buttons",inner:[l(getLang("mobile_continue"),"regular",t),l(getLang("mobile_cancel"),"secondary",n||"Popup.close(this)")]}]})));o.default.open(s,!0)}function l(e,t,n){return{class:["Popup__button",r.default.class("Btn",{theme:t||"regular"})],tag:"button",inner:e,onclick:n}}page.onChange(function(){$$(".Confirm").forEach(function(e){return o.default.close(e)})}),window.Confirm=s}},[[6,"runtime","vendors","nav","b-3bd4c8dde30b1740bbdf8ba803505cc9"]]]);